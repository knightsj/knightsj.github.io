<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>J_Knight</title>
  <subtitle>æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://github.com/knightsj/knightsj.github.io/"/>
  <updated>2017-04-14T04:19:08.000Z</updated>
  <id>https://github.com/knightsj/knightsj.github.io/</id>
  
  <author>
    <name>J_Knight</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€ŠObjective-C é«˜çº§ç¼–ç¨‹ã€‹å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸€ï¼‰ï¼šå¼•ç”¨è®¡æ•°ç¯‡</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/04/10/%E3%80%8AObjective-C%20%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E3%80%8B%E5%B9%B2%E8%B4%A7%E4%B8%89%E9%83%A8%E6%9B%B2%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%AF%87/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/04/10/ã€ŠObjective-C é«˜çº§ç¼–ç¨‹ã€‹å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸€ï¼‰ï¼šå¼•ç”¨è®¡æ•°ç¯‡/</id>
    <published>2017-04-10T00:40:50.000Z</published>
    <updated>2017-04-14T04:19:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ€»ç»“äº†<a href="http://www.jianshu.com/nb/6074358" target="_blank" rel="external">Effective Objective-C</a>ä¹‹åï¼Œè¿˜æƒ³è¯»ä¸€æœ¬è¿›é˜¶çš„iOSä¹¦ï¼Œæ¯«ä¸çŠ¹è±«é€‰ä¸­äº†ã€ŠObjective-C é«˜çº§ç¼–ç¨‹ã€‹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-7ceabf4418ec5228.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<p>è¿™æœ¬ä¹¦æœ‰ä¸‰ä¸ªç« èŠ‚ï¼Œæˆ‘é’ˆå¯¹æ¯ä¸€ç« èŠ‚è¿›è¡Œæ€»ç»“å¹¶åŠ ä¸Šé€‚å½“çš„æ‰©å±•åˆ†äº«ç»™å¤§å®¶ã€‚å¯ä»¥ä»ä¸‹é¢è¿™å¼ å›¾æ¥çœ‹ä¸€ä¸‹è¿™ä¸‰ç¯‡çš„æ•´ä½“ç»“æ„ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-169518e948933744.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ã€‹ å¹²è´§ä¸‰éƒ¨æ›²"></p>
<p>æ³¨æ„ï¼Œè¿™ä¸ªç»“æ„å¹¶ä¸å’Œä¹¦ä¸­çš„ç»“æ„ä¸€è‡´ï¼Œè€Œæ˜¯ä»¥ä¹¦ä¸­çš„ç»“æ„ä¸ºå‚è€ƒï¼Œç¨ä½œäº†è°ƒæ•´ã€‚</p>
<p>æœ¬ç¯‡æ˜¯ç¬¬ä¸€ç¯‡ï¼šå¼•ç”¨è®¡æ•°ï¼Œç®€å•è¯´ä¸¤å¥ï¼š<br>Objective-Cé€šè¿‡ retainCount çš„æœºåˆ¶æ¥å†³å®šå¯¹è±¡æ˜¯å¦éœ€è¦é‡Šæ”¾ã€‚ æ¯æ¬¡runloopè¿­ä»£ç»“æŸåï¼Œéƒ½ä¼šæ£€æŸ¥å¯¹è±¡çš„ retainCountï¼Œå¦‚æœretainCountç­‰äº0ï¼Œå°±è¯´æ˜è¯¥å¯¹è±¡æ²¡æœ‰åœ°æ–¹éœ€è¦ç»§ç»­ä½¿ç”¨å®ƒï¼Œå¯ä»¥è¢«é‡Šæ”¾æ‰äº†ã€‚æ— è®ºæ˜¯æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œè¿˜æ˜¯ARCæœºåˆ¶ï¼Œéƒ½æ˜¯é€šè¿‡å¯¹retainCountæ¥è¿›è¡Œå†…å­˜ç®¡ç†çš„ã€‚</p>
<a id="more"></a>
<p>å…ˆçœ‹ä¸€ä¸‹æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼š</p>
<h1 id="æ‰‹åŠ¨å†…å­˜ç®¡ç†"><a href="#æ‰‹åŠ¨å†…å­˜ç®¡ç†" class="headerlink" title="æ‰‹åŠ¨å†…å­˜ç®¡ç†"></a>æ‰‹åŠ¨å†…å­˜ç®¡ç†</h1><p>æˆ‘ä¸ªäººè§‰å¾—ï¼Œå­¦ä¹ ä¸€é¡¹æ–°çš„æŠ€æœ¯ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ä¸€ä¸‹å®ƒçš„æ ¸å¿ƒæ€æƒ³ã€‚ç†è§£äº†æ ¸å¿ƒæ€æƒ³ä¹‹åï¼Œå¯¹æŠ€æœ¯ç‚¹çš„æŠŠæ¡å°±ä¼šæ›´å¿«ä¸€äº›ï¼š</p>
<h2 id="å†…å­˜ç®¡ç†çš„æ€æƒ³"><a href="#å†…å­˜ç®¡ç†çš„æ€æƒ³" class="headerlink" title="å†…å­˜ç®¡ç†çš„æ€æƒ³"></a>å†…å­˜ç®¡ç†çš„æ€æƒ³</h2><ul>
<li>æ€æƒ³ä¸€ï¼šè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰ã€‚</li>
<li>æ€æƒ³äºŒï¼šéè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰ã€‚</li>
<li>æ€æƒ³ä¸‰ï¼šä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾å¯¹è±¡ã€‚</li>
<li>æ€æƒ³å››ï¼šéè‡ªå·±æŒæœ‰çš„å¯¹è±¡æ— æ³•é‡Šæ”¾ã€‚</li>
</ul>
<p>ä»ä¸Šé¢çš„æ€æƒ³æ¥çœ‹ï¼Œæˆ‘ä»¬å¯¹å¯¹è±¡çš„æ“ä½œå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šç”Ÿæˆï¼ŒæŒæœ‰ï¼Œé‡Šæ”¾ï¼Œå†åŠ ä¸ŠåºŸå¼ƒï¼Œä¸€å…±æœ‰å››ç§ã€‚å®ƒä»¬æ‰€å¯¹åº”çš„Objective-Cçš„æ–¹æ³•å’Œå¼•ç”¨è®¡æ•°çš„å˜åŒ–æ˜¯ï¼š</p>
<table>
<thead>
<tr>
<th>å¯¹è±¡æ“ä½œ</th>
<th>Objecctive-Cæ–¹æ³•</th>
<th>å¼•ç”¨è®¡æ•°çš„å˜åŒ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡</td>
<td>alloc/new/copy/mutableCopyç­‰æ–¹æ³•</td>
<td>+1</td>
</tr>
<tr>
<td>æŒæœ‰å¯¹è±¡</td>
<td>retainæ–¹æ³•</td>
<td>+1</td>
</tr>
<tr>
<td>é‡Šæ”¾å¯¹è±¡</td>
<td>releaseæ–¹æ³•</td>
<td>-1</td>
</tr>
<tr>
<td>åºŸå¼ƒå¯¹è±¡</td>
<td>deallocæ–¹æ³•</td>
<td>æ— </td>
</tr>
</tbody>
</table>
<p>ç”¨ä¹¦ä¸­çš„å›¾æ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹è¿™å››ç§æ“ä½œï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-5ced77c57afcfab8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<p>ä¸‹é¢å¼€å§‹é€ä¸€è§£é‡Šä¸Šé¢çš„å››æ¡æ€æƒ³ï¼š</p>
<h3 id="æ€æƒ³ä¸€ï¼šè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰"><a href="#æ€æƒ³ä¸€ï¼šè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰" class="headerlink" title="æ€æƒ³ä¸€ï¼šè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰"></a>æ€æƒ³ä¸€ï¼šè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰</h3><p>åœ¨ç”Ÿæˆå¯¹è±¡æ—¶ï¼Œä½¿ç”¨ä»¥ä¸‹é¢åç§°å¼€å¤´çš„æ–¹æ³•ç”Ÿæˆå¯¹è±¡ä»¥åï¼Œå°±ä¼šæŒæœ‰è¯¥å¯¹è±¡ï¼š</p>
<ul>
<li>alloc</li>
<li>new</li>
<li>copy</li>
<li>mutableCopy</li>
</ul>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];<span class="comment">//æŒæœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡</span></div></pre></td></tr></table></figure>
<p>è¿™è¡Œä»£ç è¿‡åï¼ŒæŒ‡å‘ç”Ÿæˆå¹¶æŒæœ‰[[NSObject alloc] init]çš„æŒ‡é’ˆè¢«èµ‹ç»™äº†objï¼Œä¹Ÿå°±æ˜¯è¯´objè¿™ä¸ªæŒ‡é’ˆå¼ºå¼•ç”¨[[NSObject alloc] init]è¿™ä¸ªå¯¹è±¡ã€‚</p>
<p>åŒæ ·é€‚ç”¨äºnewæ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [<span class="built_in">NSObject</span> new];<span class="comment">//æŒæœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡</span></div></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼š<br>è¿™ç§å°†æŒæœ‰å¯¹è±¡çš„æŒ‡é’ˆèµ‹ç»™æŒ‡é’ˆå˜é‡çš„æƒ…å†µä¸åªå±€é™äºä¸Šé¢è¿™å››ç§æ–¹æ³•åç§°ï¼Œè¿˜åŒ…æ‹¬ä»¥ä»–ä»¬å¼€å¤´çš„æ‰€æœ‰æ–¹æ³•åç§°ï¼š</p>
<ul>
<li>allocThisObject</li>
<li>newThatObject</li>
<li>copyThisObject</li>
<li>mutableCopyThatObject</li>
</ul>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj1 = [obj0 allocObject];<span class="comment">//ç¬¦åˆä¸Šè¿°å‘½åè§„åˆ™ï¼Œç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡</span></div></pre></td></tr></table></figure>
<p>å®ƒçš„å†…éƒ¨å®ç°ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)allocObject</div><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];<span class="comment">//æŒæœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡</span></div><div class="line">    <span class="keyword">return</span> obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åè¿‡æ¥ï¼Œå¦‚æœä¸ç¬¦åˆä¸Šè¿°çš„å‘½åè§„åˆ™ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæŒæœ‰ç”Ÿæˆçš„å¯¹è±¡ï¼Œ<br>çœ‹ä¸€ä¸ªä¸ç¬¦åˆä¸Šè¿°å‘½åè§„åˆ™çš„è¿”å›å¯¹è±¡çš„createObjectæ–¹æ³•çš„å†…éƒ¨å®ç°ğŸŒ°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)createObject</div><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];<span class="comment">//æŒæœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡</span></div><div class="line">    [obj autorelease];<span class="comment">//å–å¾—å¯¹è±¡ï¼Œä½†è‡ªå·±ä¸æŒæœ‰</span></div><div class="line">    <span class="keyword">return</span> obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ç»ç”±è¿™ä¸ªæ–¹æ³•è¿”å›ä»¥åï¼Œæ— æ³•æŒæœ‰è¿™ä¸ªè¿”å›çš„å¯¹è±¡ã€‚å› ä¸ºè¿™é‡Œä½¿ç”¨äº†autoreleaseã€‚autoreleaseæä¾›äº†è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼šåœ¨å¯¹è±¡è¶…å‡ºå…¶æŒ‡å®šçš„ç”Ÿå­˜èŒƒå›´æ—¶èƒ½å¤Ÿè‡ªåŠ¨å¹¶æ­£ç¡®åœ°é‡Šæ”¾ï¼ˆè¯¦ç»†ä¼šåœ¨åé¢ä»‹ç»ï¼‰ã€‚</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-97b23d0108e4cadf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿæˆä¸€ä¸ªè°ƒç”¨æ–¹ä¸æŒæœ‰çš„å¯¹è±¡æ˜¯å¯ä»¥é€šè¿‡autoreleaseæ¥å®ç°çš„ï¼ˆä¾‹å¦‚NSMutableArrayçš„arrayç±»æ–¹æ³•ï¼‰ã€‚</p>
<p>æˆ‘çš„ä¸ªäººç†è§£æ˜¯ï¼šé€šè¿‡autoreleaseæ–¹æ³•ï¼Œä½¿å¯¹è±¡çš„æŒæœ‰æƒè½¬ç§»ç»™äº†è‡ªåŠ¨é‡Šæ”¾æ± ã€‚æ‰€ä»¥å®ç°äº†ï¼šè°ƒç”¨æ–¹æ‹¿åˆ°äº†å¯¹è±¡ï¼Œä½†è¿™ä¸ªå¯¹è±¡è¿˜ä¸è¢«è°ƒç”¨æ–¹æ‰€æŒæœ‰ã€‚</p>
</blockquote>
<p>ç”±è¿™ä¸ªä¸ç¬¦åˆå‘½åè§„åˆ™çš„ä¾‹å­æ¥å¼•å‡ºæ€æƒ³äºŒï¼š</p>
<h3 id="æ€æƒ³äºŒï¼šéè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰"><a href="#æ€æƒ³äºŒï¼šéè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰" class="headerlink" title="æ€æƒ³äºŒï¼šéè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰"></a>æ€æƒ³äºŒï¼šéè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰</h3><p>æˆ‘ä»¬ç°åœ¨çŸ¥é“ï¼Œä»…ä»…é€šè¿‡ä¸Šé¢é‚£ä¸ªä¸ç¬¦åˆå‘½åè§„åˆ™çš„è¿”å›å¯¹è±¡å®ä¾‹çš„æ–¹æ³•æ˜¯æ— æ³•æŒæœ‰å¯¹è±¡çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸä¸ªæ“ä½œæ¥æŒæœ‰è¿™ä¸ªè¿”å›çš„å¯¹è±¡ï¼šè¿™ä¸ªæ–¹æ³•å°±æ˜¯é€šè¿‡retainæ–¹æ³•æ¥è®©æŒ‡é’ˆå˜é‡æŒæœ‰è¿™ä¸ªæ–°ç”Ÿæˆçš„å¯¹è±¡ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [<span class="built_in">NSMutableArray</span> array];<span class="comment">//éè‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰çš„å¯¹è±¡</span></div><div class="line">[obj <span class="keyword">retain</span>];<span class="comment">//æŒæœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡</span></div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œ[NSMutableArray array]è¿”å›çš„éè‡ªå·±æŒæœ‰çš„å¯¹è±¡æ­£æ˜¯é€šè¿‡ä¸Šæ–‡ä»‹ç»è¿‡çš„autoreleaseæ–¹æ³•å®ç°çš„ã€‚æ‰€ä»¥å¦‚æœæƒ³æŒæœ‰è¿™ä¸ªå¯¹è±¡ï¼Œéœ€è¦æ‰§è¡Œretainæ–¹æ³•æ‰å¯ä»¥ã€‚</p>
</blockquote>
<h3 id="æ€æƒ³ä¸‰ï¼šä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾å¯¹è±¡"><a href="#æ€æƒ³ä¸‰ï¼šä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾å¯¹è±¡" class="headerlink" title="æ€æƒ³ä¸‰ï¼šä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾å¯¹è±¡"></a>æ€æƒ³ä¸‰ï¼šä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾å¯¹è±¡</h3><p>å¯¹è±¡çš„æŒæœ‰è€…<strong>æœ‰ä¹‰åŠ¡</strong>åœ¨ä¸å†éœ€è¦è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™<strong>ä¸»åŠ¨</strong>å°†è¿™ä¸ªå¯¹è±¡é‡Šæ”¾ã€‚æ³¨æ„ï¼Œæ˜¯<strong>æœ‰ä¹‰åŠ¡</strong>ï¼Œè€Œä¸æ˜¯æœ‰æƒåˆ©ï¼Œæ³¨æ„ä¸¤ä¸ªè¯çš„ä¸åŒã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹é‡Šæ”¾å¯¹è±¡çš„ä¾‹å­ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];<span class="comment">//æŒæœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡</span></div><div class="line">[obj doSomething];<span class="comment">//ä½¿ç”¨è¯¥å¯¹è±¡åšä¸€äº›äº‹æƒ…</span></div><div class="line">[obj release];<span class="comment">//äº‹æƒ…åšå®Œäº†ï¼Œé‡Šæ”¾è¯¥å¯¹è±¡</span></div></pre></td></tr></table></figure></p>
<p>åŒæ ·é€‚ç”¨äºéè‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰çš„å¯¹è±¡ï¼ˆå‚è€ƒæ€æƒ³äºŒï¼‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [<span class="built_in">NSMutableArray</span> array];<span class="comment">//éè‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰çš„å¯¹è±¡</span></div><div class="line">[obj <span class="keyword">retain</span>];<span class="comment">//æŒæœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡</span></div><div class="line">[obj soSomething];<span class="comment">//ä½¿ç”¨è¯¥å¯¹è±¡åšä¸€äº›äº‹æƒ…</span></div><div class="line">[obj release];<span class="comment">//äº‹æƒ…åšå®Œäº†ï¼Œé‡Šæ”¾è¯¥å¯¹è±¡</span></div></pre></td></tr></table></figure>
<blockquote>
<p><strong>å¯èƒ½é‡åˆ°çš„é¢è¯•é¢˜</strong>ï¼šè°ƒç”¨å¯¹è±¡çš„releaseæ–¹æ³•ä¼šé”€æ¯å¯¹è±¡å—ï¼Ÿ<br>ç­”æ¡ˆæ˜¯ä¸ä¼šï¼šè°ƒç”¨å¯¹è±¡çš„releaseæ–¹æ³•åªæ˜¯å°†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨-1ï¼Œå½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ä¼šè°ƒç”¨äº†å¯¹è±¡çš„dealloc æ–¹æ³•æ‰èƒ½è¿›è¡Œé‡Šæ”¾å¯¹è±¡çš„å†…å­˜ã€‚</p>
</blockquote>
<h3 id="æ€æƒ³å››ï¼šæ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡"><a href="#æ€æƒ³å››ï¼šæ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡" class="headerlink" title="æ€æƒ³å››ï¼šæ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡"></a>æ€æƒ³å››ï¼šæ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡</h3><p>åœ¨é‡Šæ”¾å¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½é‡Šæ”¾å·²ç»æŒæœ‰çš„å¯¹è±¡ï¼Œéè‡ªå·±æŒæœ‰çš„å¯¹è±¡æ˜¯ä¸èƒ½è¢«è‡ªå·±é‡Šæ”¾çš„ã€‚è¿™å¾ˆç¬¦åˆå¸¸è¯†ï¼šå°±å¥½æ¯”ä½ è‡ªå·±æ‰èƒ½ä»ä½ è‡ªå·±çš„é“¶è¡Œå¡é‡Œå–é’±ï¼Œå–åˆ«äººçš„å¡é‡Œçš„é’±æ˜¯ä¸å¯¹çš„ï¼ˆé™¤éä»–çš„é’±å½’ä½ ç®¡ã€‚ã€‚ã€‚åªæ˜¯éšä¾¿ä¸¾ä¸ªä¾‹å­ï¼‰ã€‚</p>
<h4 id="ä¸¤ç§ä¸å…è®¸çš„æƒ…å†µï¼š"><a href="#ä¸¤ç§ä¸å…è®¸çš„æƒ…å†µï¼š" class="headerlink" title="ä¸¤ç§ä¸å…è®¸çš„æƒ…å†µï¼š"></a>ä¸¤ç§ä¸å…è®¸çš„æƒ…å†µï¼š</h4><h4 id="1-é‡Šæ”¾ä¸€ä¸ªå·²ç»åºŸå¼ƒäº†çš„å¯¹è±¡"><a href="#1-é‡Šæ”¾ä¸€ä¸ªå·²ç»åºŸå¼ƒäº†çš„å¯¹è±¡" class="headerlink" title="1.  é‡Šæ”¾ä¸€ä¸ªå·²ç»åºŸå¼ƒäº†çš„å¯¹è±¡"></a>1.  é‡Šæ”¾ä¸€ä¸ªå·²ç»åºŸå¼ƒäº†çš„å¯¹è±¡</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];<span class="comment">//æŒæœ‰æ–°ç”Ÿæˆçš„å¯¹è±¡</span></div><div class="line">[obj doSomething];<span class="comment">//ä½¿ç”¨è¯¥å¯¹è±¡</span></div><div class="line">[obj release];<span class="comment">//é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œä¸å†æŒæœ‰äº†</span></div><div class="line">[obj release];<span class="comment">//é‡Šæ”¾å·²ç»åºŸå¼ƒäº†çš„å¯¹è±¡ï¼Œå´©æºƒ</span></div></pre></td></tr></table></figure>
<h4 id="2-é‡Šæ”¾è‡ªå·±ä¸æŒæœ‰çš„å¯¹è±¡"><a href="#2-é‡Šæ”¾è‡ªå·±ä¸æŒæœ‰çš„å¯¹è±¡" class="headerlink" title="2. é‡Šæ”¾è‡ªå·±ä¸æŒæœ‰çš„å¯¹è±¡"></a>2. é‡Šæ”¾è‡ªå·±ä¸æŒæœ‰çš„å¯¹è±¡</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [<span class="built_in">NSMutableArray</span> array];<span class="comment">//éè‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰çš„å¯¹è±¡</span></div><div class="line">[obj release];<span class="comment">//é‡Šæ”¾äº†éè‡ªå·±æŒæœ‰çš„å¯¹è±¡</span></div></pre></td></tr></table></figure>
<p>æ€è€ƒï¼šå“ªäº›æƒ…å†µä¼šä½¿å¯¹è±¡å¤±å»æ‹¥æœ‰è€…å‘¢ï¼Ÿ</p>
<ol>
<li>å°†æŒ‡å‘æŸå¯¹è±¡çš„æŒ‡é’ˆå˜é‡æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li>å°†æŒ‡å‘æŸå¯¹è±¡çš„æŒ‡é’ˆå˜é‡è®¾ç½®ä¸ºnilã€‚</li>
<li>å½“ç¨‹åºé‡Šæ”¾å¯¹è±¡çš„æŸä¸ªæ‹¥æœ‰è€…æ—¶ã€‚</li>
<li>ä»collectionç±»ä¸­åˆ é™¤å¯¹è±¡æ—¶ã€‚</li>
</ol>
<p>ç°åœ¨çŸ¥é“äº†å¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„å››ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å››ä¸ªæ“ä½œå¼•ç”¨è®¡æ•°çš„æ–¹æ³•ï¼š</p>
<h2 id="alloc-retain-release-deallocçš„å®ç°"><a href="#alloc-retain-release-deallocçš„å®ç°" class="headerlink" title="alloc/retain/release/deallocçš„å®ç°"></a>alloc/retain/release/deallocçš„å®ç°</h2><p>æŸç§æ„ä¹‰ä¸Šï¼ŒGNUstep å’Œ Foundation æ¡†æ¶çš„å®ç°æ˜¯ç›¸ä¼¼çš„ã€‚æ‰€ä»¥è¿™æœ¬ä¹¦çš„ä½œè€…é€šè¿‡GNUstepçš„æºç æ¥æ¨æµ‹äº†è‹¹æœCocoaæ¡†æ¶çš„å®ç°ã€‚</p>
<p>ä¸‹é¢å¼€å§‹é’ˆå¯¹æ¯ä¸€ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶ç”¨GNUstepå’Œè‹¹æœçš„å®ç°æ–¹å¼ï¼ˆè¿½è¸ªç¨‹åºçš„æ‰§è¡Œå’Œä½œè€…çš„çŒœæµ‹ï¼‰æ¥å¯¹æ¯”ä¸€ä¸‹å„è‡ªçš„å®ç°ã€‚</p>
<h3 id="GNUstepå®ç°ï¼š"><a href="#GNUstepå®ç°ï¼š" class="headerlink" title="GNUstepå®ç°ï¼š"></a>GNUstepå®ç°ï¼š</h3><h4 id="allocæ–¹æ³•"><a href="#allocæ–¹æ³•" class="headerlink" title="allocæ–¹æ³•"></a>allocæ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//GNUstep/modules/core/base/Source/NSObject.m alloc:</span></div><div class="line"></div><div class="line">+ (<span class="keyword">id</span>) alloc</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> allocWithZone: <span class="built_in">NSDefaultMallocZone</span>()];</div><div class="line">&#125;</div><div class="line"> </div><div class="line">+ (<span class="keyword">id</span>) allocWithZone: (<span class="built_in">NSZone</span>*)z</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">NSAllocateObject</span>(<span class="keyword">self</span>, <span class="number">0</span>, z);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡ŒNSAllocateObjectæ–¹æ³•åˆ†é…äº†å¯¹è±¡ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„å†…éƒ¨å®ç°ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//GNUstep/modules/core/base/Source/NSObject.m NSAllocateObject:</span></div><div class="line"></div><div class="line"><span class="keyword">struct</span> obj_layout &#123;</div><div class="line">    <span class="built_in">NSUInteger</span> retained;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="built_in">NSAllocateObject</span>(Class aClass, <span class="built_in">NSUInteger</span> extraBytes, <span class="built_in">NSZone</span> *zone)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> size = è®¡ç®—å®¹çº³å¯¹è±¡æ‰€éœ€å†…å­˜å¤§å°;</div><div class="line">    <span class="keyword">id</span> new = <span class="built_in">NSZoneMalloc</span>(zone, <span class="number">1</span>, size);<span class="comment">//è¿”å›æ–°çš„å®ä¾‹</span></div><div class="line">    memset (new, <span class="number">0</span>, size);</div><div class="line">    new = (<span class="keyword">id</span>)&amp;((obj)new)[<span class="number">1</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<ol>
<li>NSAllocateObjectå‡½æ•°é€šè¿‡NSZoneMallocå‡½æ•°æ¥åˆ†é…å­˜æ”¾å¯¹è±¡æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´ã€‚</li>
<li>obj_layoutæ˜¯ç”¨æ¥ä¿å­˜å¼•ç”¨è®¡æ•°ï¼Œå¹¶å°†å…¶å†™å…¥å¯¹è±¡å†…å­˜å¤´éƒ¨ã€‚</li>
</ol>
</blockquote>
<p>å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å¯ä»¥é€šè¿‡retainCountæ–¹æ³•æ¥å–å¾—ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">GNUstep/modules/core/base/Source/<span class="built_in">NSObject</span>.m retainCount:</div><div class="line"></div><div class="line">- (<span class="built_in">NSUInteger</span>) retainCount</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">NSExtraRefCount</span>(<span class="keyword">self</span>) + <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">inline</span> <span class="built_in">NSUInteger</span></div><div class="line"><span class="built_in">NSExtraRefCount</span>(<span class="keyword">id</span> anObject)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> ((obj_layout)anObject)[<span class="number">-1</span>].retained;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»™NSExtraRefCountä¼ å…¥anObjectä»¥åï¼Œé€šè¿‡è®¿é—®å¯¹è±¡å†…å­˜å¤´éƒ¨çš„.retainedå˜é‡ï¼Œæ¥è·å–å¼•ç”¨è®¡æ•°ã€‚</p>
<h4 id="retainæ–¹æ³•"><a href="#retainæ–¹æ³•" class="headerlink" title="retainæ–¹æ³•"></a>retainæ–¹æ³•</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">//GNUstep/modules/core/base/Source/NSObject.m retain:</div><div class="line"></div><div class="line">- (id)retain</div><div class="line">&#123;</div><div class="line">    NSIncrementExtraRefCount(self);</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">inline void NSIncrementExtraRefCount(id anObject)</div><div class="line">&#123;</div><div class="line">    //retainedå˜é‡è¶…å‡ºæœ€å¤§å€¼,æŠ›å‡ºå¼‚å¸¸</div><div class="line">    if (((obj)anObject)[-1].retained == UINT_MAX - 1)&#123;</div><div class="line">        [NSException raise: NSInternalInconsistencyException</div><div class="line">        format: @"NSIncrementExtraRefCount() asked to increment too farâ€];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    ((obj_layout)anObject)[-1].retained++;//retainedå˜é‡+1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="releaseæ–¹æ³•"><a href="#releaseæ–¹æ³•" class="headerlink" title="releaseæ–¹æ³•"></a>releaseæ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//GNUstep/modules/core/base/Source/NSObject.m release</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)release</div><div class="line">&#123;</div><div class="line">    <span class="comment">//å¦‚æœå½“å‰çš„å¼•ç”¨è®¡æ•° = 0ï¼Œè°ƒç”¨deallocå‡½æ•°</span></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">NSDecrementExtraRefCountWasZero</span>(<span class="keyword">self</span>))</div><div class="line">    &#123;</div><div class="line">        [<span class="keyword">self</span> dealloc];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="built_in">BOOL</span> <span class="built_in">NSDecrementExtraRefCountWasZero</span>(<span class="keyword">id</span> anObject)</div><div class="line">&#123;</div><div class="line">    <span class="comment">//å¦‚æœå½“å‰çš„retainedå€¼ = 0.åˆ™è¿”å›yes</span></div><div class="line">    <span class="keyword">if</span> (((obj)anObject)[<span class="number">-1</span>].retained == <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//å¦‚æœå¤§äº0ï¼Œåˆ™-1ï¼Œå¹¶è¿”å›NO</span></div><div class="line">    ((obj)anObject)[<span class="number">-1</span>].retained--;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="deallocæ–¹æ³•"><a href="#deallocæ–¹æ³•" class="headerlink" title="deallocæ–¹æ³•"></a>deallocæ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//GNUstep/modules/core/base/Source/NSObject.m dealloc</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>) dealloc</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSDeallocateObject</span> (<span class="keyword">self</span>);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="built_in">NSDeallocateObject</span>(<span class="keyword">id</span> anObject)</div><div class="line">&#123;</div><div class="line">    obj_layout o = &amp;((obj_layout)anObject)[<span class="number">-1</span>];</div><div class="line">    free(o);<span class="comment">//é‡Šæ”¾</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ€»ç»“ä¸€ä¸‹ä¸Šé¢çš„å‡ ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>Objective-Cå¯¹è±¡ä¸­ä¿å­˜ç€å¼•ç”¨è®¡æ•°è¿™ä¸€æ•´æ•°å€¼ã€‚</li>
<li>è°ƒç”¨allocæˆ–è€…retainæ–¹æ³•åï¼Œå¼•ç”¨è®¡æ•°+1ã€‚</li>
<li>è°ƒç”¨releaseåï¼Œå¼•ç”¨è®¡æ•°-1ã€‚</li>
<li>å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œè°ƒç”¨deallocæ–¹æ³•åºŸå¼ƒå¯¹è±¡ã€‚</li>
</ul>
<p>ä¸‹é¢çœ‹ä¸€ä¸‹è‹¹æœçš„å®ç°ï¼š</p>
<h3 id="è‹¹æœçš„å®ç°"><a href="#è‹¹æœçš„å®ç°" class="headerlink" title="è‹¹æœçš„å®ç°"></a>è‹¹æœçš„å®ç°</h3><h4 id="allocæ–¹æ³•-1"><a href="#allocæ–¹æ³•-1" class="headerlink" title="allocæ–¹æ³•"></a>allocæ–¹æ³•</h4><p>é€šè¿‡åœ¨NSObjectç±»çš„allocç±»æ–¹æ³•ä¸Šè®¾ç½®æ–­ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰§è¡Œæ‰€è°ƒç”¨çš„å‡½æ•°ï¼š</p>
<ul>
<li>+alloc</li>
<li>+allocWithZone:</li>
<li>class_createInstance//ç”Ÿæˆå®ä¾‹</li>
<li>calloc//åˆ†é…å†…å­˜å—</li>
</ul>
<p>retainCount:</p>
<ul>
<li>__CFdoExternRefOperation</li>
<li>CFBasicHashGetCountOfKey</li>
</ul>
<h4 id="retainæ–¹æ³•-1"><a href="#retainæ–¹æ³•-1" class="headerlink" title="retainæ–¹æ³•"></a>retainæ–¹æ³•</h4><ul>
<li>__CFdoExternRefOperation</li>
<li>CFBasicHashAddValue</li>
</ul>
<h4 id="releaseæ–¹æ³•-1"><a href="#releaseæ–¹æ³•-1" class="headerlink" title="releaseæ–¹æ³•"></a>releaseæ–¹æ³•</h4><ul>
<li>__CFdoExternRefOperation</li>
<li>CFBasicHashRemoveValue</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–ä»¬éƒ½è°ƒç”¨äº†ä¸€ä¸ªå…±åŒçš„ __CFdoExternRefOperation æ–¹æ³•ã€‚</p>
<p>çœ‹ä¸€ä¸‹å®ƒçš„å®ç°ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __CFDoExternRefOperation(uintptr_t op, <span class="keyword">id</span> obj) &#123;</div><div class="line"></div><div class="line">    <span class="built_in">CFBasicHashRef</span> table = å–å¾—å¯¹è±¡çš„æ•£åˆ—è¡¨(obj);</div><div class="line">    <span class="keyword">int</span> count;</div><div class="line"> </div><div class="line">    <span class="keyword">switch</span> (op) &#123;</div><div class="line">    <span class="keyword">case</span> OPERATION_retainCount:</div><div class="line">        count = <span class="built_in">CFBasicHashGetCountOfKey</span>(table, obj);</div><div class="line">        <span class="keyword">return</span> count;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line"></div><div class="line">    <span class="keyword">case</span> OPERATION_retain:</div><div class="line">        count = <span class="built_in">CFBasicHashAddValue</span>(table, obj);</div><div class="line">        <span class="keyword">return</span> obj;</div><div class="line">    </div><div class="line">    <span class="keyword">case</span> OPERATION_release:</div><div class="line">        count = <span class="built_in">CFBasicHashRemoveValue</span>(table, obj);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> == count;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œ__CFDoExternRefOperationé€šè¿‡switchè¯­å¥ é’ˆå¯¹ä¸åŒçš„æ“ä½œæ¥è¿›è¡Œå…·ä½“çš„æ–¹æ³•è°ƒç”¨ï¼Œå¦‚æœ op æ˜¯ OPERATION_retainï¼Œå°±å»æ‰ç”¨å…·ä½“å®ç° retain çš„æ–¹æ³•ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>å¯ä»¥çŒœæƒ³ä¸Šå±‚çš„retainCount,retain,releaseæ–¹æ³•çš„å®ç°ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSUInteger</span>)retainCount</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="built_in">NSUInteger</span>)____CFDoExternRefOperation(OPERATION_retainCount,<span class="keyword">self</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)<span class="keyword">retain</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="keyword">id</span>)____CFDoExternRefOperation(OPERATION_retain,<span class="keyword">self</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//è¿™é‡Œè¿”å›å€¼åº”è¯¥æ˜¯idï¼ŒåŸä¹¦è¿™é‡Œåº”è¯¥æ˜¯é”™äº†</span></div><div class="line">- (<span class="keyword">id</span>)release</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="keyword">id</span>)____CFDoExternRefOperation(OPERATION_release,<span class="keyword">self</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹switché‡Œé¢æ¯ä¸ªè¯­å¥é‡Œçš„æ‰§è¡Œå‡½æ•°åç§°ï¼Œä¼¼ä¹å’Œæ•£åˆ—è¡¨ï¼ˆHashï¼‰æœ‰å…³ï¼Œè¿™è¯´æ˜è‹¹æœå¯¹å¼•ç”¨è®¡æ•°çš„ç®¡ç†åº”è¯¥æ˜¯é€šè¿‡æ•£åˆ—è¡¨æ¥æ‰§è¡Œçš„ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-46b607c905f2355d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<p>åœ¨è¿™å¼ è¡¨é‡Œï¼Œkeyä¸ºå†…å­˜å—åœ°å€ï¼Œè€Œå¯¹åº”çš„å€¼ä¸ºå¼•ç”¨è®¡æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¿å­˜äº†è¿™æ ·çš„ä¿¡æ¯ï¼šä¸€äº›è¢«å¼•ç”¨çš„å†…å­˜å—å„è‡ªå¯¹åº”çš„å¼•ç”¨è®¡æ•°ã€‚</p>
<p>é‚£ä¹ˆä½¿ç”¨æ•£åˆ—è¡¨æ¥ç®¡ç†å†…å­˜æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p>
<p>å› ä¸ºè®¡æ•°è¡¨ä¿å­˜å†…å­˜å—åœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™å¼ è¡¨æ¥ï¼š</p>
<ul>
<li>ç¡®è®¤æŸåå†…å­˜å—çš„ä½ç½®ã€‚</li>
<li>åœ¨æ£€æµ‹å†…å­˜æ³„æ¼æ—¶ï¼Œå¯ä»¥æŸ¥çœ‹å„å¯¹è±¡çš„æŒæœ‰è€…æ˜¯å¦å­˜åœ¨ã€‚</li>
</ul>
<h2 id="autorelease"><a href="#autorelease" class="headerlink" title="autorelease"></a>autorelease</h2><h3 id="autorelease-ä»‹ç»"><a href="#autorelease-ä»‹ç»" class="headerlink" title="autorelease ä»‹ç»"></a>autorelease ä»‹ç»</h3><p>å½“å¯¹è±¡è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶ï¼Œå¯¹è±¡å®ä¾‹çš„releaseæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œautoreleaseçš„å…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”Ÿæˆå¹¶æŒæœ‰NSAutoreleasePoolå¯¹è±¡ã€‚</li>
<li>è°ƒç”¨å·²åˆ†é…å¯¹è±¡çš„autoreleaseæ–¹æ³•ã€‚</li>
<li>åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡ã€‚</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-e4e905eeda890869.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<p>æ‰€æœ‰è°ƒç”¨è¿‡autoreleaseæ–¹æ³•çš„å¯¹è±¡ï¼Œåœ¨åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡æ—¶ï¼Œéƒ½å°†è°ƒç”¨releaseæ–¹æ³•ï¼ˆå¼•ç”¨è®¡æ•°-1ï¼‰ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</div><div class="line"><span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line">[obj autorelease];</div><div class="line">[pool drain];<span class="comment">//ç›¸å½“äºobjè°ƒç”¨releaseæ–¹æ³•</span></div></pre></td></tr></table></figure></p>
<p>NSRunLoopåœ¨æ¯æ¬¡å¾ªç¯è¿‡ç¨‹ä¸­ï¼ŒNSAutoreleasePoolå¯¹è±¡éƒ½ä¼šè¢«ç”Ÿæˆæˆ–åºŸå¼ƒã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰å¤§é‡çš„autoreleaseå˜é‡ï¼Œåœ¨NSAutoreleasePoolå¯¹è±¡åºŸå¼ƒä¹‹å‰ï¼ˆä¸€æ—¦ç›‘å¬åˆ°RunLoopå³å°†è¿›å…¥ç¡çœ ç­‰å¾…çŠ¶æ€ï¼Œå°±é‡Šæ”¾NSAutoreleasePoolï¼‰ï¼Œéƒ½ä¸ä¼šè¢«é”€æ¯ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æ¿€å¢çš„é—®é¢˜:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; imageArray.count; i++)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UIImage</span> *image = imageArray[i];</div><div class="line">    [image doSomething];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-0a9bf49d47a0e3a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æœ‰å¿…è¦åœ¨é€‚å½“çš„æ—¶å€™å†åµŒå¥—ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± æ¥ç®¡ç†ä¸´æ—¶ç”Ÿæˆçš„autoreleaseå˜é‡ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; imageArray.count; i++)</div><div class="line">&#123;</div><div class="line">    <span class="comment">//ä¸´æ—¶pool</span></div><div class="line">    <span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</div><div class="line">    <span class="built_in">UIImage</span> *image = imageArray[i];</div><div class="line">    [image doSomething];</div><div class="line">    [pool drain];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-157c469ad6fff139.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<blockquote>
<p>å¯èƒ½ä¼šå‡ºçš„é¢è¯•é¢˜ï¼šä»€ä¹ˆæ—¶å€™ä¼šåˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼Ÿ<br>ç­”ï¼šè¿è¡Œå¾ªç¯æ£€æµ‹åˆ°äº‹ä»¶å¹¶å¯åŠ¨åï¼Œå°±ä¼šåˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œè€Œä¸”å­çº¿ç¨‹çš„ runloop é»˜è®¤æ˜¯ä¸å·¥ä½œçš„ï¼Œæ— æ³•ä¸»åŠ¨åˆ›å»ºï¼Œå¿…é¡»æ‰‹åŠ¨åˆ›å»ºã€‚<br>ä¸¾ä¸ªğŸŒ°ï¼š<br>è‡ªå®šä¹‰çš„ NSOperation ç±»ä¸­çš„ main æ–¹æ³•é‡Œå°±å¿…é¡»æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± ã€‚å¦åˆ™åœ¨å‡ºäº†ä½œç”¨åŸŸä»¥åï¼Œè‡ªåŠ¨é‡Šæ”¾å¯¹è±¡ä¼šå› ä¸ºæ²¡æœ‰è‡ªåŠ¨é‡Šæ”¾æ± å»å¤„ç†è‡ªå·±è€Œé€ æˆå†…å­˜æ³„éœ²ã€‚</p>
</blockquote>
<h3 id="autoreleaseå®ç°"><a href="#autoreleaseå®ç°" class="headerlink" title="autoreleaseå®ç°"></a>autoreleaseå®ç°</h3><p>å’Œä¸Šæ–‡ä¸€æ ·ï¼Œæˆ‘ä»¬è¿˜æ˜¯é€šè¿‡GNUstepå’Œè‹¹æœçš„å®ç°æ¥åˆ†åˆ«çœ‹ä¸€ä¸‹ã€‚</p>
<h4 id="GNUstep-å®ç°"><a href="#GNUstep-å®ç°" class="headerlink" title="GNUstep å®ç°"></a>GNUstep å®ç°</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//GNUstep/modules/core/base/Source/NSObject.m autorelease</span></div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)autorelease</div><div class="line">&#123;</div><div class="line">    [<span class="built_in">NSAutoreleasePool</span> addObject:<span class="keyword">self</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœè°ƒç”¨NSObjectç±»çš„autoreleaseæ–¹æ³•ï¼Œåˆ™è¯¥å¯¹è±¡å°±ä¼šè¢«è¿½åŠ åˆ°æ­£åœ¨ä½¿ç”¨çš„NSAutoreleasePoolå¯¹è±¡ä¸­çš„æ•°ç»„é‡Œï¼ˆä½œè€…å‡æƒ³äº†ä¸€ä¸ªç®€åŒ–çš„æºä»£ç ï¼‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//GNUstep/modules/core/base/Source/NSAutoreleasePool.m addObject</span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)addObject:(<span class="keyword">id</span>)anObj</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSAutoreleasePool</span> *pool = å–å¾—æ­£åœ¨ä½¿ç”¨çš„<span class="built_in">NSAutoreleasePool</span>å¯¹è±¡</div><div class="line">    <span class="keyword">if</span> (pool != <span class="literal">nil</span>)&#123;</div><div class="line">        [pool addObject:anObj];</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"NSAutoreleasePoolå¯¹è±¡ä¸å­˜åœ¨"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)addObject:(<span class="keyword">id</span>)anObj</div><div class="line">&#123;</div><div class="line">    [pool.array addObject:anObj];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œautoreleaseå®ä¾‹æ–¹æ³•çš„æœ¬è´¨å°±æ˜¯è°ƒç”¨NSAutoreleasePoolå¯¹è±¡çš„addObjectç±»æ–¹æ³•ï¼Œç„¶åè¿™ä¸ªå¯¹è±¡å°±è¢«è¿½åŠ åˆ°æ­£åœ¨ä½¿ç”¨çš„NSAutoreleasePoolå¯¹è±¡ä¸­çš„æ•°ç»„é‡Œã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸‹NSAutoreleasePoolçš„drainæ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drain</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span> dealloc];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)dealloc</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span> emptyPool];</div><div class="line">    [array release];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)emptyPool</div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">id</span> obj <span class="keyword">in</span> array)&#123;</div><div class="line">        [obj release];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨emptyPoolæ–¹æ³•é‡Œï¼Œç¡®å®æ˜¯å¯¹æ•°ç»„é‡Œæ¯ä¸€ä¸ªå¯¹è±¡è¿›è¡Œäº†releaseæ“ä½œã€‚</p>
<h4 id="è‹¹æœçš„å®ç°-1"><a href="#è‹¹æœçš„å®ç°-1" class="headerlink" title="è‹¹æœçš„å®ç°"></a>è‹¹æœçš„å®ç°</h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡objc4/NSObject.mmæ¥ç¡®è®¤è‹¹æœä¸­autoreleaseçš„å®ç°ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">objc4/<span class="built_in">NSObject</span>.mm AutoreleasePoolPage</div><div class="line"> </div><div class="line"><span class="keyword">class</span> AutoreleasePoolPage</div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> *push()</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//ç”Ÿæˆæˆ–è€…æŒæœ‰ NSAutoreleasePool ç±»å¯¹è±¡</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> pop(<span class="keyword">void</span> *token)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//åºŸå¼ƒ NSAutoreleasePool ç±»å¯¹è±¡</span></div><div class="line">        releaseAll();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">id</span> autorelease(<span class="keyword">id</span> obj)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//ç›¸å½“äº NSAutoreleasePool ç±»çš„ addObject ç±»æ–¹æ³•</span></div><div class="line">        AutoreleasePoolPage *page = å–å¾—æ­£åœ¨ä½¿ç”¨çš„ AutoreleasePoolPage å®ä¾‹;</div><div class="line">       autoreleaesPoolPage-&gt;add(obj)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">id</span> *add(<span class="keyword">id</span> obj)</div><div class="line">    &#123;   </div><div class="line">        <span class="comment">//å°†å¯¹è±¡è¿½åŠ åˆ°å†…éƒ¨æ•°ç»„ä¸­</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> releaseAll()</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//è°ƒç”¨å†…éƒ¨æ•°ç»„ä¸­å¯¹è±¡çš„ release æ–¹æ³•</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//å‹æ ˆ</span></div><div class="line"><span class="keyword">void</span> *objc_autoreleasePoolPush(<span class="keyword">void</span>)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (UseGC) <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">return</span> AutoreleasePoolPage::push();</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="comment">//å‡ºæ ˆ</span></div><div class="line"><span class="keyword">void</span> objc_autoreleasePoolPop(<span class="keyword">void</span> *ctxt)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (UseGC) <span class="keyword">return</span>;</div><div class="line">    AutoreleasePoolPage::pop(ctxt);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ¥çœ‹ä¸€ä¸‹å¤–éƒ¨çš„è°ƒç”¨ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</div><div class="line"><span class="comment">// ç­‰åŒäº objc_autoreleasePoolPush</span></div><div class="line"> </div><div class="line"><span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line">[obj autorelease];</div><div class="line"><span class="comment">// ç­‰åŒäº objc_autorelease(obj)</span></div><div class="line"> </div><div class="line">[<span class="built_in">NSAutoreleasePool</span> showPools];</div><div class="line"><span class="comment">// æŸ¥çœ‹ NSAutoreleasePool çŠ¶å†µ</span></div><div class="line"> </div><div class="line">[pool drain];</div><div class="line"><span class="comment">// ç­‰åŒäº objc_autoreleasePoolPop(pool)</span></div></pre></td></tr></table></figure>
<p>çœ‹å‡½æ•°åå°±å¯ä»¥çŸ¥é“ï¼Œå¯¹autoreleaseåˆ†åˆ«æ‰§è¡Œpushã€popæ“ä½œã€‚é”€æ¯å¯¹è±¡æ—¶æ‰§è¡Œreleaseæ“ä½œã€‚</p>
<blockquote>
<p><strong>å¯èƒ½å‡ºç°çš„é¢è¯•é¢˜ï¼šè‹¹æœæ˜¯å¦‚ä½•å®ç°autoreleasepoolçš„ï¼Ÿ</strong><br>autoreleasepoolä»¥ä¸€ä¸ªé˜Ÿåˆ—æ•°ç»„çš„å½¢å¼å®ç°,ä¸»è¦é€šè¿‡ä¸‹åˆ—ä¸‰ä¸ªå‡½æ•°å®Œæˆ.<br>â€¢    objc_autoreleasepoolPushï¼ˆå‹å…¥ï¼‰<br>â€¢    objc_autoreleasepoolPopï¼ˆå¼¹å‡ºï¼‰<br>â€¢    objc_autoreleaseï¼ˆé‡Šæ”¾å†…éƒ¨ï¼‰</p>
</blockquote>
<h1 id="ARCå†…å­˜ç®¡ç†"><a href="#ARCå†…å­˜ç®¡ç†" class="headerlink" title="ARCå†…å­˜ç®¡ç†"></a>ARCå†…å­˜ç®¡ç†</h1><h2 id="å†…å­˜ç®¡ç†çš„æ€æƒ³-1"><a href="#å†…å­˜ç®¡ç†çš„æ€æƒ³-1" class="headerlink" title="å†…å­˜ç®¡ç†çš„æ€æƒ³"></a>å†…å­˜ç®¡ç†çš„æ€æƒ³</h2><p>ä¸Šé¢å­¦ä¹ äº†éARCæœºåˆ¶ä¸‹çš„æ‰‹åŠ¨ç®¡ç†å†…å­˜æ€æƒ³ï¼Œé’ˆå¯¹å¼•ç”¨è®¡æ•°çš„æ“ä½œå’Œè‡ªåŠ¨é‡Šæ”¾æ± çš„ç›¸å…³å†…å®¹ã€‚ç°åœ¨å­¦ä¹ ä¸€ä¸‹åœ¨ARCæœºåˆ¶ä¸‹çš„ç›¸å…³çŸ¥è¯†ã€‚</p>
<p>ARCå’ŒéARCæœºåˆ¶ä¸‹çš„å†…å­˜ç®¡ç†æ€æƒ³æ˜¯ä¸€è‡´çš„ï¼š</p>
<ul>
<li>è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰ã€‚</li>
<li>éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰ã€‚</li>
<li>ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾å¯¹è±¡ã€‚</li>
<li>éè‡ªå·±æŒæœ‰çš„å¯¹è±¡æ— æ³•é‡Šæ”¾ã€‚</li>
</ul>
<p>åœ¨ARCæœºåˆ¶ä¸‹ï¼Œç¼–è¯‘å™¨å°±å¯ä»¥è‡ªåŠ¨è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå‡å°‘äº†å¼€å‘çš„å·¥ä½œé‡ã€‚ä½†æˆ‘ä»¬æœ‰æ—¶ä»éœ€è¦å››ç§æ‰€æœ‰æƒä¿®é¥°ç¬¦æ¥é…åˆARCæ¥è¿›è¡Œå†…å­˜ç®¡ç†</p>
<h2 id="å››ç§æ‰€æœ‰æƒä¿®é¥°ç¬¦"><a href="#å››ç§æ‰€æœ‰æƒä¿®é¥°ç¬¦" class="headerlink" title="å››ç§æ‰€æœ‰æƒä¿®é¥°ç¬¦"></a>å››ç§æ‰€æœ‰æƒä¿®é¥°ç¬¦</h2><p>ä½†æ˜¯ï¼Œåœ¨ARCæœºåˆ¶ä¸‹æˆ‘ä»¬æœ‰çš„æ—¶å€™éœ€è¦è¿½åŠ æ‰€æœ‰æƒå£°æ˜(ä»¥ä¸‹å†…å®¹æ‘˜è‡ªå®˜æ–¹æ–‡æ¡£)ï¼š</p>
<ul>
<li><strong>__strong</strong>ï¼šis the default. An object remains â€œaliveâ€ as long as there is a strong pointer to it.</li>
<li><strong>__weak</strong>ï¼šspecifies a reference that does not keep the referenced object alive. A weak reference is set to nil when there are no strong references to the object.</li>
<li><strong>__unsafe_unretained</strong>ï¼šspecifies a reference that does not keep the referenced object alive and is not set to nil when there are no strong references to the object. If the object it references is deallocated, the pointer is left dangling.</li>
<li><strong>__autoreleasing</strong>ï¼šis used to denote arguments that are passed by reference (id *) and are autoreleased on return.</li>
</ul>
<p>ä¸‹é¢åˆ†åˆ«è®²è§£ä¸€ä¸‹è¿™å‡ ä¸ªä¿®é¥°ç¬¦ï¼š</p>
<h3 id="strongä¿®é¥°ç¬¦"><a href="#strongä¿®é¥°ç¬¦" class="headerlink" title="__strongä¿®é¥°ç¬¦"></a>__strongä¿®é¥°ç¬¦</h3><p>__strongä¿®é¥°ç¬¦ æ˜¯idç±»å‹å’Œå¯¹è±¡ç±»å‹é»˜è®¤çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼š</p>
<h4 id="strongä½¿ç”¨æ–¹æ³•ï¼š"><a href="#strongä½¿ç”¨æ–¹æ³•ï¼š" class="headerlink" title="__strongä½¿ç”¨æ–¹æ³•ï¼š"></a>__strongä½¿ç”¨æ–¹æ³•ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [<span class="built_in">NSObject</span> alloc] init];</div></pre></td></tr></table></figure>
<p>ç­‰åŒäºï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj = [<span class="built_in">NSObject</span> alloc] init];</div></pre></td></tr></table></figure></p>
<p>çœ‹ä¸€ä¸‹å†…å­˜ç®¡ç†çš„è¿‡ç¨‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> __<span class="keyword">strong</span> obj = [<span class="built_in">NSObject</span> alloc] init];<span class="comment">//objæŒæœ‰å¯¹è±¡</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//objè¶…å‡ºå…¶ä½œç”¨åŸŸï¼Œå¼ºå¼•ç”¨å¤±æ•ˆ</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>__strongä¿®é¥°ç¬¦è¡¨ç¤ºå¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚æŒæœ‰å¼ºå¼•ç”¨çš„å˜é‡åœ¨è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶è¢«åºŸå¼ƒã€‚</p>
</blockquote>
<p>åœ¨__strongä¿®é¥°ç¬¦ä¿®é¥°çš„å˜é‡ä¹‹é—´ç›¸äº’èµ‹å€¼çš„æƒ…å†µï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj0 = [[<span class="built_in">NSObject</span> alloc] init];<span class="comment">//obj0 æŒæœ‰å¯¹è±¡A</span></div><div class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj1 = [[<span class="built_in">NSObject</span> alloc] init];<span class="comment">//obj1 æŒæœ‰å¯¹è±¡B</span></div><div class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj2 = <span class="literal">nil</span>;<span class="comment">//ojb2ä¸æŒæœ‰ä»»ä½•å¯¹è±¡</span></div><div class="line">obj0 = obj1;<span class="comment">//obj0å¼ºå¼•ç”¨å¯¹è±¡Bï¼›è€Œå¯¹è±¡Aä¸å†è¢«ojb0å¼•ç”¨ï¼Œè¢«åºŸå¼ƒ</span></div><div class="line">obj2 = obj0;<span class="comment">//obj2å¼ºå¼•ç”¨å¯¹è±¡Bï¼ˆç°åœ¨obj0ï¼Œojb1ï¼Œobj2éƒ½å¼ºå¼•ç”¨å¯¹è±¡Bï¼‰</span></div><div class="line">obj1 = <span class="literal">nil</span>;<span class="comment">//obj1ä¸å†å¼ºå¼•ç”¨å¯¹è±¡B</span></div><div class="line">obj0 = <span class="literal">nil</span>;<span class="comment">//obj0ä¸å†å¼ºå¼•ç”¨å¯¹è±¡B</span></div><div class="line">obj2 = <span class="literal">nil</span>;<span class="comment">//obj2ä¸å†å¼ºå¼•ç”¨å¯¹è±¡Bï¼Œä¸å†æœ‰ä»»ä½•å¼ºå¼•ç”¨å¼•ç”¨å¯¹è±¡Bï¼Œå¯¹è±¡Bè¢«åºŸå¼ƒ</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>è€Œä¸”ï¼Œ<strong>strongå¯ä»¥ä½¿ä¸€ä¸ªå˜é‡åˆå§‹åŒ–ä¸ºnilï¼šid </strong>strong obj0;<br>åŒæ ·é€‚ç”¨äºï¼šid <strong>weak obj1; id </strong>autoreleasing obj2;</p>
</blockquote>
<p>åšä¸ªæ€»ç»“ï¼šè¢«__strongä¿®é¥°åï¼Œç›¸å½“äºå¼ºå¼•ç”¨æŸä¸ªå¯¹è±¡ã€‚å¯¹è±¡ä¸€æ—¦æœ‰ä¸€ä¸ªå¼ºå¼•ç”¨å¼•ç”¨è‡ªå·±ï¼Œå¼•ç”¨è®¡æ•°å°±ä¼š+1ï¼Œå°±ä¸ä¼šè¢«ç³»ç»ŸåºŸå¼ƒã€‚è€Œè¿™ä¸ªå¯¹è±¡å¦‚æœä¸å†è¢«å¼ºå¼•ç”¨çš„è¯ï¼Œå°±ä¼šè¢«ç³»ç»ŸåºŸå¼ƒã€‚</p>
<h4 id="strongå†…éƒ¨å®ç°ï¼š"><a href="#strongå†…éƒ¨å®ç°ï¼š" class="headerlink" title="__strongå†…éƒ¨å®ç°ï¼š"></a>__strongå†…éƒ¨å®ç°ï¼š</h4><p>ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> __<span class="keyword">strong</span> obj = [<span class="built_in">NSObject</span> alloc] init];<span class="comment">//objæŒæœ‰å¯¹è±¡</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç¼–è¯‘å™¨çš„æ¨¡æ‹Ÿä»£ç ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = objc_mesgSend(<span class="built_in">NSObject</span>, <span class="keyword">@selector</span>(alloc));</div><div class="line">objc_msgSend(obj,<span class="keyword">@selector</span>(init));</div><div class="line">objc_release(obj);<span class="comment">//è¶…å‡ºä½œç”¨åŸŸï¼Œé‡Šæ”¾å¯¹è±¡</span></div></pre></td></tr></table></figure></p>
<p>å†çœ‹ä¸€ä¸‹ä½¿ç”¨å‘½åè§„åˆ™ä»¥å¤–çš„æ„é€ æ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> __<span class="keyword">strong</span> obj = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç¼–è¯‘å™¨çš„æ¨¡æ‹Ÿä»£ç ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = objc_msgSend(<span class="built_in">NSMutableArray</span>, <span class="keyword">@selector</span>(array));</div><div class="line">objc_retainAutoreleasedReturnValue(obj);</div><div class="line">objc_release(obj);</div></pre></td></tr></table></figure></p>
<blockquote>
<p>objc_retainAutoreleasedReturnValueçš„ä½œç”¨ï¼šæŒæœ‰å¯¹è±¡ï¼Œå°†å¯¹è±¡æ³¨å†Œåˆ°autoreleasepoolå¹¶è¿”å›ã€‚</p>
</blockquote>
<p>åŒæ ·ä¹Ÿæœ‰objc_autoreleaseReturnValueï¼Œæ¥çœ‹ä¸€ä¸‹å®ƒçš„ä½¿ç”¨ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">id</span>)array</div><div class="line">&#123;</div><div class="line">   <span class="keyword">return</span> [[<span class="built_in">NSMutableArray</span> alloc] init];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç¼–è¯‘å™¨çš„æ¨¡æ‹Ÿä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">id</span>)array</div><div class="line">&#123;</div><div class="line">   <span class="keyword">id</span> obj = objc_msgSend(<span class="built_in">NSMutableArray</span>, <span class="keyword">@selector</span>(alloc));</div><div class="line">   objc_msgSend(obj,, <span class="keyword">@selector</span>(init));</div><div class="line">   <span class="keyword">return</span> objc_autoreleaseReturnValue(obj);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>objc_autoreleaseReturnValue:è¿”å›æ³¨å†Œåˆ°autoreleasepoolçš„å¯¹è±¡ã€‚</p>
</blockquote>
<h3 id="weakä¿®é¥°ç¬¦"><a href="#weakä¿®é¥°ç¬¦" class="headerlink" title="__weakä¿®é¥°ç¬¦"></a>__weakä¿®é¥°ç¬¦</h3><h4 id="weakä½¿ç”¨æ–¹æ³•ï¼š"><a href="#weakä½¿ç”¨æ–¹æ³•ï¼š" class="headerlink" title="__weakä½¿ç”¨æ–¹æ³•ï¼š"></a>__weakä½¿ç”¨æ–¹æ³•ï¼š</h4><p>__weakä¿®é¥°ç¬¦å¤§å¤šè§£å†³çš„æ˜¯å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡éƒ½äº’ç›¸å¼ºå¼•ç”¨å¯¹æ–¹ï¼ŒåŒæ—¶éƒ½å¤±å»äº†å¤–éƒ¨å¯¹è‡ªå·±çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆâ€œå­¤å²›â€ï¼Œè¿™ä¸ªå­¤å²›å°†æ°¸è¿œæ— æ³•è¢«é‡Šæ”¾ï¼Œä¸¾ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Test</span>:<span class="title">NSObject</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> __<span class="keyword">strong</span> obj_;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span> __<span class="keyword">strong</span>)obj;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Test</span></span></div><div class="line">- (<span class="keyword">id</span>)init</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span> __<span class="keyword">strong</span>)obj</div><div class="line">&#123;</div><div class="line">    obj_ = obj;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> test0 = [[Test alloc] init];<span class="comment">//test0å¼ºå¼•ç”¨å¯¹è±¡A</span></div><div class="line">    <span class="keyword">id</span> test1 = [[Test alloc] init];<span class="comment">//test1å¼ºå¼•ç”¨å¯¹è±¡B</span></div><div class="line">    [test0 setObject:test1];<span class="comment">//test0å¼ºå¼•ç”¨å¯¹è±¡B</span></div><div class="line">    [test1 setObject:test0];<span class="comment">//test1å¼ºå¼•ç”¨å¯¹è±¡A</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å› ä¸ºç”Ÿæˆå¯¹è±¡ï¼ˆç¬¬ä¸€ï¼Œç¬¬äºŒè¡Œï¼‰å’Œsetæ–¹æ³•ï¼ˆç¬¬ä¸‰ï¼Œç¬¬å››è¡Œï¼‰éƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥ä¼šé€ æˆä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼ºå¼•ç”¨å¯¹æ–¹çš„æƒ…å†µï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-f2164aea2490deac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æ‰“ç ´å…¶ä¸­ä¸€ç§å¼ºå¼•ç”¨ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Test</span>:<span class="title">NSObject</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> __<span class="keyword">weak</span> obj_;<span class="comment">//ç”±__strongå˜æˆäº†__weak</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span> __<span class="keyword">strong</span>)obj;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>è¿™æ ·ä¸€æ¥ï¼ŒäºŒè€…å°±åªæ˜¯å¼±å¼•ç”¨å¯¹æ–¹äº†ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-98777f8ef5bbfc13.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<h4 id="weakå†…éƒ¨å®ç°"><a href="#weakå†…éƒ¨å®ç°" class="headerlink" title="__weakå†…éƒ¨å®ç°"></a>__weakå†…éƒ¨å®ç°</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> __<span class="keyword">weak</span> obj1 = obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¼–è¯‘å™¨çš„æ¨¡æ‹Ÿä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj1;</div><div class="line">objc_initWeak(&amp;obj1,obj);<span class="comment">//åˆå§‹åŒ–é™„æœ‰__weakçš„å˜é‡</span></div><div class="line"><span class="keyword">id</span> tmp = objc_loadWeakRetained(&amp;obj1);<span class="comment">//å–å‡ºé™„æœ‰__weakä¿®é¥°ç¬¦å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡å¹¶retain</span></div><div class="line">objc_autorelease(tmp);<span class="comment">//å°†å¯¹è±¡æ³¨å†Œåˆ°autoreleasepoolä¸­</span></div><div class="line">objc_destroyWeak(&amp;obj1);<span class="comment">//é‡Šæ”¾é™„æœ‰__weakçš„å˜é‡</span></div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ç¡®è®¤äº†<strong>weakçš„ä¸€ä¸ªåŠŸèƒ½ï¼šä½¿ç”¨é™„æœ‰</strong>weakä¿®é¥°ç¬¦çš„å˜é‡ï¼Œå³æ˜¯ä½¿ç”¨æ³¨å†Œåˆ°autoreleasepoolä¸­çš„å¯¹è±¡ã€‚</p>
</blockquote>
<p>è¿™é‡Œéœ€è¦ç€é‡è®²è§£ä¸€ä¸‹objc_initWeakæ–¹æ³•å’Œobjc_destroyWeakæ–¹æ³•ï¼š</p>
<ul>
<li>objc_initWeak:åˆå§‹åŒ–é™„æœ‰__weakçš„å˜é‡ï¼Œå…·ä½“é€šè¿‡æ‰§è¡Œobjc_strongWeak(&amp;obj1, obj)æ–¹æ³•ï¼Œå°†objå¯¹è±¡ä»¥&amp;obj1ä½œä¸ºkeyæ”¾å…¥ä¸€ä¸ªweakè¡¨ï¼ˆHashï¼‰ä¸­ã€‚</li>
<li>objc_destroyWeakï¼šé‡Šæ”¾é™„æœ‰__weakçš„å˜é‡ã€‚å…·ä½“é€šè¿‡æ‰§è¡Œobjc_storeWeak(&amp;obj1,0)æ–¹æ³•ï¼Œåœ¨weakè¡¨ä¸­æŸ¥è¯¢&amp;obj1è¿™ä¸ªé”®ï¼Œå°†è¿™ä¸ªé”®ä»weakè¡¨ä¸­åˆ é™¤ã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šå› ä¸ºåŒä¸€ä¸ªå¯¹è±¡å¯ä»¥èµ‹å€¼ç»™å¤šä¸ªé™„æœ‰__weakçš„å˜é‡ä¸­ï¼Œæ‰€ä»¥å¯¹äºåŒä¸€ä¸ªé”®å€¼ï¼Œå¯ä»¥æ³¨å†Œå¤šä¸ªå˜é‡çš„åœ°å€ã€‚</p>
</blockquote>
<p>å½“ä¸€ä¸ªå¯¹è±¡ä¸å†è¢«ä»»ä½•äººæŒæœ‰ï¼Œåˆ™éœ€è¦é‡Šæ”¾å®ƒï¼Œè¿‡ç¨‹ä¸ºï¼š</p>
<ul>
<li>objc_dealloc</li>
<li>dealloc</li>
<li>_objc_rootDealloc</li>
<li>objc_dispose</li>
<li>objc_destructInstance</li>
<li>objc_clear_deallocating<ul>
<li>ä»weakè¡¨ä¸­è·å–åºŸå¼ƒå¯¹è±¡çš„åœ°å€</li>
<li>å°†åŒ…å«åœ¨è®°å½•ä¸­çš„æ‰€æœ‰é™„æœ‰__weakä¿®é¥°ç¬¦å˜é‡çš„åœ°å€èµ‹å€¼ä¸ºnil</li>
<li>ä»weakè¡¨ä¸­åˆ é™¤è¯¥è®°å½•</li>
<li>ä»å¼•ç”¨è®¡æ•°è¡¨ä¸­åˆ é™¤åºŸå¼ƒå¯¹è±¡çš„åœ°å€</li>
</ul>
</li>
</ul>
<h3 id="autoreleasingä¿®é¥°ç¬¦"><a href="#autoreleasingä¿®é¥°ç¬¦" class="headerlink" title="__autoreleasingä¿®é¥°ç¬¦"></a>__autoreleasingä¿®é¥°ç¬¦</h3><h4 id="autoreleasingä½¿ç”¨æ–¹æ³•"><a href="#autoreleasingä½¿ç”¨æ–¹æ³•" class="headerlink" title="__autoreleasingä½¿ç”¨æ–¹æ³•"></a>__autoreleasingä½¿ç”¨æ–¹æ³•</h4><p>ARCä¸‹ï¼Œå¯ä»¥ç”¨@autoreleasepoolæ¥æ›¿ä»£NSAutoreleasePoolç±»å¯¹è±¡ï¼Œç”¨__autoreleasingä¿®é¥°ç¬¦ä¿®é¥°å˜é‡æ¥æ›¿ä»£ARCæ— æ•ˆæ—¶è°ƒç”¨å¯¹è±¡çš„autoreleaseæ–¹æ³•ï¼ˆå¯¹è±¡è¢«æ³¨å†Œåˆ°autoreleasepoolï¼‰ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-6dcb0d1fd878deeb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹"></p>
<p>è¯´åˆ°<strong>autoreleasingä¿®é¥°ç¬¦ï¼Œå°±ä¸å¾—ä¸æ</strong>weakï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span>  __<span class="keyword">weak</span> obj1 = obj0;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"class = %@"</span>,[obj1 <span class="keyword">class</span>]);</div></pre></td></tr></table></figure></p>
<p>ç­‰åŒäºï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> __<span class="keyword">weak</span> obj1 = obj0;</div><div class="line"><span class="keyword">id</span> __autoreleasing tmp = obj1;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"class = %@"</span>,[tmp <span class="keyword">class</span>]);<span class="comment">//å®é™…è®¿é—®çš„æ˜¯æ³¨å†Œåˆ°è‡ªåŠ¨ä¸ªé‡Šæ”¾æ± çš„å¯¹è±¡</span></div></pre></td></tr></table></figure>
<p>æ³¨æ„ä¸€ä¸‹ä¸¤æ®µç­‰æ•ˆçš„ä»£ç é‡Œï¼ŒNSLogè¯­å¥é‡Œé¢è®¿é—®çš„å¯¹è±¡æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒè¯´æ˜ï¼šåœ¨è®¿é—®__weakä¿®é¥°ç¬¦çš„å˜é‡ï¼ˆobj1ï¼‰æ—¶å¿…é¡»è®¿é—®æ³¨å†Œåˆ°autoreleasepoolçš„å¯¹è±¡ï¼ˆtmpï¼‰ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å› ä¸º__weakä¿®é¥°ç¬¦åªæŒæœ‰å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å°†æ¥è®¿é—®è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæ— æ³•ä¿è¯å®ƒæ˜¯å¦è¿˜æ²¡æœ‰è¢«åºŸå¼ƒã€‚å› æ­¤ï¼Œå¦‚æœæŠŠè¿™ä¸ªå¯¹è±¡æ³¨å†Œåˆ°autoreleasepoolä¸­ï¼Œé‚£ä¹ˆåœ¨@autoreleasepoolå—ç»“æŸä¹‹å‰éƒ½èƒ½ç¡®ä¿è¯¥å¯¹è±¡å­˜åœ¨ã€‚</p>
<h4 id="autoreleasingå†…éƒ¨å®ç°"><a href="#autoreleasingå†…éƒ¨å®ç°" class="headerlink" title="__autoreleasingå†…éƒ¨å®ç°"></a>__autoreleasingå†…éƒ¨å®ç°</h4><p>å°†å¯¹è±¡èµ‹å€¼ç»™é™„æœ‰__autoreleasingä¿®é¥°ç¬¦çš„å˜é‡ç­‰åŒäºARCæ— æ•ˆæ—¶è°ƒç”¨å¯¹è±¡çš„autoreleaseæ–¹æ³•ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@autoreleasepool</span>&#123;</div><div class="line">    <span class="keyword">id</span> __autoreleasing obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¼–è¯‘å™¨çš„æ¨¡æ‹Ÿä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> pool = objc_autoreleasePoolPush();<span class="comment">//poolå…¥æ ˆ</span></div><div class="line"><span class="keyword">id</span> obj = objc_msgSend(<span class="built_in">NSObject</span>, <span class="keyword">@selector</span>(alloc));</div><div class="line">objc_msgSend(obj, <span class="keyword">@selector</span>(init));</div><div class="line">objc_autorelease(obj);</div><div class="line">objc_autoreleasePoolPop(pool);<span class="comment">//poolå‡ºæ ˆ</span></div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°poolå…¥æ ˆï¼Œæ‰§è¡Œautoreleaseï¼Œå‡ºæ ˆçš„ä¸‰ä¸ªæ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="ARCä¸‹çš„è§„åˆ™"><a href="#ARCä¸‹çš„è§„åˆ™" class="headerlink" title="ARCä¸‹çš„è§„åˆ™"></a>ARCä¸‹çš„è§„åˆ™</h2><p>æˆ‘ä»¬çŸ¥é“äº†åœ¨ARCæœºåˆ¶ä¸‹ç¼–è¯‘å™¨ä¼šå¸®åŠ©æˆ‘ä»¬ç®¡ç†å†…å­˜ï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æœŸï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦éµå®ˆä¸€äº›è§„åˆ™ï¼Œä½œè€…ä¸ºæˆ‘ä»¬åˆ—å‡ºäº†ä»¥ä¸‹çš„è§„åˆ™ï¼š</p>
<ol>
<li>ä¸èƒ½ä½¿ç”¨retain/release/retainCount/autorelease</li>
<li>ä¸èƒ½ä½¿ç”¨NSAllocateObject/NSDeallocateObject</li>
<li>å¿…é¡»éµå®ˆå†…å­˜ç®¡ç†çš„æ–¹æ³•åè§„åˆ™</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨dealloc</li>
<li>ä½¿ç”¨@autoreleaseå—ä»£æ›¿NSAutoreleasePool</li>
<li>ä¸èƒ½ä½¿ç”¨åŒºåŸŸï¼ˆNSZoneï¼‰</li>
<li>å¯¹è±¡å‹å˜é‡ä¸èƒ½ä½œä¸ºCè¯­è¨€ç»“æ„ä½“çš„æˆå‘˜</li>
<li>æ˜¾å¼è½¬æ¢idå’Œvoid*</li>
</ol>
<h3 id="1-ä¸èƒ½ä½¿ç”¨retain-release-retainCount-autorelease"><a href="#1-ä¸èƒ½ä½¿ç”¨retain-release-retainCount-autorelease" class="headerlink" title="1. ä¸èƒ½ä½¿ç”¨retain/release/retainCount/autorelease"></a>1. ä¸èƒ½ä½¿ç”¨retain/release/retainCount/autorelease</h3><p>åœ¨ARCæœºåˆ¶ä¸‹ä½¿ç”¨retain/release/retainCount/autoreleaseæ–¹æ³•ï¼Œä¼šå¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ã€‚</p>
<h3 id="2-ä¸èƒ½ä½¿ç”¨NSAllocateObject-NSDeallocateObject"><a href="#2-ä¸èƒ½ä½¿ç”¨NSAllocateObject-NSDeallocateObject" class="headerlink" title="2. ä¸èƒ½ä½¿ç”¨NSAllocateObject/NSDeallocateObject"></a>2. ä¸èƒ½ä½¿ç”¨NSAllocateObject/NSDeallocateObject</h3><p>åœ¨ARCæœºåˆ¶ä¸‹ä½¿ç”¨NSAllocateObject/NSDeallocateObjectæ–¹æ³•ï¼Œä¼šå¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ã€‚</p>
<h3 id="3-å¿…é¡»éµå®ˆå†…å­˜ç®¡ç†çš„æ–¹æ³•åè§„åˆ™"><a href="#3-å¿…é¡»éµå®ˆå†…å­˜ç®¡ç†çš„æ–¹æ³•åè§„åˆ™" class="headerlink" title="3. å¿…é¡»éµå®ˆå†…å­˜ç®¡ç†çš„æ–¹æ³•åè§„åˆ™"></a>3. å¿…é¡»éµå®ˆå†…å­˜ç®¡ç†çš„æ–¹æ³•åè§„åˆ™</h3><p>å¯¹è±¡çš„ç”Ÿæˆï¼æŒæœ‰çš„æ–¹æ³•å¿…é¡»éµå¾ªä»¥ä¸‹å‘½åè§„åˆ™ï¼š</p>
<ul>
<li>alloc</li>
<li>new</li>
<li>copy</li>
<li>mutableCopy</li>
<li>init</li>
</ul>
<p>å‰å››ç§æ–¹æ³•å·²ç»ä»‹ç»å®Œã€‚è€Œå…³äºinitæ–¹æ³•çš„è¦æ±‚åˆ™æ›´ä¸ºä¸¥æ ¼ï¼š</p>
<ul>
<li>å¿…é¡»æ˜¯å®ä¾‹æ–¹æ³•</li>
<li>å¿…é¡»è¿”å›å¯¹è±¡</li>
<li>è¿”å›å¯¹è±¡çš„ç±»å‹å¿…é¡»æ˜¯idç±»å‹æˆ–æ–¹æ³•å£°æ˜ç±»çš„å¯¹è±¡ç±»å‹</li>
</ul>
<h3 id="4-ä¸è¦æ˜¾å¼è°ƒç”¨dealloc"><a href="#4-ä¸è¦æ˜¾å¼è°ƒç”¨dealloc" class="headerlink" title="4. ä¸è¦æ˜¾å¼è°ƒç”¨dealloc"></a>4. ä¸è¦æ˜¾å¼è°ƒç”¨dealloc</h3><p>å¯¹è±¡è¢«åºŸå¼ƒæ—¶ï¼Œæ— è®ºARCæ˜¯å¦æœ‰æ•ˆï¼Œç³»ç»Ÿéƒ½ä¼šè°ƒç”¨å¯¹è±¡çš„deallocæ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬åªèƒ½åœ¨deallocæ–¹æ³•é‡Œå†™ä¸€äº›å¯¹è±¡è¢«åºŸå¼ƒæ—¶éœ€è¦è¿›è¡Œçš„æ“ä½œï¼ˆä¾‹å¦‚ç§»é™¤å·²ç»æ³¨å†Œçš„è§‚å¯Ÿè€…å¯¹è±¡ï¼‰ä½†æ˜¯ä¸èƒ½æ‰‹åŠ¨è°ƒç”¨deallocæ–¹æ³•ã€‚</p>
<p>æ³¨æ„åœ¨ARCæ— æ•ˆçš„æ—¶å€™ï¼Œè¿˜éœ€è¦è°ƒç”¨[super dealloc]ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)dealloc</div><div class="line">&#123;</div><div class="line">    <span class="comment">//è¯¥å¯¹è±¡çš„å¤„ç†</span></div><div class="line">    [<span class="keyword">super</span> dealloc];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="5-ä½¿ç”¨-autoreleaseå—ä»£æ›¿NSAutoreleasePool"><a href="#5-ä½¿ç”¨-autoreleaseå—ä»£æ›¿NSAutoreleasePool" class="headerlink" title="5. ä½¿ç”¨@autoreleaseå—ä»£æ›¿NSAutoreleasePool"></a>5. ä½¿ç”¨@autoreleaseå—ä»£æ›¿NSAutoreleasePool</h3><p>ARCä¸‹é¡»ä½¿ç”¨ä½¿ç”¨@autoreleaseå—ä»£æ›¿NSAutoreleasePoolã€‚</p>
<h3 id="6-ä¸èƒ½ä½¿ç”¨åŒºåŸŸï¼ˆNSZoneï¼‰"><a href="#6-ä¸èƒ½ä½¿ç”¨åŒºåŸŸï¼ˆNSZoneï¼‰" class="headerlink" title="6. ä¸èƒ½ä½¿ç”¨åŒºåŸŸï¼ˆNSZoneï¼‰"></a>6. ä¸èƒ½ä½¿ç”¨åŒºåŸŸï¼ˆNSZoneï¼‰</h3><p>NSZoneå·²ç»åœ¨ç›®å‰çš„è¿è¡Œæ—¶ç³»ç»Ÿï¼ˆ<strong>OBC2</strong>è¢«è®¾å®šçš„ç¯å¢ƒï¼‰è¢«å¿½ç•¥äº†ã€‚</p>
<h3 id="7-å¯¹è±¡å‹å˜é‡ä¸èƒ½ä½œä¸ºCè¯­è¨€ç»“æ„ä½“çš„æˆå‘˜"><a href="#7-å¯¹è±¡å‹å˜é‡ä¸èƒ½ä½œä¸ºCè¯­è¨€ç»“æ„ä½“çš„æˆå‘˜" class="headerlink" title="7. å¯¹è±¡å‹å˜é‡ä¸èƒ½ä½œä¸ºCè¯­è¨€ç»“æ„ä½“çš„æˆå‘˜"></a>7. å¯¹è±¡å‹å˜é‡ä¸èƒ½ä½œä¸ºCè¯­è¨€ç»“æ„ä½“çš„æˆå‘˜</h3><p>Cè¯­è¨€çš„ç»“æ„ä½“å¦‚æœå­˜åœ¨Objective-Cå¯¹è±¡å‹å˜é‡ï¼Œä¾¿ä¼šå¼•èµ·é”™è¯¯ï¼Œå› ä¸ºCè¯­è¨€åœ¨è§„çº¦ä¸Šæ²¡æœ‰æ–¹æ³•æ¥ç®¡ç†ç»“æ„ä½“æˆå‘˜çš„ç”Ÿå­˜å‘¨æœŸ ã€‚</p>
<h3 id="8-æ˜¾å¼è½¬æ¢idå’Œvoid"><a href="#8-æ˜¾å¼è½¬æ¢idå’Œvoid" class="headerlink" title="8. æ˜¾å¼è½¬æ¢idå’Œvoid*"></a>8. æ˜¾å¼è½¬æ¢idå’Œvoid*</h3><p>éARCä¸‹ï¼Œè¿™ä¸¤ä¸ªç±»å‹æ˜¯å¯ä»¥ç›´æ¥èµ‹å€¼çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">id obj = [NSObject alloc] init];</div><div class="line">void *p = obj;</div><div class="line">id o = p;</div></pre></td></tr></table></figure>
<p>ä½†æ˜¯åœ¨ARCä¸‹å°±ä¼šå¼•èµ·ç¼–è¯‘é”™è¯¯ã€‚ä¸ºäº†é¿å…é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡__bridegeæ¥è½¬æ¢ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line"><span class="keyword">void</span> *p = (__bridge <span class="keyword">void</span>*)obj;<span class="comment">//æ˜¾å¼è½¬æ¢</span></div><div class="line"><span class="keyword">id</span> o = (__bridge <span class="keyword">id</span>)p;<span class="comment">//æ˜¾å¼è½¬æ¢</span></div></pre></td></tr></table></figure>
<h2 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h2><p>æ¥çœ‹ä¸€ä¸‹å±æ€§çš„å£°æ˜ä¸æ‰€æœ‰æƒä¿®é¥°ç¬¦çš„å…³ç³»</p>
<table>
<thead>
<tr>
<th>å±æ€§å…³é”®å­—</th>
<th>æ‰€æœ‰æƒ ä¿®é¥°ç¬¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>assign</td>
<td>__unsafe_unretained</td>
</tr>
<tr>
<td>copy</td>
<td>__strong</td>
</tr>
<tr>
<td>retain</td>
<td>__strong</td>
</tr>
<tr>
<td>strong</td>
<td>__strong</td>
</tr>
<tr>
<td>__unsafe_unretained</td>
<td>__unsafe_unretained</td>
</tr>
<tr>
<td>weak</td>
<td>__weak</td>
</tr>
</tbody>
</table>
<p>è¯´ä¸€ä¸‹<strong>unsafe_unretainedï¼š
</strong>unsafe_unretainedè¡¨ç¤ºå­˜å–æ–¹æ³•ä¼šç›´æ¥ä¸ºå®ä¾‹å˜é‡èµ‹å€¼ã€‚</p>
<p>è¿™é‡Œçš„â€œunsafeâ€æ˜¯ç›¸å¯¹äºweakè€Œè¨€çš„ã€‚æˆ‘ä»¬çŸ¥é“weakæŒ‡å‘çš„å¯¹è±¡è¢«é”€æ¯æ—¶ï¼ŒæŒ‡é’ˆä¼šè‡ªåŠ¨è®¾ç½®ä¸ºnilã€‚è€Œ__unsafe_unretainedå´ä¸ä¼šï¼Œè€Œæ˜¯æˆä¸ºç©ºæŒ‡é’ˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå½“å¤„ç†éå¯¹è±¡å±æ€§çš„æ—¶å€™å°±ä¸ä¼šå‡ºç°ç©ºæŒ‡é’ˆçš„é—®é¢˜ã€‚</p>
<p>è¿™æ ·ç¬¬ä¸€ç« å°±ä»‹ç»å®Œäº†ï¼Œç¬¬äºŒç¯‡ä¼šåœ¨ä¸‹å‘¨ä¸€å‘å¸ƒ^^</p>
<hr>
<p>æ‰©å±•æ–‡çŒ®ï¼š</p>
<ol>
<li><a href="https://developer.apple.com/library/content/releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html" target="_blank" rel="external">Apple:Transitioning to ARC Release Notes</a> </li>
<li><a href="http://www.jianshu.com/p/6cf682f90fa2" target="_blank" rel="external">èšŠé¦™é…±:å¯èƒ½æ˜¯å²ä¸Šæœ€å…¨é¢çš„å†…å­˜ç®¡ç†æ–‡ç« </a></li>
<li><a href="http://www.jianshu.com/p/0ad9957e3716" target="_blank" rel="external">å¾®ç¬‘å’Œé£é£:å¯èƒ½ç¢°åˆ°çš„iOSç¬”è¯•é¢è¯•é¢˜ï¼ˆ6ï¼‰â€“å†…å­˜ç®¡ç†</a></li>
<li><a href="https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00RWORA1O/ref=sr_1_1?ie=UTF8&amp;qid=1491531635&amp;sr=8-1&amp;keywords=ios%E7%BC%96%E7%A8%8B" target="_blank" rel="external">ã€ŠiOSç¼–ç¨‹(ç¬¬4ç‰ˆ)ã€‹</a> </li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ€»ç»“äº†&lt;a href=&quot;http://www.jianshu.com/nb/6074358&quot;&gt;Effective Objective-C&lt;/a&gt;ä¹‹åï¼Œè¿˜æƒ³è¯»ä¸€æœ¬è¿›é˜¶çš„iOSä¹¦ï¼Œæ¯«ä¸çŠ¹è±«é€‰ä¸­äº†ã€ŠObjective-C é«˜çº§ç¼–ç¨‹ã€‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-7ceabf4418ec5228.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ï¼šiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æœ¬ä¹¦æœ‰ä¸‰ä¸ªç« èŠ‚ï¼Œæˆ‘é’ˆå¯¹æ¯ä¸€ç« èŠ‚è¿›è¡Œæ€»ç»“å¹¶åŠ ä¸Šé€‚å½“çš„æ‰©å±•åˆ†äº«ç»™å¤§å®¶ã€‚å¯ä»¥ä»ä¸‹é¢è¿™å¼ å›¾æ¥çœ‹ä¸€ä¸‹è¿™ä¸‰ç¯‡çš„æ•´ä½“ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-169518e948933744.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ã€‹ å¹²è´§ä¸‰éƒ¨æ›²&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œè¿™ä¸ªç»“æ„å¹¶ä¸å’Œä¹¦ä¸­çš„ç»“æ„ä¸€è‡´ï¼Œè€Œæ˜¯ä»¥ä¹¦ä¸­çš„ç»“æ„ä¸ºå‚è€ƒï¼Œç¨ä½œäº†è°ƒæ•´ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡æ˜¯ç¬¬ä¸€ç¯‡ï¼šå¼•ç”¨è®¡æ•°ï¼Œç®€å•è¯´ä¸¤å¥ï¼š&lt;br&gt;Objective-Cé€šè¿‡ retainCount çš„æœºåˆ¶æ¥å†³å®šå¯¹è±¡æ˜¯å¦éœ€è¦é‡Šæ”¾ã€‚ æ¯æ¬¡runloopè¿­ä»£ç»“æŸåï¼Œéƒ½ä¼šæ£€æŸ¥å¯¹è±¡çš„ retainCountï¼Œå¦‚æœretainCountç­‰äº0ï¼Œå°±è¯´æ˜è¯¥å¯¹è±¡æ²¡æœ‰åœ°æ–¹éœ€è¦ç»§ç»­ä½¿ç”¨å®ƒï¼Œå¯ä»¥è¢«é‡Šæ”¾æ‰äº†ã€‚æ— è®ºæ˜¯æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œè¿˜æ˜¯ARCæœºåˆ¶ï¼Œéƒ½æ˜¯é€šè¿‡å¯¹retainCountæ¥è¿›è¡Œå†…å­˜ç®¡ç†çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºMVVMï¼Œç”¨äºå¿«é€Ÿæ­å»ºè®¾ç½®é¡µï¼Œä¸ªäººä¿¡æ¯é¡µçš„æ¡†æ¶ï¼ˆé™„ï¼šä»¿å¾®ä¿¡iOSå®¢æˆ·ç«¯å‘ç°é¡µï¼Œä¸ªäººé¡µï¼Œè®¾ç½®é¡µDemoï¼‰</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/03/20/%E5%9F%BA%E4%BA%8EMVVM%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E8%AE%BE%E7%BD%AE%E9%A1%B5%EF%BC%8C%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E9%A1%B5%E7%9A%84%E6%A1%86%E6%9E%B6%EF%BC%88%E9%99%84%EF%BC%9A%E4%BB%BF%E5%BE%AE%E4%BF%A1iOS%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%E7%8E%B0%E9%A1%B5%EF%BC%8C%E4%B8%AA%E4%BA%BA%E9%A1%B5%EF%BC%8C%E8%AE%BE%E7%BD%AE%E9%A1%B5Demo%EF%BC%89/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/03/20/åŸºäºMVVMï¼Œç”¨äºå¿«é€Ÿæ­å»ºè®¾ç½®é¡µï¼Œä¸ªäººä¿¡æ¯é¡µçš„æ¡†æ¶ï¼ˆé™„ï¼šä»¿å¾®ä¿¡iOSå®¢æˆ·ç«¯å‘ç°é¡µï¼Œä¸ªäººé¡µï¼Œè®¾ç½®é¡µDemoï¼‰/</id>
    <published>2017-03-20T05:47:51.000Z</published>
    <updated>2017-03-21T00:08:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>å†™UITableViewçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°çš„æ˜¯å®Œå…¨ä¾èµ–äºç½‘ç»œè¯·æ±‚ï¼Œéœ€è¦è‡ªå®šä¹‰çš„åŠ¨æ€cellçš„éœ€æ±‚ï¼ˆæ¯”å¦‚å¾®åšå¸–å­åˆ—è¡¨ï¼‰ã€‚ä½†æ˜¯åŒæ—¶ï¼Œå¤§å¤šæ•°appé‡Œé¢å‡ ä¹ä¹Ÿéƒ½æœ‰è®¾ç½®é¡µï¼Œä¸ªäººé¡µç­‰å…¶ä»–ä»¥é™æ€è¡¨æ ¼ä¸ºä¸»çš„é¡µé¢ã€‚</p>
<p>è€Œä¸”è¿™äº›é¡µé¢çš„å…±æ€§æ¯”è¾ƒå¤šï¼š</p>
<ol>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹åœ¨è¿›å…¥é¡µé¢ä¹‹å‰å°±å·²ç»æ‹¿åˆ°æ‰€æœ‰æ•°æ®ã€‚</li>
<li>cellæ ·å¼å•ä¸€ï¼Œè‡ªå®šä¹‰cellå‡ºç°çš„å‡ ç‡æ¯”è¾ƒå°ï¼ˆå‡ ä¹éƒ½æ˜¯é«˜åº¦ä¸º44çš„cellï¼‰ã€‚</li>
<li>å¤šæ•°éƒ½åˆ†ç»„ã€‚</li>
</ol>
<p>å› ä¸ºè‡ªå·±éå¸¸æƒ³å†™ä¸€ä¸ªå¼€æºçš„ä¸œè¥¿å‡ºæ¥ï¼ˆä¹Ÿå¯ä»¥æš´éœ²è‡ªå·±çš„ä¸è¶³ï¼‰ï¼ŒåŒæ—¶åˆå—é™äºæ°´å¹³ï¼Œæ‰€ä»¥å°±æ‰“ç®—å†™è¿™ä¹ˆä¸€ä¸ªæ¯”è¾ƒç®€å•ï¼Œåˆå…·æœ‰é€šç”¨æ€§çš„æ¡†æ¶ï¼š<strong>ä¸€ä¸ªå®šåˆ¶æ€§æ¯”è¾ƒé«˜çš„é€‚åˆåœ¨ä¸ªäººé¡µå’Œè®¾ç½®é¡µä½¿ç”¨çš„UITableView</strong>ã€‚</p>
<p>åœ¨çœŸæ­£å†™ä¹‹å‰ï¼Œçœ‹äº†å‡ ç¯‡ç±»ä¼¼çš„æ–‡ç« ï¼ŒæŒ‘å‡ºä¸‰ç¯‡è‡ªå·±è§‰å¾—æ¯”è¾ƒå¥½çš„ï¼š</p>
<ol>
<li><a href="https://www.objc.io/issues/1-view-controllers/table-views/" target="_blank" rel="external">Clean Table View Code</a> </li>
<li><a href="http://www.jianshu.com/p/504c61a9dc82" target="_blank" rel="external">å¦‚ä½•å†™å¥½ä¸€ä¸ªUITableView</a></li>
<li><a href="http://www.jianshu.com/p/81d0c573f7a8" target="_blank" rel="external">åˆ©ç”¨MVVMè®¾è®¡å¿«é€Ÿå¼€å‘ä¸ªäººä¸­å¿ƒã€è®¾ç½®ç­‰æ¨¡å—</a></li>
</ol>
<p>çœ‹å®Œæ€»ç»“ä¹‹åï¼Œåˆ©ç”¨ä¸Šå‘¨3å¤©çš„ä¸šä½™æ—¶é—´å†™å¥½äº†è¿™ä¸ªæ¡†æ¶ï¼Œä¸ºäº†å®ƒå®ç”¨æ€§ï¼Œæˆ‘ä»¿ç…§äº†å¾®ä¿¡å®¢æˆ·ç«¯çš„å‘ç°é¡µï¼Œä¸ªäººé¡µå’Œè®¾ç½®é¡µå†™äº†ä¸€ä¸ªDemoï¼Œæ¥çœ‹ä¸€ä¸‹æ•ˆæœå›¾ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_1.png" alt="å‘ç°é¡µ | ä¸ªäººé¡µ | ä¸ªäººä¿¡æ¯é¡µ | è®¾ç½®é¡µ"><br><a id="more"></a></p>
<blockquote>
<p>é¡¹ç›®æ‰€ç”¨èµ„æºæ¥è‡ªï¼š<a href="https://github.com/zhengwenming/WeChat">GitHub:zhengwenming/WeChat</a><br>Demoåœ°å€ï¼š<a href="https://github.com/knightsj/SJStaticTableView">GitHub: knightsj/SJStaticTableView</a></p>
</blockquote>
<p>ä¸ºäº†ä½“ç°å‡ºè¿™ä¸ªæ¡†æ¶çš„å®šåˆ¶æ€§ï¼Œæˆ‘è‡ªå·±ä¹Ÿåœ¨é‡Œé¢æ·»åŠ äº†ä¸¤ä¸ªé¡µé¢ï¼Œå…¥å£åœ¨è®¾ç½®é¡µé‡Œé¢ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_2.png" alt="åˆ†ç»„å®šåˆ¶ | åŒç»„å®šåˆ¶"></p>
<blockquote>
<p>å…ˆä¸è¦çº ç»“åˆ†ç»„å®šåˆ¶å’ŒåŒç»„å®šåˆ¶çš„å…·ä½“æ„æ€ï¼Œåœ¨åé¢è®²åˆ°å®šåˆ¶æ€§çš„æ—¶å€™æˆ‘ä¼šè¯¦ç»†è¯´æ˜ã€‚ç°åœ¨åªæ˜¯è®©å¤§å®¶çœ‹ä¸€ä¸‹æ•ˆæœã€‚</p>
</blockquote>
<p>åœ¨å¤§æ¦‚äº†è§£äº†åŠŸèƒ½ä¹‹åï¼Œå¼€å§‹è¯¦ç»†ä»‹ç»è¿™ä¸ªæ¡†æ¶ã€‚å†™è¿™ç¯‡ä»‹ç»çš„åŸå› å€’ä¸æ˜¯å¸Œæœ›æœ‰å¤šå°‘äººæ¥ç”¨ï¼Œè€Œæ˜¯è¡¨è¾¾ä¸€ä¸‹æˆ‘è‡ªå·±çš„æ€è·¯è€Œå·²ã€‚å„ä½è§‰å¾—ä¸å¥½çš„åœ°æ–¹è¯·å¤šæ‰¹è¯„ã€‚</p>
<p>åœ¨æ­£å¼è®²è§£ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹æœ¬ç¯‡çš„åŸºæœ¬ç›®å½•ï¼š</p>
<ol>
<li>ç”¨åˆ°çš„æŠ€æœ¯ç‚¹ã€‚</li>
<li>åŠŸèƒ½è¯´æ˜ã€‚</li>
<li>ä½¿ç”¨æ–¹æ³•ã€‚</li>
<li>å®šåˆ¶æ€§ä»‹ç»ã€‚</li>
</ol>
<h1 id="ç”¨åˆ°çš„æŠ€æœ¯ç‚¹"><a href="#ç”¨åˆ°çš„æŠ€æœ¯ç‚¹" class="headerlink" title="ç”¨åˆ°çš„æŠ€æœ¯ç‚¹"></a>ç”¨åˆ°çš„æŠ€æœ¯ç‚¹</h1><hr>
<p>æ¡†æ¶æ•´ä½“æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸»è¦è¿˜æ˜¯åŸºäºè‹¹æœçš„<code>UITableView</code>ç»„ä»¶ï¼Œä¸ºäº†è§£è€¦å’Œè´£ä»»åˆ†ç¦»ï¼Œä¸»è¦è¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯ç‚¹ï¼š</p>
<ul>
<li><strong>MVVM</strong>ï¼šé‡‡ç”¨MVVMæ¶æ„ï¼Œå°†æ¯ä¸€è¡Œâ€œçº¯ç²¹â€çš„æ•°æ®äº¤ç»™ä¸€ä¸ªå•ç‹¬çš„<code>ViewModel</code>,è®©å…¶æŒæœ‰æ¯ä¸ªcellçš„æ•°æ®ï¼ˆè¡Œé«˜ï¼Œcellç±»å‹ï¼Œæ–‡æœ¬å®½åº¦ï¼Œå›¾ç‰‡é«˜åº¦ç­‰ç­‰ï¼‰ã€‚è€Œä¸”æ¯ä¸€ä¸ªsectionä¹Ÿå¯¹åº”ä¸€ä¸ª<code>ViewModel</code>ï¼Œå®ƒæŒæœ‰å½“å‰sectionçš„é…ç½®æ•°æ®ï¼ˆtitleï¼Œheaderå’Œfooterçš„é«˜åº¦ç­‰ç­‰ï¼‰ã€‚</li>
<li><strong>è½»UITableView</strong>ï¼šåˆ†ç¦»<code>UITableViewDataSource</code>ä¸<code>UIViewController</code>ï¼Œè®©å•ç‹¬ä¸€ä¸ªç±»æ¥å®ç°<code>UITableViewDataSource</code>çš„èŒèƒ½ã€‚</li>
<li><strong>block</strong>ï¼šä½¿ç”¨blockæ¥è°ƒç”¨cellçš„ç»˜åˆ¶æ–¹æ³•ã€‚</li>
<li><strong>åˆ†ç±»</strong>ï¼šä½¿ç”¨åˆ†ç±»æ¥å®šä¹‰æ¯ä¸€ç§ä¸åŒçš„cellçš„ç»˜åˆ¶æ–¹æ³•ã€‚</li>
</ul>
<p>çŸ¥é“äº†ä¸»è¦è¿ç”¨çš„æŠ€æœ¯ç‚¹ä»¥åï¼Œç»™å¤§å®¶è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¯¥æ¡†æ¶çš„åŠŸèƒ½ã€‚</p>
<h1 id="åŠŸèƒ½ä»‹ç»"><a href="#åŠŸèƒ½ä»‹ç»" class="headerlink" title="åŠŸèƒ½ä»‹ç»"></a>åŠŸèƒ½ä»‹ç»</h1><hr>
<p>è¿™ä¸ªæ¡†æ¶å¯ä»¥ç”¨æ¥å¿«é€Ÿæ­å»ºè®¾ç½®é¡µï¼Œä¸ªäººä¿¡æ¯é¡µèƒ½é™æ€è¡¨æ ¼é¡µé¢ï¼Œä½¿ç”¨è€…åªéœ€è¦ç»™tableViewçš„DataSourceä¼ å…¥å…ƒç´ æ˜¯viewModelçš„æ•°ç»„å°±å¯ä»¥äº†ã€‚</p>
<p>è™½è¯´è¿™ç±»é¡µé¢çš„å¸ƒå±€è¿˜æ˜¯æ¯”è¾ƒå•ä¸€çš„ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰å‡ ç§ä¸åŒçš„æƒ…å†µï¼ˆcellçš„å¸ƒå±€ç±»å‹ï¼‰ï¼Œæˆ‘å¯¹æ¯”è¾ƒå¸¸è§çš„cellå¸ƒå±€åšäº†å°è£…ï¼Œä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>æˆ‘åœ¨å®šä¹‰è¿™äº›cellçš„ç±»å‹çš„æ—¶å€™ï¼Œå¤§è‡´åˆ’åˆ†äº†ä¸¤ç±»ï¼š</p>
<ol>
<li>ç¬¬ä¸€ç±»æ˜¯ç³»ç»Ÿé£æ ¼çš„cellï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œcellé«˜åº¦ä¸º44ï¼›åœ¨cellå·¦ä¾§ä¼šæœ‰ä¸€å¼ å›¾ï¼Œä¸€ä¸ªlabelï¼Œä¹Ÿå¯ä»¥åªå­˜åœ¨ä¸€ç§ï¼ˆä½†æ˜¯åªå­˜åœ¨å›¾ç‰‡çš„æƒ…å†µå¾ˆå°‘ï¼‰ï¼›åœ¨cellå³ä¾§ä¸€èˆ¬éƒ½æœ‰ä¸€ä¸ªå‘å³çš„ç®­å¤´ï¼Œè€Œä¸”æœ‰æ—¶è¿™ä¸ªç®­å¤´çš„å·¦ä¾§è¿˜å¯èƒ½æœ‰labelï¼Œimageï¼Œä¹Ÿå¯ä»¥ä¸¤ä¸ªéƒ½æœ‰ã€‚</li>
<li>ç¬¬äºŒç±»å°±æ˜¯è‡ªå®šä¹‰çš„celläº†ï¼Œå®ƒçš„é«˜åº¦ä¸ä¸€å®šæ˜¯44ï¼Œè€Œä¸”å¸ƒå±€å’Œç³»ç»Ÿé£æ ¼çš„cellå¾ˆä¸ä¸€æ ·ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±æ·»åŠ ã€‚</li>
</ol>
<p>åŸºäºè¿™ä¸¤å¤§ç±»ï¼Œå†ç»†åˆ†äº†å‡ ç§æƒ…å†µï¼Œå¯ä»¥ç”±ä¸‹é¢è¿™å¼ å›¾æ¥ç›´è§‚çœ‹ä¸€ä¸‹ï¼š</p>
<p>æ—¢ç„¶æ˜¯cellçš„ç±»å‹ï¼Œé‚£ä¹ˆå°±ç±»å‹çš„æšä¸¾å°±éœ€è¦å®šä¹‰åœ¨cellçš„viewModelé‡Œé¢ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, SJStaticCellType) &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//ç³»ç»Ÿé£æ ¼çš„å„ç§cellç±»å‹ï¼Œå·²å°è£…å¥½ï¼Œå¯ä»¥ç›´æ¥ç”¨</span></div><div class="line">    SJStaticCellTypeSystemLogout,                          <span class="comment">//é€€å‡ºç™»å½•cell</span></div><div class="line">    SJStaticCellTypeSystemAccessoryNone,                   <span class="comment">//å³ä¾§æ²¡æœ‰ä»»ä½•æ§ä»¶</span></div><div class="line">    SJStaticCellTypeSystemAccessorySwitch,                 <span class="comment">//å³ä¾§æ˜¯å¼€å…³</span></div><div class="line">    SJStaticCellTypeSystemAccessoryDisclosureIndicator,    <span class="comment">//å³ä¾§æ˜¯ä¸‰è§’ç®­å¤´(ç®­å¤´å·¦ä¾§å¯ä»¥æœ‰ä¸€ä¸ªimageæˆ–è€…ä¸€ä¸ªlabelï¼Œæˆ–è€…äºŒè€…éƒ½æœ‰ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°å†³å®š)</span></div><div class="line">    </div><div class="line">    <span class="comment">//éœ€è¦ç”¨æˆ·è‡ªå·±æ·»åŠ çš„è‡ªå®šä¹‰cellç±»å‹</span></div><div class="line">    SJStaticCellTypeMeAvatar,                              <span class="comment">//ä¸ªäººé¡µâ€œæˆ‘â€cell    </span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>æ¥ä¸€å¼ å›¾ç›´è§‚å¾—ä½“ä¼šä¸€ä¸‹ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_6.png" alt="æ”¯æŒcellç±»å‹"></p>
<p>åœ¨è¿™é‡Œæœ‰ä¸‰ç‚¹éœ€è¦è¯´ä¸€ä¸‹ï¼š</p>
<ol>
<li>è¿™é‡Œé¢é™¤äº†è‡ªå®šä¹‰çš„cellä»¥å¤–ï¼Œå…¶ä»–ç±»å‹çš„celléƒ½ä¸éœ€è¦å¼€å‘è€…è‡ªå·±å¸ƒå±€ï¼Œéƒ½å·²ç»è¢«æˆ‘å°è£…å¥½ï¼Œåªéœ€è¦åœ¨cellçš„<code>ViewModel</code>é‡Œé¢ä¼ å…¥ç›¸åº”çš„ç±»å‹å’Œæ•°æ®ï¼ˆæ–‡å­—ï¼Œå›¾ç‰‡ï¼‰å³å¯ã€‚</li>
<li>å› ä¸ºå·¦ä¾§çš„ä¸¤ä¸ªæ§ä»¶ï¼ˆå›¾ç‰‡å’Œæ–‡å­—ï¼‰æ˜¯è‡³å°‘å­˜åœ¨ä¸€ä¸ªè€Œä¸”å·¦å³é¡ºåºå›ºå®šï¼ˆå›¾ç‰‡æ°¸è¿œåœ¨æœ€å·¦ä¾§ï¼‰ï¼Œæ‰€ä»¥è¯¥æ¡†æ¶é€šè¿‡å¼€å‘è€…ä¼ å…¥çš„å·¦ä¾§éœ€è¦æ˜¾ç¤ºçš„å›¾ç‰‡å’Œæ–‡å­—ï¼Œå¯ä»¥è‡ªå·±è¿›è¡Œcellçš„å¸ƒå±€ã€‚æ‰€ä»¥ç±»å‹çš„åˆ¤æ–­ä¸»è¦ä½œç”¨äºcellçš„å³ä¾§ã€‚</li>
<li>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨â€æœ€å³ä¾§æ˜¯ä¸€ä¸ªç®­å¤´â€å­åˆ†æ”¯çš„äº”ä¸ªç±»å‹å…¶å®éƒ½å±äºä¸€ä¸ªç±»å‹ï¼Œåªéœ€è¦ä¼ å…¥æ–‡å­—å’Œå›¾ç‰‡ï¼Œä»¥åŠæ–‡å­—å›¾ç‰‡çš„æ˜¾ç¤ºé¡ºåºå‚æ•°ï¼ˆè¿™ä¸ªå‚æ•°åªåœ¨åŒæ—¶å­˜åœ¨å›¾ç‰‡å’Œæ–‡å­—çš„æ—¶å€™æœ‰æ•ˆï¼‰å°±å¯ä»¥è‡ªè¡Œåˆ¤æ–­å¸ƒå±€ã€‚</li>
</ol>
<p>åœ¨äº†è§£äº†è¯¥æ¡†æ¶çš„åŠŸèƒ½ä¹‹åï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ¡†æ¶ï¼š</p>
<h1 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h1><hr>
<p>æœ€å¼€å§‹å…ˆç”¨æ–‡å­—è¯´æ˜ä¸€ä¸‹ï¼š</p>
<ol>
<li>å°†SJStaticTableViewComponentæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å·¥ç¨‹é‡Œã€‚</li>
<li>å°†è¦å¼€å‘çš„é¡µé¢çš„ViewControllerç»§æ‰¿<code>SJStaticTableViewController</code>ã€‚</li>
<li>åœ¨æ–°ViewControlleré‡Œå®ç°<code>createDataSource</code>æ–¹æ³•ï¼Œå°†viewModelæ•°ç»„ä¼ ç»™æ§åˆ¶å™¨çš„<code>dataSource</code>å±æ€§ã€‚</li>
<li>æ ¹æ®ä¸åŒçš„cellç±»å‹ï¼Œè°ƒç”¨ä¸åŒçš„cellç»˜åˆ¶æ–¹æ³•ã€‚</li>
<li>å¦‚æœéœ€è¦æ¥å—cellçš„ç‚¹å‡»ï¼Œéœ€è¦å®ç°<code>didSelectViewModel</code>æ–¹æ³•ã€‚</li>
</ol>
<p>å¯èƒ½æ„Ÿè§‰æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘æ‹¿è®¾ç½®é¡µæ¥å…·ä½“è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p>å…ˆçœ‹ä¸€ä¸‹è®¾ç½®é¡µçš„å¸ƒå±€ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_3.png" alt="è®¾ç½®é¡µ"></p>
<p>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹è®¾ç½®çš„ViewControllerçš„ä»£ç ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="keyword">self</span>.navigationItem.title = <span class="string">@"è®¾ç½®"</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)createDataSource</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.dataSource = [[SJStaticTableViewDataSource alloc] initWithViewModelsArray:[Factory settingPageData] configureBlock:^(SJStaticTableViewCell *cell, SJStaticTableviewCellViewModel *viewModel) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">switch</span> (viewModel.staticCellType)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">case</span> SJStaticCellTypeSystemAccessoryDisclosureIndicator:</div><div class="line">            &#123;</div><div class="line">                [cell configureAccessoryDisclosureIndicatorCellWithViewModel:viewModel];</div><div class="line">            &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">                </div><div class="line">            <span class="keyword">case</span> SJStaticCellTypeSystemAccessorySwitch:</div><div class="line">            &#123;</div><div class="line">                [cell configureAccessorySwitchCellWithViewModel:viewModel];</div><div class="line">            &#125;</div><div class="line">                <span class="keyword">break</span>;             </div><div class="line">            <span class="keyword">case</span> SJStaticCellTypeSystemLogout:</div><div class="line">            &#123;</div><div class="line">                [cell configureLogoutTableViewCellWithViewModel:viewModel];</div><div class="line">            &#125;</div><div class="line">                <span class="keyword">break</span>;                </div><div class="line">            <span class="keyword">case</span> SJStaticCellTypeSystemAccessoryNone:</div><div class="line">            &#123;</div><div class="line">                [cell configureAccessoryNoneCellWithViewModel:viewModel];</div><div class="line">            &#125;</div><div class="line">                <span class="keyword">break</span>;                </div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)didSelectViewModel:(SJStaticTableviewCellViewModel *)viewModel atIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;    </div><div class="line">    <span class="keyword">switch</span> (viewModel.identifier)</div><div class="line">    &#123;            </div><div class="line">        <span class="keyword">case</span> <span class="number">6</span>:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"é€€å‡ºç™»å½•"</span>);</div><div class="line">            [<span class="keyword">self</span> showAlertWithMessage:<span class="string">@"çœŸçš„è¦é€€å‡ºç™»å½•å˜›ï¼Ÿ"</span>];</div><div class="line">        &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> <span class="number">8</span>:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ¸…ç†ç¼“å­˜"</span>);</div><div class="line">        &#125;</div><div class="line">            <span class="keyword">break</span>;            </div><div class="line">        <span class="keyword">case</span> <span class="number">9</span>:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"è·³è½¬åˆ°å®šåˆ¶æ€§cellå±•ç¤ºé¡µé¢ - åˆ†ç»„"</span>);</div><div class="line">            SJCustomCellsViewController *vc = [[SJCustomCellsViewController alloc] init];</div><div class="line">            [<span class="keyword">self</span>.navigationController pushViewController:vc animated:<span class="literal">YES</span>];</div><div class="line">        &#125;</div><div class="line">            <span class="keyword">break</span>;            </div><div class="line">        <span class="keyword">case</span> <span class="number">10</span>:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"è·³è½¬åˆ°å®šåˆ¶æ€§cellå±•ç¤ºé¡µé¢ - åŒç»„"</span>);</div><div class="line">            SJCustomCellsOneSectionViewController *vc = [[SJCustomCellsOneSectionViewController alloc] init];</div><div class="line">            [<span class="keyword">self</span>.navigationController pushViewController:vc animated:<span class="literal">YES</span>];</div><div class="line">        &#125;</div><div class="line">            <span class="keyword">break</span>;            </div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™äº›ç–‘é—®ï¼š</p>
<ol>
<li>UITableViewDataSourceæ–¹æ³•å“ªå„¿å»äº†ï¼Ÿ</li>
<li>viewModelæ•°ç»„æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Ÿ</li>
<li>cellçš„ç»˜åˆ¶æ–¹æ³•æ˜¯å¦‚ä½•åŒºåˆ†çš„ï¼Ÿ</li>
<li>UITableViewDelegateçš„æ–¹æ³•å“ªé‡Œå»äº†ï¼Ÿ</li>
</ol>
<p>ä¸‹é¢æˆ‘ä¼šä¸€ä¸€è§£ç­”ï¼Œçœ‹å®Œäº†ä¸‹é¢çš„è§£ç­”ï¼Œå°±èƒ½å‡ ä¹å®Œå…¨æŒæ¡è¿™ä¸ªæ¡†æ¶çš„æ€è·¯äº†ï¼š</p>
<h2 id="é—®é¢˜1ï¼šUITableViewDataSourceæ–¹æ³•å“ªå„¿å»äº†ï¼Ÿ"><a href="#é—®é¢˜1ï¼šUITableViewDataSourceæ–¹æ³•å“ªå„¿å»äº†ï¼Ÿ" class="headerlink" title="é—®é¢˜1ï¼šUITableViewDataSourceæ–¹æ³•å“ªå„¿å»äº†ï¼Ÿ"></a>é—®é¢˜1ï¼šUITableViewDataSourceæ–¹æ³•å“ªå„¿å»äº†ï¼Ÿ</h2><p>æˆ‘è‡ªå·±å°è£…äº†ä¸€ä¸ªç±»<code>SJStaticTableViewDataSource</code>ä¸“é—¨ä½œä¸ºæ•°æ®æºï¼Œéœ€è¦æ§åˆ¶å™¨ç»™å®ƒä¸€ä¸ªviewModelæ•°ç»„ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹å®ƒçš„å®ç°æ–‡ä»¶ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//SJStaticTableViewDataSource.m</span></div><div class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.viewModelsArray.count;</div><div class="line">&#125;</div><div class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</div><div class="line">&#123;</div><div class="line">    SJStaticTableviewSectionViewModel *vm = <span class="keyword">self</span>.viewModelsArray[section];</div><div class="line">    <span class="keyword">return</span> vm.cellViewModelsArray.count;</div><div class="line">&#125;</div><div class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    <span class="comment">//è·å–sectionçš„ViewModel</span></div><div class="line">    SJStaticTableviewSectionViewModel *sectionViewModel = <span class="keyword">self</span>.viewModelsArray[indexPath.section];</div><div class="line">    <span class="comment">//è·å–cellçš„viewModel</span></div><div class="line">    SJStaticTableviewCellViewModel *cellViewModel = sectionViewModel.cellViewModelsArray[indexPath.row];</div><div class="line">    </div><div class="line">    SJStaticTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellViewModel.cellID];</div><div class="line">    <span class="keyword">if</span> (!cell) &#123;</div><div class="line">        cell = [[SJStaticTableViewCell alloc] initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:cellViewModel.cellID];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">self</span>.cellConfigureBlock(cell,cellViewModel);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">    </div><div class="line">&#125;</div><div class="line">- (<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForHeaderInSection:(<span class="built_in">NSInteger</span>)section&#123;</div><div class="line">    SJStaticTableviewSectionViewModel *vm = <span class="keyword">self</span>.viewModelsArray[section];</div><div class="line">    <span class="keyword">return</span> vm.sectionHeaderTitle;  </div><div class="line">&#125;</div><div class="line">- (<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForFooterInSection:(<span class="built_in">NSInteger</span>)section</div><div class="line">&#123;</div><div class="line">    SJStaticTableviewSectionViewModel *vm = <span class="keyword">self</span>.viewModelsArray[section];</div><div class="line">    <span class="keyword">return</span> vm.sectionFooterTitle;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>è¡¨æ ¼çš„cellå’Œsectionéƒ½è®¾ç½®äº†ä¸å…¶å¯¹åº”çš„viewModelï¼Œç”¨äºå°è£…å…¶å¯¹åº”çš„æ•°æ®ï¼š</p>
</blockquote>
<p>cellçš„viewModel(å¤§è‡´çœ‹ä¸€ä¸‹å³å¯ï¼Œåé¢æœ‰è¯¦ç»†è¯´æ˜)ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, SJStaticCellType) &#123;    </div><div class="line">    <span class="comment">//ç³»ç»Ÿé£æ ¼çš„å„ç§cellç±»å‹ï¼Œå·²å°è£…å¥½ï¼Œå¯ä»¥ç›´æ¥ç”¨</span></div><div class="line">    SJStaticCellTypeSystemLogout,                          <span class="comment">//é€€å‡ºç™»å½•cellï¼ˆå·²å°è£…å¥½ï¼‰</span></div><div class="line">    SJStaticCellTypeSystemAccessoryNone,                   <span class="comment">//å³ä¾§æ²¡æœ‰ä»»ä½•æ§ä»¶</span></div><div class="line">    SJStaticCellTypeSystemAccessorySwitch,                 <span class="comment">//å³ä¾§æ˜¯å¼€å…³</span></div><div class="line">    SJStaticCellTypeSystemAccessoryDisclosureIndicator,    <span class="comment">//å³ä¾§æ˜¯ä¸‰è§’ç®­å¤´(ç®­å¤´å·¦ä¾§å¯ä»¥æœ‰ä¸€ä¸ªimageæˆ–è€…ä¸€ä¸ªlabelï¼Œæˆ–è€…äºŒè€…éƒ½æœ‰ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°å†³å®š)</span></div><div class="line">    </div><div class="line">    <span class="comment">//éœ€è¦ç”¨æˆ·è‡ªå·±æ·»åŠ çš„è‡ªå®šä¹‰cellç±»å‹</span></div><div class="line">    SJStaticCellTypeMeAvatar,                              <span class="comment">//ä¸ªäººé¡µâ€œæˆ‘â€cell    </span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^SwitchValueChagedBlock)(<span class="built_in">BOOL</span> isOn);           <span class="comment">//switchå¼€å…³åˆ‡æ¢æ—¶è°ƒç”¨çš„block</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableviewCellViewModel</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) SJStaticCellType staticCellType;                  <span class="comment">//ç±»å‹</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *cellID;                                  <span class="comment">//cell reuser identifier</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> identifier;                              <span class="comment">//åŒºåˆ«æ¯ä¸ªcellï¼Œç”¨äºç‚¹å‡»</span></div><div class="line"><span class="comment">// =============== ç³»ç»Ÿé»˜è®¤cellå·¦ä¾§ =============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span>  *leftImage;                               <span class="comment">//å·¦ä¾§çš„imageï¼ŒæŒ‰éœ€ä¼ å…¥</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> leftImageSize;                              <span class="comment">//å·¦ä¾§imageçš„å¤§å°ï¼Œå­˜åœ¨é»˜è®¤è®¾ç½®</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *leftTitle;                               <span class="comment">//cellä¸»æ ‡é¢˜ï¼ŒæŒ‰éœ€ä¼ å…¥</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *leftLabelTextColor;                       <span class="comment">//å½“å‰ç»„cellå·¦ä¾§labelé‡Œæ–‡å­—çš„é¢œè‰²</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIFont</span> *leftLabelTextFont;                         <span class="comment">//å½“å‰ç»„cellå·¦ä¾§labelé‡Œæ–‡å­—çš„å­—ä½“</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> leftImageAndLabelGap;                      <span class="comment">//å·¦ä¾§imageå’Œlabelçš„è·ç¦»ï¼Œå­˜åœ¨é»˜è®¤å€¼</span></div><div class="line"><span class="comment">// =============== ç³»ç»Ÿé»˜è®¤cellå³ä¾§ =============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *indicatorLeftTitle;                      <span class="comment">//å³ä¾§ç®­å¤´å·¦ä¾§çš„æ–‡æœ¬ï¼ŒæŒ‰éœ€ä¼ å…¥</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *indicatorLeftLabelTextColor;              <span class="comment">//å³ä¾§æ–‡å­—çš„é¢œè‰²ï¼Œå­˜åœ¨é»˜è®¤è®¾ç½®ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIFont</span> *indicatorLeftLabelTextFont;                <span class="comment">//å³ä¾§æ–‡å­—çš„å­—ä½“ï¼Œå­˜åœ¨é»˜è®¤è®¾ç½®ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *indicatorLeftImage;                       <span class="comment">//å³ä¾§ç®­å¤´å·¦ä¾§çš„imageï¼ŒæŒ‰éœ€ä¼ å…¥</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> indicatorLeftImageSize;                     <span class="comment">//å³ä¾§å°–å¤´å·¦ä¾§imageå¤§å°ï¼Œå­˜åœ¨é»˜è®¤è®¾ç½®ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">readonly</span>)  <span class="built_in">BOOL</span> hasIndicatorImageAndLabel;         <span class="comment">//å³ä¾§å°–å¤´å·¦ä¾§çš„æ–‡æœ¬å’Œimageæ˜¯å¦åŒæ—¶å­˜åœ¨ï¼Œåªèƒ½é€šè¿‡å†…éƒ¨è®¡ç®—</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> indicatorLeftImageAndLabelGap;             <span class="comment">//å³ä¾§å°–å¤´å·¦ä¾§imageå’Œlabelçš„è·ç¦»ï¼Œå­˜åœ¨é»˜è®¤å€¼</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isImageFirst;                                 <span class="comment">//å³ä¾§å°–å¤´å·¦ä¾§çš„æ–‡æœ¬å’ŒimageåŒæ—¶å­˜åœ¨æ—¶ï¼Œæ˜¯å¦æ˜¯imageæŒ¨ç€ç®­å¤´ï¼Œé»˜è®¤ä¸ºYES</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) SwitchValueChagedBlock switchValueDidChangeBlock;    <span class="comment">//åˆ‡æ¢switchå¼€å…³çš„æ—¶å€™è°ƒç”¨çš„block</span></div><div class="line"><span class="comment">// =============== é•¿å®½æ•°æ® =============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> cellHeight;                                <span class="comment">//cellé«˜åº¦,é»˜è®¤æ˜¯44ï¼Œå¯ä»¥è®¾ç½®</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span>  leftTitleLabelSize;                        <span class="comment">//å·¦ä¾§é»˜è®¤Labelçš„sizeï¼Œä¼ å…¥textä»¥åå†…éƒ¨è®¡ç®—</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span>  indicatorLeftLabelSize;                    <span class="comment">//å³ä¾§labelçš„size</span></div><div class="line"><span class="comment">// =============== è‡ªå®šä¹‰cellçš„æ•°æ®æ”¾åœ¨è¿™é‡Œ =============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *avatarImage;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *codeImage;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *userName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *userID;</div></pre></td></tr></table></figure></p>
<p>sectionçš„viewModel(å¤§è‡´çœ‹ä¸€ä¸‹å³å¯ï¼Œåé¢æœ‰è¯¦ç»†è¯´æ˜)ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableviewSectionViewModel</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *sectionHeaderTitle;         <span class="comment">//è¯¥sectionçš„æ ‡é¢˜</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *sectionFooterTitle;         <span class="comment">//è¯¥sectionçš„æ ‡é¢˜</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span>  *cellViewModelsArray;        <span class="comment">//è¯¥sectionçš„æ•°æ®æº</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span>  sectionHeaderHeight;         <span class="comment">//headerçš„é«˜åº¦</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span>  sectionFooterHeight;         <span class="comment">//footerçš„é«˜åº¦</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> leftImageSize;                 <span class="comment">//å½“å‰ç»„cellå·¦ä¾§imageçš„å¤§å°</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *leftLabelTextColor;          <span class="comment">//å½“å‰ç»„cellå·¦ä¾§labelé‡Œæ–‡å­—çš„é¢œè‰²</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIFont</span> *leftLabelTextFont;            <span class="comment">//å½“å‰ç»„cellå·¦ä¾§labelé‡Œæ–‡å­—çš„å­—ä½“</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> leftImageAndLabelGap;         <span class="comment">//å½“å‰ç»„å·¦ä¾§imageå’Œlabelçš„è·ç¦»ï¼Œå­˜åœ¨é»˜è®¤å€¼</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *indicatorLeftLabelTextColor; <span class="comment">//å½“å‰ç»„cellå³ä¾§labelé‡Œæ–‡å­—çš„é¢œè‰²</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIFont</span> *indicatorLeftLabelTextFont;   <span class="comment">//å½“å‰ç»„cellå³ä¾§labelé‡Œæ–‡å­—çš„å­—ä½“</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> indicatorLeftImageSize;        <span class="comment">//å½“å‰ç»„cellå³ä¾§imageçš„å¤§å°</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> indicatorLeftImageAndLabelGap;<span class="comment">//å½“å‰ç»„cellå³ä¾§imageå’Œlabelçš„è·ç¦»ï¼Œå­˜åœ¨é»˜è®¤å€¼</span></div><div class="line">- (<span class="keyword">instancetype</span>)initWithCellViewModelsArray:(<span class="built_in">NSArray</span> *)cellViewModelsArray;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>ä½ å¯èƒ½ä¼šè§‰å¾—å±æ€§å¤ªå¤šäº†ï¼Œä½†è¿™äº›å±æ€§çš„å­˜åœ¨æ„ä¹‰æ˜¯ä¸ºcellçš„å®šåˆ¶æ€§æœåŠ¡çš„ï¼Œåœ¨åæ–‡ä¼šæœ‰è§£é‡Šã€‚</p>
</blockquote>
<p>ç°åœ¨äº†è§£äº†æˆ‘å°è£…å¥½çš„æ•°æ®æºï¼Œcellçš„viewModelï¼Œsectionçš„viewModelä»¥åï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ç¬¬äºŒä¸ªé—®é¢˜ï¼š</p>
<h2 id="é—®é¢˜2ï¼š-viewModelæ•°ç»„æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Ÿ"><a href="#é—®é¢˜2ï¼š-viewModelæ•°ç»„æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Ÿ" class="headerlink" title="é—®é¢˜2ï¼š viewModelæ•°ç»„æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Ÿ"></a>é—®é¢˜2ï¼š viewModelæ•°ç»„æ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Ÿ</h2><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è®¾ç½®é¡µçš„viewModelæ•°ç»„çš„è®¾ç½®ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSArray</span> *)settingPageData</div><div class="line">&#123;</div><div class="line">    <span class="comment">// ========== section 0</span></div><div class="line">    SJStaticTableviewCellViewModel *vm0 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm0.leftTitle = <span class="string">@"è´¦å·ä¸å®‰å…¨"</span>;</div><div class="line">    vm0.identifier = <span class="number">0</span>;</div><div class="line">    vm0.indicatorLeftTitle = <span class="string">@"å·²ä¿æŠ¤"</span>;</div><div class="line">    vm0.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"ProfileLockOn"</span>];</div><div class="line">    vm0.isImageFirst = <span class="literal">NO</span>;    </div><div class="line">    SJStaticTableviewSectionViewModel *section0 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm0]];</div><div class="line">    </div><div class="line">    <span class="comment">// ========== section 1</span></div><div class="line">    SJStaticTableviewCellViewModel *vm1 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm1.leftTitle = <span class="string">@"æ–°æ¶ˆæ¯é€šçŸ¥"</span>;</div><div class="line">    vm1.identifier = <span class="number">1</span>;    </div><div class="line">    <span class="comment">//é¢å¤–æ·»åŠ switch</span></div><div class="line">    SJStaticTableviewCellViewModel *vm7 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm7.leftTitle = <span class="string">@"å¤œé—´æ¨¡å¼"</span>;</div><div class="line">    vm7.switchValueDidChangeBlock = ^(<span class="built_in">BOOL</span> isON)&#123;</div><div class="line">        <span class="built_in">NSString</span> *message = isON?<span class="string">@"æ‰“å¼€å¤œé—´æ¨¡å¼"</span>:<span class="string">@"å…³é—­å¤œé—´æ¨¡å¼"</span>;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,message);</div><div class="line">    &#125;;</div><div class="line">    vm7.staticCellType = SJStaticCellTypeSystemAccessorySwitch;</div><div class="line">    vm7.identifier = <span class="number">7</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm8 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm8.leftTitle = <span class="string">@"æ¸…ç†ç¼“å­˜"</span>;</div><div class="line">    vm8.indicatorLeftTitle = <span class="string">@"12.3M"</span>;</div><div class="line">    vm8.identifier = <span class="number">8</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm2 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm2.leftTitle = <span class="string">@"éšç§"</span>;</div><div class="line">    vm2.identifier = <span class="number">2</span>;</div><div class="line">     </div><div class="line">    SJStaticTableviewCellViewModel *vm3 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm3.leftTitle = <span class="string">@"é€šç”¨"</span>;</div><div class="line">    vm3.identifier = <span class="number">3</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section1 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm1,vm7,vm8,vm2,vm3]];</div><div class="line"></div><div class="line">    <span class="comment">// ========== section 2</span></div><div class="line">    SJStaticTableviewCellViewModel *vm4 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm4.leftTitle = <span class="string">@"å¸®åŠ©ä¸åé¦ˆ"</span>;</div><div class="line">    vm4.identifier = <span class="number">4</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm5 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm5.leftTitle = <span class="string">@"å…³äºå¾®ä¿¡"</span>;</div><div class="line">    vm5.identifier = <span class="number">5</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section2 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm4,vm5]];</div><div class="line"></div><div class="line">      <span class="comment">// ========== section 4</span></div><div class="line">    SJStaticTableviewCellViewModel *vm9 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm9.leftTitle = <span class="string">@"å®šåˆ¶æ€§cellå±•ç¤ºé¡µé¢ - åˆ†ç»„"</span>;</div><div class="line">    vm9.identifier = <span class="number">9</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm10 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm10.leftTitle = <span class="string">@"å®šåˆ¶æ€§cellå±•ç¤ºé¡µé¢ - åŒç»„"</span>;</div><div class="line">    vm10.identifier = <span class="number">10</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section4 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm9,vm10]];</div><div class="line"></div><div class="line">    <span class="comment">// ========== section 3</span></div><div class="line">    SJStaticTableviewCellViewModel *vm6 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm6.staticCellType = SJStaticCellTypeSystemLogout;</div><div class="line">    vm6.cellID = <span class="string">@"logout"</span>;</div><div class="line">    vm6.identifier = <span class="number">6</span>;</div><div class="line">   </div><div class="line">    SJStaticTableviewSectionViewModel *section3 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm6]];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> @[section0,section1,section2,section4,section3];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œäº¤ç»™dataSourceçš„æ•°ç»„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç»´æ˜¯sectionæ•°ç»„ï¼Œå…ƒç´ æ˜¯æ¯ä¸€ä¸ªsectionå¯¹åº”çš„viewModelï¼š<code>SJStaticTableviewSectionViewModel</code>ã€‚</li>
<li>ç¬¬äºŒç»´æ˜¯cellæ•°ç»„ï¼Œå…ƒç´ æ˜¯æ¯ä¸€ä¸ªcellå¯¹åº”çš„viewModel:<code>SJStaticTableviewCellViewModel</code>ã€‚</li>
</ul>
<p>æœ‰å‡ ä¸ª<code>SJStaticTableviewCellViewModel</code>çš„å±æ€§éœ€è¦å¼ºè°ƒä¸€ä¸‹ï¼š</p>
<ol>
<li>isImageFirstï¼šå› ä¸ºè¯¥é¡µé¢ç¬¬ä¸€ç»„çš„cellå³ä¾§çš„ç®­å¤´å·¦è¾¹åŒæ—¶å­˜åœ¨ä¸€ä¸ªimageå’Œä¸€ä¸ªlabelï¼Œæ‰€ä»¥éœ€è¦é¢å¤–è®¾ç½®äºŒè€…çš„é¡ºåºã€‚å› ä¸ºé»˜è®¤ç´§æŒ¨ç€ç®­å¤´çš„æ˜¯å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡æ–°è®¾ç½®å®ƒä¸ºNOï¼Œä½œç”¨æ˜¯è®©labelç´§æŒ¨ç€ç®­å¤´ã€‚</li>
<li>identifierï¼šè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå®ƒç”¨æ¥æ ‡è®°æ¯ä¸ªcellï¼Œç”¨äºåœ¨ç”¨æˆ·ç‚¹å‡»cellçš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ã€‚æˆ‘æ²¡æœ‰å°†ç”¨æˆ·çš„ç‚¹å‡»ä¸cellçš„indexç›¸å…³è”ï¼Œæ˜¯å› ä¸ºæœ‰çš„æ—¶å€™å› ä¸ºéœ€æ±‚æˆ‘ä»¬å¯èƒ½ä¼šæ›´æ”¹cellçš„é¡ºåºæˆ–è€…åˆ é™¤æŸä¸ªcellï¼Œæ‰€ä»¥ä¾èµ–cellçš„indexæ˜¯ä¸å¦¥çš„ï¼Œå®¹æ˜“å‡ºé”™ã€‚</li>
<li>cellIDï¼šè¿™ä¸ªå±æ€§ç”¨æ¥cellçš„å¤ç”¨ã€‚å› ä¸ºæ€»æ˜¯æœ‰ä¸ªåˆ«cellçš„å¸ƒå±€æ˜¯ä¸åŒçš„ï¼šåœ¨è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªé€€å‡ºç™»å½•çš„cellï¼Œæ‰€ä»¥éœ€è¦å’Œå…¶ä»–çš„cellåŒºåˆ«å¼€æ¥ï¼ˆcellIDå¯ä»¥ä¸ç”¨è®¾ç½®ï¼Œæœ‰é»˜è®¤å€¼ï¼Œç”¨æ¥æ ‡è®°æœ€å¸¸ç”¨çš„cellç±»å‹ï¼‰ã€‚</li>
</ol>
<p>æ˜¾ç„¶ï¼Œ<code>Factory</code>ç±»å±äº<code>Model</code>ï¼Œå®ƒå°†â€œçº¯æ•°æ®â€äº¤ç»™äº†dataSourceä½¿ç”¨çš„ä¸¤ä¸ªviewModelã€‚è¿™ä¸ªç±»æ˜¯æˆ‘è‡ªå·±å®šä¹‰çš„ï¼Œè¯»è€…åœ¨ä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„æ—¶å€™å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªå·±å®šä¹‰ã€‚</p>
<p>ç°åœ¨çŸ¥é“äº†æ•°æ®æºçš„è®¾ç½®æ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<h2 id="é—®é¢˜3ï¼šcellçš„ç»˜åˆ¶æ–¹æ³•æ˜¯å¦‚ä½•åŒºåˆ†çš„ï¼Ÿ"><a href="#é—®é¢˜3ï¼šcellçš„ç»˜åˆ¶æ–¹æ³•æ˜¯å¦‚ä½•åŒºåˆ†çš„ï¼Ÿ" class="headerlink" title="é—®é¢˜3ï¼šcellçš„ç»˜åˆ¶æ–¹æ³•æ˜¯å¦‚ä½•åŒºåˆ†çš„ï¼Ÿ"></a>é—®é¢˜3ï¼šcellçš„ç»˜åˆ¶æ–¹æ³•æ˜¯å¦‚ä½•åŒºåˆ†çš„ï¼Ÿ</h2><p>å¿ƒç»†çš„åŒå­¦ä¼šå‘ç°ï¼Œåœ¨dataSourceçš„<code>cellForRow:</code>æ–¹æ³•é‡Œï¼Œæˆ‘ç”¨äº†blockæ–¹æ³•æ¥ç»˜åˆ¶äº†cellã€‚</p>
<p>å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªblockçš„å®šä¹‰ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^SJStaticCellConfigureBlock)(SJStaticTableViewCell *cell, SJStaticTableviewCellViewModel * viewModel);</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªblockåœ¨æ§åˆ¶å™¨é‡Œé¢å›è°ƒï¼Œé€šè¿‡åˆ¤æ–­cellçš„ç±»å‹æ¥ç»˜åˆ¶ä¸åŒçš„cellã€‚</p>
<p>é‚£ä¹ˆä¸åŒç±»å‹çš„cellæ˜¯å¦‚ä½•åŒºåˆ†çš„å‘¢ï¼Ÿ<br>â€” æˆ‘ç”¨çš„æ˜¯åˆ†ç±»ã€‚</p>
<p>æœ‰åˆ†ç±»ï¼Œå°±ä¸€å®šæœ‰ä¸€ä¸ªè¢«åˆ†ç±»çš„ç±»ï¼š <code>SJStaticTableViewCell</code></p>
<p>çœ‹ä¸€ä¸‹å®ƒçš„å¤´æ–‡ä»¶ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ‰€æœ‰celléƒ½æ˜¯è¿™ä¸ªç±»çš„åˆ†ç±»</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> : <span class="title">UITableViewCell</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) SJStaticTableviewCellViewModel *viewModel;</div><div class="line"><span class="comment">// =============== ç³»ç»Ÿé£æ ¼cellçš„æ‰€æœ‰æ§ä»¶ =============== //</span></div><div class="line"><span class="comment">//å·¦åŠéƒ¨åˆ†</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *leftImageView;               <span class="comment">//å·¦ä¾§çš„ImageView</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *leftTitleLabel;                  <span class="comment">//å·¦ä¾§çš„Label</span></div><div class="line"></div><div class="line"><span class="comment">//å³åŠéƒ¨åˆ†</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *indicatorArrow;              <span class="comment">//å³ä¾§çš„ç®­å¤´</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *indicatorLeftImageView;      <span class="comment">//å³ä¾§çš„ç®­å¤´çš„å·¦è¾¹çš„imageview</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *indicatorLeftLabel;              <span class="comment">//å³ä¾§çš„ç®­å¤´çš„å·¦è¾¹çš„Label</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UISwitch</span> *indicatorSwitch;                <span class="comment">//å³ä¾§çš„ç®­å¤´çš„å·¦è¾¹çš„å¼€å…³</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *logoutLabel;                     <span class="comment">//é€€å‡ºç™»å½•çš„label</span></div><div class="line"><span class="comment">// =============== ç”¨æˆ·è‡ªå®šä¹‰çš„cellé‡Œé¢çš„æ§ä»¶ =============== //</span></div><div class="line"><span class="comment">//MeViewControlleré‡Œé¢çš„å¤´åƒcell</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *avatarImageView;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *codeImageView;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *avatarIndicatorImageView;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *userNameLabel;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *userIdLabel;</div><div class="line"></div><div class="line"><span class="comment">//ç»Ÿä¸€çš„ï¼Œå¸ƒå±€cellå·¦ä¾§éƒ¨åˆ†çš„å†…å®¹ï¼ˆæ ‡é¢˜ ï¼ å›¾ç‰‡ + æ ‡é¢˜ï¼‰ï¼Œæ‰€æœ‰ç³»ç»Ÿé£æ ¼çš„celléƒ½è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•</span></div><div class="line">- (<span class="keyword">void</span>)layoutLeftPartSubViewsWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™é‡Œæˆ‘å®šä¹‰äº†æ‰€æœ‰çš„æ§ä»¶å’Œä¸€ä¸ªå¸ƒå±€cellå·¦ä¾§çš„æ§ä»¶çš„æ–¹æ³•ã€‚å› ä¸ºå‡ ä¹æ‰€æœ‰çš„åˆ†ç±»çš„å·¦ä¾§å‡ ä¹éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œæ‰€ä»¥å°†å®ƒæŠ½å–å‡ºæ¥ã€‚</p>
<p>é‚£ä¹ˆç©¶ç«Ÿæœ‰å‡ ä¸ªåˆ†ç±»å‘¢ï¼Ÿï¼ˆå¯ä»¥å‚è€ƒä¸Šé¢cellViewModelå¤´æ–‡ä»¶é‡Œçš„æšä¸¾ç±»å‹ï¼‰</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å³ä¾§æœ‰å‰ªå¤´çš„cellï¼ˆæœ€å¸¸è§ï¼‰</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">AccessoryDisclosureIndicator</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureAccessoryDisclosureIndicatorCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å³ä¾§æ²¡æœ‰æ§ä»¶çš„cell</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">AccessoryNone</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureAccessoryNoneCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å³ä¾§æ˜¯å¼€å…³çš„ cell</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">AccessorySwitch</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureAccessorySwitchCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//é€€å‡ºç™»å½•cell</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">Logout</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureLogoutTableViewCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ä¸€ä¸ªè‡ªå®šä¹‰çš„cellï¼ˆåœ¨ä¸ªäººé¡µçš„ç¬¬ä¸€æ’ï¼‰</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">MeAvatar</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureMeAvatarTableViewCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°ä¸æ»¡è¶³å½“å‰éœ€æ±‚çš„æƒ…å†µï¼Œå¯ä»¥è‡ªå·±æ·»åŠ åˆ†ç±»ã€‚</p>
<h2 id="é—®é¢˜4ï¼šUITableViewDelegateçš„æ–¹æ³•å“ªé‡Œå»äº†ï¼Ÿ"><a href="#é—®é¢˜4ï¼šUITableViewDelegateçš„æ–¹æ³•å“ªé‡Œå»äº†ï¼Ÿ" class="headerlink" title="é—®é¢˜4ï¼šUITableViewDelegateçš„æ–¹æ³•å“ªé‡Œå»äº†ï¼Ÿ"></a>é—®é¢˜4ï¼šUITableViewDelegateçš„æ–¹æ³•å“ªé‡Œå»äº†ï¼Ÿ</h2><p>è¯´åˆ°<code>UITableViewDelegate</code>çš„ä»£ç†æ–¹æ³•ï¼Œæˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„è«è¿‡äº<code>didSelectRowAtIndexPath:</code>äº†ã€‚</p>
<p>ä½†æ˜¯æˆ‘åœ¨å†™è¿™ä¸ªæ¡†æ¶çš„æ—¶å€™ï¼Œè‡ªå·±å®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿äº<code>UITableViewDelegate</code>çš„ä»£ç†ï¼š<code>SJStaticTableViewDelegate</code>ï¼Œå¹¶ç»™å®ƒæ·»åŠ äº†ä¸€ä¸ªä»£ç†æ–¹æ³•ï¼š<br>``<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SJStaticTableViewDelegate</span> &lt;<span class="title">UITableViewDelegate</span>&gt;</span></div><div class="line"><span class="keyword">@optional</span></div><div class="line">- (<span class="keyword">void</span>)didSelectViewModel: (SJStaticTableviewCellViewModel *)viewModel atIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯å½“å‰ç‚¹å‡»çš„cellå¯¹åº”çš„viewModelï¼Œå¼±åŒ–äº†indexPathçš„ä½œç”¨ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ</p>
<p>æƒ³ä¸€æƒ³åŸæ¥ç‚¹å‡»cellçš„ä»£ç†æ–¹æ³•ï¼š<code>didSelectRowAtIndexPath:</code>ã€‚æˆ‘ä»¬é€šè¿‡è¿™ä¸ªç‚¹å‡»æ–¹æ³•ï¼Œæ‹¿åˆ°çš„æ˜¯cellå¯¹åº”çš„indexPathï¼Œç„¶åå†é€šè¿‡è¿™ä¸ªindexPathï¼Œå°±å¯ä»¥åœ¨æ•°æ®æºé‡Œé¢æŸ¥æ‰¾å¯¹åº”çš„æ¨¡å‹ï¼ˆviewModelæˆ–è€…modelï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘å®šä¹‰çš„è¿™ä¸ªæ–¹æ³•ç›´æ¥è¿”å›äº†è¢«ç‚¹å‡»cellå¯¹åº”çš„viewModelï¼Œç­‰äºè¯´å¸®ä½¿ç”¨è€…èŠ‚çœäº†ä¸€ä¸ªæ­¥éª¤ã€‚å½“ç„¶å¦‚æœè¦ä½¿ç”¨çš„è¯ä¹Ÿå¯ä»¥ä½¿ç”¨ç³»ç»ŸåŸæ¥çš„<code>didSelectRowAtIndexPath:</code>æ–¹æ³•ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–°çš„ä»£ç†æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//SJStaticTableView.m</span></div><div class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    [tableView deselectRowAtIndexPath:indexPath animated:<span class="literal">YES</span>];</div><div class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span>.sjDelegate) &amp;&amp; [<span class="keyword">self</span>.sjDelegate respondsToSelector:<span class="keyword">@selector</span>(didSelectViewModel:atIndexPath:)]) &#123;        </div><div class="line">        SJStaticTableviewCellViewModel *cellViewModel = [<span class="keyword">self</span>.sjDataSource tableView:tableView cellViewModelAtIndexPath:indexPath];</div><div class="line">        [<span class="keyword">self</span>.sjDelegate didSelectViewModel:cellViewModel atIndexPath:indexPath];</div><div class="line">        </div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>((<span class="keyword">self</span>.sjDelegate)&amp;&amp; [<span class="keyword">self</span>.sjDelegate respondsToSelector:<span class="keyword">@selector</span>(tableView:didSelectRowAtIndexPath:)])&#123;</div><div class="line">        </div><div class="line">        [<span class="keyword">self</span>.sjDelegate tableView:tableView didSelectRowAtIndexPath:indexPath];        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨è¯»è€…åº”è¯¥å¤§è‡´äº†è§£äº†è¿™ä¸ªæ¡†æ¶çš„å®ç°æ€è·¯ï¼Œç°åœ¨æˆ‘è®²ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶çš„å®šåˆ¶æ€§ã€‚</p>
<h1 id="å®šåˆ¶æ€§"><a href="#å®šåˆ¶æ€§" class="headerlink" title="å®šåˆ¶æ€§"></a>å®šåˆ¶æ€§</h1><hr>
<p>è¿™ä¸ªæ¡†æ¶æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼šSJConst.hï¼Œå®ƒå®šä¹‰äº†è¿™ä¸ªæ¡†æ¶çš„æ‰€æœ‰é»˜è®¤æ•°æ®å’Œé»˜è®¤é…ç½®ï¼Œæ¯”å¦‚cellå·¦ä¾§lableçš„å­—ä½“ï¼Œé¢œè‰²ï¼›å·¦ä¾§labelå’Œimageçš„è·ç¦»ï¼›å³ä¾§labelçš„å­—ä½“å’Œé¢œè‰²ï¼Œå³ä¾§å›¾ç‰‡çš„é»˜è®¤å¤§å°ç­‰ç­‰ã€‚æ¥çœ‹ä¸€ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#ifndef SJConst_h</span></div><div class="line"><span class="meta">#define SJConst_h</span></div><div class="line"><span class="comment">//distance</span></div><div class="line"><span class="meta">#define SJScreenWidth      [UIScreen mainScreen].bounds.size.width</span></div><div class="line"><span class="meta">#define SJScreenHeight     [UIScreen mainScreen].bounds.size.height</span></div><div class="line"><span class="meta">#define SJTopGap 8               //same as bottom gap</span></div><div class="line"><span class="meta">#define SJLeftGap 12             //same as right gap</span></div><div class="line"><span class="meta">#define SJLeftMiddleGap 10       //in left  part: the gap between image and label</span></div><div class="line"><span class="meta">#define SJRightMiddleGap 6       //in right part: the gap between image and label</span></div><div class="line"><span class="meta">#define SJImgWidth 30            //default width and height</span></div><div class="line"><span class="meta">#define SJTitleWidthLimit 180    //limt width of left and right labels</span></div><div class="line"><span class="comment">//image</span></div><div class="line"><span class="meta">#define SJIndicatorArrow @<span class="meta-string">"arrow"</span></span></div><div class="line"><span class="comment">//font</span></div><div class="line"><span class="meta">#define SJLeftTitleTextFont               [UIFont systemFontOfSize:15]</span></div><div class="line"><span class="meta">#define SJLogoutButtonFont                [UIFont systemFontOfSize:16]</span></div><div class="line"><span class="meta">#define SJIndicatorLeftTitleTextFont      [UIFont systemFontOfSize:13]</span></div><div class="line"><span class="comment">//color</span></div><div class="line"><span class="meta">#define SJColorWithRGB(R,G,B,A)           [UIColor colorWithRed:R/255.0 green:G/255.0 blue:B/255.0 alpha:A]</span></div><div class="line"><span class="meta">#define SJLeftTitleTextColor              [UIColor blackColor]</span></div><div class="line"><span class="meta">#define SJIndicatorLeftTitleTextColor     SJColorWithRGB(136,136,136,1)</span></div><div class="line"><span class="meta">#endif /* SJConst_h */</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œå®šä¹‰çš„é»˜è®¤é…ç½®åœ¨cellViewModelå’ŒsectionViewModelåˆå§‹åŒ–çš„æ—¶å€™ä½¿ç”¨ï¼š</p>
<p>cellçš„viewModelï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//SJStaticTableviewCellViewModel.m</span></div><div class="line">- (<span class="keyword">instancetype</span>)init</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;        </div><div class="line">        _cellHeight = <span class="number">44</span>;</div><div class="line">        _cellID = <span class="string">@"defaultCell"</span>;</div><div class="line">        _staticCellType = SJStaticCellTypeSystemAccessoryDisclosureIndicator;<span class="comment">//é»˜è®¤æ˜¯å­˜åœ¨ä¸‰è§’ç®­å¤´çš„cell</span></div><div class="line">        _isImageFirst = <span class="literal">YES</span>;</div><div class="line">        </div><div class="line">        <span class="comment">//éƒ½æ˜¯é»˜è®¤é…ç½®</span></div><div class="line">        _leftLabelTextFont = SJLeftTitleTextFont;</div><div class="line">        _leftLabelTextColor = SJLeftTitleTextColor;</div><div class="line">        _leftImageSize = <span class="built_in">CGSizeMake</span>(SJImgWidth, SJImgWidth);</div><div class="line">        _leftImageAndLabelGap = SJLeftMiddleGap;</div><div class="line">        _indicatorLeftLabelTextFont = SJIndicatorLeftTitleTextFont;</div><div class="line">        _indicatorLeftLabelTextColor = SJIndicatorLeftTitleTextColor;</div><div class="line">        _indicatorLeftImageSize = <span class="built_in">CGSizeMake</span>(SJImgWidth, SJImgWidth);</div><div class="line">        _indicatorLeftImageAndLabelGap = SJRightMiddleGap;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>sectionçš„viewModelï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)initWithCellViewModelsArray:(<span class="built_in">NSArray</span> *)cellViewModelsArray</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        _sectionHeaderHeight = <span class="number">10</span>;</div><div class="line">        _sectionFooterHeight = <span class="number">10</span>;</div><div class="line">        _leftLabelTextFont = SJLeftTitleTextFont;</div><div class="line">        _leftLabelTextColor = SJLeftTitleTextColor;</div><div class="line">        _leftImageSize = <span class="built_in">CGSizeMake</span>(SJImgWidth, SJImgWidth);</div><div class="line">        _leftImageAndLabelGap = SJLeftMiddleGap;</div><div class="line">        _indicatorLeftLabelTextFont = SJIndicatorLeftTitleTextFont;</div><div class="line">        _indicatorLeftLabelTextColor = SJIndicatorLeftTitleTextColor;</div><div class="line">        _indicatorLeftImageSize = <span class="built_in">CGSizeMake</span>(SJImgWidth, SJImgWidth);</div><div class="line">        _indicatorLeftImageAndLabelGap = SJRightMiddleGap;</div><div class="line">        _cellViewModelsArray = cellViewModelsArray;        </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶ï¼Œè¿™ä¸ªé»˜è®¤é…ç½®åªæœ‰ä¸€ç»„ï¼Œä½†æ˜¯å¯èƒ½ä¸€ä¸ªappé‡Œé¢åŒæ—¶å­˜åœ¨ä¸€ä¸ªè®¾ç½®é¡µå’Œä¸€ä¸ªä¸ªäººé¡µã€‚è€Œè¿™ä¸¤ä¸ªé¡µé¢çš„é£æ ¼ä¹Ÿå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™ä¸ªé»˜è®¤é…ç½®åªèƒ½ç»™å…¶ä¸­ä¸€ä¸ªé¡µé¢ï¼Œå¦ä¸€ä¸ªé¡µé¢éœ€è¦å¦å¤–é…ç½®ï¼Œäºæ˜¯å°±æœ‰äº†å®šåˆ¶æ€§çš„åŠŸèƒ½ã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸‹å±•ç¤ºå®šåˆ¶æ€§æ•ˆæœçš„å›¾ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_2.png" alt="åˆ†ç»„å®šåˆ¶ | åŒç»„å®šåˆ¶"></p>
<p>å‚ç…§è¿™ä¸ªæ•ˆæœå›¾ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªé¡µé¢çš„æ•°æ®æºæ˜¯å¦‚ä½•è®¾ç½®çš„ï¼š</p>
<p>åˆ†ç»„é¡µé¢ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSArray</span> *)customCellsPageData</div><div class="line">&#123;</div><div class="line">    <span class="comment">//é»˜è®¤é…ç½®</span></div><div class="line">    SJStaticTableviewCellViewModel *vm1 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm1.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm1.leftTitle = <span class="string">@"å…¨éƒ¨é»˜è®¤é…ç½®ï¼Œç”¨äºå¯¹ç…§"</span>;</div><div class="line">    vm1.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm1.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section1 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm1]];</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm2 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm2.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm2.leftTitle = <span class="string">@"å·¦ä¾§å›¾ç‰‡å˜å°"</span>;</div><div class="line">    vm2.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm2.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section2 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm2]];</div><div class="line">    section2.leftImageSize = <span class="built_in">CGSizeMake</span>(<span class="number">20</span>, <span class="number">20</span>);</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm3 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm3.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm3.leftTitle = <span class="string">@"å­—ä½“å˜å°å˜çº¢"</span>;</div><div class="line">    vm3.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm3.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section3 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm3]];</div><div class="line">    section3.leftLabelTextFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">8</span>];</div><div class="line">    section3.leftLabelTextColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm4 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm4.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm4.leftTitle = <span class="string">@"å·¦ä¾§ä¸¤ä¸ªæ§ä»¶è·ç¦»å˜å¤§"</span>;</div><div class="line">    vm4.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm4.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section4 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm4]];</div><div class="line">    section4.leftImageAndLabelGap = <span class="number">20</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm5 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm5.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm5.leftTitle = <span class="string">@"å³ä¾§å›¾ç‰‡å˜å°"</span>;</div><div class="line">    vm5.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm5.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section5 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm5]];</div><div class="line">    section5.indicatorLeftImageSize = <span class="built_in">CGSizeMake</span>(<span class="number">15</span>, <span class="number">15</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm6= [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm6.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm6.leftTitle = <span class="string">@"å³ä¾§å­—ä½“å˜å¤§å˜è“"</span>;</div><div class="line">    vm6.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm6.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section6 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm6]];</div><div class="line">    section6.indicatorLeftLabelTextFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">18</span>];</div><div class="line">    section6.indicatorLeftLabelTextColor = [<span class="built_in">UIColor</span> blueColor];</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm7= [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm7.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm7.leftTitle = <span class="string">@"å³ä¾§ä¸¤ä¸ªæ§ä»¶è·ç¦»å˜å¤§"</span>;</div><div class="line">    vm7.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm7.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section7 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm7]];</div><div class="line">    section7.indicatorLeftImageAndLabelGap = <span class="number">18</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">return</span> @[section1,section2,section3,section4,section5,section6,section7];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®šåˆ¶çš„ä»£ç éƒ½ä½œç”¨äºsectionçš„viewModelã€‚</p>
</blockquote>
<p>åŒç»„é¡µé¢ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSArray</span> *)customCellsOneSectionPageData</div><div class="line">&#123;</div><div class="line">    <span class="comment">//é»˜è®¤é…ç½®</span></div><div class="line">    SJStaticTableviewCellViewModel *vm1 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm1.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm1.leftTitle = <span class="string">@"å…¨éƒ¨é»˜è®¤é…ç½®ï¼Œç”¨äºå¯¹ç…§"</span>;</div><div class="line">    vm1.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm1.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm2 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm2.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm2.leftTitle = <span class="string">@"å·¦ä¾§å›¾ç‰‡å˜å°"</span>;</div><div class="line">    vm2.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm2.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    vm2.leftImageSize = <span class="built_in">CGSizeMake</span>(<span class="number">20</span>, <span class="number">20</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm3 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm3.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm3.leftTitle = <span class="string">@"å­—ä½“å˜å°å˜çº¢"</span>;</div><div class="line">    vm3.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm3.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    vm3.leftLabelTextFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">8</span>];</div><div class="line">    vm3.leftLabelTextColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm4 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm4.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm4.leftTitle = <span class="string">@"å·¦ä¾§ä¸¤ä¸ªæ§ä»¶è·ç¦»å˜å¤§"</span>;</div><div class="line">    vm4.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm4.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    vm4.leftImageAndLabelGap = <span class="number">20</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm5 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm5.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm5.leftTitle = <span class="string">@"å³ä¾§å›¾ç‰‡å˜å°"</span>;</div><div class="line">    vm5.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm5.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    vm5.indicatorLeftImageSize = <span class="built_in">CGSizeMake</span>(<span class="number">15</span>, <span class="number">15</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm6= [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm6.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm6.leftTitle = <span class="string">@"å³ä¾§å­—ä½“å˜å¤§å˜è“"</span>;</div><div class="line">    vm6.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm6.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    vm6.indicatorLeftLabelTextFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">18</span>];</div><div class="line">    vm6.indicatorLeftLabelTextColor = [<span class="built_in">UIColor</span> blueColor];</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm7= [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm7.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm7.leftTitle = <span class="string">@"å³ä¾§ä¸¤ä¸ªæ§ä»¶è·ç¦»å˜å¤§"</span>;</div><div class="line">    vm7.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm7.indicatorLeftTitle = <span class="string">@"ç‹è€…è£è€€!"</span>;</div><div class="line">    vm7.indicatorLeftImageAndLabelGap = <span class="number">18</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section1 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm1,vm2,vm3,vm4,vm5,vm6,vm7]];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> @[section1];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ºäº†æ–¹ä¾¿æ¯”è¾ƒï¼ŒåŒç»„é¡µé¢çš„å®šåˆ¶å’Œåˆ†ç»„æ˜¯ä¸€è‡´çš„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®šåˆ¶ä»£ç éƒ½ä½œç”¨äºcellçš„viewModelä¸Šäº†ã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆè¦æœ‰åŒç»„å’Œåˆ†ç»„å±•ç¤ºï¼Ÿ</p>
<p>åŒç»„å’Œåˆ†ç»„å±•ç¤ºçš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†å±•ç¤ºè¿™ä¸ªæ¡†æ¶çš„ä¸¤ç§å®šåˆ¶æ€§ã€‚</p>
<ul>
<li><p>åˆ†ç»„é¡µé¢æ‰€å±•ç¤ºçš„æ˜¯sectionçº§çš„å®šåˆ¶æ€§ï¼šcellçš„é…ç½®ä»»åŠ¡äº¤ç»™sectionå±‚çš„viewModelã€‚ä¸€æ—¦è®¾ç½®ï¼Œè¯¥sectioné‡Œé¢çš„æ‰€æœ‰celléƒ½èƒ½ä¿æŒè¿™ä¸€é…ç½®ã€‚</p>
</li>
<li><p>åŒç»„é¡µé¢æ‰€å±•ç¤ºçš„æ˜¯cellçº§çš„å®šåˆ¶æ€§ï¼šcellçš„é…ç½®ä»»åŠ¡äº¤ç»™cellå±‚çš„viewModelã€‚ä¸€æ—¦è®¾ç½®ï¼Œåªæœ‰å½“å‰cellå…·æœ‰è¿™ä¸ªé…ç½®ï¼Œä¸å½±å“å…¶ä»–cellã€‚</p>
</li>
</ul>
<p>å…¶å®ä¸ºäº†çœäº‹ï¼Œåªåœ¨sectionå±‚çš„viewModelä¸Šé…ç½®å³å¯ï¼ˆå¦‚æœç»™æ¯ä¸ªcelléƒ½ç»™è®¾ç½®ç›¸åŒçš„é…ç½®å¤ªä¸ä¼˜é›…äº†ï¼‰ï¼Œå› ä¸ºä»è®¾è®¡è§’åº¦æ¥çœ‹ï¼Œä¸€ä¸ªsectioné‡Œé¢çš„cellçš„é£æ ¼ä¸ä¸€è‡´çš„æƒ…å†µæ¯”è¾ƒå°‘è§ï¼ˆæˆ‘è§‰å¾—ä¸ç¬¦åˆè®¾è®¡ï¼‰ï¼šæ¯”å¦‚åœ¨ä¸€ä¸ªsectioné‡Œé¢ï¼Œä¸å¤ªå¯èƒ½ä¸¤ä¸ªcellé‡Œé¢çš„å›¾ç‰‡å¤§å°æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ–è€…å­—ä½“å¤§å°ä¹Ÿä¸ä¸€æ ·ã€‚</p>
<p>è¿˜æ˜¯çœ‹ä¸€ä¸‹sectionçº§çš„å®šåˆ¶ä»£ç å§ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//é‡æ–°è®¾ç½®äº†è¯¥ç»„å…¨éƒ¨cellé‡Œé¢å·¦ä¾§labelçš„å­—ä½“</span></div><div class="line">- (<span class="keyword">void</span>)setLeftLabelTextFont:(<span class="built_in">UIFont</span> *)leftLabelTextFont</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (_leftLabelTextFont != leftLabelTextFont) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (![<span class="keyword">self</span> font1:_leftLabelTextFont hasSameFontSizeOfFont2:leftLabelTextFont]) &#123;</div><div class="line">            </div><div class="line">            _leftLabelTextFont = leftLabelTextFont;</div><div class="line">            </div><div class="line">            <span class="comment">//å¦‚æœæ–°çš„å®½åº¦å¤§äºåŸæ¥çš„å®½åº¦ï¼Œéœ€è¦é‡æ–°è®¾ç½®ï¼Œå¦åˆ™ä¸éœ€è¦</span></div><div class="line">            [_cellViewModelsArray enumerateObjectsUsingBlock:^(SJStaticTableviewCellViewModel * viewModel, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</div><div class="line">                viewModel.leftLabelTextFont = _leftLabelTextFont;</div><div class="line">                <span class="built_in">CGSize</span> size = [<span class="keyword">self</span> sizeForTitle:viewModel.leftTitle withFont:_leftLabelTextFont];</div><div class="line">                <span class="keyword">if</span> (size.width &gt; viewModel.leftTitleLabelSize.width) &#123;</div><div class="line">                    viewModel.leftTitleLabelSize = size;</div><div class="line">                &#125;</div><div class="line">            &#125;];</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//é‡æ–°è®¾ç½®äº†è¯¥ç»„å…¨éƒ¨cellé‡Œé¢å·¦ä¾§labelçš„å­—çš„é¢œè‰²</span></div><div class="line">- (<span class="keyword">void</span>)setLeftLabelTextColor:(<span class="built_in">UIColor</span> *)leftLabelTextColor</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span> color1:_leftLabelTextColor hasTheSameRGBAOfColor2:leftLabelTextColor]) &#123;</div><div class="line">         _leftLabelTextColor = leftLabelTextColor;</div><div class="line">        [_cellViewModelsArray makeObjectsPerformSelector:<span class="keyword">@selector</span>(setLeftLabelTextColor:) withObject:_leftLabelTextColor];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//é‡æ–°è®¾ç½®äº†è¯¥ç»„å…¨éƒ¨cellé‡Œé¢å·¦ä¾§å›¾ç‰‡ç­‰å¤§å°</span></div><div class="line">- (<span class="keyword">void</span>)setLeftImageSize:(<span class="built_in">CGSize</span>)leftImageSize</div><div class="line">&#123;</div><div class="line">    SJStaticTableviewCellViewModel *viewMoel = _cellViewModelsArray.firstObject;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> cellHeight = viewMoel.cellHeight;</div><div class="line">    <span class="keyword">if</span> ( (!<span class="built_in">CGSizeEqualToSize</span>(_leftImageSize, leftImageSize)) &amp;&amp; (leftImageSize.height &lt; cellHeight)) &#123;</div><div class="line">        _leftImageSize = leftImageSize;</div><div class="line">        [_cellViewModelsArray enumerateObjectsUsingBlock:^(SJStaticTableviewCellViewModel *viewModel, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop)</div><div class="line">        &#123;</div><div class="line">            viewMoel.leftImageSize = _leftImageSize;</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å› ä¸ºæ¯ä¸ªsectionéƒ½æŒæœ‰å®ƒå†…éƒ¨çš„æ‰€æœ‰cellçš„viewModelï¼Œæ‰€ä»¥åœ¨setæ–¹æ³•é‡Œé¢ï¼Œå¦‚æœå‘ç°ä¼ è¿›æ¥çš„é…ç½®ä¸å½“å‰é…ç½®ä¸ä¸€è‡´ï¼Œå°±éœ€è¦æ›´æ–°æ‰€æœ‰cellçš„viewModelå¯¹åº”çš„å±æ€§ã€‚</p>
<p>æ—¢ç„¶sectionçš„ViewModelèƒ½åšè¿™äº›ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸€ä¸ªcellå±‚çš„é…ç½®å‘¢ï¼Ÿ</p>
<p>â€“ åªæ˜¯ä¸ºäº†æé«˜é…ç½®çš„è‡ªç”±åº¦ç½¢äº†ï¼Œä¸‡ä¸€çªç„¶æ¥ä¸ªéœ€æ±‚éœ€è¦æŸä¸ªcellå¾ˆç‹¬ç‰¹å‘¢ï¼Ÿï¼ˆå¤§å®¶åº”è¯¥çŸ¥é“æˆ‘è¯´çš„ç¥ä¹ˆæ„æ€ ^^ï¼‰</p>
<p>cellçš„viewModelå±æ€§çš„setæ–¹æ³•çš„å®ç°å’Œsectionçš„ä¸€è‡´ï¼Œè¿™é‡Œå°±ä¸ä¸Šä»£ç äº†ã€‚</p>
<hr>
<p>å¥½äº†ï¼Œåˆ°è¿™é‡Œå°±è®²å·®ä¸å¤šäº†ï¼Œä»£ç é‡è™½ç„¶ä¸å¤šï¼Œä½†æ˜¯éƒ½è¯´æ¸…æ¥šè¿˜æ˜¯æ„Ÿè§‰æŒºéœ€è¦æ—¶é—´æƒ³çš„ã€‚</p>
<p>å¸Œæœ›å¦‚æœå„ä½è§‰å¾—å“ªé‡Œä¸å¥½ï¼Œå¯ä»¥ç»™å‡ºæ‚¨çš„å®è´µæ„è§ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å†™UITableViewçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°çš„æ˜¯å®Œå…¨ä¾èµ–äºç½‘ç»œè¯·æ±‚ï¼Œéœ€è¦è‡ªå®šä¹‰çš„åŠ¨æ€cellçš„éœ€æ±‚ï¼ˆæ¯”å¦‚å¾®åšå¸–å­åˆ—è¡¨ï¼‰ã€‚ä½†æ˜¯åŒæ—¶ï¼Œå¤§å¤šæ•°appé‡Œé¢å‡ ä¹ä¹Ÿéƒ½æœ‰è®¾ç½®é¡µï¼Œä¸ªäººé¡µç­‰å…¶ä»–ä»¥é™æ€è¡¨æ ¼ä¸ºä¸»çš„é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸”è¿™äº›é¡µé¢çš„å…±æ€§æ¯”è¾ƒå¤šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤§å¤šæ•°æƒ…å†µä¸‹åœ¨è¿›å…¥é¡µé¢ä¹‹å‰å°±å·²ç»æ‹¿åˆ°æ‰€æœ‰æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;cellæ ·å¼å•ä¸€ï¼Œè‡ªå®šä¹‰cellå‡ºç°çš„å‡ ç‡æ¯”è¾ƒå°ï¼ˆå‡ ä¹éƒ½æ˜¯é«˜åº¦ä¸º44çš„cellï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¤šæ•°éƒ½åˆ†ç»„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› ä¸ºè‡ªå·±éå¸¸æƒ³å†™ä¸€ä¸ªå¼€æºçš„ä¸œè¥¿å‡ºæ¥ï¼ˆä¹Ÿå¯ä»¥æš´éœ²è‡ªå·±çš„ä¸è¶³ï¼‰ï¼ŒåŒæ—¶åˆå—é™äºæ°´å¹³ï¼Œæ‰€ä»¥å°±æ‰“ç®—å†™è¿™ä¹ˆä¸€ä¸ªæ¯”è¾ƒç®€å•ï¼Œåˆå…·æœ‰é€šç”¨æ€§çš„æ¡†æ¶ï¼š&lt;strong&gt;ä¸€ä¸ªå®šåˆ¶æ€§æ¯”è¾ƒé«˜çš„é€‚åˆåœ¨ä¸ªäººé¡µå’Œè®¾ç½®é¡µä½¿ç”¨çš„UITableView&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨çœŸæ­£å†™ä¹‹å‰ï¼Œçœ‹äº†å‡ ç¯‡ç±»ä¼¼çš„æ–‡ç« ï¼ŒæŒ‘å‡ºä¸‰ç¯‡è‡ªå·±è§‰å¾—æ¯”è¾ƒå¥½çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.objc.io/issues/1-view-controllers/table-views/&quot;&gt;Clean Table View Code&lt;/a&gt; &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/504c61a9dc82&quot;&gt;å¦‚ä½•å†™å¥½ä¸€ä¸ªUITableView&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/81d0c573f7a8&quot;&gt;åˆ©ç”¨MVVMè®¾è®¡å¿«é€Ÿå¼€å‘ä¸ªäººä¸­å¿ƒã€è®¾ç½®ç­‰æ¨¡å—&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹å®Œæ€»ç»“ä¹‹åï¼Œåˆ©ç”¨ä¸Šå‘¨3å¤©çš„ä¸šä½™æ—¶é—´å†™å¥½äº†è¿™ä¸ªæ¡†æ¶ï¼Œä¸ºäº†å®ƒå®ç”¨æ€§ï¼Œæˆ‘ä»¿ç…§äº†å¾®ä¿¡å®¢æˆ·ç«¯çš„å‘ç°é¡µï¼Œä¸ªäººé¡µå’Œè®¾ç½®é¡µå†™äº†ä¸€ä¸ªDemoï¼Œæ¥çœ‹ä¸€ä¸‹æ•ˆæœå›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_1.png&quot; alt=&quot;å‘ç°é¡µ | ä¸ªäººé¡µ | ä¸ªäººä¿¡æ¯é¡µ | è®¾ç½®é¡µ&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Production" scheme="https://github.com/knightsj/knightsj.github.io/categories/Production/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>å…ˆæ˜¯ç¨‹åºå‘˜ï¼Œç„¶åæ‰æ˜¯iOSç¨‹åºå‘˜ â€” å†™ç»™å¹¿å¤§éç§‘ç­iOSå¼€å‘è€…çš„ä¸€ç¯‡é¢è¯•æ€»ç»“</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/03/14/%E5%85%88%E6%98%AF%E7%A8%8B%E5%BA%8F%E5%91%98%EF%BC%8C%E7%84%B6%E5%90%8E%E6%89%8D%E6%98%AFiOS%E7%A8%8B%E5%BA%8F%E5%91%98%20%E2%80%94%20%E5%86%99%E7%BB%99%E5%B9%BF%E5%A4%A7%E9%9D%9E%E7%A7%91%E7%8F%ADiOS%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E4%B8%80%E7%AF%87%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/03/14/å…ˆæ˜¯ç¨‹åºå‘˜ï¼Œç„¶åæ‰æ˜¯iOSç¨‹åºå‘˜ â€” å†™ç»™å¹¿å¤§éç§‘ç­iOSå¼€å‘è€…çš„ä¸€ç¯‡é¢è¯•æ€»ç»“/</id>
    <published>2017-03-14T00:37:08.000Z</published>
    <updated>2017-03-20T07:56:04.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/859001-10c56d4121bfe78d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Objective-C | Swift | C"></p>
<p>è¿™ç¯‡é¢è¯•æ€»ç»“å¾ˆçŸ­ï¼Œä¹Ÿæ²¡æœ‰é¢è¯•é¢˜çš„ç­”æ¡ˆï¼Œåªæ˜¯å†™ç»™åƒæˆ‘ä¸€æ ·çš„éç§‘ç­iOSå¼€å‘è€…çš„ä¸€äº›è¯ã€‚</p>
<p>æ˜¨å¤©è¿›è¡Œäº†äººç”Ÿç¬¬ä¸€æ¬¡è§†é¢‘é¢è¯•ï¼Œä¸€å…±ä¸‰ä¸ªå°æ—¶çš„æŠ€æœ¯é¢ï¼Œè¿˜æ²¡è§åˆ°äººäº‹ï¼Œåº”è¯¥æ˜¯æŒ‚äº†ã€‚</p>
<p>ä¸è¿‡æ•´ä¸ªè¿‡ç¨‹ä¸‹æ¥æ„Ÿè§¦è¿˜æ˜¯è›®å¤šçš„ï¼Œé™¤äº†æ„Ÿå—åˆ°é¢è¯•å®˜çš„ç‰›Xä¹‹å¤–ï¼Œä¹ŸçŸ¥é“è‡ªå·±å¹³æ—¶åœ¨å­¦ä¹ ä¸­çš„ä¸è¶³ã€‚</p>
<h4 id="å…ˆä»‹ç»ä¸€ä¸‹é¢è¯•ä¸­è§‰å¾—æ¯”è¾ƒåƒåŠ›çš„é—®é¢˜ï¼š"><a href="#å…ˆä»‹ç»ä¸€ä¸‹é¢è¯•ä¸­è§‰å¾—æ¯”è¾ƒåƒåŠ›çš„é—®é¢˜ï¼š" class="headerlink" title="å…ˆä»‹ç»ä¸€ä¸‹é¢è¯•ä¸­è§‰å¾—æ¯”è¾ƒåƒåŠ›çš„é—®é¢˜ï¼š"></a>å…ˆä»‹ç»ä¸€ä¸‹é¢è¯•ä¸­è§‰å¾—æ¯”è¾ƒåƒåŠ›çš„é—®é¢˜ï¼š</h4><ol>
<li>å¦‚æœè®©ä½ å®ç°å±æ€§çš„weakï¼Œå¦‚ä½•å®ç°çš„ï¼Ÿ</li>
<li>å¦‚æœè®©ä½ æ¥å®ç°å±æ€§çš„atomicï¼Œå¦‚ä½•å®ç°ï¼Ÿ</li>
<li>KVOä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Ÿ</li>
<li>ç±»ç»“æ„ä½“çš„ç»„æˆï¼ŒisaæŒ‡é’ˆæŒ‡å‘äº†ä»€ä¹ˆï¼Ÿï¼ˆè¿™é‡Œåº”è¯¥å°†å…ƒç±»å’Œæ ¹å…ƒç±»ä¹Ÿè¯´ä¸€ä¸‹ï¼‰</li>
<li>RunLoopæœ‰å‡ ç§äº‹ä»¶æºï¼Ÿæœ‰å‡ ç§æ¨¡å¼ï¼Ÿ</li>
<li>æ–¹æ³•åˆ—è¡¨çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>åˆ†ç±»æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸ºä»€ä¹ˆä¼šè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•ï¼Ÿ</li>
</ol>
<p>å¦å¤–å€¼å¾—ä¸€æçš„å°±æ˜¯é—®äº†æˆ‘è‡ªå·±å†™çš„åšå®¢é‡Œçš„ä¸œè¥¿ï¼ˆJSONModelçš„è§£æï¼ŒEOCçš„ç¬”è®°ï¼‰ç­‰ç­‰ã€‚ã€‚</p>
<a id="more"></a>
<h4 id="è¿™æ¬¡é¢è¯•è®©æˆ‘æ·±åˆ»æ„è¯†åˆ°äº†ä¸¤ç‚¹ï¼š"><a href="#è¿™æ¬¡é¢è¯•è®©æˆ‘æ·±åˆ»æ„è¯†åˆ°äº†ä¸¤ç‚¹ï¼š" class="headerlink" title="è¿™æ¬¡é¢è¯•è®©æˆ‘æ·±åˆ»æ„è¯†åˆ°äº†ä¸¤ç‚¹ï¼š"></a>è¿™æ¬¡é¢è¯•è®©æˆ‘æ·±åˆ»æ„è¯†åˆ°äº†ä¸¤ç‚¹ï¼š</h4><ol>
<li>å¯¹äºæ¯ä¸ªè®¾è®¡ï¼Œä¸èƒ½åªåœç•™åœ¨â€œä¼šç”¨â€è€Œå·²ï¼Œåº”è¯¥ç†è§£å®ƒçš„å®ç°æœºåˆ¶ï¼Œè€Œä¸”å‡ ä¹æ¯ä¸ªè®¾è®¡éƒ½æ˜¯ä¸æ•°æ®ç»“æ„æ¯æ¯ç›¸å…³çš„ï¼Œç†è§£äº†æ•°æ®ç»“æ„å’ŒæŒ‡é’ˆä¼šæœ‰åŠ©äºç†è§£è¿™äº›è®¾è®¡ã€‚</li>
<li>äº†è§£è®¾è®¡çš„åŸç†ä¹‹åï¼Œè¿˜è¦çŸ¥å…¶æ‰€ä»¥ç„¶ï¼šä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Ÿæœ€å¥½è¿˜è¦çŸ¥é“è¿™ä¸ªè®¾è®¡å­˜åœ¨ä»€ä¹ˆç¼ºé™·ï¼Œè¿™ä¸ªç¼ºé™·æ˜¯å“ªä¸ªè§£å†³ç±»ä¼¼é—®é¢˜çš„è®¾è®¡æ‰€æ²¡æœ‰çš„ï¼Ÿ</li>
</ol>
<p>ç¬¬ä¸€ç‚¹æ˜¯â€œhowâ€çš„é—®é¢˜ï¼Œç¬¬äºŒç‚¹æ˜¯â€œwhyâ€çš„é—®é¢˜ï¼Œç„¶è€Œæˆ‘ç›¸ä¿¡æœ‰ä¸å°‘äººåªåœç•™åœ¨â€œwhatâ€å’Œâ€œusingâ€ä¸Šã€‚</p>
<p>åœ¨é¢è¯•çš„æ—¶å€™ï¼Œæˆ‘å¼ºçƒˆæ„Ÿå—åˆ°äº†é¢è¯•å®˜çš„åŠŸåŠ›ä¹‹æ·±ï¼šç»™æˆ‘çš„æ„Ÿè§‰ï¼Œå¯¹ä»–è€Œè¨€ï¼Œå‡ ä¹æ‰€æœ‰çš„è®¾è®¡éƒ½å¯ä»¥ç”¨æŸç§æ•°æ®ç»“æ„è§£é‡Šå‡ºæ¥ï¼ˆæœ‰çš„æ—¶å€™ä¹Ÿä¼šç»“åˆæŒ‡é’ˆï¼‰ï¼Œå¯¹çŸ¥è¯†ç‚¹ç†è§£å¾—éå¸¸é€å½»ï¼šå³ä¾¿æ˜¯å¾ˆç®€å•çŸ¥è¯†ç‚¹ï¼Œä¹Ÿèƒ½è¯´å‡ºå¾ˆå¤šæ·±å±‚æ¬¡çš„ä¸œè¥¿æ¥ã€‚è€Œæˆ‘è‡ªå·±åªæ˜¯åˆšå¼€å§‹å­¦æ•°æ®ç»“æ„ä¸ä¹…ï¼Œåœ¨é¢å¯¹æåˆ°æ•°æ®ç»“æ„çš„é—®é¢˜å‡ ä¹æ˜¯æ²¡æœ‰æ€è·¯çš„ã€‚</p>
<h4 id="æˆ‘æƒ³è¯´çš„ï¼š"><a href="#æˆ‘æƒ³è¯´çš„ï¼š" class="headerlink" title="æˆ‘æƒ³è¯´çš„ï¼š"></a>æˆ‘æƒ³è¯´çš„ï¼š</h4><p>æ‰€ä»¥æˆ‘è§‰å¾—å¯¹äºå¹¿å¤§éç§‘ç­çš„iOSå¼€å‘æ¥è¯´ï¼Œå¦‚æœæƒ³åœ¨iOSå¼€å‘ä¸Šèµ°è¿œï¼Œå°±å¿…é¡»å°½å¿«è¡¥å……æ•°æ®ç»“æ„ï¼Œç®—æ³•ï¼ŒæŒ‡é’ˆç­‰è®¡ç®—æœºåŸºç¡€çŸ¥è¯†ï¼Œä¸ç„¶ä¼šå¯¹çŸ¥è¯†çš„ç†è§£å½¢æˆå¾ˆå¤§çš„é˜»åŠ›ã€‚å› ä¸ºåªæœ‰çŸ¥é“äº†è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œæ‰èƒ½æ›´æ·±å…¥å¾—ç†è§£æ¯ä¸€ä¸ªæŠ€æœ¯ç‚¹ï¼Œè€Œä¸”ä»¥åå¦‚æœå­¦ä¹ å…¶ä»–çš„è¯­è¨€ï¼Œä¹Ÿä¼šæ›´é«˜æ•ˆä¸€äº›ã€‚</p>
<p>ç®€å•æ¥è¯´å°±ä¸€å¥è¯ï¼šå…ˆæ˜¯ç¨‹åºå‘˜ï¼Œç„¶åæ‰æ˜¯iOSç¨‹åºå‘˜ã€‚åªæœ‰è¿™æ ·æ€è€ƒï¼Œè·¯æ‰èƒ½è¶Šèµ°è¶Šå®½ï¼Œè¶Šèµ°è¶Šå¿«ï¼Œè¶Šèµ°è¶Šè¿œã€‚</p>
<p>ç°åœ¨iOSå¼€å‘å½¢åŠ¿è¿™ä¹ˆä¸å¥½ï¼Œå¸‚åœºè¦è¿‡æ»¤æ‰é‚£äº›è®¡ç®—æœºåŸºç¡€çŸ¥è¯†è–„å¼±çš„äººä¹Ÿæ˜¯æƒ…æœ‰å¯åŸçš„ã€‚</p>
<blockquote>
<p>æ‰€è°“çš„ç°åœ¨çš„â€œä¸å¥½â€ï¼Œåªæ˜¯ç›¸å¯¹äºä¹‹å‰â€œä¸æ­£å¸¸çš„å¥½â€çš„ä¸å¥½ã€‚ç°åœ¨è¿™ä¸ªè¡Œä¸šå˜å¾—â€œä¸å¥½â€ï¼Œå…¶å®æ˜¯å› ä¸ºè¿™ä¸ªè¡Œä¸šæ­£åœ¨å˜å¾—å¥½ï¼Œåº”è¯¥å€¼å¾—æˆ‘ä»¬é«˜å…´æ‰æ˜¯ã€‚</p>
</blockquote>
<p>æ‰€ä»¥å¯¹äºæˆ‘ä»¬è¿™ç¾¤äººï¼ˆéç§‘ç­çš„iOSå¼€å‘è€…ï¼‰ï¼Œåº”è¯¥æé«˜å¿§æ‚£æ„è¯†ï¼Œæœªé›¨ç»¸ç¼ªï¼Œæ›´ä½•å†µï¼Œé›¨å·²ç»æ¥è¿‡äº†ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-0dc7553fc98a04f7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼špixabay.com"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-10c56d4121bfe78d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;Objective-C | Swift | C&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡é¢è¯•æ€»ç»“å¾ˆçŸ­ï¼Œä¹Ÿæ²¡æœ‰é¢è¯•é¢˜çš„ç­”æ¡ˆï¼Œåªæ˜¯å†™ç»™åƒæˆ‘ä¸€æ ·çš„éç§‘ç­iOSå¼€å‘è€…çš„ä¸€äº›è¯ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¨å¤©è¿›è¡Œäº†äººç”Ÿç¬¬ä¸€æ¬¡è§†é¢‘é¢è¯•ï¼Œä¸€å…±ä¸‰ä¸ªå°æ—¶çš„æŠ€æœ¯é¢ï¼Œè¿˜æ²¡è§åˆ°äººäº‹ï¼Œåº”è¯¥æ˜¯æŒ‚äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æ•´ä¸ªè¿‡ç¨‹ä¸‹æ¥æ„Ÿè§¦è¿˜æ˜¯è›®å¤šçš„ï¼Œé™¤äº†æ„Ÿå—åˆ°é¢è¯•å®˜çš„ç‰›Xä¹‹å¤–ï¼Œä¹ŸçŸ¥é“è‡ªå·±å¹³æ—¶åœ¨å­¦ä¹ ä¸­çš„ä¸è¶³ã€‚&lt;/p&gt;
&lt;h4 id=&quot;å…ˆä»‹ç»ä¸€ä¸‹é¢è¯•ä¸­è§‰å¾—æ¯”è¾ƒåƒåŠ›çš„é—®é¢˜ï¼š&quot;&gt;&lt;a href=&quot;#å…ˆä»‹ç»ä¸€ä¸‹é¢è¯•ä¸­è§‰å¾—æ¯”è¾ƒåƒåŠ›çš„é—®é¢˜ï¼š&quot; class=&quot;headerlink&quot; title=&quot;å…ˆä»‹ç»ä¸€ä¸‹é¢è¯•ä¸­è§‰å¾—æ¯”è¾ƒåƒåŠ›çš„é—®é¢˜ï¼š&quot;&gt;&lt;/a&gt;å…ˆä»‹ç»ä¸€ä¸‹é¢è¯•ä¸­è§‰å¾—æ¯”è¾ƒåƒåŠ›çš„é—®é¢˜ï¼š&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;å¦‚æœè®©ä½ å®ç°å±æ€§çš„weakï¼Œå¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚æœè®©ä½ æ¥å®ç°å±æ€§çš„atomicï¼Œå¦‚ä½•å®ç°ï¼Ÿ&lt;/li&gt;
&lt;li&gt;KVOä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç±»ç»“æ„ä½“çš„ç»„æˆï¼ŒisaæŒ‡é’ˆæŒ‡å‘äº†ä»€ä¹ˆï¼Ÿï¼ˆè¿™é‡Œåº”è¯¥å°†å…ƒç±»å’Œæ ¹å…ƒç±»ä¹Ÿè¯´ä¸€ä¸‹ï¼‰&lt;/li&gt;
&lt;li&gt;RunLoopæœ‰å‡ ç§äº‹ä»¶æºï¼Ÿæœ‰å‡ ç§æ¨¡å¼ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ–¹æ³•åˆ—è¡¨çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;åˆ†ç±»æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸ºä»€ä¹ˆä¼šè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦å¤–å€¼å¾—ä¸€æçš„å°±æ˜¯é—®äº†æˆ‘è‡ªå·±å†™çš„åšå®¢é‡Œçš„ä¸œè¥¿ï¼ˆJSONModelçš„è§£æï¼ŒEOCçš„ç¬”è®°ï¼‰ç­‰ç­‰ã€‚ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Career" scheme="https://github.com/knightsj/knightsj.github.io/categories/Career/"/>
    
    
      <category term="Life" scheme="https://github.com/knightsj/knightsj.github.io/tags/Life/"/>
    
      <category term="Job" scheme="https://github.com/knightsj/knightsj.github.io/tags/Job/"/>
    
  </entry>
  
  <entry>
    <title>JSONModelæºç è§£æ</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/02/22/JSONModel%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/02/22/JSONModelæºç è§£æ/</id>
    <published>2017-02-22T01:16:56.000Z</published>
    <updated>2017-03-20T07:56:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸€ç³»åˆ—çš„<a href="http://www.jianshu.com/nb/9137726" target="_blank" rel="external">æºç è§£æ</a>åˆ†äº«åˆ°ç°åœ¨å·²ç»æ˜¯ç¬¬äº”ç¯‡äº†ã€‚è¿™äº”ç¯‡è®²è§£çš„éƒ½æ˜¯viewå±‚çš„ä¸€äº›æµè¡Œçš„iOSå¼€æºæ¡†æ¶ã€‚è€Œä»æœ¬ç¯‡å¼€å§‹å¼€å§‹ï¼Œæˆ‘æ‰“ç®—è¦é€æ¸åŠ æ·±éš¾åº¦ï¼Œè®²è§£ä¸€äº›modelå±‚å’Œç½‘ç»œå±‚ç›¸å…³çš„å¼€æºæ¡†æ¶ã€‚</p>
<p>æƒ³æ¥æƒ³å»ï¼Œè¿˜æ˜¯ä»<a href="https://github.com/jsonmodel/jsonmodel">JSONModel</a>å¼€å§‹å§ï½</p>
<p>é¦–å…ˆå› ä¸ºè¯¥æ¡†æ¶è¿˜æ˜¯æ¯”è¾ƒæµè¡Œçš„ï¼Œåœ¨GitHubä¸Šä¹Ÿæœ‰å°†è¿‘6000é¢—æ˜Ÿäº†ï¼Œè€Œä¸”æˆ‘è‡ªå·±å¯¹è¿™ä¸ªæ¡†æ¶çš„ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç†Ÿæ‚‰ã€‚è¿˜æœ‰ä¸€ç‚¹æ˜¯è¿™ä¸ªæ¡†æ¶è¿ç”¨äº†è¿è¡Œæ—¶çš„ç›¸å…³çŸ¥è¯†ï¼Œå¯¹æƒ³è¦äº†è§£è¿è¡Œæ—¶çš„ç«¥é‹è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p>
<p>è¯¥æ¡†æ¶çš„æ ¸å¿ƒä»£ç å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œä¸»è¦è¿˜æ˜¯é”™è¯¯ç±»å‹åˆ¤æ–­å’Œå®¹é”™å¤„ç†å äº†ä¸å°‘å†…å®¹ã€‚è¯»è¿‡ä¸€éä¹‹åï¼Œæ„Ÿè§‰åˆ°ä½œè€…æ€ç»´çš„ä¸¥è°¨æ€§æ˜¯éå¸¸å€¼å¾—æˆ‘ä»¬å­¦ä¹ çš„ï¼šä½œè€…ä¸“é—¨å»ºç«‹äº†ä¸€ä¸ªå±•ç¤ºé”™è¯¯(NSError)çš„ç±»ï¼Œé‡Œé¢å°è£…äº†å¾ˆå¤šé”™è¯¯ç±»å‹ï¼Œè€Œä¸”è¿™ä¸ªæ¡†æ¶è¿˜å…è®¸ç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥è‡ªå®šä¹‰é”™è¯¯ç±»å‹å¹¶é˜»æ­¢æœ€ç»ˆæ¨¡å‹çš„ç”Ÿæˆï¼Œåœ¨åæ–‡ä¼šæœ‰è¯¦ç»†è®²è§£ã€‚</p>
<a id="more"></a>
<p>åœ¨è®²è§£æºç ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆç»™ä¸ä¼šä½¿ç”¨JSONModelçš„åŒå­¦ä»¬é€šè¿‡å®é™…çš„ä¾‹å­æ¥ä»‹ç»ä¸€ä¸‹å®ƒçš„ä½¿ç”¨æ–¹æ³•ï¼ˆè€Œä¸”åé¢çš„æºç è§£æéƒ¨åˆ†ä¹Ÿæ˜¯ç»“åˆè¿™äº›ä¾‹å­ç»™å‡ºçš„ï¼Œå› ä¸ºç»“åˆä¾‹å­æœ‰åŠ©äºåŠ å¿«ç†è§£ï¼‰ï¼š</p>
<h1 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h1><h2 id="1-æœ€åŸºæœ¬çš„ä½¿ç”¨"><a href="#1-æœ€åŸºæœ¬çš„ä½¿ç”¨" class="headerlink" title="1. æœ€åŸºæœ¬çš„ä½¿ç”¨"></a>1. æœ€åŸºæœ¬çš„ä½¿ç”¨</h2><p>ç¬¬ä¸€ç§å°±æ˜¯å•çº¯åœ°ä¼ å…¥ä¸€ä¸ªå­—å…¸ï¼Œå¹¶è½¬æ¢æˆæ¨¡å‹ï¼š<br>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„æ¨¡å‹ç±»ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">JSONModel</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *name;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *sex;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> age;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>ç„¶åå†ä½¿ç”¨å­—å…¸æ¥è½¬æ¢ä¸ºæ¨¡å‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSDictionary</span> *dict = @&#123;</div><div class="line">                        <span class="string">@"name"</span>:<span class="string">@"Jack"</span>,</div><div class="line">                        <span class="string">@"age"</span>:@<span class="number">23</span>,</div><div class="line">                        <span class="string">@"gender"</span>:<span class="string">@"male"</span>,</div><div class="line">                      &#125;;</div><div class="line"> <span class="built_in">NSError</span> *error;</div><div class="line"> Person *person = [[Person alloc] initWithDictionary:dict error:&amp;error];</div></pre></td></tr></table></figure></p>
<p>è¾“å‡ºï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> &lt;Person&gt; </div><div class="line">   [name]: Jack</div><div class="line">   [sex]: male</div><div class="line">   [gender]: 23</div><div class="line">&lt;/Person&gt;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¯¥æ¡†æ¶çš„ä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œä¸€è¡Œä»£ç å°±å°†æ¨¡å‹è½¬æ¢å¥½äº†ã€‚<br>ä½†æ˜¯è¯¥æ¡†æ¶çš„åŠŸèƒ½è¿œä¸æ­¢è¿™äº›ï¼š</p>
<h2 id="2-è½¬æ¢å±æ€§åç§°"><a href="#2-è½¬æ¢å±æ€§åç§°" class="headerlink" title="2. è½¬æ¢å±æ€§åç§°"></a>2. è½¬æ¢å±æ€§åç§°</h2><p>æœ‰çš„æ—¶å€™ï¼Œä¼ å…¥çš„å­—å…¸é‡Œçš„keyå‘ç”Ÿäº†å˜åŒ–ï¼ˆæ¯”å¦‚æ¥å£é‡æ„ä¹‹ç±»çš„åŸå› ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å‰ç«¯è¿™è¾¹å·²ç»å†™å¥½çš„æ¨¡å‹å±æ€§å¯èƒ½ä¸å®¹æ˜“è¢«ä¿®æ”¹ï¼ˆå› ä¸ºä¸šåŠ¡é€»è¾‘å¾ˆå¤æ‚ä»€ä¹ˆçš„ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œæœ€å¥½æœ‰ä¸€ä¸ªè½¬åŒ–çš„åŠŸèƒ½ã€‚</p>
<p>åœ¨è¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼šåŸæ¥å­—å…¸é‡Œçš„<code>gender</code>è¿™ä¸ªkeyå˜æˆäº†<code>sex</code>ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè½¬æ¢çš„mapperï¼ˆ<code>JSONKeyMapper</code>ï¼‰ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></div><div class="line">+ (JSONKeyMapper *)keyMapper</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [[JSONKeyMapper alloc] initWithModelToJSONDictionary:@&#123;</div><div class="line">                                                                  <span class="string">@"gender"</span>: <span class="string">@"sex"</span>,                                                             &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·ä¸€æ¥ï¼Œ<code>JSONKeyMapper</code>å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åšè½¬æ¢ã€‚<br>ä¸ºäº†éªŒè¯æ•ˆæœï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä¼ å…¥çš„å­—å…¸é‡Œçš„<code>gender</code>å­—æ®µä¸º<code>sex</code>ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSDictionary</span> *dict = @&#123;</div><div class="line">                        <span class="string">@"name"</span>:<span class="string">@"Jack"</span>,</div><div class="line">                        <span class="string">@"age"</span>:@<span class="number">23</span>,</div><div class="line">                        <span class="string">@"sex"</span>:<span class="string">@"male"</span>,</div><div class="line">                      &#125;;</div><div class="line"><span class="built_in">NSError</span> *error;</div><div class="line">Person *person = [[Person alloc] initWithDictionary:dict error:&amp;error];</div></pre></td></tr></table></figure></p>
<p>å†çœ‹ä¸€ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Person&gt; </div><div class="line">   [name]: Jack</div><div class="line">   [age]: 23</div><div class="line">   [gender]: male</div><div class="line">&lt;/Person&gt;</div></pre></td></tr></table></figure>
<p>æ²¡æœ‰å—åˆ°ä¼ å…¥å­—å…¸é‡Œkeyå€¼çš„å˜åŒ–çš„å½±å“ï¼Œæ˜¯å§ï¼Ÿ</p>
<h2 id="3-è‡ªå®šä¹‰é”™è¯¯"><a href="#3-è‡ªå®šä¹‰é”™è¯¯" class="headerlink" title="3. è‡ªå®šä¹‰é”™è¯¯"></a>3. è‡ªå®šä¹‰é”™è¯¯</h2><p>é™¤äº†ä¸€äº›æ¡†æ¶é‡Œè‡ªå·±å¤„ç†çš„é”™è¯¯ï¼ˆæ¯”å¦‚ä¼ å…¥çš„å¯¹è±¡ä¸æ˜¯å­—å…¸ç­‰ï¼‰ï¼Œæ¡†æ¶çš„ä½œè€…ä¹Ÿå…è®¸æˆ‘ä»¬è‡ªå·±å®šä¹‰å±äºæˆ‘ä»¬è‡ªå·±çš„é”™è¯¯ã€‚</p>
<p>æ¯”å¦‚ï¼Œå½“<code>age</code>å¯¹åº”çš„æ•°å€¼å°äº25çš„æ—¶å€™ï¼Œæ‰“å°å‡º<code>Too young!</code>,å¹¶é˜»æ­¢æ¨¡å‹çš„è½¬æ¢ï¼š</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æ¨¡å‹çš„å®ç°æ–‡ä»¶é‡Œæ·»åŠ ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)validate:(<span class="built_in">NSError</span> **)error</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (![<span class="keyword">super</span> validate:error])</div><div class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.age &lt; <span class="number">25</span>)</div><div class="line">    &#123;</div><div class="line">        *error = [<span class="built_in">NSError</span> errorWithDomain:<span class="string">@"Too young!"</span> code:<span class="number">10</span> userInfo:<span class="literal">nil</span>];</div><div class="line">        <span class="built_in">NSError</span> *errorLog = *error;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,errorLog.domain);</div><div class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸‹ç»“æœï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">2017</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">14</span>:<span class="number">54.217</span> jsonmodel_demo[<span class="number">32942</span>:<span class="number">1967433</span>] Too young!</div><div class="line"><span class="number">2017</span><span class="number">-02</span><span class="number">-20</span> <span class="number">16</span>:<span class="number">14</span>:<span class="number">54.217</span> jsonmodel_demo[<span class="number">32942</span>:<span class="number">1967433</span>] (null)</div></pre></td></tr></table></figure></p>
<p>æ‰“å°äº†é”™è¯¯ï¼Œè€Œä¸”æ¨¡å‹ä¹Ÿæ²¡æœ‰è¢«è½¬æ¢ã€‚</p>
<h2 id="4-æ¨¡å‹åµŒå¥—"><a href="#4-æ¨¡å‹åµŒå¥—" class="headerlink" title="4. æ¨¡å‹åµŒå¥—"></a>4. æ¨¡å‹åµŒå¥—</h2><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¨¡å‹é‡ŒåŠ ä¸€ä¸ªæ•°ç»„ï¼Œè€Œè¿™ä¸ªæ•°ç»„é‡Œé¢çš„å…ƒç´ æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼šè¿™å°±æ¶‰åŠåˆ°äº†æ¨¡å‹çš„åµŒå¥—ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è®©ä¸Šé¢çš„<code>Person</code>å¯¹è±¡å«æœ‰ä¸€ä¸ªæ•°ç»„<code>Friends</code>ï¼Œå®ƒé‡Œé¢çš„å…ƒç´ æ˜¯å¯¹è±¡<code>Friend</code>ï¼Œä¹Ÿå°±æ˜¯å¥½å‹ä¿¡æ¯ã€‚è‹¥è¦å®ç°æ¨¡å‹çš„åµŒå¥—ï¼Œæˆ‘ä»¬åªéœ€åœ¨åŸæ¥çš„æ¨¡å‹ç±»é‡Œå¢åŠ ä¸€ä¸ªåè®®<code>Friend</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"JSONModel.h"</span></span></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">Friend</span>;</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Friend</span> : <span class="title">JSONModel</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> age;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">JSONModel</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> age;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *gender;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span>&lt;Friend&gt; *friends;<span class="comment">//æ•°ç»„ï¼ŒåµŒå¥—æ¨¡å‹</span></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è€Œä¸”è¦åœ¨<code>Person</code>çš„å®ç°æ–‡ä»¶é‡ŒåŠ ä¸Šè¿™ä¸€æ®µä»£ç ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Friend</span></span></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼å¦‚æœä¸æ·»åŠ ï¼Œåˆ™ä¼šä»¤ç¨‹åºå´©æºƒã€‚</p>
<p>æœ€åï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€å°†æŒæœ‰ä¸€ä¸ªæ•°ç»„çš„å­—å…¸é‡Œä¼ å…¥å³å¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *array = @[</div><div class="line">                      @&#123;</div><div class="line">                        <span class="string">@"name"</span>:<span class="string">@"Peter"</span>,</div><div class="line">                        <span class="string">@"age"</span>:@<span class="number">35</span>,</div><div class="line">                        &#125;,</div><div class="line">                   ];</div><div class="line">    </div><div class="line"> <span class="built_in">NSDictionary</span> *dict = @&#123;</div><div class="line">                           <span class="string">@"name"</span>:<span class="string">@"Jack"</span>,</div><div class="line">                           <span class="string">@"age"</span>:@<span class="number">23</span>,</div><div class="line">                           <span class="string">@"sex"</span>:<span class="string">@"male"</span>,</div><div class="line">                           <span class="string">@"friends"</span>:array,<span class="comment">//æœ‹å‹åˆ—è¡¨ï¼ˆæ¨¡å‹åµŒå¥—ï¼‰</span></div><div class="line">                         &#125;;</div><div class="line"><span class="built_in">NSError</span> *error;</div><div class="line">Person *person = [[Person alloc] initWithDictionary:dict error:&amp;error];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,person);</div></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;Person&gt; </div><div class="line">   [age]: 23</div><div class="line">   [gender]: male</div><div class="line">   [friends]: (</div><div class="line">       "&lt;Friend&gt; \n   [name]: Peter\n   [age]: 35\n&lt;/Friend&gt;"</div><div class="line">   )</div><div class="line">   [name]: Jack</div><div class="line">&lt;/Person&gt;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œpersonå¯¹è±¡é‡Œå«æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå¯¹åº”ç€ä¸Šé¢å­—å…¸é‡Œçš„arrayé‡Œçš„ä¿¡æ¯ã€‚</p>
<p>OKï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¤§å®¶å·²ç»å¯ä»¥æŒæ¡è¯¥æ¡†æ¶çš„ä¸»è¦ç”¨æ³•äº†ï¼Œç°åœ¨å¼€å§‹è¯¦ç»†è®²è§£ä»£ç ï¼š</p>
<h1 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h1><p>æœ¬ç¯‡æºç è§£æä¸»è¦å›´ç»•ç€<code>initWithDictionary:error:</code>æ¥å±•å¼€ï¼Œåœ¨è¿™ä¸€ä¸ªæ–¹æ³•é‡Œä½œè€…åšåˆ°äº†æ‰€æœ‰çš„å®¹é”™å’Œæ¨¡å‹çš„è½¬åŒ–ã€‚</p>
<p>æŒ‰ç…§è€è§„çŸ©ï¼Œå…ˆä¸Šæµç¨‹å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-94b356eeb7b560e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å­—å…¸-&gt;æ¨¡å‹"></p>
<p>è¯¥æµç¨‹å›¾å¯¹åº”çš„æ–¹æ³•å®ç°æ˜¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">id</span>)initWithDictionary:(<span class="built_in">NSDictionary</span>*)dict error:(<span class="built_in">NSError</span>**)err</div><div class="line">&#123;</div><div class="line">    <span class="comment">//æ–¹æ³•1. å‚æ•°ä¸ºnil</span></div><div class="line">    <span class="keyword">if</span> (!dict) &#123;</div><div class="line">        <span class="keyword">if</span> (err) *err = [JSONModelError errorInputIsNil];</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ–¹æ³•2. å‚æ•°ä¸æ˜¯nilï¼Œä½†ä¹Ÿä¸æ˜¯å­—å…¸</span></div><div class="line">    <span class="keyword">if</span> (![dict isKindOfClass:[<span class="built_in">NSDictionary</span> <span class="keyword">class</span>]]) &#123;</div><div class="line">        <span class="keyword">if</span> (err) *err = [JSONModelError errorInvalidDataWithMessage:<span class="string">@"Attempt to initialize JSONModel object using initWithDictionary:error: but the dictionary parameter was not an 'NSDictionary'."</span>];</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ–¹æ³•3. åˆå§‹åŒ–</span></div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">self</span> init];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) &#123;</div><div class="line">        <span class="comment">//åˆå§‹åŒ–å¤±è´¥</span></div><div class="line">        <span class="keyword">if</span> (err) *err = [JSONModelError errorModelIsInvalid];</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ–¹æ³•4. æ£€æŸ¥ç”¨æˆ·å®šä¹‰çš„æ¨¡å‹é‡Œçš„å±æ€§é›†åˆæ˜¯å¦å¤§äºä¼ å…¥çš„å­—å…¸é‡Œçš„keyé›†åˆï¼ˆå¦‚æœå¤§äºï¼Œåˆ™è¿”å›NOï¼‰</span></div><div class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span> __doesDictionary:dict matchModelWithKeyMapper:<span class="keyword">self</span>.__keyMapper error:err]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ–¹æ³•5. æ ¸å¿ƒæ–¹æ³•ï¼šå­—å…¸çš„keyä¸æ¨¡å‹çš„å±æ€§çš„æ˜ å°„</span></div><div class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span> __importDictionary:dict withKeyMapper:<span class="keyword">self</span>.__keyMapper validation:<span class="literal">YES</span> error:err]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ–¹æ³•6. å¯ä»¥é‡å†™[self validate:err]æ–¹æ³•å¹¶è¿”å›NOï¼Œè®©ç”¨æˆ·è‡ªå®šä¹‰é”™è¯¯å¹¶é˜»æ‹¦modelçš„è¿”å›</span></div><div class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span> validate:err]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ–¹æ³•7. ç»ˆäºé€šè¿‡äº†ï¼æˆåŠŸè¿”å›model</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ</p>
<ul>
<li>æ–¹æ³•1-4:éƒ½æ˜¯å¯¹é”™è¯¯çš„å‘ç°ä¸å¤„ç†ã€‚</li>
<li>æ–¹æ³•5:æ˜¯çœŸæ­£çš„mappingã€‚</li>
<li>æ–¹æ³•6:æ˜¯ä½œè€…ç»™ç”¨æˆ·è‡ªå·±å®šä¹‰é”™è¯¯çš„æ–¹æ³•ï¼Œå¦‚æœå¤åˆäº†ç”¨æˆ·è‡ªå·±å®šä¹‰çš„é”™è¯¯ï¼Œé‚£ä¹ˆå³ä½¿mappingæˆåŠŸäº†ï¼Œä¹Ÿè¦è¿”å›nilã€‚<br>-æ–¹æ³•7:æˆåŠŸè¿”å›æ¨¡å‹å¯¹è±¡ã€‚</li>
</ul>
<p>åœ¨è®²è§£ä»£ç ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹JSONModelæ‰€æŒæœ‰çš„ä¸€äº›æ•°æ®ï¼š</p>
<ul>
<li><p><strong>å…³è”å¯¹è±¡kClassPropertiesKey</strong>:(ç”¨æ¥ä¿å­˜æ‰€æœ‰å±æ€§ä¿¡æ¯çš„NSDictionary)</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">       age = <span class="string">"@property primitive age (Setters = [])"</span>;</div><div class="line">      name = <span class="string">"@property NSString* name (Standard JSON type, Setters = [])"</span>;</div><div class="line">    gender = <span class="string">"@property NSString* gender (Standard JSON type, Setters = [])"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><strong>å…³è”å¯¹è±¡kClassRequiredPropertyNamesKey</strong>ï¼š(ç”¨æ¥ä¿å­˜æ‰€æœ‰å±æ€§çš„åç§°NSSet)</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;(</div><div class="line">    name,</div><div class="line">    age,</div><div class="line">    gender</div><div class="line">)&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><strong>å…³è”å¯¹è±¡kMapperObjectKey</strong>ï¼š(ç”¨æ¥ä¿å­˜JSONKeyMapper)ï¼šè‡ªå®šä¹‰çš„mapperï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹æ³•åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ã€‚</p>
</li>
</ul>
<ul>
<li><strong>JSONModelClassProperty</strong>ï¼šå°è£…çš„jsonmodelçš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒåŒ…å«äº†å¯¹åº”å±æ€§çš„åå­—ï¼ˆnameï¼šgenderï¼‰ï¼Œç±»å‹ï¼ˆtypeï¼šNSStringï¼‰ï¼Œæ˜¯å¦æ˜¯JSONModelæ”¯æŒçš„ç±»å‹ï¼ˆisStandardJSONTypeï¼šYES/NOï¼‰ï¼Œæ˜¯å¦æ˜¯å¯å˜å¯¹è±¡ï¼ˆisMutable:YES/NOï¼‰ç­‰å±æ€§ã€‚</li>
</ul>
<p>å†å¤§è‡´è®²è§£ä¸€ä¸‹æ•´ä¸ªçš„æµç¨‹ï¼š<br>é¦–å…ˆï¼Œåœ¨è¿™ä¸ªæ¨¡å‹ç±»çš„å¯¹è±¡è¢«åˆå§‹åŒ–çš„æ—¶å€™ï¼Œéå†è‡ªèº«åˆ°æ‰€æœ‰çš„çˆ¶ç±»ï¼ˆç›´åˆ°JSONModelä¸ºæ­¢ï¼‰ï¼Œè·å–æ‰€æœ‰çš„å±æ€§ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªå­—å…¸é‡Œã€‚è·å–ä¼ å…¥å­—å…¸çš„æ‰€æœ‰keyï¼Œå°†è¿™äº›keyä¸ä¿å­˜çš„æ‰€æœ‰å±æ€§è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™è¿›è¡Œkvcèµ‹å€¼ã€‚</p>
<p>OKï¼Œç°åœ¨ä»ä¸Šåˆ°ä¸‹é€æ­¥è®²è§£ä¸Šæ®µä»£ç ï¼š</p>
<p>é¦–å…ˆï¼Œåœ¨<code>load</code>æ–¹æ³•é‡Œï¼Œå®šä¹‰äº†è¯¥æ¡†æ¶æ”¯æŒçš„ç±»å‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">+(<span class="keyword">void</span>)load</div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> once;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;once, ^&#123;</div><div class="line">        <span class="keyword">@autoreleasepool</span> &#123;           </div><div class="line">            <span class="comment">//å…¼å®¹çš„å¯¹è±¡å±æ€§</span></div><div class="line">            allowedJSONTypes = @[</div><div class="line">                [<span class="built_in">NSString</span> <span class="keyword">class</span>], [<span class="built_in">NSNumber</span> <span class="keyword">class</span>], [<span class="built_in">NSDecimalNumber</span> <span class="keyword">class</span>], [<span class="built_in">NSArray</span> <span class="keyword">class</span>], [<span class="built_in">NSDictionary</span> <span class="keyword">class</span>], [<span class="built_in">NSNull</span> <span class="keyword">class</span>], <span class="comment">//immutable JSON classes</span></div><div class="line">                [<span class="built_in">NSMutableString</span> <span class="keyword">class</span>], [<span class="built_in">NSMutableArray</span> <span class="keyword">class</span>], [<span class="built_in">NSMutableDictionary</span> <span class="keyword">class</span>] <span class="comment">//mutable JSON classes</span></div><div class="line">            ];</div><div class="line">            <span class="comment">//å…¼å®¹çš„åŸºæœ¬ç±»å‹å±æ€§</span></div><div class="line">            allowedPrimitiveTypes = @[</div><div class="line">                <span class="string">@"BOOL"</span>, <span class="string">@"float"</span>, <span class="string">@"int"</span>, <span class="string">@"long"</span>, <span class="string">@"double"</span>, <span class="string">@"short"</span>,</div><div class="line">                <span class="comment">//and some famous aliases</span></div><div class="line">                <span class="string">@"NSInteger"</span>, <span class="string">@"NSUInteger"</span>,</div><div class="line">                <span class="string">@"Block"</span></div><div class="line">            ];</div><div class="line">            <span class="comment">//è½¬æ¢å™¨</span></div><div class="line">            valueTransformer = [[JSONValueTransformer alloc] init];</div><div class="line">            </div><div class="line">            <span class="comment">//è‡ªå·±çš„ç±»å‹</span></div><div class="line">            JSONModelClass = <span class="built_in">NSClassFromString</span>(<span class="built_in">NSStringFromClass</span>(<span class="keyword">self</span>));</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»æ–¹æ³•3çš„initæ–¹æ³•å¼€å§‹ï¼Œä½œè€…éƒ½åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">id</span>)init</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        [<span class="keyword">self</span> __setup__];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line">-(<span class="keyword">void</span>)__setup__</div><div class="line">&#123;</div><div class="line">    <span class="comment">//åªæœ‰ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–æ—¶ï¼Œæ‰æ‰§è¡Œ</span></div><div class="line">    <span class="keyword">if</span> (!objc_getAssociatedObject(<span class="keyword">self</span>.class, &amp;kClassPropertiesKey)) &#123;</div><div class="line">        [<span class="keyword">self</span> __inspectProperties];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//å¦‚æœå­˜åœ¨è‡ªå®šä¹‰çš„mapperï¼Œåˆ™å°†å®ƒä¿å­˜åœ¨å…³è”å¯¹è±¡é‡Œé¢ï¼Œkeyæ˜¯kMapperObjectKey</span></div><div class="line">    <span class="keyword">id</span> mapper = [[<span class="keyword">self</span> <span class="keyword">class</span>] keyMapper];</div><div class="line">    <span class="keyword">if</span> ( mapper &amp;&amp; !objc_getAssociatedObject(<span class="keyword">self</span>.class, &amp;kMapperObjectKey) ) &#123;</div><div class="line">        objc_setAssociatedObject(</div><div class="line">                                 <span class="keyword">self</span>.class,</div><div class="line">                                 &amp;kMapperObjectKey,</div><div class="line">                                 mapper,</div><div class="line">                                 OBJC_ASSOCIATION_RETAIN <span class="comment">// This is atomic</span></div><div class="line">                                 );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„<code>__inspectProperties:</code>æ–¹æ³•æ˜¯è¯¥æ¡†æ¶çš„æ ¸å¿ƒæ–¹æ³•ä¹‹ä¸€ï¼šå®ƒçš„ä»»åŠ¡æ˜¯ä¿å­˜äº†æ‰€æœ‰éœ€è¦èµ‹å€¼çš„å±æ€§ã€‚ç”¨ä½œåœ¨å°†æ¥ä¸ä¼ è¿›æ¥å­—å…¸è¿›è¡Œæ˜ å°„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)__inspectProperties</div><div class="line">&#123;</div><div class="line"><span class="comment">//    æœ€ç»ˆä¿å­˜æ‰€æœ‰å±æ€§çš„å­—å…¸ï¼Œå½¢å¼ä¸ºï¼š</span></div><div class="line"><span class="comment">//    &#123;</span></div><div class="line"><span class="comment">//        age = "@property primitive age (Setters = [])";</span></div><div class="line"><span class="comment">//        friends = "@property NSArray*&lt;Friend&gt; friends (Standard JSON type, Setters = [])";</span></div><div class="line"><span class="comment">//        gender = "@property NSString* gender (Standard JSON type, Setters = [])";</span></div><div class="line"><span class="comment">//        name = "@property NSString* name (Standard JSON type, Setters = [])";</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line">    <span class="built_in">NSMutableDictionary</span>* propertyIndex = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    <span class="comment">//è·å–å½“å‰çš„ç±»å</span></div><div class="line">    Class <span class="keyword">class</span> = [<span class="keyword">self</span> <span class="keyword">class</span>];    </div><div class="line">    <span class="built_in">NSScanner</span>* scanner = <span class="literal">nil</span>;</div><div class="line">    <span class="built_in">NSString</span>* propertyType = <span class="literal">nil</span>;</div><div class="line">    <span class="comment">// å¾ªç¯æ¡ä»¶ï¼šå½“class æ˜¯ JSONModelè‡ªå·±çš„æ—¶å€™ç»ˆæ­¢</span></div><div class="line">    <span class="keyword">while</span> (<span class="keyword">class</span> != [JSONModel <span class="keyword">class</span>]) &#123;        </div><div class="line">        <span class="comment">//å±æ€§çš„ä¸ªæ•°</span></div><div class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> propertyCount;</div><div class="line">        <span class="comment">//è·å¾—å±æ€§åˆ—è¡¨ï¼ˆæ‰€æœ‰@propertyå£°æ˜çš„å±æ€§ï¼‰</span></div><div class="line">        objc_property_t *properties = class_copyPropertyList(<span class="keyword">class</span>, &amp;propertyCount);</div><div class="line">        <span class="comment">//éå†æ‰€æœ‰çš„å±æ€§</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; propertyCount; i++) &#123;</div><div class="line">            <span class="comment">//è·å¾—å±æ€§åç§°</span></div><div class="line">            objc_property_t property = properties[i];<span class="comment">//è·å¾—å½“å‰çš„å±æ€§</span></div><div class="line">            <span class="keyword">const</span> <span class="keyword">char</span> *propertyName = property_getName(property);<span class="comment">//nameï¼ˆCå­—ç¬¦ä¸²ï¼‰            </span></div><div class="line">            <span class="comment">//JSONModelé‡Œçš„æ¯ä¸€ä¸ªå±æ€§ï¼Œéƒ½è¢«å°è£…æˆä¸€ä¸ªJSONModelClassPropertyå¯¹è±¡</span></div><div class="line">            JSONModelClassProperty* p = [[JSONModelClassProperty alloc] init];</div><div class="line">            p.name = @(propertyName);<span class="comment">//propertyName:å±æ€§åç§°ï¼Œä¾‹å¦‚ï¼šnameï¼Œageï¼Œgender</span></div><div class="line">            <span class="comment">//è·å¾—å±æ€§ç±»å‹</span></div><div class="line">            <span class="keyword">const</span> <span class="keyword">char</span> *attrs = property_getAttributes(property);</div><div class="line">            <span class="built_in">NSString</span>* propertyAttributes = @(attrs);</div><div class="line">            <span class="comment">// T@\"NSString\",C,N,V_name</span></div><div class="line">            <span class="comment">// Tq,N,V_age</span></div><div class="line">            <span class="comment">// T@\"NSString\",C,N,V_gender</span></div><div class="line">            <span class="comment">// T@"NSArray&lt;Friend&gt;",&amp;,N,V_friends            </span></div><div class="line">            <span class="built_in">NSArray</span>* attributeItems = [propertyAttributes componentsSeparatedByString:<span class="string">@","</span>];</div><div class="line">            <span class="comment">//è¯´æ˜æ˜¯åªè¯»å±æ€§ï¼Œä¸åšä»»ä½•æ“ä½œ</span></div><div class="line">            <span class="keyword">if</span> ([attributeItems containsObject:<span class="string">@"R"</span>]) &#123;</div><div class="line">                <span class="keyword">continue</span>; <span class="comment">//to next property</span></div><div class="line">            &#125;</div><div class="line">            <span class="comment">//æ£€æŸ¥å‡ºæ˜¯å¸ƒå°”å€¼</span></div><div class="line">            <span class="keyword">if</span> ([propertyAttributes hasPrefix:<span class="string">@"Tc,"</span>]) &#123;</div><div class="line">                p.structName = <span class="string">@"BOOL"</span>;<span class="comment">//ä½¿å…¶å˜ä¸ºç»“æ„ä½“</span></div><div class="line">            &#125;            </div><div class="line">            <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªscanner</span></div><div class="line">            scanner = [<span class="built_in">NSScanner</span> scannerWithString: propertyAttributes];</div><div class="line">            [scanner scanUpToString:<span class="string">@"T"</span> intoString: <span class="literal">nil</span>];</div><div class="line">            [scanner scanString:<span class="string">@"T"</span> intoString:<span class="literal">nil</span>];</div><div class="line">            <span class="comment">//http://blog.csdn.net/kmyhy/article/details/8258858           </span></div><div class="line">            <span class="keyword">if</span> ([scanner scanString:<span class="string">@"@\""</span> intoString: &amp;propertyType]) &#123;                </div><div class="line">                 <span class="comment">//å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡</span></div><div class="line">                [scanner scanUpToCharactersFromSet:[<span class="built_in">NSCharacterSet</span> characterSetWithCharactersInString:<span class="string">@"\"&lt;"</span>]</div><div class="line">                                        intoString:&amp;propertyType];<span class="comment">//propertyType -&gt; NSString                </span></div><div class="line">                p.type = <span class="built_in">NSClassFromString</span>(propertyType);<span class="comment">// p.type = @"NSString"</span></div><div class="line">                p.isMutable = ([propertyType rangeOfString:<span class="string">@"Mutable"</span>].location != <span class="built_in">NSNotFound</span>); <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¯å˜çš„å¯¹è±¡</span></div><div class="line">                p.isStandardJSONType = [allowedJSONTypes containsObject:p.type];<span class="comment">//æ˜¯å¦æ˜¯è¯¥æ¡†æ¶å…¼å®¹çš„ç±»å‹</span></div><div class="line">                <span class="comment">//å­˜åœ¨åè®®(æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯åµŒå¥—æ¨¡å‹)</span></div><div class="line">                <span class="keyword">while</span> ([scanner scanString:<span class="string">@"&lt;"</span> intoString:<span class="literal">NULL</span>]) &#123;</div><div class="line">                    <span class="built_in">NSString</span>* protocolName = <span class="literal">nil</span>;</div><div class="line">                    [scanner scanUpToString:<span class="string">@"&gt;"</span> intoString: &amp;protocolName];</div><div class="line">                    <span class="keyword">if</span> ([protocolName isEqualToString:<span class="string">@"Optional"</span>]) &#123;</div><div class="line">                        p.isOptional = <span class="literal">YES</span>;</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span>([protocolName isEqualToString:<span class="string">@"Index"</span>]) &#123;</div><div class="line"><span class="meta">#pragma GCC diagnostic push</span></div><div class="line"><span class="meta">#pragma GCC diagnostic ignored <span class="meta-string">"-Wdeprecated-declarations"</span></span></div><div class="line">                        p.isIndex = <span class="literal">YES</span>;</div><div class="line"><span class="meta">#pragma GCC diagnostic pop</span></div><div class="line">                        objc_setAssociatedObject(</div><div class="line">                                                 <span class="keyword">self</span>.class,</div><div class="line">                                                 &amp;kIndexPropertyNameKey,</div><div class="line">                                                 p.name,</div><div class="line">                                                 OBJC_ASSOCIATION_RETAIN <span class="comment">// This is atomic</span></div><div class="line">                                                 );</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span>([protocolName isEqualToString:<span class="string">@"Ignore"</span>]) &#123;</div><div class="line">                        p = <span class="literal">nil</span>;</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        p.protocol = protocolName;</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">//åˆ°æœ€æ¥è¿‘çš„&gt;ä¸ºæ­¢</span></div><div class="line">                    [scanner scanString:<span class="string">@"&gt;"</span> intoString:<span class="literal">NULL</span>];</div><div class="line">                &#125;</div><div class="line">            &#125;            </div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ([scanner scanString:<span class="string">@"&#123;"</span> intoString: &amp;propertyType])                </div><div class="line">                <span class="comment">//å±æ€§æ˜¯ç»“æ„ä½“</span></div><div class="line">                [scanner scanCharactersFromSet:[<span class="built_in">NSCharacterSet</span> alphanumericCharacterSet]</div><div class="line">                                    intoString:&amp;propertyType];</div><div class="line">                p.isStandardJSONType = <span class="literal">NO</span>;</div><div class="line">                p.structName = propertyType;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">//å±æ€§æ˜¯åŸºæœ¬ç±»å‹ï¼šTq,N,V_age</span></div><div class="line">                [scanner scanUpToCharactersFromSet:[<span class="built_in">NSCharacterSet</span> characterSetWithCharactersInString:<span class="string">@","</span>]</div><div class="line">                                        intoString:&amp;propertyType];</div><div class="line">                <span class="comment">//propertyType:q</span></div><div class="line">                propertyType = valueTransformer.primitivesNames[propertyType];              </div><div class="line">                <span class="comment">//propertyType:long</span></div><div class="line">                <span class="comment">//åŸºæœ¬ç±»å‹æ•°ç»„</span></div><div class="line">                <span class="keyword">if</span> (![allowedPrimitiveTypes containsObject:propertyType]) &#123;</div><div class="line">                    <span class="comment">//ç±»å‹ä¸æ”¯æŒ</span></div><div class="line">                    <span class="keyword">@throw</span> [<span class="built_in">NSException</span> exceptionWithName:<span class="string">@"JSONModelProperty type not allowed"</span></div><div class="line">                                                   reason:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Property type of %@.%@ is not supported by JSONModel."</span>, <span class="keyword">self</span>.class, p.name]</div><div class="line">                                                 userInfo:<span class="literal">nil</span>];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">NSString</span> *nsPropertyName = @(propertyName);            </div><div class="line">            <span class="comment">//å¯é€‰çš„</span></div><div class="line">            <span class="keyword">if</span>([[<span class="keyword">self</span> <span class="keyword">class</span>] propertyIsOptional:nsPropertyName])&#123;</div><div class="line">                p.isOptional = <span class="literal">YES</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//å¯å¿½ç•¥çš„</span></div><div class="line">            <span class="keyword">if</span>([[<span class="keyword">self</span> <span class="keyword">class</span>] propertyIsIgnored:nsPropertyName])&#123;</div><div class="line">                p = <span class="literal">nil</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//é›†åˆç±»</span></div><div class="line">            Class customClass = [[<span class="keyword">self</span> <span class="keyword">class</span>] classForCollectionProperty:nsPropertyName];            </div><div class="line">            <span class="keyword">if</span> (customClass) &#123;</div><div class="line">                p.protocol = <span class="built_in">NSStringFromClass</span>(customClass);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//å¿½ç•¥block</span></div><div class="line">            <span class="keyword">if</span> ([propertyType isEqualToString:<span class="string">@"Block"</span>]) &#123;</div><div class="line">                p = <span class="literal">nil</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//å¦‚æœå­—å…¸é‡Œä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ åˆ°å±æ€§å­—å…¸é‡Œï¼ˆç»ˆäºæ·»åŠ ä¸Šå»äº†ã€‚ã€‚ã€‚ï¼‰</span></div><div class="line">            <span class="keyword">if</span> (p &amp;&amp; ![propertyIndex objectForKey:p.name]) &#123;</div><div class="line">                [propertyIndex setValue:p forKey:p.name];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//setter å’Œ getter</span></div><div class="line">            <span class="keyword">if</span> (p)</div><div class="line">            &#123;   <span class="comment">//name -&gt;Name</span></div><div class="line">                <span class="built_in">NSString</span> *name = [p.name stringByReplacingCharactersInRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">1</span>) withString:[p.name substringToIndex:<span class="number">1</span>].uppercaseString];</div><div class="line">                <span class="comment">// getter</span></div><div class="line">                SEL <span class="keyword">getter</span> = <span class="built_in">NSSelectorFromString</span>([<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"JSONObjectFor%@"</span>, name]);</div><div class="line">                <span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:<span class="keyword">getter</span>])</div><div class="line">                    p.customGetter = <span class="keyword">getter</span>;</div><div class="line">                <span class="comment">// setters</span></div><div class="line">                p.customSetters = [<span class="built_in">NSMutableDictionary</span> new];</div><div class="line">                SEL genericSetter = <span class="built_in">NSSelectorFromString</span>([<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"set%@WithJSONObject:"</span>, name]);</div><div class="line">                <span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:genericSetter])</div><div class="line">                    p.customSetters[<span class="string">@"generic"</span>] = [<span class="built_in">NSValue</span> valueWithBytes:&amp;genericSetter objCType:<span class="keyword">@encode</span>(SEL)];</div><div class="line">                <span class="keyword">for</span> (Class type <span class="keyword">in</span> allowedJSONTypes)</div><div class="line">                &#123;</div><div class="line">                    <span class="built_in">NSString</span> *<span class="keyword">class</span> = <span class="built_in">NSStringFromClass</span>([JSONValueTransformer classByResolvingClusterClasses:type]);</div><div class="line">                    <span class="keyword">if</span> (p.customSetters[<span class="keyword">class</span>])</div><div class="line">                        <span class="keyword">continue</span>;</div><div class="line">                    SEL <span class="keyword">setter</span> = <span class="built_in">NSSelectorFromString</span>([<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"set%@With%@:"</span>, name, <span class="keyword">class</span>]);</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:<span class="keyword">setter</span>])</div><div class="line">                        p.customSetters[<span class="keyword">class</span>] = [<span class="built_in">NSValue</span> valueWithBytes:&amp;<span class="keyword">setter</span> objCType:<span class="keyword">@encode</span>(SEL)];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        free(properties);</div><div class="line">        <span class="comment">//å†æŒ‡å‘è‡ªå·±çš„çˆ¶ç±»ï¼ŒçŸ¥é“ç­‰äºJSONModelæ‰åœæ­¢</span></div><div class="line">        <span class="keyword">class</span> = [<span class="keyword">class</span> superclass];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æœ€åä¿å­˜æ‰€æœ‰å½“å‰ç±»ï¼ŒJSONModelçš„æ‰€æœ‰çš„çˆ¶ç±»çš„å±æ€§</span></div><div class="line">    objc_setAssociatedObject(</div><div class="line">                             <span class="keyword">self</span>.class,</div><div class="line">                             &amp;kClassPropertiesKey,</div><div class="line">                             [propertyIndex <span class="keyword">copy</span>],</div><div class="line">                             OBJC_ASSOCIATION_RETAIN</div><div class="line">                             );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p>
<ol>
<li>ä½œè€…åˆ©ç”¨ä¸€ä¸ª<code>while</code>å‡½æ•°ï¼Œè·å–å½“å‰ç±»å’Œå½“å‰ç±»çš„é™¤JSONModelçš„æ‰€æœ‰çˆ¶ç±»çš„å±æ€§ä¿å­˜åœ¨ä¸€ä¸ªå­—å…¸ä¸­ã€‚åœ¨å°†æ¥ç”¨äºå’Œä¼ å…¥çš„å­—å…¸è¿›è¡Œæ˜ å°„ã€‚</li>
<li>ä½œè€…ç”¨<code>JSONModelClassProperty</code>ç±»å°è£…äº†JSONModelçš„æ¯ä¸€ä¸ªå±æ€§ã€‚è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ï¼šä¸€ä¸ªæ˜¯<code>name</code>ï¼Œå®ƒæ˜¯å±æ€§çš„åç§°(ä¾‹å¦‚gender)ã€‚å¦ä¸€ä¸ªæ˜¯<code>type</code>ï¼Œå®ƒæ˜¯å±æ€§çš„ç±»å‹ï¼ˆä¾‹å¦‚NSStringï¼‰ã€‚</li>
<li>ä½œè€…å°†å±æ€§åˆ†ä¸ºäº†å¦‚ä¸‹å‡ ä¸ªç±»å‹ï¼š<ol>
<li>å¯¹è±¡ï¼ˆä¸å«æœ‰åè®®ï¼‰ã€‚</li>
<li>å¯¹è±¡ï¼ˆå«æœ‰åè®®ï¼Œå±äºæ¨¡å‹åµŒå¥—ï¼‰ã€‚</li>
<li>åŸºæœ¬æ•°æ®ç±»å‹ã€‚</li>
<li>ç»“æ„ä½“ã€‚</li>
</ol>
</li>
</ol>
</blockquote>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ–¹æ³•4çš„å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">BOOL</span>)__doesDictionary:(<span class="built_in">NSDictionary</span>*)dict matchModelWithKeyMapper:(JSONKeyMapper*)keyMapper error:(<span class="built_in">NSError</span>**)err</div><div class="line">&#123;</div><div class="line">    <span class="comment">//æ‹¿åˆ°å­—å…¸é‡Œæ‰€æœ‰çš„key</span></div><div class="line">    <span class="built_in">NSArray</span>* incomingKeysArray = [dict allKeys];    </div><div class="line">    <span class="comment">//è¿”å›ä¿å­˜æ‰€æœ‰å±æ€§åç§°çš„æ•°ç»„(name,age,gender...)</span></div><div class="line">    <span class="built_in">NSMutableSet</span>* requiredProperties = [<span class="keyword">self</span> __requiredPropertyNames].mutableCopy;    </div><div class="line">    <span class="comment">//ä»arrayæ‹¿åˆ°set</span></div><div class="line">    <span class="built_in">NSSet</span>* incomingKeys = [<span class="built_in">NSSet</span> setWithArray: incomingKeysArray];</div><div class="line">    <span class="comment">//å¦‚æœç”¨æˆ·è‡ªå®šä¹‰äº†mapperï¼Œåˆ™è¿›è¡Œè½¬æ¢</span></div><div class="line">    <span class="keyword">if</span> (keyMapper || globalKeyMapper) &#123;</div><div class="line">        <span class="built_in">NSMutableSet</span>* transformedIncomingKeys = [<span class="built_in">NSMutableSet</span> setWithCapacity: requiredProperties.count];</div><div class="line">        <span class="built_in">NSString</span>* transformedName = <span class="literal">nil</span>;</div><div class="line">        <span class="comment">//ä¾¿åˆ©éœ€è¦è½¬æ¢çš„å±æ€§åˆ—è¡¨</span></div><div class="line">        <span class="keyword">for</span> (JSONModelClassProperty* property <span class="keyword">in</span> [<span class="keyword">self</span> __properties__]) &#123;</div><div class="line">            <span class="comment">//è¢«è½¬æ¢æˆçš„å±æ€§åç§° genderï¼ˆæ¨¡å‹å†…ï¼‰ -&gt; sexï¼ˆå­—å…¸å†…ï¼‰</span></div><div class="line">            transformedName = (keyMapper||globalKeyMapper) ? [<span class="keyword">self</span> __mapString:property.name withKeyMapper:keyMapper] : property.name;</div><div class="line">            <span class="comment">//æ‹¿åˆ°sexä»¥åï¼ŒæŸ¥çœ‹ä¼ å…¥çš„å­—å…¸é‡Œæ˜¯å¦æœ‰sexå¯¹åº”çš„å€¼</span></div><div class="line">            <span class="keyword">id</span> value;</div><div class="line">            <span class="keyword">@try</span> &#123;</div><div class="line">                value = [dict valueForKeyPath:transformedName];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</div><div class="line">                value = dict[transformedName];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//å¦‚æœå€¼å­˜åœ¨ï¼Œåˆ™å°†sexæ·»åŠ åˆ°ä¼ å…¥çš„keysæ•°ç»„ä¸­</span></div><div class="line">            <span class="keyword">if</span> (value) &#123;</div><div class="line">                [transformedIncomingKeys addObject: property.name];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        incomingKeys = transformedIncomingKeys;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æŸ¥çœ‹å½“å‰çš„modelçš„å±æ€§çš„é›†åˆæ˜¯å¦å¤§äºä¼ å…¥çš„å±æ€§é›†åˆï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚</span></div><div class="line">    <span class="comment">//ä¹Ÿå°±æ˜¯è¯´æ¨¡å‹ç±»é‡Œçš„å±æ€§æ˜¯ä¸èƒ½å¤šäºä¼ å…¥å­—å…¸é‡Œçš„keyçš„ï¼Œä¾‹å¦‚ï¼š</span></div><div class="line">    <span class="keyword">if</span> (![requiredProperties isSubsetOfSet:incomingKeys]) &#123;</div><div class="line">        <span class="comment">//è·å–å¤šå‡ºæ¥çš„å±æ€§</span></div><div class="line">        [requiredProperties minusSet:incomingKeys];</div><div class="line">        <span class="comment">//not all required properties are in - invalid input</span></div><div class="line">        JMLog(<span class="string">@"Incoming data was invalid [%@ initWithDictionary:]. Keys missing: %@"</span>, <span class="keyword">self</span>.class, requiredProperties);</div><div class="line">        <span class="keyword">if</span> (err) *err = [JSONModelError errorInvalidDataWithMissingKeys:requiredProperties];</div><div class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//ä¸éœ€è¦äº†ï¼Œé‡Šæ”¾æ‰</span></div><div class="line">    incomingKeys= <span class="literal">nil</span>;</div><div class="line">    requiredProperties= <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œéœ€è¦éœ€è¦æ³¨æ„çš„ï¼š</p>
<ol>
<li>modelç±»é‡Œé¢å®šä¹‰çš„å±æ€§é›†åˆæ˜¯ä¸èƒ½å¤§äºä¼ å…¥çš„å­—å…¸é‡Œçš„keyé›†åˆçš„ã€‚</li>
<li>å¦‚æœå­˜åœ¨äº†ç”¨æˆ·è‡ªå®šä¹‰çš„mapperï¼Œåˆ™éœ€è¦æŒ‰ç…§ç”¨æˆ·çš„å®šä¹‰æ¥è¿›è¡Œè½¬æ¢ã€‚<br>ï¼ˆåœ¨è¿™é‡Œæ˜¯å¥–genderè½¬æ¢ä¸ºäº†sexï¼‰ã€‚</li>
</ol>
</blockquote>
<p>æœ€åæ¥çœ‹ä¸€ä¸‹æœ¬æ¡†æ¶ç¬¬äºŒä¸ªæ ¸å¿ƒä»£ç (ä¸Šé¢çš„æ–¹æ³•5)ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£ä»å­—å…¸é‡Œè·å–å€¼å¹¶èµ‹ç»™å½“å‰æ¨¡å‹å¯¹è±¡çš„å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">BOOL</span>)__importDictionary:(<span class="built_in">NSDictionary</span>*)dict withKeyMapper:(JSONKeyMapper*)keyMapper validation:(<span class="built_in">BOOL</span>)validation error:(<span class="built_in">NSError</span>**)err</div><div class="line">&#123;</div><div class="line">    <span class="comment">//éå†ä¿å­˜çš„æ‰€æœ‰å±æ€§çš„å­—å…¸</span></div><div class="line">    <span class="keyword">for</span> (JSONModelClassProperty* property <span class="keyword">in</span> [<span class="keyword">self</span> __properties__]) &#123;</div><div class="line">        <span class="comment">//å°†å±æ€§çš„åç§°æ‹¿è¿‡æ¥ï¼Œä½œä¸ºkeyï¼Œç”¨è¿™ä¸ªkeyæ¥æŸ¥æ‰¾ä¼ è¿›æ¥çš„å­—å…¸é‡Œå¯¹åº”çš„å€¼</span></div><div class="line">        <span class="built_in">NSString</span>* jsonKeyPath = (keyMapper||globalKeyMapper) ? [<span class="keyword">self</span> __mapString:property.name withKeyMapper:keyMapper] : property.name;</div><div class="line">        <span class="comment">//ç”¨æ¥ä¿å­˜ä»å­—å…¸é‡Œè·å–çš„å€¼</span></div><div class="line">        <span class="keyword">id</span> jsonValue;        </div><div class="line">        <span class="keyword">@try</span> &#123;</div><div class="line">            jsonValue = [dict valueForKeyPath: jsonKeyPath];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</div><div class="line">            jsonValue = dict[jsonKeyPath];</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//å­—å…¸ä¸å­˜åœ¨å¯¹åº”çš„key</span></div><div class="line">        <span class="keyword">if</span> (isNull(jsonValue)) &#123;</div><div class="line">            <span class="comment">//å¦‚æœè¿™ä¸ªkeyæ˜¯å¯ä»¥ä¸å­˜åœ¨çš„</span></div><div class="line">            <span class="keyword">if</span> (property.isOptional || !validation) <span class="keyword">continue</span>;            </div><div class="line">            <span class="comment">//å¦‚æœè¿™ä¸ªkeyæ˜¯å¿…é¡»æœ‰çš„ï¼Œåˆ™è¿”å›é”™è¯¯</span></div><div class="line">            <span class="keyword">if</span> (err) &#123;</div><div class="line">                <span class="built_in">NSString</span>* msg = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Value of required model key %@ is null"</span>, property.name];</div><div class="line">                JSONModelError* dataErr = [JSONModelError errorInvalidDataWithMessage:msg];</div><div class="line">                *err = [dataErr errorByPrependingKeyPathComponent:property.name];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">        &#125;        </div><div class="line">        <span class="comment">//è·å– å–åˆ°çš„å€¼çš„ç±»å‹</span></div><div class="line">        Class jsonValueClass = [jsonValue <span class="keyword">class</span>];</div><div class="line">        <span class="built_in">BOOL</span> isValueOfAllowedType = <span class="literal">NO</span>;</div><div class="line">        <span class="comment">//æŸ¥çœ‹æ˜¯å¦æ˜¯æœ¬æ¡†æ¶å…¼å®¹çš„å±æ€§ç±»å‹</span></div><div class="line">        <span class="keyword">for</span> (Class allowedType <span class="keyword">in</span> allowedJSONTypes) &#123;</div><div class="line">            <span class="keyword">if</span> ( [jsonValueClass isSubclassOfClass: allowedType] ) &#123;</div><div class="line">                isValueOfAllowedType = <span class="literal">YES</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;        </div><div class="line">        <span class="comment">//å¦‚æœä¸å…¼å®¹ï¼Œåˆ™è¿”å›NOï¼Œmappingå¤±è´¥</span></div><div class="line">        <span class="keyword">if</span> (isValueOfAllowedType==<span class="literal">NO</span>) &#123;</div><div class="line">            <span class="comment">//type not allowed</span></div><div class="line">            JMLog(<span class="string">@"Type %@ is not allowed in JSON."</span>, <span class="built_in">NSStringFromClass</span>(jsonValueClass));</div><div class="line">            <span class="keyword">if</span> (err) &#123;</div><div class="line">                <span class="built_in">NSString</span>* msg = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Type %@ is not allowed in JSON."</span>, <span class="built_in">NSStringFromClass</span>(jsonValueClass)];</div><div class="line">                JSONModelError* dataErr = [JSONModelError errorInvalidDataWithMessage:msg];</div><div class="line">                *err = [dataErr errorByPrependingKeyPathComponent:property.name];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//å¦‚æœæ˜¯å…¼å®¹çš„ç±»å‹ï¼š</span></div><div class="line">        <span class="keyword">if</span> (property) &#123;</div><div class="line">            <span class="comment">// æŸ¥çœ‹æ˜¯å¦æœ‰è‡ªå®šä¹‰setterï¼Œå¹¶è®¾ç½®</span></div><div class="line">            <span class="keyword">if</span> ([<span class="keyword">self</span> __customSetValue:jsonValue forProperty:property]) &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;;</div><div class="line">            <span class="comment">// åŸºæœ¬ç±»å‹</span></div><div class="line">            <span class="keyword">if</span> (property.type == <span class="literal">nil</span> &amp;&amp; property.structName==<span class="literal">nil</span>) &#123;</div><div class="line">                <span class="comment">//kvcèµ‹å€¼</span></div><div class="line">                <span class="keyword">if</span> (jsonValue != [<span class="keyword">self</span> valueForKey:property.name]) &#123;</div><div class="line">                    [<span class="keyword">self</span> setValue:jsonValue forKey: property.name];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// å¦‚æœä¼ æ¥çš„å€¼æ˜¯ç©ºï¼Œå³ä½¿å½“å‰çš„å±æ€§å¯¹åº”çš„å€¼ä¸æ˜¯ç©ºï¼Œä¹Ÿè¦å°†ç©ºå€¼èµ‹ç»™å®ƒ</span></div><div class="line">            <span class="keyword">if</span> (isNull(jsonValue)) &#123;</div><div class="line">                <span class="keyword">if</span> ([<span class="keyword">self</span> valueForKey:property.name] != <span class="literal">nil</span>) &#123;</div><div class="line">                    [<span class="keyword">self</span> setValue:<span class="literal">nil</span> forKey: property.name];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 1. å±æ€§æœ¬èº«æ˜¯å¦æ˜¯jsonmodelç±»å‹</span></div><div class="line">            <span class="keyword">if</span> ([<span class="keyword">self</span> __isJSONModelSubClass:property.type]) &#123;</div><div class="line">                <span class="comment">//é€šè¿‡è‡ªèº«çš„è½¬æ¨¡å‹æ–¹æ³•ï¼Œè·å–å¯¹åº”çš„å€¼</span></div><div class="line">                JSONModelError* initErr = <span class="literal">nil</span>;</div><div class="line">                <span class="keyword">id</span> value = [[property.type alloc] initWithDictionary: jsonValue error:&amp;initErr];</div><div class="line">                <span class="keyword">if</span> (!value) &#123;               </div><div class="line">                    <span class="comment">//å¦‚æœè¯¥å±æ€§ä¸æ˜¯å¿…é¡»çš„ï¼Œåˆ™ç•¥è¿‡</span></div><div class="line">                    <span class="keyword">if</span> (property.isOptional || !validation) <span class="keyword">continue</span>;</div><div class="line">                    <span class="comment">//å¦‚æœè¯¥å±æ€§æ˜¯å¿…é¡»çš„ï¼Œåˆ™è¿”å›é”™è¯¯</span></div><div class="line">                    <span class="keyword">if</span>((err != <span class="literal">nil</span>) &amp;&amp; (initErr != <span class="literal">nil</span>))</div><div class="line">                    &#123;</div><div class="line">                        *err = [initErr errorByPrependingKeyPathComponent:property.name];</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">                &#125;            </div><div class="line">                <span class="comment">//å½“å‰çš„å±æ€§å€¼ä¸ºç©ºï¼Œåˆ™èµ‹å€¼</span></div><div class="line">                <span class="keyword">if</span> (![value isEqual:[<span class="keyword">self</span> valueForKey:property.name]]) &#123;</div><div class="line">                    [<span class="keyword">self</span> setValue:value forKey: property.name];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// å¦‚æœä¸æ˜¯jsonmodelçš„ç±»å‹ï¼Œåˆ™å¯èƒ½æ˜¯ä¸€äº›æ™®é€šçš„ç±»å‹ï¼šNSArrayï¼ŒNSStringã€‚ã€‚ã€‚</span></div><div class="line">                <span class="comment">// æ˜¯å¦æ˜¯æ¨¡å‹åµŒå¥—ï¼ˆå¸¦æœ‰åè®®ï¼‰</span></div><div class="line">                <span class="keyword">if</span> (property.protocol) &#123;</div><div class="line">                    <span class="comment">//è½¬åŒ–ä¸ºæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å°±æ˜¯ä¾‹å­ä¸­çš„friendså±æ€§ã€‚</span></div><div class="line">                    jsonValue = [<span class="keyword">self</span> __transform:jsonValue forProperty:property error:err];</div><div class="line">                   </div><div class="line">                    <span class="keyword">if</span> (!jsonValue) &#123;</div><div class="line">                        <span class="keyword">if</span> ((err != <span class="literal">nil</span>) &amp;&amp; (*err == <span class="literal">nil</span>)) &#123;</div><div class="line">                            <span class="built_in">NSString</span>* msg = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Failed to transform value, but no error was set during transformation. (%@)"</span>, property];</div><div class="line">                            JSONModelError* dataErr = [JSONModelError errorInvalidDataWithMessage:msg];</div><div class="line">                            *err = [dataErr errorByPrependingKeyPathComponent:property.name];</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// å¯¹è±¡ç±»å‹</span></div><div class="line">                <span class="keyword">if</span> (property.isStandardJSONType &amp;&amp; [jsonValue isKindOfClass: property.type]) &#123;</div><div class="line">                    <span class="comment">//å¯å˜ç±»å‹</span></div><div class="line">                    <span class="keyword">if</span> (property.isMutable) &#123;</div><div class="line">                        jsonValue = [jsonValue mutableCopy];</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">//èµ‹å€¼</span></div><div class="line">                    <span class="keyword">if</span> (![jsonValue isEqual:[<span class="keyword">self</span> valueForKey:property.name]]) &#123;</div><div class="line">                        [<span class="keyword">self</span> setValue:jsonValue forKey: property.name];</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// å½“å‰çš„å€¼çš„ç±»å‹ä¸å¯¹åº”çš„å±æ€§çš„ç±»å‹ä¸ä¸€æ ·çš„æ—¶å€™ï¼Œéœ€è¦æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦è‡ªå®šä¹‰äº†è½¬æ¢å™¨ï¼ˆä¾‹å¦‚ä»NSSetåˆ°NSArrayè½¬æ¢ï¼š- (NSSet *)NSSetFromNSArray:(NSArray *)arrayï¼‰</span></div><div class="line">                <span class="keyword">if</span> (</div><div class="line">                    (![jsonValue isKindOfClass:property.type] &amp;&amp; !isNull(jsonValue))</div><div class="line">                    ||</div><div class="line">                    <span class="comment">//the property is mutable</span></div><div class="line">                    property.isMutable</div><div class="line">                    ||</div><div class="line">                    <span class="comment">//custom struct property</span></div><div class="line">                    property.structName</div><div class="line">                    ) &#123;</div><div class="line">                    <span class="comment">// searched around the web how to do this better</span></div><div class="line">                    <span class="comment">// but did not find any solution, maybe that's the best idea? (hardly)</span></div><div class="line">                    Class sourceClass = [JSONValueTransformer classByResolvingClusterClasses:[jsonValue <span class="keyword">class</span>]];</div><div class="line">                    <span class="comment">//JMLog(@"to type: [%@] from type: [%@] transformer: [%@]", p.type, sourceClass, selectorName);</span></div><div class="line"></div><div class="line">                    <span class="comment">//build a method selector for the property and json object classes</span></div><div class="line">                    <span class="built_in">NSString</span>* selectorName = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@From%@:"</span>,</div><div class="line">                                              (property.structName? property.structName : property.type), <span class="comment">//target name</span></div><div class="line">                                              sourceClass]; <span class="comment">//source name</span></div><div class="line">                    SEL selector = <span class="built_in">NSSelectorFromString</span>(selectorName);</div><div class="line">                    <span class="comment">//æŸ¥çœ‹è‡ªå®šä¹‰çš„è½¬æ¢å™¨æ˜¯å¦å­˜åœ¨</span></div><div class="line">                    <span class="built_in">BOOL</span> foundCustomTransformer = <span class="literal">NO</span>;</div><div class="line">                    <span class="keyword">if</span> ([valueTransformer respondsToSelector:selector]) &#123;</div><div class="line">                        foundCustomTransformer = <span class="literal">YES</span>;                        </div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="comment">//try for hidden custom transformer</span></div><div class="line">                        selectorName = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"__%@"</span>,selectorName];</div><div class="line">                        selector = <span class="built_in">NSSelectorFromString</span>(selectorName);</div><div class="line">                        <span class="keyword">if</span> ([valueTransformer respondsToSelector:selector]) &#123;</div><div class="line">                            foundCustomTransformer = <span class="literal">YES</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">//å¦‚æœå­˜åœ¨è‡ªå®šä¹‰è½¬æ¢å™¨ï¼Œåˆ™è¿›è¡Œè½¬æ¢</span></div><div class="line">                    <span class="keyword">if</span> (foundCustomTransformer) &#123;                        </div><div class="line">                        IMP imp = [valueTransformer methodForSelector:selector];</div><div class="line">                        <span class="keyword">id</span> (*func)(<span class="keyword">id</span>, SEL, <span class="keyword">id</span>) = (<span class="keyword">void</span> *)imp;</div><div class="line">                        jsonValue = func(valueTransformer, selector, jsonValue);</div><div class="line"></div><div class="line">                        <span class="keyword">if</span> (![jsonValue isEqual:[<span class="keyword">self</span> valueForKey:property.name]])</div><div class="line">                            [<span class="keyword">self</span> setValue:jsonValue forKey:property.name];                        </div><div class="line">                    &#125; <span class="keyword">else</span> &#123;                       </div><div class="line">                        <span class="comment">//æ²¡æœ‰è‡ªå®šä¹‰è½¬æ¢å™¨ï¼Œè¿”å›é”™è¯¯</span></div><div class="line">                        <span class="built_in">NSString</span>* msg = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@ type not supported for %@.%@"</span>, property.type, [<span class="keyword">self</span> <span class="keyword">class</span>], property.name];</div><div class="line">                        JSONModelError* dataErr = [JSONModelError errorInvalidDataWithTypeMismatch:msg];</div><div class="line">                        *err = [dataErr errorByPrependingKeyPathComponent:property.name];</div><div class="line">                        <span class="keyword">return</span> <span class="literal">NO</span>;                        </div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="comment">// 3.4) handle "all other" cases (if any)</span></div><div class="line">                    <span class="keyword">if</span> (![jsonValue isEqual:[<span class="keyword">self</span> valueForKey:property.name]])</div><div class="line">                        [<span class="keyword">self</span> setValue:jsonValue forKey:property.name];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>ä½œè€…åœ¨æœ€åç»™å±æ€§èµ‹å€¼çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯kvcçš„<code>setValue:ForKey:</code>çš„æ–¹æ³•ã€‚</li>
<li>ä½œè€…åˆ¤æ–­äº†æ¨¡å‹é‡Œçš„å±æ€§çš„ç±»å‹æ˜¯å¦æ˜¯JSONModelçš„å­ç±»ï¼Œå¯è§ä½œè€…çš„è€ƒè™‘æ˜¯éå¸¸å‘¨å…¨çš„ã€‚</li>
<li>æ•´ä¸ªæ¡†æ¶çœ‹ä¸‹æ¥ï¼Œæœ‰å¾ˆå¤šçš„åœ°æ–¹æ¶‰åŠåˆ°äº†é”™è¯¯åˆ¤æ–­ï¼Œä½œè€…å°†å°†é”™è¯¯ç±»å‹å•ç‹¬æŠ½å‡ºä¸€ä¸ªç±»ï¼ˆ<code>JSONModelError</code>ï¼‰ï¼Œé‡Œé¢æ”¯æŒçš„é”™è¯¯ç±»å‹å¾ˆå¤šï¼Œå¯ä»¥ä¾§é¢ååº”ä½œè€…æ€ç»´ä¹‹ç¼œå¯†ã€‚è€Œä¸”è¿™ä¸ªåšæ³•ä¹Ÿå¯ä»¥åœ¨æˆ‘ä»¬å†™è‡ªå·±çš„æ¡†æ¶æˆ–è€…é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</li>
</ul>
</blockquote>
<p>é”™è¯¯åˆ¤æ–­çš„ä¸€ä¸ªä¾‹å­ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//JSONModelError.m</span></div><div class="line">+(<span class="keyword">id</span>)errorInvalidDataWithMessage:(<span class="built_in">NSString</span>*)message</div><div class="line">&#123;</div><div class="line">    message = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Invalid JSON data: %@"</span>, message];</div><div class="line">    <span class="keyword">return</span> [JSONModelError errorWithDomain:JSONModelErrorDomain</div><div class="line">                                      code:kJSONModelErrorInvalidData</div><div class="line">                                  userInfo:@&#123;<span class="built_in">NSLocalizedDescriptionKey</span>:message&#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¤¸äº†ä½œè€…è¿™ä¹ˆå¤šï¼Œå”¯ä¸€æˆ‘ä¸ªäººä¸å¤ªå–œæ¬¢çš„åœ°æ–¹å°±æ˜¯ifè¯­å¥ä¸‹åªæœ‰ä¸€è¡Œçš„æ—¶å€™ï¼Œä½œè€…ä¸å–œæ¬¢åŠ ä¸Šå¤§æ‹¬å·ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (![jsonValue isEqual:[<span class="keyword">self</span> valueForKey:property.name]])</div><div class="line">    [<span class="keyword">self</span> setValue:jsonValue forKey:property.name];</div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯æˆ‘è§‰å¾—åº”è¯¥åŠ çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (![jsonValue isEqual:[<span class="keyword">self</span> valueForKey:property.name]])&#123;</div><div class="line">  [<span class="keyword">self</span> setValue:jsonValue forKey:property.name];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="çŸ¥è¯†æ‰©å±•"><a href="#çŸ¥è¯†æ‰©å±•" class="headerlink" title="çŸ¥è¯†æ‰©å±•"></a>çŸ¥è¯†æ‰©å±•</h2><ul>
<li>ä½œè€…ç”¨NSScanneræ¥æ‰«æå­—ç¬¦ä¸²ï¼Œå°†ä»ç±»ç»“æ„ä½“é‡Œæ‹¿è¿‡æ¥çš„å±æ€§çš„æè¿°å­—ç¬¦ä¸²<code>T@\&quot;NSString\&quot;,C,N,V_name</code>ä¸­æ‰«æå‡ºäº†ç±»å‹ï¼š<code>NSString</code>ã€‚</li>
<li>ä½œè€…ä¸¤æ¬¡ç”¨åˆ°äº†NSSetï¼šå½“é›†åˆé‡Œçš„å…ƒç´ é¡ºåºä¸é‡è¦çš„æ—¶å€™ï¼Œä¼˜å…ˆè€ƒè™‘ç”¨NSSetã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´è¿™ä¸ªæ¡†æ¶çš„éš¾åº¦è¿˜æ˜¯ä¸å¤§çš„ï¼Œä½†å¯èƒ½å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡é˜…è¯»ä¸æ¶‰åŠUIVIiewçš„æ¡†æ¶ï¼Œæ„Ÿè§‰æœ‰äº›æ¯ç‡¥ï¼Œä¸è¿‡æ…¢æ…¢ä¹ æƒ¯å°±å¥½å•¦ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ä¸€ç³»åˆ—çš„&lt;a href=&quot;http://www.jianshu.com/nb/9137726&quot;&gt;æºç è§£æ&lt;/a&gt;åˆ†äº«åˆ°ç°åœ¨å·²ç»æ˜¯ç¬¬äº”ç¯‡äº†ã€‚è¿™äº”ç¯‡è®²è§£çš„éƒ½æ˜¯viewå±‚çš„ä¸€äº›æµè¡Œçš„iOSå¼€æºæ¡†æ¶ã€‚è€Œä»æœ¬ç¯‡å¼€å§‹å¼€å§‹ï¼Œæˆ‘æ‰“ç®—è¦é€æ¸åŠ æ·±éš¾åº¦ï¼Œè®²è§£ä¸€äº›modelå±‚å’Œç½‘ç»œå±‚ç›¸å…³çš„å¼€æºæ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³æ¥æƒ³å»ï¼Œè¿˜æ˜¯ä»&lt;a href=&quot;https://github.com/jsonmodel/jsonmodel&quot;&gt;JSONModel&lt;/a&gt;å¼€å§‹å§ï½&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå› ä¸ºè¯¥æ¡†æ¶è¿˜æ˜¯æ¯”è¾ƒæµè¡Œçš„ï¼Œåœ¨GitHubä¸Šä¹Ÿæœ‰å°†è¿‘6000é¢—æ˜Ÿäº†ï¼Œè€Œä¸”æˆ‘è‡ªå·±å¯¹è¿™ä¸ªæ¡†æ¶çš„ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç†Ÿæ‚‰ã€‚è¿˜æœ‰ä¸€ç‚¹æ˜¯è¿™ä¸ªæ¡†æ¶è¿ç”¨äº†è¿è¡Œæ—¶çš„ç›¸å…³çŸ¥è¯†ï¼Œå¯¹æƒ³è¦äº†è§£è¿è¡Œæ—¶çš„ç«¥é‹è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ¡†æ¶çš„æ ¸å¿ƒä»£ç å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œä¸»è¦è¿˜æ˜¯é”™è¯¯ç±»å‹åˆ¤æ–­å’Œå®¹é”™å¤„ç†å äº†ä¸å°‘å†…å®¹ã€‚è¯»è¿‡ä¸€éä¹‹åï¼Œæ„Ÿè§‰åˆ°ä½œè€…æ€ç»´çš„ä¸¥è°¨æ€§æ˜¯éå¸¸å€¼å¾—æˆ‘ä»¬å­¦ä¹ çš„ï¼šä½œè€…ä¸“é—¨å»ºç«‹äº†ä¸€ä¸ªå±•ç¤ºé”™è¯¯(NSError)çš„ç±»ï¼Œé‡Œé¢å°è£…äº†å¾ˆå¤šé”™è¯¯ç±»å‹ï¼Œè€Œä¸”è¿™ä¸ªæ¡†æ¶è¿˜å…è®¸ç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥è‡ªå®šä¹‰é”™è¯¯ç±»å‹å¹¶é˜»æ­¢æœ€ç»ˆæ¨¡å‹çš„ç”Ÿæˆï¼Œåœ¨åæ–‡ä¼šæœ‰è¯¦ç»†è®²è§£ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
      <category term="æºç è§£æ" scheme="https://github.com/knightsj/knightsj.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>VVeboTableViewæºç è§£æ</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/02/14/VVeboTableView%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/02/14/VVeboTableViewæºç è§£æ/</id>
    <published>2017-02-14T02:57:30.000Z</published>
    <updated>2017-03-20T07:57:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ¬¡åˆ†äº«ä¸€ä¸ªå…³äºæ€§èƒ½ä¼˜åŒ–çš„æºç ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“<code>UITabelView</code>åœ¨iOSå¼€å‘ä¸­æ‰®æ¼”è€…ä¸¾è¶³è½»é‡çš„è§’è‰²ï¼Œå› ä¸ºå®ƒæ˜¯iOSå¼€å‘ä¸­ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„æ§ä»¶ä¹‹ä¸€ï¼šå‡ ä¹æ¯ä¸ªappéƒ½ç¦»ä¸å¼€å®ƒï¼Œå› æ­¤ï¼Œ<code>UITabelView</code>çš„æ€§èƒ½å°†ç›´æ¥å½±å“è¿™ä¸ªappçš„æ€§èƒ½ã€‚</p>
<p>å¦‚æœ<code>UITabelView</code>é‡Œçš„cellè®¾è®¡çš„æ¯”è¾ƒç®€å•ï¼Œé‚£ä¹ˆå³ä½¿ä¸åšç›¸åº”çš„ä¼˜åŒ–ï¼Œå¯¹æ€§èƒ½çš„å½±å“ä¹Ÿä¸ä¼šå¾ˆå¤§ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“cellé‡Œé¢æ¶‰åŠåˆ°å›¾æ–‡æ··æ’ï¼Œcellé«˜åº¦ä¸éƒ½ç›¸ç­‰çš„è®¾è®¡æ—¶ï¼Œå¦‚æœä¸è¿›è¡Œä¸€äº›æ“ä½œçš„è¯ï¼Œä¼šéå¸¸å½±å“æ€§èƒ½ï¼Œç”šè‡³ä¼šå‡ºç°å¡é¡¿ï¼Œé€ æˆéå¸¸ä¸å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>æœ€è¿‘åœ¨çœ‹ä¸€äº›iOSæ€§èƒ½ä¼˜åŒ–çš„æ–‡ç« ï¼Œæˆ‘æ‰¾åˆ°äº†<a href="https://github.com/johnil/VVeboTableViewDemo">VVeboTableView</a>è¿™ä¸ªæ¡†æ¶ã€‚ä¸¥æ ¼æ¥è¯´è¿™ä¸ªä¸å±äºæ¡†æ¶ï¼Œè€Œæ˜¯ä½œè€…ç”¨è‡ªå·±çš„æ–¹å¼ä¼˜åŒ–<code>UITableView</code>çš„ä¸€ä¸ªå®ç°ã€‚</p>
<p>ä½œè€…æ¨¡ä»¿äº†æ–°æµªå¾®åšçš„cellæ ·å¼ï¼Œåœ¨é‡Œé¢å±•ç¤ºäº†å„ç§å¾®åšçš„cellã€‚è™½ç„¶æ ·å¼æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯æ€§èƒ½å´å¾ˆå¥½ï¼šæˆ‘åœ¨æˆ‘çš„iphone 4sä¸Šè¿›è¡Œäº†Core Animationæµ‹è¯•ï¼Œåœ¨æ»‘åŠ¨çš„æ—¶å€™å¸§ç‡æ²¡æœ‰ä½äº56ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è§‰å¾—æœ‰åŠç‚¹å¡é¡¿ï¼Œé‚£ä¹ˆä»–æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p>
<p>çœ‹äº†æºç ä¹‹åï¼Œæˆ‘æŠŠä½œè€…çš„æ€è·¯æ•´ç†äº†å‡ºæ¥ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/VVeboTableView_0.png" alt="ä¼˜åŒ–æ€è·¯å›¾"></p>
<p>ä¸‹é¢æˆ‘å°±ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œç»“åˆä»£ç æ¥å±•ç¤ºä¸€ä¸‹ä½œè€…æ˜¯å¦‚ä½•å®ç°æ¯ä¸€ç‚¹çš„ã€‚</p>
<a id="more"></a>
<h2 id="1-å‡å°‘CPUï¼GPUè®¡ç®—é‡"><a href="#1-å‡å°‘CPUï¼GPUè®¡ç®—é‡" class="headerlink" title="1. å‡å°‘CPUï¼GPUè®¡ç®—é‡"></a>1. å‡å°‘CPUï¼GPUè®¡ç®—é‡</h2><h3 id="1-1-cellçš„é‡ç”¨æœºåˆ¶"><a href="#1-1-cellçš„é‡ç”¨æœºåˆ¶" class="headerlink" title="1.1 cellçš„é‡ç”¨æœºåˆ¶"></a>1.1 cellçš„é‡ç”¨æœºåˆ¶</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//cellé‡ç”¨</span></div><div class="line">    VVeboTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:<span class="string">@"cell"</span>];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (cell==<span class="literal">nil</span>) &#123;</div><div class="line">        cell = [[VVeboTableViewCell alloc] initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:<span class="string">@"cell"</span>];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//ç»˜åˆ¶</span></div><div class="line">    [<span class="keyword">self</span> drawCell:cell withIndexPath:indexPath];</div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†å°±ä¸èµ˜è¿°äº†ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å¯ä»¥æŒæ¡ã€‚</p>
<h3 id="1-2-å°†cellé«˜åº¦å’Œ-cellé‡Œçš„æ§ä»¶çš„frameç¼“å­˜åœ¨modelé‡Œ"><a href="#1-2-å°†cellé«˜åº¦å’Œ-cellé‡Œçš„æ§ä»¶çš„frameç¼“å­˜åœ¨modelé‡Œ" class="headerlink" title="1.2 å°†cellé«˜åº¦å’Œ cellé‡Œçš„æ§ä»¶çš„frameç¼“å­˜åœ¨modelé‡Œ"></a>1.2 å°†cellé«˜åº¦å’Œ cellé‡Œçš„æ§ä»¶çš„frameç¼“å­˜åœ¨modelé‡Œ</h3><p>è¿™ä¸€æ­¥æˆ‘ä»¬éœ€è¦åœ¨å­—å…¸è½¬æ¨¡å‹é‡Œç»Ÿä¸€è®¡ç®—(ä¸éœ€è¦çœ‹ä»£ç ç»†èŠ‚ï¼Œåªéœ€è¦çŸ¥é“è¿™é‡Œåœ¨æ¨¡å‹é‡Œä¿å­˜äº†éœ€è¦ä¿å­˜çš„æ§ä»¶çš„frameå’Œæ•´ä¸ªcellçš„é«˜åº¦å³å¯)ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)loadData&#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> temp) &#123;</div><div class="line">        </div><div class="line">        <span class="built_in">NSDictionary</span> *user = dict[<span class="string">@"user"</span>];</div><div class="line">        </div><div class="line">        ...</div><div class="line">        </div><div class="line">        <span class="built_in">NSDictionary</span> *retweet = [dict valueForKey:<span class="string">@"retweeted_status"</span>];</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (retweet) &#123;</div><div class="line">            </div><div class="line">            <span class="built_in">NSMutableDictionary</span> *subData = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">            ...</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">float</span> width = [<span class="built_in">UIScreen</span> screenWidth]-SIZE_GAP_LEFT*<span class="number">2</span>;</div><div class="line">                <span class="built_in">CGSize</span> size = [subData[<span class="string">@"text"</span>] sizeWithConstrainedToWidth:width fromFont:FontWithSize(SIZE_FONT_SUBCONTENT) lineSpace:<span class="number">5</span>];</div><div class="line">                <span class="built_in">NSInteger</span> sizeHeight = (size.height+<span class="number">.5</span>);</div><div class="line">                subData[<span class="string">@"textRect"</span>] = [<span class="built_in">NSValue</span> valueWithCGRect:<span class="built_in">CGRectMake</span>(SIZE_GAP_LEFT, SIZE_GAP_BIG, width, sizeHeight)];</div><div class="line">                sizeHeight += SIZE_GAP_BIG;</div><div class="line">                <span class="keyword">if</span> (subData[<span class="string">@"pic_urls"</span>] &amp;&amp; [subData[<span class="string">@"pic_urls"</span>] count]&gt;<span class="number">0</span>) &#123;</div><div class="line">                    sizeHeight += (SIZE_GAP_IMG+SIZE_IMAGE+SIZE_GAP_IMG);</div><div class="line">                &#125;</div><div class="line">                sizeHeight += SIZE_GAP_BIG;</div><div class="line">                subData[<span class="string">@"frame"</span>] = [<span class="built_in">NSValue</span> valueWithCGRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, [<span class="built_in">UIScreen</span> screenWidth], sizeHeight)];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            data[<span class="string">@"subData"</span>] = subData;</div><div class="line">           </div><div class="line">        </div><div class="line">            <span class="keyword">float</span> width = [<span class="built_in">UIScreen</span> screenWidth]-SIZE_GAP_LEFT*<span class="number">2</span>;</div><div class="line">            <span class="built_in">CGSize</span> size = [data[<span class="string">@"text"</span>] sizeWithConstrainedToWidth:width fromFont:FontWithSize(SIZE_FONT_CONTENT) lineSpace:<span class="number">5</span>];</div><div class="line">            <span class="built_in">NSInteger</span> sizeHeight = (size.height+<span class="number">.5</span>);</div><div class="line">            ...</div><div class="line">            sizeHeight += SIZE_GAP_TOP+SIZE_AVATAR+SIZE_GAP_BIG;</div><div class="line">            <span class="keyword">if</span> (data[<span class="string">@"pic_urls"</span>] &amp;&amp; [data[<span class="string">@"pic_urls"</span>] count]&gt;<span class="number">0</span>) &#123;</div><div class="line">                sizeHeight += (SIZE_GAP_IMG+SIZE_IMAGE+SIZE_GAP_IMG);</div><div class="line">            </div><div class="line">            </div><div class="line">            <span class="built_in">NSMutableDictionary</span> *subData = [data valueForKey:<span class="string">@"subData"</span>];</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> (subData) &#123;</div><div class="line">                sizeHeight += SIZE_GAP_BIG;</div><div class="line">                <span class="built_in">CGRect</span> frame = [subData[<span class="string">@"frame"</span>] <span class="built_in">CGRectValue</span>];</div><div class="line">                ...</div><div class="line">                sizeHeight += frame.size.height;</div><div class="line">                data[<span class="string">@"subData"</span>] = subData;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            sizeHeight += <span class="number">30</span>;</div><div class="line">            data[<span class="string">@"frame"</span>] = [<span class="built_in">NSValue</span> valueWithCGRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, [<span class="built_in">UIScreen</span> screenWidth], sizeHeight)];</div><div class="line">        &#125;</div><div class="line">        [datas addObject:data];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//è·å–é«˜åº¦ç¼“å­˜</span></div><div class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    <span class="built_in">NSDictionary</span> *dict = datas[indexPath.row];</div><div class="line">    <span class="keyword">float</span> height = [dict[<span class="string">@"frame"</span>] <span class="built_in">CGRectValue</span>].size.height;</div><div class="line">    <span class="keyword">return</span> height;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½œè€…æ ¹æ®å¸–å­ç±»å‹çš„ä¸åŒï¼šåŸè´´(subData)çš„å­˜åœ¨ä¸å¦ï¼‰ï¼Œæ¥é€æ¸å åŠ cellçš„é«˜åº¦ã€‚</p>
<p>è€Œç¼“å­˜çš„æ§ä»¶çš„frameï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢è®²è§£ç»˜åˆ¶cellçš„ä»£ç é‡Œè¯¦ç»†ä»‹ç»ã€‚</p>
<h3 id="1-3-å‡å°‘cellå†…éƒ¨æ§ä»¶çš„å±‚çº§"><a href="#1-3-å‡å°‘cellå†…éƒ¨æ§ä»¶çš„å±‚çº§" class="headerlink" title="1.3 å‡å°‘cellå†…éƒ¨æ§ä»¶çš„å±‚çº§"></a>1.3 å‡å°‘cellå†…éƒ¨æ§ä»¶çš„å±‚çº§</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªå¸¦æœ‰åŸè´´çš„è½¬å‘è´´çš„å¸ƒå±€ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/VVeboTableView_3.png" alt="å¸ƒå±€"></p>
<p>å¯èƒ½æœ‰å°ä¼™ä¼´ä¼šå°†ä¸Šä¸­ä¸‹è¿™ä¸‰ä¸ªéƒ¨åˆ†å„è‡ªå°è£…æˆä¸€ä¸ªviewï¼Œå†é€šè¿‡æ¯ä¸ªviewæ¥ç®¡ç†å„è‡ªçš„å­viewã€‚ä½†æ˜¯è¿™ä¸ªæ¡†æ¶çš„ä½œè€…å´å°†å®ƒä»¬éƒ½æ’åˆ—åˆ°ä¸€å±‚ä¸Šã€‚</p>
<p>å‡å°‘äº†å­viewçš„å±‚çº§ï¼Œæœ‰åŠ©äºå‡å°‘cpuå¯¹å„ç§çº¦æŸçš„è®¡ç®—ã€‚è¿™åœ¨å­viewçš„æ•°é‡ï¼Œå±‚çº§éƒ½å¾ˆå¤šçš„æƒ…å†µä¸‹å¯¹cpuçš„å‹åŠ›ä¼šå‡è½»å¾ˆå¤šã€‚</p>
<h3 id="1-4-é€šè¿‡è¦†ç›–åœ†è§’å›¾ç‰‡æ¥å®ç°å¤´åƒçš„åœ†è§’æ•ˆæœ"><a href="#1-4-é€šè¿‡è¦†ç›–åœ†è§’å›¾ç‰‡æ¥å®ç°å¤´åƒçš„åœ†è§’æ•ˆæœ" class="headerlink" title="1.4 é€šè¿‡è¦†ç›–åœ†è§’å›¾ç‰‡æ¥å®ç°å¤´åƒçš„åœ†è§’æ•ˆæœ"></a>1.4 é€šè¿‡è¦†ç›–åœ†è§’å›¾ç‰‡æ¥å®ç°å¤´åƒçš„åœ†è§’æ•ˆæœ</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å¤´åƒï¼Œframeå›ºå®š</span></div><div class="line">avatarView = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];<span class="comment">//[[VVeboAvatarView alloc] initWithFrame:avatarRect];</span></div><div class="line">avatarView.frame = <span class="built_in">CGRectMake</span>(SIZE_GAP_LEFT, SIZE_GAP_TOP, SIZE_AVATAR, SIZE_AVATAR);</div><div class="line">avatarView.backgroundColor = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">250</span>/<span class="number">255.0</span> green:<span class="number">250</span>/<span class="number">255.0</span> blue:<span class="number">250</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>];</div><div class="line">avatarView.hidden = <span class="literal">NO</span>;</div><div class="line">avatarView.tag = <span class="built_in">NSIntegerMax</span>;</div><div class="line">avatarView.clipsToBounds = <span class="literal">YES</span>;</div><div class="line">[<span class="keyword">self</span>.contentView addSubview:avatarView];</div><div class="line"><span class="comment">//è¦†ç›–åœ¨å¤´åƒä¸Šé¢çš„å›¾ç‰‡ï¼Œåˆ¶é€ åœ†è§’æ•ˆæœï¼šframe</span></div><div class="line">cornerImage = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, SIZE_AVATAR+<span class="number">5</span>, SIZE_AVATAR+<span class="number">5</span>)];</div><div class="line">cornerImage.center = avatarView.center;</div><div class="line">cornerImage.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"corner_circle@2x.png"</span>];</div><div class="line">cornerImage.tag = <span class="built_in">NSIntegerMax</span>;</div><div class="line">[<span class="keyword">self</span>.contentView addSubview:cornerImage];</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œä½œè€…æ²¡æœ‰ä½¿ç”¨ä»»ä½•å¤æ‚çš„æŠ€æœ¯æ¥å®ç°å›¾ç‰‡çš„åœ†è§’ï¼ˆä½¿ç”¨layeræˆ–è€…è£å‰ªå›¾ç‰‡ï¼‰ï¼Œåªæ˜¯å°†ä¸€å¼ åœ†è§’é¢œè‰²å’ŒcellèƒŒæ™¯è‰²ä¸€è‡´çš„å›¾ç‰‡è¦†ç›–åœ¨äº†åŸæ¥çš„å¤´åƒä¸Šï¼Œå®ç°äº†åœ†è§’çš„æ•ˆæœï¼ˆä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸å¤ªé€‚ç”¨äºæœ‰å¤šä¸ªé…è‰²æ–¹æ¡ˆçš„appï¼‰ã€‚</p>
<h2 id="2-æŒ‰éœ€åŠ è½½cell"><a href="#2-æŒ‰éœ€åŠ è½½cell" class="headerlink" title="2. æŒ‰éœ€åŠ è½½cell"></a>2. æŒ‰éœ€åŠ è½½cell</h2><p>ä¸Šæ–‡æåˆ°è¿‡ï¼Œ<code>UITableView</code>æŒæœ‰ä¸€ä¸ª<code>needLoadArr</code>æ•°ç»„ï¼Œå®ƒä¿å­˜ç€éœ€è¦åˆ·æ–°çš„cellçš„<code>NSIndexPath</code>ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹<code>needLoadArr</code>æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š</p>
<h3 id="2-1-åœ¨cellForRow-æ–¹æ³•é‡ŒåªåŠ è½½å¯è§cell"><a href="#2-1-åœ¨cellForRow-æ–¹æ³•é‡ŒåªåŠ è½½å¯è§cell" class="headerlink" title="2.1 åœ¨cellForRow:æ–¹æ³•é‡ŒåªåŠ è½½å¯è§cell"></a>2.1 åœ¨cellForRow:æ–¹æ³•é‡ŒåªåŠ è½½å¯è§cell</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    ...</div><div class="line">    [<span class="keyword">self</span> drawCell:cell withIndexPath:indexPath];</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)drawCell:(VVeboTableViewCell *)cell withIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSDictionary</span> *data = [datas objectAtIndex:indexPath.row];    </div><div class="line">    ...</div><div class="line">    cell.data = data;</div><div class="line">    <span class="comment">//å½“å‰çš„cellçš„indexPathä¸åœ¨needLoadArré‡Œé¢ï¼Œä¸ç”¨ç»˜åˆ¶</span></div><div class="line">    <span class="keyword">if</span> (needLoadArr.count&gt;<span class="number">0</span>&amp;&amp;[needLoadArr indexOfObject:indexPath]==<span class="built_in">NSNotFound</span>) &#123;</div><div class="line">        [cell clear];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;    </div><div class="line">    <span class="comment">//å°†è¦æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œä¸ç»˜åˆ¶</span></div><div class="line">    <span class="keyword">if</span> (scrollToToping) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;  </div><div class="line">    <span class="comment">//çœŸæ­£ç»˜åˆ¶cellçš„ä»£ç </span></div><div class="line">    [cell draw];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-2-ç›‘å¬tableviewçš„å¿«é€Ÿæ»šåŠ¨ï¼Œä¿å­˜ç›®æ ‡æ»šåŠ¨èŒƒå›´çš„å‰åä¸‰è¡Œçš„ç´¢å¼•"><a href="#2-2-ç›‘å¬tableviewçš„å¿«é€Ÿæ»šåŠ¨ï¼Œä¿å­˜ç›®æ ‡æ»šåŠ¨èŒƒå›´çš„å‰åä¸‰è¡Œçš„ç´¢å¼•" class="headerlink" title="2.2 ç›‘å¬tableviewçš„å¿«é€Ÿæ»šåŠ¨ï¼Œä¿å­˜ç›®æ ‡æ»šåŠ¨èŒƒå›´çš„å‰åä¸‰è¡Œçš„ç´¢å¼•"></a>2.2 ç›‘å¬tableviewçš„å¿«é€Ÿæ»šåŠ¨ï¼Œä¿å­˜ç›®æ ‡æ»šåŠ¨èŒƒå›´çš„å‰åä¸‰è¡Œçš„ç´¢å¼•</h3><p>çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨<code>needLoadArr</code>ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>needLoadArr</code>é‡Œé¢çš„å…ƒç´ å¸ˆå¦‚ä½•æ·»åŠ å’Œåˆ é™¤ã€‚</p>
<h4 id="æ·»åŠ å…ƒç´ NSIndexPath"><a href="#æ·»åŠ å…ƒç´ NSIndexPath" class="headerlink" title="æ·»åŠ å…ƒç´ NSIndexPath"></a>æ·»åŠ å…ƒç´ NSIndexPath</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æŒ‰éœ€åŠ è½½ - å¦‚æœç›®æ ‡è¡Œä¸å½“å‰è¡Œç›¸å·®è¶…è¿‡æŒ‡å®šè¡Œæ•°ï¼Œåªåœ¨ç›®æ ‡æ»šåŠ¨èŒƒå›´çš„å‰åæŒ‡å®š3è¡ŒåŠ è½½ã€‚</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewWillEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView withVelocity:(<span class="built_in">CGPoint</span>)velocity targetContentOffset:(<span class="keyword">inout</span> <span class="built_in">CGPoint</span> *)targetContentOffset&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//targetContentOffset ï¼š åœæ­¢åçš„contentOffset</span></div><div class="line">    <span class="built_in">NSIndexPath</span> *ip = [<span class="keyword">self</span> indexPathForRowAtPoint:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, targetContentOffset-&gt;y)];</div><div class="line">    </div><div class="line">    <span class="comment">//å½“å‰å¯è§ç¬¬ä¸€è¡Œrowçš„index</span></div><div class="line">    <span class="built_in">NSIndexPath</span> *cip = [[<span class="keyword">self</span> indexPathsForVisibleRows] firstObject];</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®æœ€å°è·¨åº¦ï¼Œå½“æ»‘åŠ¨çš„é€Ÿåº¦å¾ˆå¿«ï¼Œè¶…è¿‡è¿™ä¸ªè·¨åº¦æ—¶å€™æ‰§è¡ŒæŒ‰éœ€åŠ è½½</span></div><div class="line">    <span class="built_in">NSInteger</span> skipCount = <span class="number">8</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//å¿«é€Ÿæ»‘åŠ¨(è·¨åº¦è¶…è¿‡äº†8ä¸ªcell)</span></div><div class="line">    <span class="keyword">if</span> (labs(cip.row-ip.row)&gt;skipCount) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//æŸä¸ªåŒºåŸŸé‡Œçš„å•å…ƒæ ¼çš„indexPath</span></div><div class="line">        <span class="built_in">NSArray</span> *temp = [<span class="keyword">self</span> indexPathsForRowsInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, targetContentOffset-&gt;y, <span class="keyword">self</span>.width, <span class="keyword">self</span>.height)];</div><div class="line">        <span class="built_in">NSMutableArray</span> *arr = [<span class="built_in">NSMutableArray</span> arrayWithArray:temp];</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (velocity.y&lt;<span class="number">0</span>) &#123;</div><div class="line">            </div><div class="line">            <span class="comment">//å‘ä¸Šæ»šåŠ¨</span></div><div class="line">            <span class="built_in">NSIndexPath</span> *indexPath = [temp lastObject];</div><div class="line">            </div><div class="line">            <span class="comment">//è¶…è¿‡å€’æ•°ç¬¬3ä¸ª</span></div><div class="line">            <span class="keyword">if</span> (indexPath.row+<span class="number">3</span>&lt;datas.count) &#123;</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">1</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">2</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row+<span class="number">3</span> inSection:<span class="number">0</span>]];</div><div class="line">            &#125;</div><div class="line">        </div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            </div><div class="line">            <span class="comment">//å‘ä¸‹æ»šåŠ¨</span></div><div class="line">            <span class="built_in">NSIndexPath</span> *indexPath = [temp firstObject];</div><div class="line">            <span class="comment">//è¶…è¿‡æ­£æ•°ç¬¬3ä¸ª</span></div><div class="line">            <span class="keyword">if</span> (indexPath.row&gt;<span class="number">3</span>) &#123;</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-3</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-2</span> inSection:<span class="number">0</span>]];</div><div class="line">                [arr addObject:[<span class="built_in">NSIndexPath</span> indexPathForRow:indexPath.row<span class="number">-1</span> inSection:<span class="number">0</span>]];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//æ·»åŠ arré‡Œçš„å†…å®¹åˆ°needLoadArrçš„æœ«å°¾</span></div><div class="line">        [needLoadArr addObjectsFromArray:arr];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çŸ¥é“äº†å¦‚ä½•å‘<code>needLoadArr</code>é‡Œæ·»åŠ å…ƒç´ ï¼Œç°åœ¨çœ‹ä¸€ä¸‹ä½•æ—¶ï¼ˆé‡ç½®ï¼‰æ¸…ç†è¿™ä¸ªarrayï¼š</p>
<h4 id="ç§»é™¤å…ƒç´ NSIndexPath"><a href="#ç§»é™¤å…ƒç´ NSIndexPath" class="headerlink" title="ç§»é™¤å…ƒç´ NSIndexPath"></a>ç§»é™¤å…ƒç´ NSIndexPath</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ç”¨æˆ·è§¦æ‘¸æ—¶ç¬¬ä¸€æ—¶é—´åŠ è½½å†…å®¹</span></div><div class="line">- (<span class="built_in">UIView</span> *)hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (!scrollToToping) &#123;</div><div class="line">        [needLoadArr removeAllObjects];</div><div class="line">        [<span class="keyword">self</span> loadContent];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> hitTest:point withEvent:event];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView&#123;</div><div class="line">    [needLoadArr removeAllObjects];</div><div class="line">&#125;</div><div class="line"><span class="comment">//å°†è¦æ»šåŠ¨åˆ°é¡¶éƒ¨</span></div><div class="line">- (<span class="built_in">BOOL</span>)scrollViewShouldScrollToTop:(<span class="built_in">UIScrollView</span> *)scrollView&#123;</div><div class="line">    scrollToToping = <span class="literal">YES</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//åœæ­¢æ»šåŠ¨</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewDidEndScrollingAnimation:(<span class="built_in">UIScrollView</span> *)scrollView&#123;</div><div class="line">    scrollToToping = <span class="literal">NO</span>;</div><div class="line">    [<span class="keyword">self</span> loadContent];</div><div class="line">&#125;</div><div class="line"><span class="comment">//æ»šåŠ¨åˆ°äº†é¡¶éƒ¨</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewDidScrollToTop:(<span class="built_in">UIScrollView</span> *)scrollView&#123;</div><div class="line">    scrollToToping = <span class="literal">NO</span>;</div><div class="line">    [<span class="keyword">self</span> loadContent];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“æ‰‹æŒ‡è§¦ç¢°åˆ°tableviewæ—¶ å’Œ å¼€å§‹æ‹–åŠ¨tableviewçš„æ—¶å€™å°±è¦æ¸…ç†è¿™ä¸ªæ•°ç»„ã€‚</p>
<p>è€Œä¸”åœ¨æ‰‹æŒ‡è§¦ç¢°åˆ°tableviewæ—¶å’Œ tableviewåœæ­¢æ»šåŠ¨åå°±ä¼šæ‰§è¡Œ<code>loadContent</code>æ–¹æ³•ï¼Œç”¨æ¥åŠ è½½å¯è§åŒºåŸŸçš„cellã€‚</p>
<p><code>loadContent</code>æ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)loadContent&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//æ­£åœ¨æ»šåŠ¨åˆ°é¡¶éƒ¨</span></div><div class="line">    <span class="keyword">if</span> (scrollToToping) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//å¯è§cellæ•°</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.indexPathsForVisibleRows.count&lt;=<span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//è§¦æ‘¸çš„æ—¶å€™åˆ·æ–°å¯è§cell</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.visibleCells&amp;&amp;<span class="keyword">self</span>.visibleCells.count&gt;<span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">id</span> temp <span class="keyword">in</span> [<span class="keyword">self</span>.visibleCells <span class="keyword">copy</span>]) &#123;</div><div class="line">            VVeboTableViewCell *cell = (VVeboTableViewCell *)temp;</div><div class="line">            [cell draw];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œtableviewçš„<code>visibleCells</code>å±æ€§æ˜¯å¯è§çš„cellçš„æ•°ç»„ã€‚</p>
<h2 id="3-å¼‚æ­¥å¤„ç†cell"><a href="#3-å¼‚æ­¥å¤„ç†cell" class="headerlink" title="3. å¼‚æ­¥å¤„ç†cell"></a>3. å¼‚æ­¥å¤„ç†cell</h2><p>åœ¨è®²è§£cellæ˜¯å¦‚ä½•æ˜¾ç¤ºå‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬å¤§è‡´çœ‹ä¸€ä¸‹è¿™ä¸ªcelléƒ½æœ‰å“ªäº›æ§ä»¶ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/VVeboTableView_4.png" alt="æ§ä»¶åç§°"></p>
<p>äº†è§£åˆ°æ§ä»¶çš„åç§°ï¼Œä½ç½®ä¹‹åï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä½œè€…æ˜¯å¦‚ä½•å¸ƒå±€è¿™äº›æ§ä»¶çš„ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/VVeboTableView_2.png" alt="æ§ä»¶å¸ƒå±€"><br>åœ¨ä¸Šé¢å¯ä»¥å¤§è‡´çœ‹å‡ºæ¥ï¼Œé™¤äº†éœ€è¦å¼‚æ­¥ç½‘ç»œåŠ è½½çš„å¤´åƒ(avatarView)å’Œå¸–å­å›¾ç‰‡(multiPhotoScrollView)ï¼Œä½œè€…éƒ½å°†è¿™äº›æ§ä»¶ç”»åœ¨äº†ä¸€å¼ å›¾ä¸Šé¢ï¼ˆpostBgViewï¼‰ã€‚</p>
<p>è€Œä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨postBgViewä¸Šé¢éœ€è¦å¼‚æ­¥æ˜¾ç¤ºçš„å†…å®¹åˆ†ä¸ºå››ç§ï¼š</p>
<ol>
<li>UIImageViewï¼šæœ¬åœ°å›¾ç‰‡ï¼ˆcomments, more,repostsï¼‰ã€‚</li>
<li>UIViewï¼šèƒŒæ™¯ï¼Œåˆ†å‰²çº¿(topLine)ã€‚</li>
<li>NSStringï¼šnameï¼Œfromå­—ç¬¦ä¸²ã€‚</li>
<li>Labelï¼šåŸè´´çš„detailLabel å’Œ å½“å‰è´´çš„ labelã€‚</li>
</ol>
<p>ä¸‹é¢ç»“åˆä»£ç æ¥è®²è§£è¿™å››ç§ç»˜åˆ¶ï¼š</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹cellå†…éƒ¨çš„æ ¸å¿ƒç»˜åˆ¶æ–¹æ³•ï¼š</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹cellç»˜åˆ¶çš„æ ¸å¿ƒæ–¹æ³•,drawæ–¹æ³•:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å°†cellçš„ä¸»è¦å†…å®¹ç»˜åˆ¶åˆ°å›¾ç‰‡ä¸Š</span></div><div class="line">- (<span class="keyword">void</span>)draw&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//drawed = YESè¯´æ˜æ­£åœ¨ç»˜åˆ¶ï¼Œåˆ™ç«‹å³è¿”å›ã€‚å› ä¸ºç»˜åˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥åœ¨å¼€å§‹ç»˜åˆ¶ä¹‹åéœ€è¦ç«‹å³è®¾ä¸ºyesï¼Œé˜²æ­¢é‡å¤ç»˜åˆ¶</span></div><div class="line">    <span class="keyword">if</span> (drawed) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//æ ‡è®°å½“å‰çš„ç»˜åˆ¶</span></div><div class="line">    <span class="built_in">NSInteger</span> flag = drawColorFlag;</div><div class="line">    </div><div class="line">    drawed = <span class="literal">YES</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        </div><div class="line">        <span class="comment">//è·å–æ•´ä¸ªcellçš„frameï¼Œå·²ç»æ¢å­˜åœ¨æ¨¡å‹é‡Œäº†</span></div><div class="line">        <span class="built_in">CGRect</span> rect = [_data[<span class="string">@"frame"</span>] <span class="built_in">CGRectValue</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//å¼€å¯å›¾å½¢ä¸Šä¸‹æ–‡</span></div><div class="line">        <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(rect.size, <span class="literal">YES</span>, <span class="number">0</span>);</div><div class="line">        </div><div class="line">        <span class="comment">//è·å–å›¾å½¢ä¸Šä¸‹æ–‡</span></div><div class="line">        <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">        </div><div class="line">        <span class="comment">//èƒŒæ™¯é¢œè‰²</span></div><div class="line">        [[<span class="built_in">UIColor</span> colorWithRed:<span class="number">250</span>/<span class="number">255.0</span> green:<span class="number">250</span>/<span class="number">255.0</span> blue:<span class="number">250</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>] set];</div><div class="line">        </div><div class="line">        <span class="comment">//é€šè¿‡rectå¡«å……èƒŒæ™¯é¢œè‰²</span></div><div class="line">        <span class="built_in">CGContextFillRect</span>(context, rect);</div><div class="line">        </div><div class="line">        <span class="comment">//å¦‚æœæœ‰åŸå¸–ï¼ˆè¯´æ˜å½“å‰è´´æ˜¯è½¬å‘è´´ï¼‰</span></div><div class="line">        <span class="keyword">if</span> ([_data valueForKey:<span class="string">@"subData"</span>]) &#123;</div><div class="line">            </div><div class="line">            [[<span class="built_in">UIColor</span> colorWithRed:<span class="number">243</span>/<span class="number">255.0</span> green:<span class="number">243</span>/<span class="number">255.0</span> blue:<span class="number">243</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>] set];</div><div class="line">            <span class="built_in">CGRect</span> subFrame = [_data[<span class="string">@"subData"</span>][<span class="string">@"frame"</span>] <span class="built_in">CGRectValue</span>];</div><div class="line">            <span class="built_in">CGContextFillRect</span>(context, subFrame);</div><div class="line">            </div><div class="line">            <span class="comment">//åŸå¸–ä¸Šé¢çš„åˆ†å‰²çº¿</span></div><div class="line">            [[<span class="built_in">UIColor</span> colorWithRed:<span class="number">200</span>/<span class="number">255.0</span> green:<span class="number">200</span>/<span class="number">255.0</span> blue:<span class="number">200</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>] set];</div><div class="line">            <span class="built_in">CGContextFillRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, subFrame.origin.y, rect.size.width, <span class="number">.5</span>));</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        &#123;</div><div class="line">            <span class="keyword">float</span> leftX = SIZE_GAP_LEFT+SIZE_AVATAR+SIZE_GAP_BIG;</div><div class="line">            <span class="keyword">float</span> x = leftX;</div><div class="line">            <span class="keyword">float</span> y = (SIZE_AVATAR-(SIZE_FONT_NAME+SIZE_FONT_SUBTITLE+<span class="number">6</span>))/<span class="number">2</span><span class="number">-2</span>+SIZE_GAP_TOP+SIZE_GAP_SMALL<span class="number">-5</span>;</div><div class="line">            </div><div class="line">            <span class="comment">//ç»˜åˆ¶åå­—</span></div><div class="line">            [_data[<span class="string">@"name"</span>] drawInContext:context withPosition:<span class="built_in">CGPointMake</span>(x, y) andFont:FontWithSize(SIZE_FONT_NAME)</div><div class="line">                             andTextColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">106</span>/<span class="number">255.0</span> green:<span class="number">140</span>/<span class="number">255.0</span> blue:<span class="number">181</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>]</div><div class="line">                                andHeight:rect.size.height];</div><div class="line">            </div><div class="line">            <span class="comment">//ç»˜åˆ¶åå­—ä¸‹é¢çš„info</span></div><div class="line">            y += SIZE_FONT_NAME+<span class="number">5</span>;</div><div class="line">            <span class="keyword">float</span> fromX = leftX;</div><div class="line">            <span class="keyword">float</span> size = [<span class="built_in">UIScreen</span> screenWidth]-leftX;</div><div class="line">            <span class="built_in">NSString</span> *from = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@  %@"</span>, _data[<span class="string">@"time"</span>], _data[<span class="string">@"from"</span>]];</div><div class="line">            </div><div class="line">            [from drawInContext:context withPosition:<span class="built_in">CGPointMake</span>(fromX, y) andFont:FontWithSize(SIZE_FONT_SUBTITLE)</div><div class="line">                   andTextColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">178</span>/<span class="number">255.0</span> green:<span class="number">178</span>/<span class="number">255.0</span> blue:<span class="number">178</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>]</div><div class="line">                      andHeight:rect.size.height andWidth:size];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        &#123;</div><div class="line">            </div><div class="line">            <span class="comment">//è¯„è®ºè§’</span></div><div class="line">            <span class="built_in">CGRect</span> countRect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, rect.size.height<span class="number">-30</span>, [<span class="built_in">UIScreen</span> screenWidth], <span class="number">30</span>);</div><div class="line">            [[<span class="built_in">UIColor</span> colorWithRed:<span class="number">250</span>/<span class="number">255.0</span> green:<span class="number">250</span>/<span class="number">255.0</span> blue:<span class="number">250</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>] set];</div><div class="line">            <span class="built_in">CGContextFillRect</span>(context, countRect);</div><div class="line">            <span class="keyword">float</span> alpha = <span class="number">1</span>;</div><div class="line">            </div><div class="line">            <span class="keyword">float</span> x = [<span class="built_in">UIScreen</span> screenWidth]-SIZE_GAP_LEFT<span class="number">-10</span>;</div><div class="line">            <span class="built_in">NSString</span> *comments = _data[<span class="string">@"comments"</span>];</div><div class="line">            <span class="keyword">if</span> (comments) &#123;</div><div class="line">                <span class="built_in">CGSize</span> size = [comments sizeWithConstrainedToSize:<span class="built_in">CGSizeMake</span>(<span class="built_in">CGFLOAT_MAX</span>, <span class="built_in">CGFLOAT_MAX</span>) fromFont:FontWithSize(SIZE_FONT_SUBTITLE) lineSpace:<span class="number">5</span>];</div><div class="line">                </div><div class="line">                x -= size.width;</div><div class="line">                </div><div class="line">                <span class="comment">//å›¾ç‰‡æ–‡å­—</span></div><div class="line">                [comments drawInContext:context withPosition:<span class="built_in">CGPointMake</span>(x, <span class="number">8</span>+countRect.origin.y)</div><div class="line">                                andFont:FontWithSize(<span class="number">12</span>)</div><div class="line">                           andTextColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">178</span>/<span class="number">255.0</span> green:<span class="number">178</span>/<span class="number">255.0</span> blue:<span class="number">178</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>]</div><div class="line">                              andHeight:rect.size.height];</div><div class="line">                </div><div class="line">                <span class="comment">//è¯„è®ºå›¾ç‰‡ï¼ˆbundleé‡Œçš„å›¾ç‰‡ï¼‰</span></div><div class="line">                [[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"t_comments.png"</span>] drawInRect:<span class="built_in">CGRectMake</span>(x<span class="number">-5</span>, <span class="number">10.5</span>+countRect.origin.y, <span class="number">10</span>, <span class="number">9</span>) blendMode:kCGBlendModeNormal alpha:alpha];</div><div class="line">                </div><div class="line">                commentsRect = <span class="built_in">CGRectMake</span>(x<span class="number">-5</span>, <span class="keyword">self</span>.height<span class="number">-50</span>, [<span class="built_in">UIScreen</span> screenWidth]-x+<span class="number">5</span>, <span class="number">50</span>);</div><div class="line">                x -= <span class="number">20</span>;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="comment">//è½¬å‘è§’</span></div><div class="line">            <span class="built_in">NSString</span> *reposts = _data[<span class="string">@"reposts"</span>];</div><div class="line">            <span class="keyword">if</span> (reposts) &#123;</div><div class="line">                <span class="built_in">CGSize</span> size = [reposts sizeWithConstrainedToSize:<span class="built_in">CGSizeMake</span>(<span class="built_in">CGFLOAT_MAX</span>, <span class="built_in">CGFLOAT_MAX</span>) fromFont:FontWithSize(SIZE_FONT_SUBTITLE) lineSpace:<span class="number">5</span>];</div><div class="line">                </div><div class="line">                x -= MAX(size.width, <span class="number">5</span>)+SIZE_GAP_BIG;</div><div class="line">                </div><div class="line">                <span class="comment">//è½¬å‘æ–‡å­—</span></div><div class="line">                [reposts drawInContext:context withPosition:<span class="built_in">CGPointMake</span>(x, <span class="number">8</span>+countRect.origin.y)</div><div class="line">                                andFont:FontWithSize(<span class="number">12</span>)</div><div class="line">                           andTextColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">178</span>/<span class="number">255.0</span> green:<span class="number">178</span>/<span class="number">255.0</span> blue:<span class="number">178</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>]</div><div class="line">                 </div><div class="line">                             andHeight:rect.size.height];</div><div class="line">               </div><div class="line">                <span class="comment">//è½¬å‘å›¾ç‰‡ï¼ˆbundleé‡Œçš„å›¾ç‰‡ï¼‰</span></div><div class="line">                [[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"t_repost.png"</span>] drawInRect:<span class="built_in">CGRectMake</span>(x<span class="number">-5</span>, <span class="number">11</span>+countRect.origin.y, <span class="number">10</span>, <span class="number">9</span>) blendMode:kCGBlendModeNormal alpha:alpha];</div><div class="line">                repostsRect = <span class="built_in">CGRectMake</span>(x<span class="number">-5</span>, <span class="keyword">self</span>.height<span class="number">-50</span>, commentsRect.origin.x-x, <span class="number">50</span>);</div><div class="line">                x -= <span class="number">20</span>;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="comment">//æ›´å¤šè§’</span></div><div class="line">            [<span class="string">@"â€¢â€¢â€¢"</span> drawInContext:context</div><div class="line">                     withPosition:<span class="built_in">CGPointMake</span>(SIZE_GAP_LEFT, <span class="number">8</span>+countRect.origin.y)</div><div class="line">                          andFont:FontWithSize(<span class="number">11</span>)</div><div class="line">                     andTextColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">178</span>/<span class="number">255.0</span> green:<span class="number">178</span>/<span class="number">255.0</span> blue:<span class="number">178</span>/<span class="number">255.0</span> alpha:<span class="number">.5</span>]</div><div class="line">                        andHeight:rect.size.height];</div><div class="line">            </div><div class="line">            <span class="comment">//ç»˜åˆ¶åŸå¸–åº•éƒ¨çš„åˆ†å‰²çº¿</span></div><div class="line">            <span class="keyword">if</span> ([_data valueForKey:<span class="string">@"subData"</span>]) &#123;</div><div class="line">                [[<span class="built_in">UIColor</span> colorWithRed:<span class="number">200</span>/<span class="number">255.0</span> green:<span class="number">200</span>/<span class="number">255.0</span> blue:<span class="number">200</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>] set];</div><div class="line">                <span class="built_in">CGContextFillRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, rect.size.height<span class="number">-30.5</span>, rect.size.width, <span class="number">.5</span>));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//å°†æ•´ä¸ªcontexè½¬åŒ–ä¸ºå›¾ç‰‡ï¼Œèµ‹ç»™èƒŒæ™¯imageview</span></div><div class="line">        <span class="built_in">UIImage</span> *temp = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</div><div class="line">        <span class="built_in">UIGraphicsEndImageContext</span>();</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            <span class="keyword">if</span> (flag==drawColorFlag) &#123;</div><div class="line">                postBGView.frame = rect;</div><div class="line">                postBGView.image = <span class="literal">nil</span>;</div><div class="line">                postBGView.image = temp;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    <span class="comment">//ç»˜åˆ¶ä¸¤ä¸ªlabelçš„text</span></div><div class="line">    [<span class="keyword">self</span> drawText];</div><div class="line">    </div><div class="line">    <span class="comment">//åŠ è½½å¸–å­é‡Œçš„ç½‘è·¯å›¾ç‰‡ï¼Œä½¿ç”¨SDWebImage</span></div><div class="line">    [<span class="keyword">self</span> loadThumb];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸‹é¢æŠ½å‡ºæ¯ä¸€ç§ç»˜åˆ¶å†…å®¹çš„ä»£ç ï¼Œåˆ†åˆ«è®²è§£ï¼š</p>
<h3 id="3-1-å¼‚æ­¥åŠ è½½ç½‘ç»œå›¾ç‰‡"><a href="#3-1-å¼‚æ­¥åŠ è½½ç½‘ç»œå›¾ç‰‡" class="headerlink" title="3.1 å¼‚æ­¥åŠ è½½ç½‘ç»œå›¾ç‰‡"></a>3.1 å¼‚æ­¥åŠ è½½ç½‘ç»œå›¾ç‰‡</h3><p>å…³äºç½‘ç»œå›¾ç‰‡çš„å¼‚æ­¥åŠ è½½å’Œç¼“å­˜ï¼Œä½œè€…ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼š<code>SDWebImage</code>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setData:(<span class="built_in">NSDictionary</span> *)data&#123;</div><div class="line">    _data = data;</div><div class="line">    [avatarView setBackgroundImage:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</div><div class="line">    <span class="keyword">if</span> ([data valueForKey:<span class="string">@"avatarUrl"</span>]) &#123;</div><div class="line">        <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:[data valueForKey:<span class="string">@"avatarUrl"</span>]];</div><div class="line">        [avatarView sd_setBackgroundImageWithURL:url forState:<span class="built_in">UIControlStateNormal</span> placeholderImage:<span class="literal">nil</span> options:SDWebImageLowPriority];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹äº<code>SDWebImage</code>ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶éƒ½ä¸ä¼šé™Œç”Ÿï¼Œæˆ‘å‰ä¸€é˜µå†™äº†ä¸€ç¯‡æºç è§£æï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥çœ‹ä¸€ä¸‹ï¼š<a href="http://www.jianshu.com/p/93696717b4a3" target="_blank" rel="external">SDWebImageæºç è§£æ</a>ã€‚</p>
<h3 id="3-2-å¼‚æ­¥ç»˜åˆ¶æœ¬åœ°å›¾ç‰‡"><a href="#3-2-å¼‚æ­¥ç»˜åˆ¶æœ¬åœ°å›¾ç‰‡" class="headerlink" title="3.2 å¼‚æ­¥ç»˜åˆ¶æœ¬åœ°å›¾ç‰‡"></a>3.2 å¼‚æ­¥ç»˜åˆ¶æœ¬åœ°å›¾ç‰‡</h3><p>æœ¬åœ°å›¾ç‰‡çš„ç»˜åˆ¶ï¼Œåªéœ€è¦æä¾›å›¾ç‰‡åœ¨bundleå†…éƒ¨çš„åå­—å’Œframeå°±å¯ä»¥ç»˜åˆ¶ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"t_comments.png"</span>] drawInRect:<span class="built_in">CGRectMake</span>(x<span class="number">-5</span>, <span class="number">10.5</span>+countRect.origin.y, <span class="number">10</span>, <span class="number">9</span>) blendMode:kCGBlendModeNormal alpha:alpha];</div></pre></td></tr></table></figure>
<p>###3.3  å¼‚æ­¥ç»˜åˆ¶UIView</p>
<p>å¯¹äº<code>UIView</code>çš„ç»˜åˆ¶ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“è¦ç»˜åˆ¶çš„<code>UIView</code>çš„frameå’Œé¢œè‰²å³å¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//èƒŒæ™¯é¢œè‰²</span></div><div class="line">[[<span class="built_in">UIColor</span> colorWithRed:<span class="number">250</span>/<span class="number">255.0</span> green:<span class="number">250</span>/<span class="number">255.0</span> blue:<span class="number">250</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>] set];</div><div class="line">        </div><div class="line"><span class="comment">//é€šè¿‡rectå¡«å……èƒŒæ™¯é¢œè‰²</span></div><div class="line"><span class="built_in">CGContextFillRect</span>(context, rect);</div></pre></td></tr></table></figure>
<p>è®²åˆ°ç°åœ¨ï¼Œå°±å‰©ä¸‹äº†å…³äºæ–‡å­—çš„ç»˜åˆ¶ï¼ŒåŒ…æ‹¬è„±ç¦»äº†UILabelçš„çº¯æ–‡æœ¬çš„ç»˜åˆ¶å’ŒUILabelé‡Œæ–‡æœ¬çš„ç»˜åˆ¶ï¼Œæˆ‘ä»¬å…ˆè¯´ä¸€ä¸‹å…³äºç®€å•çš„çº¯NSStringçš„ç»˜åˆ¶ï¼š</p>
<h3 id="3-4-å¼‚æ­¥ç»˜åˆ¶NSString"><a href="#3-4-å¼‚æ­¥ç»˜åˆ¶NSString" class="headerlink" title="3.4  å¼‚æ­¥ç»˜åˆ¶NSString"></a>3.4  å¼‚æ­¥ç»˜åˆ¶NSString</h3><p>ä½œè€…é€šè¿‡ä¼ å…¥å­—ç¬¦ä¸²çš„å­—ä½“ï¼Œé¢œè‰²å’Œè¡Œé«˜ï¼Œä»¥åŠä½ç½®å°±å®ç°äº†çº¯æ–‡æœ¬çš„ç»˜åˆ¶ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ç»˜åˆ¶åå­—</span></div><div class="line">[_data[<span class="string">@"name"</span>] drawInContext:context withPosition:<span class="built_in">CGPointMake</span>(x, y) andFont:FontWithSize(SIZE_FONT_NAME)</div><div class="line">                 andTextColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">106</span>/<span class="number">255.0</span> green:<span class="number">140</span>/<span class="number">255.0</span> blue:<span class="number">181</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>]</div><div class="line">             andHeight:rect.size.height];</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•æ˜¯ä½œè€…åœ¨<code>NSString</code>çš„ä¸€ä¸ªåˆ†ç±»é‡Œè‡ªå®šä¹‰çš„ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawInContext:(<span class="built_in">CGContextRef</span>)context withPosition:(<span class="built_in">CGPoint</span>)p andFont:(<span class="built_in">UIFont</span> *)font andTextColor:(<span class="built_in">UIColor</span> *)color andHeight:(<span class="keyword">float</span>)height andWidth:(<span class="keyword">float</span>)width&#123;    </div><div class="line">    <span class="built_in">CGSize</span> size = <span class="built_in">CGSizeMake</span>(width, font.pointSize+<span class="number">10</span>);    </div><div class="line">    <span class="built_in">CGContextSetTextMatrix</span>(context,<span class="built_in">CGAffineTransformIdentity</span>);    </div><div class="line">    <span class="comment">//ç§»åŠ¨åæ ‡ç³»ç»Ÿï¼Œæ‰€æœ‰ç‚¹çš„yå¢åŠ äº†height</span></div><div class="line">    <span class="built_in">CGContextTranslateCTM</span>(context,<span class="number">0</span>,height);</div><div class="line">    </div><div class="line">    <span class="comment">//ç¼©æ”¾åæ ‡ç³»ç»Ÿï¼Œæ‰€æœ‰ç‚¹çš„xä¹˜ä»¥1.0ï¼Œæ‰€æœ‰çš„ç‚¹çš„yä¹˜ä»¥-1.0</span></div><div class="line">    <span class="built_in">CGContextScaleCTM</span>(context,<span class="number">1.0</span>,<span class="number">-1.0</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//æ–‡å­—é¢œè‰²</span></div><div class="line">    <span class="built_in">UIColor</span>* textColor = color;</div><div class="line">    </div><div class="line">    <span class="comment">//ç”ŸæˆCTFont</span></div><div class="line">    <span class="built_in">CTFontRef</span> font1 = <span class="built_in">CTFontCreateWithName</span>((__bridge <span class="built_in">CFStringRef</span>)font.fontName, font.pointSize,<span class="literal">NULL</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//ç”¨äºåˆ›å»ºCTParagraphStyleRefçš„ä¸€äº›åŸºæœ¬æ•°æ®</span></div><div class="line">    <span class="built_in">CGFloat</span> minimumLineHeight = font.pointSize,maximumLineHeight = minimumLineHeight+<span class="number">10</span>, linespace = <span class="number">5</span>;</div><div class="line">    <span class="built_in">CTLineBreakMode</span> lineBreakMode = kCTLineBreakByTruncatingTail;</div><div class="line">    </div><div class="line">    <span class="comment">//å·¦å¯¹é½</span></div><div class="line">    <span class="built_in">CTTextAlignment</span> alignment = kCTLeftTextAlignment;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ›å»ºCTParagraphStyleRef</span></div><div class="line">    <span class="built_in">CTParagraphStyleRef</span> style = <span class="built_in">CTParagraphStyleCreate</span>((<span class="built_in">CTParagraphStyleSetting</span>[<span class="number">6</span>])&#123;</div><div class="line">        &#123;kCTParagraphStyleSpecifierAlignment, <span class="keyword">sizeof</span>(alignment), &amp;alignment&#125;,</div><div class="line">        &#123;kCTParagraphStyleSpecifierMinimumLineHeight,<span class="keyword">sizeof</span>(minimumLineHeight),&amp;minimumLineHeight&#125;,</div><div class="line">        &#123;kCTParagraphStyleSpecifierMaximumLineHeight,<span class="keyword">sizeof</span>(maximumLineHeight),&amp;maximumLineHeight&#125;,</div><div class="line">        &#123;kCTParagraphStyleSpecifierMaximumLineSpacing, <span class="keyword">sizeof</span>(linespace), &amp;linespace&#125;,</div><div class="line">        &#123;kCTParagraphStyleSpecifierMinimumLineSpacing, <span class="keyword">sizeof</span>(linespace), &amp;linespace&#125;,</div><div class="line">        &#123;kCTParagraphStyleSpecifierLineBreakMode,<span class="keyword">sizeof</span>(<span class="built_in">CTLineBreakMode</span>),&amp;lineBreakMode&#125;</div><div class="line">    &#125;,<span class="number">6</span>);</div><div class="line">    <span class="comment">//è®¾ç½®å±æ€§å­—å…¸ï¼›å¯¹è±¡ï¼Œkey</span></div><div class="line">    <span class="built_in">NSDictionary</span>* attributes = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:</div><div class="line">                                (__bridge <span class="keyword">id</span>)font1,(<span class="built_in">NSString</span>*)kCTFontAttributeName,</div><div class="line">                                textColor.CGColor,kCTForegroundColorAttributeName,</div><div class="line">                                style,kCTParagraphStyleAttributeName,</div><div class="line">                                <span class="literal">nil</span>];</div><div class="line"></div><div class="line">    <span class="comment">//ç”Ÿæˆpathï¼Œæ·»åŠ åˆ°cgcontexä¸Š</span></div><div class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</div><div class="line">    <span class="built_in">CGPathAddRect</span>(path,<span class="literal">NULL</span>,<span class="built_in">CGRectMake</span>(p.x, height-p.y-size.height,(size.width),(size.height)));</div><div class="line">    </div><div class="line">    <span class="comment">//ç”ŸæˆCFå±æ€§å­—ç¬¦ä¸²</span></div><div class="line">    <span class="built_in">NSMutableAttributedString</span> *attributedStr = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="keyword">self</span> attributes:attributes];</div><div class="line">    <span class="built_in">CFAttributedStringRef</span> attributedString = (__bridge <span class="built_in">CFAttributedStringRef</span>)attributedStr;</div><div class="line">    </div><div class="line">    <span class="comment">//ä»attributedStringæ‹¿åˆ°ctframesetter</span></div><div class="line">    <span class="built_in">CTFramesetterRef</span> framesetter = <span class="built_in">CTFramesetterCreateWithAttributedString</span>((<span class="built_in">CFAttributedStringRef</span>)attributedString);</div><div class="line">    </div><div class="line">    <span class="comment">//ä»framesetteræ‹¿åˆ° core text çš„ ctframe</span></div><div class="line">    <span class="built_in">CTFrameRef</span> ctframe = <span class="built_in">CTFramesetterCreateFrame</span>(framesetter, <span class="built_in">CFRangeMake</span>(<span class="number">0</span>,<span class="built_in">CFAttributedStringGetLength</span>(attributedString)),path,<span class="literal">NULL</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//å°†ctframeç»˜åˆ¶åˆ°contexté‡Œé¢</span></div><div class="line">    <span class="built_in">CTFrameDraw</span>(ctframe,context);</div><div class="line">    </div><div class="line">    <span class="comment">//å› ä¸ºä¸æ˜¯å¯¹è±¡ç±»å‹ï¼Œéœ€è¦é‡Šæ”¾</span></div><div class="line">    <span class="built_in">CGPathRelease</span>(path);</div><div class="line">    <span class="built_in">CFRelease</span>(font1);</div><div class="line">    <span class="built_in">CFRelease</span>(framesetter);</div><div class="line">    <span class="built_in">CFRelease</span>(ctframe);</div><div class="line">    [[attributedStr mutableString] setString:<span class="string">@""</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//æ¢å¤contextåæ ‡ç³»ç»Ÿ</span></div><div class="line">    <span class="built_in">CGContextSetTextMatrix</span>(context,<span class="built_in">CGAffineTransformIdentity</span>);</div><div class="line">    <span class="built_in">CGContextTranslateCTM</span>(context,<span class="number">0</span>, height);</div><div class="line">    <span class="built_in">CGContextScaleCTM</span>(context,<span class="number">1.0</span>,<span class="number">-1.0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œä½œè€…æ ¹æ®æ–‡å­—çš„èµ·ç‚¹ï¼Œé¢œè‰²ï¼Œå­—ä½“å¤§å°å’Œè¡Œé«˜ï¼Œä½¿ç”¨Core Textï¼Œå°†æ–‡å­—ç»˜åˆ¶åœ¨äº†ä¼ å…¥çš„contextä¸Šé¢ã€‚</p>
<h3 id="3-5-å¼‚æ­¥ç»˜åˆ¶UILabel"><a href="#3-5-å¼‚æ­¥ç»˜åˆ¶UILabel" class="headerlink" title="3.5 å¼‚æ­¥ç»˜åˆ¶UILabel"></a>3.5 å¼‚æ­¥ç»˜åˆ¶UILabel</h3><p>è€Œå¯¹äº<code>UILabel</code>é‡Œé¢çš„ç»˜åˆ¶ï¼Œä½œè€…ä¹Ÿé‡‡å–äº†ç±»ä¼¼çš„æ–¹æ³•ï¼š</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹åœ¨cellå®ç°æ–‡ä»¶é‡Œï¼Œå…³äºç»˜åˆ¶labelæ–‡å­—æ–¹æ³•çš„è°ƒç”¨ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å°†æ–‡æœ¬å†…å®¹ç»˜åˆ¶åˆ°å›¾ç‰‡ä¸Šï¼Œä¹Ÿæ˜¯å¼‚æ­¥ç»˜åˆ¶</span></div><div class="line">- (<span class="keyword">void</span>)drawText&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//å¦‚æœå‘ç°labelæˆ–detailLabelä¸å­˜åœ¨ï¼Œåˆ™é‡æ–°addä¸€æ¬¡</span></div><div class="line">    <span class="keyword">if</span> (label==<span class="literal">nil</span>||detailLabel==<span class="literal">nil</span>) &#123;</div><div class="line">        [<span class="keyword">self</span> addLabel];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//ä¼ å…¥frame</span></div><div class="line">    label.frame = [_data[<span class="string">@"textRect"</span>] <span class="built_in">CGRectValue</span>];</div><div class="line">    <span class="comment">//å¼‚æ­¥ç»˜åˆ¶text</span></div><div class="line">    [label setText:_data[<span class="string">@"text"</span>]];</div><div class="line">    </div><div class="line">    <span class="comment">//å¦‚æœå­˜åœ¨åŸå¸–</span></div><div class="line">    <span class="keyword">if</span> ([_data valueForKey:<span class="string">@"subData"</span>]) &#123;</div><div class="line">        </div><div class="line">        detailLabel.frame = [[_data valueForKey:<span class="string">@"subData"</span>][<span class="string">@"textRect"</span>] <span class="built_in">CGRectValue</span>];</div><div class="line">        <span class="comment">//å¼‚æ­¥ç»˜åˆ¶text</span></div><div class="line">        [detailLabel setText:[_data valueForKey:<span class="string">@"subData"</span>][<span class="string">@"text"</span>]];</div><div class="line">        detailLabel.hidden = <span class="literal">NO</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå¸–å­è€Œè¨€ï¼Œæ˜¯å¦å­˜åœ¨åŸè´´ï¼ˆå½“å‰è´´æ˜¯å¦æ˜¯è½¬å‘è´´ï¼‰æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨åˆ¤æ–­ä¹‹åï¼Œç”¨<code>hidden</code>å±æ€§æ¥æ§åˆ¶ç›¸åº”æ§ä»¶çš„éšè—å’Œæ˜¾ç¤ºï¼Œè€Œä¸æ˜¯ç”¨<code>addSubView</code>çš„æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œçš„labelæ˜¯ä½œè€…è‡ªå·±å°è£…çš„<code>VVeboLabel</code>ã€‚å®ƒå…·æœ‰é«˜äº®æ˜¾ç¤ºç‚¹å‡»ï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒºåˆ†ä¸åŒç±»å‹çš„ç‰¹æ®Šæ–‡å­—ï¼ˆè¯é¢˜åï¼Œç”¨æˆ·åï¼Œç½‘å€ï¼Œemojiï¼‰çš„åŠŸèƒ½ã€‚</p>
<p>ç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªå°è£…å¥½çš„labelï¼š</p>
<ul>
<li>ç»§æ‰¿äº<code>UIView</code>,å¯ä»¥å“åº”ç”¨æˆ·ç‚¹å‡»ï¼Œåœ¨åˆå§‹åŒ–ä¹‹åï¼Œ<code>_textAlignment</code>,<code>_textColor</code>,<code>_font</code>,<code>_lienSpace</code>å±æ€§éƒ½ä¼šè¢«åˆå§‹åŒ–ã€‚</li>
<li>ä½¿ç”¨Core Textç»˜åˆ¶æ–‡å­—ã€‚</li>
<li>æŒæœ‰ä¸¤ç§UIImageViewï¼Œç”¨æ¥æ˜¾ç¤ºé»˜è®¤çŠ¶æ€å’Œé«˜äº®çŠ¶æ€çš„å›¾ç‰‡ï¼ˆå°†å­—ç¬¦ä¸²ç»˜åˆ¶æˆå›¾ç‰‡ï¼‰ã€‚</li>
<li>ä¿å­˜äº†å››ç§ç‰¹æ®Šæ–‡å­—çš„é¢œè‰²ï¼Œç”¨æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«ä»¥åï¼Œç»™å…¶ç€è‰²ã€‚</li>
</ul>
<p>è¿™é‡Œè®²ä¸€ä¸‹è¿™ä¸ªlabelçš„<code>setText:</code>æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ä½¿ç”¨coretextå°†æ–‡æœ¬ç»˜åˆ¶åˆ°å›¾ç‰‡ã€‚</span></div><div class="line">- (<span class="keyword">void</span>)setText:(<span class="built_in">NSString</span> *)text&#123;</div><div class="line">   </div><div class="line">    <span class="comment">//labelImageView æ™®é€šçŠ¶æ€æ—¶çš„imageview</span></div><div class="line">    <span class="comment">//highlightImageView é«˜äº®çŠ¶æ€æ—¶çš„iamgeview</span></div><div class="line">    </div><div class="line">    ...</div><div class="line">    </div><div class="line">    <span class="comment">//ç»˜åˆ¶æ ‡è®°ï¼Œåˆå§‹åŒ–æ—¶èµ‹ä¸€ä¸ªéšæœºå€¼ï¼›clearä¹‹åæ›´æ–°ä¸€ä¸ªéšæœºå€¼</span></div><div class="line">    <span class="built_in">NSInteger</span> flag = drawFlag;</div><div class="line">    </div><div class="line">    <span class="comment">//æ˜¯å¦æ­£åœ¨é«˜äº®ï¼ˆåœ¨ç‚¹å‡»labelçš„æ—¶å€™è®¾ç½®ä¸ºyesï¼Œæ¾å¼€çš„æ—¶å€™è®¾ç½®ä¸ºNOï¼‰</span></div><div class="line">    <span class="built_in">BOOL</span> isHighlight = highlighting;</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        </div><div class="line">        <span class="built_in">NSString</span> *temp = text;</div><div class="line">        _text = text;</div><div class="line">        <span class="built_in">CGSize</span> size = <span class="keyword">self</span>.frame.size;</div><div class="line">        size.height += <span class="number">10</span>;</div><div class="line">       </div><div class="line">        <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(size, ![<span class="keyword">self</span>.backgroundColor isEqual:[<span class="built_in">UIColor</span> clearColor]], <span class="number">0</span>);</div><div class="line">        <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">        <span class="keyword">if</span> (context==<span class="literal">NULL</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (![<span class="keyword">self</span>.backgroundColor isEqual:[<span class="built_in">UIColor</span> clearColor]]) &#123;</div><div class="line">            [<span class="keyword">self</span>.backgroundColor set];</div><div class="line">            <span class="built_in">CGContextFillRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, size.width, size.height));</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">CGContextSetTextMatrix</span>(context,<span class="built_in">CGAffineTransformIdentity</span>);</div><div class="line">        <span class="built_in">CGContextTranslateCTM</span>(context,<span class="number">0</span>,size.height);</div><div class="line">        <span class="built_in">CGContextScaleCTM</span>(context,<span class="number">1.0</span>,<span class="number">-1.0</span>);</div><div class="line">        </div><div class="line">        <span class="comment">//Determine default text color</span></div><div class="line">        <span class="built_in">UIColor</span>* textColor = <span class="keyword">self</span>.textColor;</div><div class="line">        </div><div class="line">        <span class="comment">//Set line height, font, color and break mode</span></div><div class="line">        <span class="built_in">CGFloat</span> minimumLineHeight = <span class="keyword">self</span>.font.pointSize,maximumLineHeight = minimumLineHeight, linespace = <span class="keyword">self</span>.lineSpace;</div><div class="line">        </div><div class="line">        <span class="built_in">CTFontRef</span> font = <span class="built_in">CTFontCreateWithName</span>((__bridge <span class="built_in">CFStringRef</span>)<span class="keyword">self</span>.font.fontName, <span class="keyword">self</span>.font.pointSize,<span class="literal">NULL</span>);</div><div class="line">        <span class="built_in">CTLineBreakMode</span> lineBreakMode = kCTLineBreakByWordWrapping;</div><div class="line">        <span class="built_in">CTTextAlignment</span> alignment = <span class="built_in">CTTextAlignmentFromUITextAlignment</span>(<span class="keyword">self</span>.textAlignment);</div><div class="line">        <span class="comment">//Apply paragraph settings</span></div><div class="line">        <span class="built_in">CTParagraphStyleRef</span> style = <span class="built_in">CTParagraphStyleCreate</span>((<span class="built_in">CTParagraphStyleSetting</span>[<span class="number">6</span>])&#123;</div><div class="line">            &#123;kCTParagraphStyleSpecifierAlignment, <span class="keyword">sizeof</span>(alignment), &amp;alignment&#125;,</div><div class="line">            &#123;kCTParagraphStyleSpecifierMinimumLineHeight,<span class="keyword">sizeof</span>(minimumLineHeight),&amp;minimumLineHeight&#125;,</div><div class="line">            &#123;kCTParagraphStyleSpecifierMaximumLineHeight,<span class="keyword">sizeof</span>(maximumLineHeight),&amp;maximumLineHeight&#125;,</div><div class="line">            &#123;kCTParagraphStyleSpecifierMaximumLineSpacing, <span class="keyword">sizeof</span>(linespace), &amp;linespace&#125;,</div><div class="line">            &#123;kCTParagraphStyleSpecifierMinimumLineSpacing, <span class="keyword">sizeof</span>(linespace), &amp;linespace&#125;,</div><div class="line">            &#123;kCTParagraphStyleSpecifierLineBreakMode,<span class="keyword">sizeof</span>(<span class="built_in">CTLineBreakMode</span>),&amp;lineBreakMode&#125;</div><div class="line">        &#125;,<span class="number">6</span>);</div><div class="line">    </div><div class="line">        <span class="comment">//å±æ€§å­—å…¸</span></div><div class="line">        <span class="built_in">NSDictionary</span>* attributes = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:(__bridge <span class="keyword">id</span>)font,(<span class="built_in">NSString</span>*)kCTFontAttributeName,</div><div class="line">                                    textColor.CGColor,kCTForegroundColorAttributeName,</div><div class="line">                                    style,kCTParagraphStyleAttributeName,</div><div class="line">                                    <span class="literal">nil</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//æ‹¿åˆ°CFAttributedStringRef</span></div><div class="line">        <span class="built_in">NSMutableAttributedString</span> *attributedStr = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:text attributes:attributes];</div><div class="line">        <span class="built_in">CFAttributedStringRef</span> attributedString = (__bridge <span class="built_in">CFAttributedStringRef</span>)[<span class="keyword">self</span> highlightText:attributedStr];</div><div class="line">        </div><div class="line">        <span class="comment">//æ ¹æ®attributedStringRef è·å–CTFramesetterRef</span></div><div class="line">        <span class="built_in">CTFramesetterRef</span> framesetter = <span class="built_in">CTFramesetterCreateWithAttributedString</span>((<span class="built_in">CFAttributedStringRef</span>)attributedString);</div><div class="line">        </div><div class="line">        <span class="built_in">CGRect</span> rect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">5</span>,(size.width),(size.height<span class="number">-5</span>));</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> ([temp isEqualToString:text]) &#123;</div><div class="line">            </div><div class="line">            <span class="comment">//æ ¹æ® framesetter å’Œ attributedString ç»˜åˆ¶text</span></div><div class="line">            [<span class="keyword">self</span> drawFramesetter:framesetter attributedString:attributedStr textRange:<span class="built_in">CFRangeMake</span>(<span class="number">0</span>, text.length) inRect:rect context:context];</div><div class="line">            </div><div class="line">            <span class="comment">//æ¢å¤context</span></div><div class="line">            <span class="built_in">CGContextSetTextMatrix</span>(context,<span class="built_in">CGAffineTransformIdentity</span>);</div><div class="line">            <span class="built_in">CGContextTranslateCTM</span>(context,<span class="number">0</span>,size.height);</div><div class="line">            <span class="built_in">CGContextScaleCTM</span>(context,<span class="number">1.0</span>,<span class="number">-1.0</span>);</div><div class="line">            </div><div class="line">            <span class="comment">//æˆªå–å½“å‰å›¾ç‰‡</span></div><div class="line">            <span class="built_in">UIImage</span> *screenShotimage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</div><div class="line">            <span class="built_in">UIGraphicsEndImageContext</span>();</div><div class="line">            </div><div class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                </div><div class="line">                <span class="built_in">CFRelease</span>(font);</div><div class="line">                <span class="built_in">CFRelease</span>(framesetter);</div><div class="line">                [[attributedStr mutableString] setString:<span class="string">@""</span>];</div><div class="line">                </div><div class="line">                <span class="keyword">if</span> (drawFlag==flag) &#123;</div><div class="line">                    </div><div class="line">                    <span class="keyword">if</span> (isHighlight) &#123;</div><div class="line">                        </div><div class="line">                        <span class="comment">//é«˜äº®çŠ¶æ€ï¼šæŠŠå›¾ç‰‡ä»˜ç»™highlightImageView</span></div><div class="line">                        <span class="keyword">if</span> (highlighting) &#123;</div><div class="line">                            highlightImageView.image = <span class="literal">nil</span>;</div><div class="line">                            <span class="keyword">if</span> (highlightImageView.width!=screenShotimage.size.width) &#123;</div><div class="line">                                highlightImageView.width = screenShotimage.size.width;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span> (highlightImageView.height!=screenShotimage.size.height) &#123;</div><div class="line">                                highlightImageView.height = screenShotimage.size.height;</div><div class="line">                            &#125;</div><div class="line">                            highlightImageView.image = screenShotimage;</div><div class="line">                        &#125;</div><div class="line">                    </div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        </div><div class="line">                        <span class="comment">//éé«˜äº®çŠ¶æ€ï¼ŒæŠŠå›¾ç‰‡ä»˜ç»™labelImageView</span></div><div class="line">                        <span class="keyword">if</span> ([temp isEqualToString:text]) &#123;</div><div class="line">                            <span class="keyword">if</span> (labelImageView.width!=screenShotimage.size.width) &#123;</div><div class="line">                                labelImageView.width = screenShotimage.size.width;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span> (labelImageView.height!=screenShotimage.size.height) &#123;</div><div class="line">                                labelImageView.height = screenShotimage.size.height;</div><div class="line">                            &#125;</div><div class="line">                            highlightImageView.image = <span class="literal">nil</span>;</div><div class="line">                            labelImageView.image = <span class="literal">nil</span>;</div><div class="line">                            labelImageView.image = screenShotimage;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line"><span class="comment">//                    [self debugDraw];//ç»˜åˆ¶å¯è§¦æ‘¸åŒºåŸŸ</span></div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªè¢«ä½œè€…å°è£…å¥½çš„Labelé‡Œé¢è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ–¹æ³•ï¼Œæ¯”å¦‚ç”¨æ­£åˆ™è¡¨è¾¾å¼é«˜äº®æ˜¾ç¤ºç‰¹æ®Šå­—ç¬¦ä¸²ç­‰ç­‰ã€‚</p>
<p>å…³äºtableViewçš„ä¼˜åŒ–ï¼Œä½œè€…åšäº†å¾ˆå¤šå¤„ç†ï¼Œä½¿å¾—è¿™ç§æ˜¾ç¤ºå†…å®¹æ¯”è¾ƒä¸°å¯Œçš„cellåœ¨4sçœŸæœºä¸Šå¥½ä¸å¡é¡¿ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™æ¬¡åˆ†äº«ä¸€ä¸ªå…³äºæ€§èƒ½ä¼˜åŒ–çš„æºç ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“&lt;code&gt;UITabelView&lt;/code&gt;åœ¨iOSå¼€å‘ä¸­æ‰®æ¼”è€…ä¸¾è¶³è½»é‡çš„è§’è‰²ï¼Œå› ä¸ºå®ƒæ˜¯iOSå¼€å‘ä¸­ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„æ§ä»¶ä¹‹ä¸€ï¼šå‡ ä¹æ¯ä¸ªappéƒ½ç¦»ä¸å¼€å®ƒï¼Œå› æ­¤ï¼Œ&lt;code&gt;UITabelView&lt;/code&gt;çš„æ€§èƒ½å°†ç›´æ¥å½±å“è¿™ä¸ªappçš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ&lt;code&gt;UITabelView&lt;/code&gt;é‡Œçš„cellè®¾è®¡çš„æ¯”è¾ƒç®€å•ï¼Œé‚£ä¹ˆå³ä½¿ä¸åšç›¸åº”çš„ä¼˜åŒ–ï¼Œå¯¹æ€§èƒ½çš„å½±å“ä¹Ÿä¸ä¼šå¾ˆå¤§ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå½“cellé‡Œé¢æ¶‰åŠåˆ°å›¾æ–‡æ··æ’ï¼Œcellé«˜åº¦ä¸éƒ½ç›¸ç­‰çš„è®¾è®¡æ—¶ï¼Œå¦‚æœä¸è¿›è¡Œä¸€äº›æ“ä½œçš„è¯ï¼Œä¼šéå¸¸å½±å“æ€§èƒ½ï¼Œç”šè‡³ä¼šå‡ºç°å¡é¡¿ï¼Œé€ æˆéå¸¸ä¸å¥½çš„ç”¨æˆ·ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘åœ¨çœ‹ä¸€äº›iOSæ€§èƒ½ä¼˜åŒ–çš„æ–‡ç« ï¼Œæˆ‘æ‰¾åˆ°äº†&lt;a href=&quot;https://github.com/johnil/VVeboTableViewDemo&quot;&gt;VVeboTableView&lt;/a&gt;è¿™ä¸ªæ¡†æ¶ã€‚ä¸¥æ ¼æ¥è¯´è¿™ä¸ªä¸å±äºæ¡†æ¶ï¼Œè€Œæ˜¯ä½œè€…ç”¨è‡ªå·±çš„æ–¹å¼ä¼˜åŒ–&lt;code&gt;UITableView&lt;/code&gt;çš„ä¸€ä¸ªå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…æ¨¡ä»¿äº†æ–°æµªå¾®åšçš„cellæ ·å¼ï¼Œåœ¨é‡Œé¢å±•ç¤ºäº†å„ç§å¾®åšçš„cellã€‚è™½ç„¶æ ·å¼æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯æ€§èƒ½å´å¾ˆå¥½ï¼šæˆ‘åœ¨æˆ‘çš„iphone 4sä¸Šè¿›è¡Œäº†Core Animationæµ‹è¯•ï¼Œåœ¨æ»‘åŠ¨çš„æ—¶å€™å¸§ç‡æ²¡æœ‰ä½äº56ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è§‰å¾—æœ‰åŠç‚¹å¡é¡¿ï¼Œé‚£ä¹ˆä»–æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;çœ‹äº†æºç ä¹‹åï¼Œæˆ‘æŠŠä½œè€…çš„æ€è·¯æ•´ç†äº†å‡ºæ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://oih3a9o4n.bkt.clouddn.com/VVeboTableView_0.png&quot; alt=&quot;ä¼˜åŒ–æ€è·¯å›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘å°±ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œç»“åˆä»£ç æ¥å±•ç¤ºä¸€ä¸‹ä½œè€…æ˜¯å¦‚ä½•å®ç°æ¯ä¸€ç‚¹çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
      <category term="æºç è§£æ" scheme="https://github.com/knightsj/knightsj.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>PNChartæºç è§£æ</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/02/09/PNChart%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/02/09/PNChartæºç è§£æ/</id>
    <published>2017-02-09T03:33:20.000Z</published>
    <updated>2017-03-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€-æ¡†æ¶ä»‹ç»"><a href="#ä¸€-æ¡†æ¶ä»‹ç»" class="headerlink" title="ä¸€. æ¡†æ¶ä»‹ç»"></a>ä¸€. æ¡†æ¶ä»‹ç»</h2><p><a href="https://github.com/kevinzhow/PNChart">PNChart</a>æ˜¯å›½å†…å¼€å‘è€…å¼€å‘çš„iOSå›¾è¡¨æ¡†æ¶ï¼Œç°åœ¨å·²ç»7900å¤šé¢—staräº†ã€‚å®ƒæ¶µç›–äº†æŠ˜çº¿å›¾ï¼ŒæŸ±çŠ¶å›¾ï¼Œé¥¼å›¾ï¼Œæ•£ç‚¹å›¾ç­‰å›¾è¡¨ã€‚å›¾è¡¨çš„å¯å®šåˆ¶æ€§å¾ˆé«˜ï¼Œè€Œä¸”UIè®¾è®¡ç®€æ´å¤§æ–¹ã€‚</p>
<p>è¯¥æ¡†æ¶åˆ†ä¸ºä¸¤å±‚ï¼šè§†å›¾å±‚å’Œæ•°æ®å±‚ã€‚è§†å›¾å±‚é‡Œæœ‰ä¸¤å±‚ç»§æ‰¿å…³ç³»ï¼Œç¬¬ä¸€å±‚æ˜¯æ‰€æœ‰ç±»å‹å›¾è¡¨çš„çˆ¶ç±»<code>PNGenericChart</code>,ç¬¬äºŒå±‚å°±æ˜¯æ‰€æœ‰ç±»å‹çš„å›¾è¡¨ã€‚æä¾›ä¸€å¼ å›¾æ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/PNChart_00.png" alt="å±‚çº§å›¾"></p>
<blockquote>
<p>åœ¨è¿™å¼ å›¾é‡Œï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>å¸¦ç®­å¤´çš„çº¿å’Œä¸å¸¦ç®­å¤´çš„çº¿çš„åŒºåˆ«ã€‚</li>
<li><code>Data</code>ç±»å¯¹åº”å›¾è¡¨çš„ä¸€ç»„æ•°æ®ï¼Œå› ä¸ºå½“å‰ç±»å‹çš„å›¾è¡¨æ”¯æŒå¤šç»„æ•°æ®ï¼ˆä¾‹å¦‚ï¼šé¥¼çŠ¶å›¾æ²¡æœ‰<code>Data</code>ç±»ï¼Œå› ä¸ºé¥¼çŠ¶å›¾æ²¡æœ‰å¤šç»„æ•°æ®ï¼Œè€ŒæŠ˜çº¿å›¾<code>LineChart</code>æ˜¯æ”¯æŒå¤šç»„æ•°æ®çš„ï¼Œæ‰€ä»¥æœ‰<code>Data</code>ç±»ã€‚</li>
<li><code>Item</code>ç±»è´Ÿè´£å°†ä¼ å…¥å›¾è¡¨çš„æŸä¸ªçœŸå®å€¼è½¬åŒ–ä¸ºå›¾è¡¨ä¸­æ˜¾ç¤ºçš„å€¼ï¼Œå…·ä½“åšæ³•ä¼šåœ¨ä¸‹æ–‡è¯¦ç»†è®²è§£ã€‚</li>
<li><code>BarChart</code>ç±»é‡Œé¢çš„æ¯ä¸€æ ¹æŸ±å­éƒ½æ˜¯<code>PNBar</code>çš„å®ä¾‹ï¼ˆè¯¥ç±»å‹çš„å›¾è¡¨ä¸åœ¨æœ¬ç¯‡è®²è§£çš„èŒƒå›´ä¹‹å†…ï¼‰ã€‚</li>
</ol>
</blockquote>
<a id="more"></a>
<p>ä»Šå¤©å°±æ¥ä»‹ç»ä¸€ä¸‹è¯¥æ¡†æ¶é‡Œçš„æŠ˜çº¿å›¾çš„æºç ã€‚ä¸Šæ–‡æåˆ°è¿‡ï¼Œè¯¥æ¡†æ¶çš„æŠ˜çº¿å›¾æ˜¯æ”¯æŒå¤šç»„æ•°æ®çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨åŒä¸€å¼ å›¾è¡¨ä¸Šæ˜¾ç¤ºå¤šæ¡æŠ˜çº¿ã€‚å…ˆå¸¦å¤§å®¶çœ‹ä¸€ä¸‹æ•ˆæœå›¾ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/PNChart_2.png" alt="æŠ˜çº¿å›¾"></p>
<p>æŠ˜çº¿å›¾åœ¨æ•ˆæœä¸Šè¿˜æ˜¯å¾ˆç®€æ´ç¾è§‚çš„ï¼Œå¦‚æœç°åœ¨çš„ä½ è¿˜ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨<code>CAShapeLayer</code>å’Œ<code>UIBezierPath</code>ç”»å›¾å¹¶é™„åŠ åŠ¨ç”»æ•ˆæœï¼Œé‚£ä¹ˆæœ¬ç¯‡æºç è§£æéå¸¸é€‚åˆä½ ã€‚</p>
<p>é˜…è¯»æœ¬æ–‡ä¹‹åï¼Œä½ å¯ä»¥æŒæ¡æœ‰å…³å›¾å½¢ç»˜åˆ¶çš„ç›¸å…³çŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥æŒæ¡è‡ªå®šä¹‰å„ç§å›¾å½¢ï¼ˆ<code>UIView</code>ï¼‰çš„æ–¹æ³•ï¼Œè€Œä¸”ä½ ä¹Ÿåº”è¯¥æœ‰èƒ½åŠ›ä½œå‡ºè¿™æ ·çš„å›¾è¡¨ï¼Œç”šè‡³æ›´å¥½ï¼</p>
<p>åœ¨å¼€å§‹è®²è§£ä¹‹å‰ï¼Œæˆ‘å…ˆç²—ç•¥ä»‹ç»ä¸€ä¸‹åˆ©ç”¨<code>CAShapeLayer</code>ç”»å›¾çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æœ‰ä¸‰ä¸ªå¤§å‰æï¼š</p>
<ul>
<li>å› ä¸º<code>UIView</code>æ˜¯å¯¹<code>CALayer</code>çš„å°è£…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜<code>UIView</code>æ‰€æŒæœ‰çš„<code>layer</code>å±æ€§æ¥ç›´æ¥æ”¹å˜<code>UIView</code>çš„æ˜¾ç¤ºæ•ˆæœã€‚</li>
<li><code>CAShapeLayer</code>æ˜¯<code>CALayer</code>çš„å­ç±»ã€‚</li>
<li><code>CAShapeLayer</code>çš„ä½¿ç”¨æ˜¯ä¾èµ–äº<code>UIBezierPath</code>çš„ã€‚<code>UIBezierPath</code>å°±æ˜¯â€œè·¯å¾„â€ï¼Œå¯ä»¥ç†è§£ä¸ºå½¢çŠ¶ã€‚ä¸éš¾ç†è§£ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç”»ä¸€ä¸ªå›¾å½¢ï¼Œé‚£ä¹ˆè¿™ä¸ªå›¾å½¢çš„å½¢çŠ¶ï¼ˆåŒ…æ‹¬é¢œè‰²ï¼‰æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè€Œè¿™ä¸ªè§’è‰²ï¼Œå°±éœ€è¦<code>UIBezierPath</code>æ¥å……å½“ã€‚</li>
</ul>
<p>é‚£ä¹ˆäº†è¿™ä¸‰ä¸ªå¤§å‰æï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å¦‚ä½•ç”»å›¾äº†ï¼š</p>
<ol>
<li>å®ä¾‹åŒ–ä¸€ä¸ª<code>UIBezierPath</code>ï¼Œå¹¶èµ‹ç»™<code>CAShapeLayer</code>å®ä¾‹çš„<code>path</code>å±æ€§ã€‚</li>
<li>å°†è¿™ä¸ª<code>CAShapeLayer</code>çš„å®ä¾‹æ·»åŠ åˆ°<code>UIView</code>çš„<code>layer</code>ä¸Šã€‚</li>
</ol>
<p>ç®€å•çš„ä»£ç æ¼”ç¤ºä¸Šè¿°è¿‡ç¨‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPath];</div><div class="line">...è‡ªå®šä¹‰path...</div><div class="line"><span class="built_in">CAShapeLayer</span> *shapLayer = [<span class="built_in">CAShapeLayer</span> alloc] init];</div><div class="line">shapLayer.path = path;</div><div class="line">[<span class="keyword">self</span>.view.layer addSubLayer:shapeLayer];</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨å¤§è‡´äº†è§£äº†ç”»å›¾çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥æ¡†æ¶çš„ä½œè€…æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ªæŠ˜çº¿å›¾çš„å§ï¼</p>
<h2 id="äºŒ-æºç è§£æ"><a href="#äºŒ-æºç è§£æ" class="headerlink" title="äºŒ. æºç è§£æ"></a>äºŒ. æºç è§£æ</h2><p>é¦–å…ˆçœ‹ä¸€ä¸‹æ•´ä¸ªç»˜åˆ¶æŠ˜çº¿å›¾çš„æ­¥éª¤ï¼š</p>
<ol>
<li>å›¾è¡¨çš„åˆå§‹åŒ–ã€‚</li>
<li>è·å–æ¨ªè½´å’Œçºµè½´çš„æ•°æ®ã€‚</li>
<li>è®¡ç®—æŠ˜çº¿ä¸Šæ‰€æœ‰æ‹ç‚¹çš„xï¼Œyå€¼ã€‚</li>
<li>è®¡ç®—æ¯ä¸ªæ‹ç‚¹ä¸­é—´çš„åœ†åœˆçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰ã€‚</li>
<li>ç”Ÿæˆæ¯ä¸ªæ‹ç‚¹ä¸Šé¢çš„Labelï¼ˆå¯æœ‰å¯æ— ï¼‰ã€‚</li>
<li>è®¡ç®—æ¯æ¡çº¿æ®µçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰ã€‚</li>
<li>å°†ä¸Šé¢å¾—åˆ°çš„è´å¡å°”æ›²çº¿èµ‹ç»™æ¯æ¡çº¿æ®µå’Œåœ†åœˆçš„layerï¼ˆCAShapeLayerï¼‰ã€‚</li>
<li>ç»˜åˆ¶æ‰€æœ‰æŠ˜çº¿ï¼ˆæ‰€æœ‰çº¿æ®µ+æ‰€æœ‰åœ†åœˆï¼‰ã€‚</li>
<li>æ·»åŠ åŠ¨ç”»(å¯æœ‰å¯æ— )ã€‚</li>
<li>ç»˜åˆ¶xï¼Œyåæ ‡è½´ã€‚</li>
</ol>
<p>åœ¨é›†åˆä»£ç å…·ä½“è®²è§£ä¹‹å‰ï¼Œæˆ‘ä»¬è¦æ¸…æ¥šä¸‰ç‚¹ï¼ˆéå¸¸éå¸¸é‡è¦ï¼‰ï¼š</p>
<ol>
<li>æ­¤æŠ˜çº¿å›¾æ¡†æ¶æ˜¯å¯ä»¥è®¾ç½®æ‹ç‚¹çš„æ ·å¼çš„:å¯ä»¥è®¾ç½®ä¸ºæ²¡æœ‰æ ·å¼ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æœ‰æ ·å¼ï¼šåœ†åœˆï¼Œæ–¹å—ï¼Œä¸‰è§’å½¢ã€‚<ul>
<li>å¦‚æœæ²¡æœ‰æ ·å¼ï¼Œåˆ™æ˜¯ç®€å•çš„çº¿æ®µä¸çº¿æ®µçš„è¿æ¥ï¼Œåœ¨æ‹ç‚¹å¤„æ²¡æœ‰ä»»ä½•å…¶ä»–æ§ä»¶ã€‚</li>
<li>å¦‚æœæ˜¯æœ‰æ ·å¼çš„ï¼Œé‚£ä¹ˆè¿™æ¡æŠ˜çº¿é‡Œçš„æ¯æ¡çº¿æ®µï¼ˆåœ¨æœ¬ç¯‡æ–‡ç« é‡Œç»Ÿä¸€è¯´æˆçº¿æ®µï¼‰ä¹‹é—´æ˜¯<strong>åˆ†ç¦»çš„</strong>ï¼Œå› ä¸ºçº¿æ®µä¸­é—´æœ‰ä¸€ä¸ªæ‹ç‚¹æ§ä»¶ã€‚æœ¬ç¯‡æ–‡ç« ä»‹ç»çš„æ˜¯åœ†åœˆæ ·å¼ï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ‹ç‚¹æ§ä»¶æ˜¯ä¸€ä¸ªåœ†åœˆï¼‰ã€‚</li>
</ul>
</li>
<li>ä¸Šæ–‡æåˆ°è¿‡ï¼Œè¯¥æŠ˜çº¿å›¾æ¡†æ¶å¯ä»¥åœ¨ä¸€å¼ å›¾è¡¨é‡ŒåŒæ—¶æ˜¾ç¤ºå¤šæ¡æŠ˜çº¿ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è®¾ç½®å¤šç»„æ•°æ®ï¼ˆä¸€æ¡æŠ˜çº¿å¯¹åº”ä¸€ç»„æ•°æ®ï¼‰ã€‚å› æ­¤ï¼Œä¸Šé¢çš„3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7é¡¹éƒ½æ˜¯ç”¨å„è‡ªä¸åŒçš„ä¸€ä¸ªæ•°ç»„ä¿å­˜çš„ï¼Œæ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ å¯¹åº”ä¸€æ¡æŠ˜çº¿çš„æ•°æ®ã€‚</li>
<li>æ—¢ç„¶åŒä¸€ä¸ªå¼ å›¾è¡¨å¯ä»¥æ˜¾ç¤ºå¤šæ¡æŠ˜çº¿ï¼š<ul>
<li>é‚£ä¹ˆæœ‰äº›å±æ€§å°±æ˜¯è¿™äº›æŠ˜çº¿å…±æœ‰çš„ï¼Œæ¯”å¦‚æ¨ªåæ ‡çš„valueï¼Œè¿™äº›å±æ€§ä¿å­˜åœ¨<code>PNLineChart</code>çš„å®ä¾‹é‡Œé¢ã€‚</li>
<li>æœ‰äº›å±æ€§æ˜¯æ¯æ¡æŠ˜çº¿ç§æœ‰çš„ï¼Œæ¯”å¦‚æ¯æ¡æŠ˜çº¿çš„é¢œè‰²ï¼Œçºµåæ ‡valueç­‰ç­‰ï¼Œè¿™äº›å±æ€§ä¿å­˜åœ¨<code>PNLineChartData</code>é‡Œé¢ã€‚æ¯ä¸€æ¡æŠ˜çº¿å¯¹åº”ä¸€ä¸ª<code>PNLineChartData</code>å®ä¾‹ã€‚è¿™äº›å®ä¾‹æ±‡æ€»åˆ°ä¸€ä¸ªæ•°ç»„é‡Œé¢ï¼Œè¿™ä¸ªæ•°ç»„ç”±<code>PNLineChart</code>çš„å®ä¾‹ç®¡ç†ã€‚</li>
</ul>
</li>
</ol>
<p>åœ¨å……åˆ†äº†è§£äº†è¿™ä¸‰ç‚¹ä¹‹åï¼Œæˆ‘ä»¬ç»“åˆä¸€ä¸‹ä»£ç æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°ï¼š</p>
<h3 id="1-å›¾è¡¨çš„åˆå§‹åŒ–"><a href="#1-å›¾è¡¨çš„åˆå§‹åŒ–" class="headerlink" title="1. å›¾è¡¨çš„åˆå§‹åŒ–"></a>1. å›¾è¡¨çš„åˆå§‹åŒ–</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        [<span class="keyword">self</span> setupDefaultValues];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)setupDefaultValues &#123;</div><div class="line">    </div><div class="line">    [<span class="keyword">super</span> setupDefaultValues];</div><div class="line">    </div><div class="line">    ...</div><div class="line">    </div><div class="line">    <span class="comment">//å››ä¸ªå†…è¾¹è·</span></div><div class="line">    _chartMarginLeft = <span class="number">25.0</span>;</div><div class="line">    _chartMarginRight = <span class="number">25.0</span>;</div><div class="line">    _chartMarginTop = <span class="number">25.0</span>;</div><div class="line">    _chartMarginBottom = <span class="number">25.0</span>;</div><div class="line">    </div><div class="line">    ...</div><div class="line">    </div><div class="line">    <span class="comment">//çœŸæ­£ç»˜åˆ¶å›¾è¡¨çš„ç”»å¸ƒï¼ˆCavanWidthï¼‰çš„å®½é«˜</span></div><div class="line">    _chartCavanWidth = <span class="keyword">self</span>.frame.size.width - _chartMarginLeft - _chartMarginRight;</div><div class="line">    _chartCavanHeight = <span class="keyword">self</span>.frame.size.height - _chartMarginBottom - _chartMarginTop;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¸Šé¢è¿™æ®µä»£ç æˆ‘åˆ»æ„çœå»äº†å…¶ä»–ä¸€äº›åŸºæœ¬çš„è®¾ç½®ï¼Œçªå‡ºäº†å›¾è¡¨å¸ƒå±€çš„è®¾ç½®ã€‚</p>
<p>å¸ƒå±€çš„è®¾ç½®æ˜¯å›¾è¡¨ç»˜åˆ¶çš„å‰æï¼Œå› ä¸ºåœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œå°±åº”è¯¥è®¡ç®—å‡ºâ€œç”»å¸ƒâ€ï¼Œä¹Ÿå°±æ˜¯å›¾è¡¨å†…å®¹ï¼ˆä¸åŒ…æ‹¬åæ ‡è½´å’Œåæ ‡labelï¼‰çš„å…·ä½“å¤§å°å’Œä½ç½®ï¼ˆå†…è¾¹è·ä»¥å†…çš„éƒ¨åˆ†ï¼‰ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦è·å–çœŸæ­£ç»˜åˆ¶å›¾è¡¨çš„ç”»å¸ƒçš„å®½é«˜(<code>_chartCavanWidth</code>å’Œ<code>_chartCavanHeight</code>)ã€‚è€Œä¸”ï¼Œè¦ç•™æ„çš„æ˜¯<code>_chartMarginLeft</code>åœ¨å°†æ¥æ˜¯è¦ç”¨ä½œyè½´Labelçš„å®½åº¦ï¼Œè€Œ<code>_chartMarginBottom</code>åœ¨å°†æ¥æ˜¯è¦ç”¨ä½œxè½´Labelçš„é«˜åº¦çš„ã€‚</p>
</blockquote>
<p>ç”¨ä¸€å¼ å›¾ç›´è§‚çœ‹ä¸€ä¸‹ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/PNChart_4.png" alt="æ•´ä¸ªæ§ä»¶çš„å¤§å°å’Œç”»å¸ƒçš„å¤§å°"></p>
<h3 id="2-è·å–æ¨ªè½´å’Œçºµè½´çš„æ•°æ®"><a href="#2-è·å–æ¨ªè½´å’Œçºµè½´çš„æ•°æ®" class="headerlink" title="2. è·å–æ¨ªè½´å’Œçºµè½´çš„æ•°æ®"></a>2. è·å–æ¨ªè½´å’Œçºµè½´çš„æ•°æ®</h3><p>ç°åœ¨ç”»å¸ƒçš„ä½ç½®å’Œå¤§å°ç¡®å®šäº†ï¼Œæˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸‹æŠ˜çº¿å›¾æ˜¯æ€ä¹ˆç”»çš„äº†ã€‚<br>æ•´ä¸ªå›¾è¡¨çš„ç»˜åˆ¶éƒ½åŸºäºä¸‰ç»„æ•°æ®ï¼ˆä¹Ÿå¯ä»¥æ˜¯ä¸¤ç»„ï¼Œä¸ºä»€ä¹ˆæ˜¯ä¸¤ç»„ï¼Œæˆ‘ç¨åä¼šç»™å‡ºè§£é‡Šï¼‰ï¼Œåœ¨è®²è§£è¯¥æ¡†æ¶æ˜¯å¦‚ä½•åˆ©ç”¨è¿™äº›æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™äº›æ•°æ®æ˜¯å¦‚ä½•ä¼ è¿›å›¾è¡¨çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="comment">//è®¾ç½®xè½´çš„æ•°æ®</span></div><div class="line">[<span class="keyword">self</span>.lineChart setXLabels:@[<span class="string">@"SEP 1"</span>, <span class="string">@"SEP 2"</span>, <span class="string">@"SEP 3"</span>, <span class="string">@"SEP 4"</span>, <span class="string">@"SEP 5"</span>, <span class="string">@"SEP 6"</span>, <span class="string">@"SEP 7"</span>]];</div><div class="line"><span class="comment">//è®¾ç½®yè½´çš„æ•°æ®</span></div><div class="line">[<span class="keyword">self</span>.lineChart setYLabels:@[</div><div class="line">                             <span class="string">@"0"</span>,<span class="string">@"50"</span>,<span class="string">@"100"</span>,<span class="string">@"150"</span>,<span class="string">@"200"</span>,<span class="string">@"250"</span>,<span class="string">@"300"</span>,</div><div class="line">                             ]</div><div class="line"> ];</div><div class="line"><span class="comment">// Line Chart</span></div><div class="line"><span class="comment">//è®¾ç½®æ¯ä¸ªç‚¹çš„yå€¼</span></div><div class="line"><span class="built_in">NSArray</span> *dataArray = @[@<span class="number">0.0</span>, @<span class="number">180.1</span>, @<span class="number">26.4</span>, @<span class="number">202.2</span>, @<span class="number">126.2</span>, @<span class="number">167.2</span>, @<span class="number">276.2</span>];</div><div class="line">PNLineChartData *data = [PNLineChartData new];</div><div class="line">data.pointLabelColor = [<span class="built_in">UIColor</span> blackColor];</div><div class="line">data.color = PNTwitterColor;</div><div class="line">data.alpha = <span class="number">0.5</span>f;</div><div class="line">data.itemCount = dataArray.count;</div><div class="line">data.inflexionPointStyle = PNLineChartPointStyleCircle;</div><div class="line"><span class="comment">//è¿™ä¸ªblockçš„ä½œç”¨æ˜¯å°†ä¸Šé¢çš„dataArrayé‡Œçš„æ¯ä¸€ä¸ªå€¼ä¼ ç»™line chartã€‚</span></div><div class="line">data.getData = ^(<span class="built_in">NSUInteger</span> index) &#123;</div><div class="line">    <span class="built_in">CGFloat</span> yValue = [dataArray[index] floatValue];</div><div class="line">    <span class="keyword">return</span> [PNLineChartDataItem dataItemWithY:yValue];</div><div class="line">&#125;;</div><div class="line"><span class="comment">//å› ä¸ºåªæœ‰ä¸€æ¡æŠ˜çº¿ï¼Œæ‰€ä»¥åªæœ‰ä¸€ç»„æ•°æ®</span></div><div class="line"><span class="keyword">self</span>.lineChart.chartData = @[data];</div><div class="line"><span class="comment">//ç»˜åˆ¶å›¾è¡¨</span></div><div class="line">[<span class="keyword">self</span>.lineChart strokeChart];</div><div class="line"><span class="comment">//è®¾ç½®ä»£ç†ï¼Œå“åº”ç‚¹å‡»</span></div><div class="line"><span class="keyword">self</span>.lineChart.delegate = <span class="keyword">self</span>;</div><div class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineChart];</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç æˆ‘å¯ä»¥ç•¥å»äº†å¾ˆå¤šå¤šä½™çš„è®¾ç½®ï¼Œç›®çš„æ˜¯çªå‡ºå›¾è¡¨æ•°æ®çš„è®¾ç½®ã€‚</p>
<p>ä¸éš¾çœ‹å‡ºï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªæ•°æ®ä¼ ç»™äº†lineChartï¼š</p>
<p>1.xè½´çš„æ•°æ®ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.lineChart setXLabels:@[<span class="string">@"SEP 1"</span>, <span class="string">@"SEP 2"</span>, <span class="string">@"SEP 3"</span>, <span class="string">@"SEP 4"</span>, <span class="string">@"SEP 5"</span>, <span class="string">@"SEP 6"</span>, <span class="string">@"SEP 7"</span>]];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ®µä»£ç è°ƒç”¨ä¹‹åï¼Œå®ç°äº†ï¼š</p>
<ol>
<li>æ ¹æ®ä¼ å…¥çš„xLabelæ•°ç»„é‡Œå…ƒç´ çš„æ•°é‡ï¼Œå†…å®¹å®½åº¦(<code>_chartCavanWidth</code>)å’Œä¸‹è¾¹è·ï¼ˆ<code>_chartMarginBottom</code>ï¼‰ï¼Œè®¡ç®—æ¯ä¸ªxlabelçš„sizeã€‚</li>
<li>æ ¹æ®xLabelæ‰€éœ€è¦å±•ç¤ºçš„å†…å®¹(<code>NSString</code>)å’Œå®½åº¦ï¼Œå®ä¾‹åŒ–æ‰€æœ‰çš„xLabelï¼ˆåŒ…æ‹¬å†…å®¹ï¼Œä½ç½®ï¼‰å¹¶æ˜¾ç¤ºå‡ºæ¥ï¼Œæœ€åä¿å­˜åœ¨<code>_xChartLabels</code>é‡Œé¢ã€‚</li>
</ol>
</blockquote>
<p>2.yè½´çš„æ•°æ®ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.lineChart setYLabels:@[</div><div class="line">                <span class="string">@"0"</span>,<span class="string">@"50"</span>,<span class="string">@"100"</span>,<span class="string">@"150"</span>,<span class="string">@"200"</span>,<span class="string">@"250"</span>,<span class="string">@"300"</span>,</div><div class="line">                ]</div><div class="line">    ];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ®µä»£ç è°ƒç”¨ä¹‹åï¼Œå®ç°äº†ï¼š</p>
<ol>
<li>æ ¹æ®ä¼ å…¥çš„yLabelæ•°ç»„é‡Œå…ƒç´ çš„æ•°é‡ï¼Œå†…å®¹é«˜åº¦(<code>_chartCavanHeight</code>)å’Œå·¦è¾¹è·(<code>_chartMarginLeft</code>)ï¼Œè®¡ç®—å‡ºæ¯ä¸ªylabelçš„sizeã€‚</li>
<li>æ ¹æ®xLabelæ‰€éœ€è¦å±•ç¤ºçš„å†…å®¹(<code>NSString</code>)å’Œå®½åº¦ï¼Œå®ä¾‹åŒ–æ‰€æœ‰çš„yLabelï¼ˆåŒ…æ‹¬å†…å®¹ï¼Œä½ç½®ï¼‰å¹¶æ˜¾ç¤ºå‡ºæ¥ï¼Œæœ€åä¿å­˜åœ¨<code>_yChartLabels</code>é‡Œé¢ã€‚</li>
</ol>
</blockquote>
<p>3.ä¸€æ¡æŠ˜çº¿ä¸Šæ¯ä¸ªç‚¹çš„å®é™…å€¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *dataArray = @[@<span class="number">0.0</span>, @<span class="number">180.1</span>, @<span class="number">26.4</span>, @<span class="number">202.2</span>, @<span class="number">126.2</span>, @<span class="number">167.2</span>, @<span class="number">276.2</span>];</div><div class="line">data.getData = ^(<span class="built_in">NSUInteger</span> index) &#123;</div><div class="line">        <span class="built_in">CGFloat</span> yValue = [dataArray[index] floatValue];</div><div class="line">        <span class="keyword">return</span> [PNLineChartDataItem dataItemWithY:yValue];</div><div class="line">    &#125;;</div><div class="line"><span class="keyword">self</span>.lineChart.chartData = @[data];</div></pre></td></tr></table></figure>
<blockquote>
<p>ç€é‡è®²ä¸€ä¸‹blockï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠè¿™ä¸ªæ•°ç»„(<code>dataArray</code>)ä½œä¸ºline chartçš„å±æ€§ä¼ è¿›å»å‘¢ï¼Ÿæˆ‘è®¤ä¸ºä½œè€…æ˜¯æƒ³æä¾›ä¸€ä¸ªæ¥å£ç»™ç”¨æˆ·ä¸€ä¸ªè‡ªå·±è½¬åŒ–yå€¼çš„æœºä¼šã€‚</p>
<p>åƒä¸Šæ–‡æ‰€è¯´çš„ï¼Œè¿™é‡Œ1ï¼Œ2æ˜¯å±äº<code>lineChart</code>çš„æ•°æ®ï¼Œå®ƒé€‚ç”¨äºè¿™å¼ å›¾è¡¨ä¸Šæ‰€æœ‰çš„æŠ˜çº¿çš„ã€‚è€Œ3æ˜¯å±äºæŸä¸€æ¡æŠ˜çº¿çš„ã€‚</p>
<p>ç°åœ¨å›ç­”ä¸€ä¸‹ä¸ºä»€ä¹ˆå¯ä»¥åªä¼ å…¥ä¸¤ç»„æ•°æ®ï¼šå› ä¸ºyè½´æ•°æ®å¯ä»¥ç”±æ¯ä¸ªç‚¹çš„å®é™…å€¼æ•°ç»„å¾—å‡ºã€‚å¯ä»¥ç®€å•æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è·å–è¿™äº›çœŸå®å€¼é‡Œé¢çš„æœ€å¤§å€¼ï¼Œç„¶åå°†å®ƒnç­‰åˆ†ï¼Œå°±è‡ªç„¶å¾—åˆ°äº†yè½´æ•°æ®äº†ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å·²ç»å¸ƒå±€äº†xè½´å’Œyè½´çš„æ‰€æœ‰labelï¼Œç°åœ¨å¼€å§‹çœŸæ­£è®¡ç®—å›¾è¡¨çš„æ•°æ®äº†ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä¸‹é¢è¦ä»‹ç»çš„3ï¼Œ4ï¼Œ5ï¼Œ6é¡¹éƒ½æ˜¯åœ¨åŒä¸€æ–¹æ³•ä¸­è®¡ç®—å‡ºæ¥ï¼Œä¸ºäº†é¿å…ä»£ç è¿‡é•¿ï¼Œæˆ‘å°†æ¯ä¸ªéƒ¨åˆ†åˆ†è§£å¼€æ¥åšå‡ºè§£é‡Šã€‚å› ä¸ºåœ¨åŒä¸€æ–¹æ³•é‡Œï¼Œæ‰€ä»¥è¿™äº›æ¶‰åŠåˆ°forå¾ªç¯çš„è¯­å¥æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>æ•´ä¸ªå›¾è¡¨çš„ç»˜åˆ¶éƒ½æ˜¯ä¾èµ–äºæ•°æ®çš„å¤„ç†ï¼Œæ‰€ä»¥3ï¼Œ4ï¼Œ5ï¼Œ6é¡¹ä¹Ÿæ˜¯ç†è§£è¯¥æ¡†æ¶çš„ä¸€ä¸ªå…³é”®ï¼</p>
</blockquote>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ¯ä¸ªæ•°æ®ç‚¹ï¼ˆæ‹ç‚¹ï¼‰çš„å‡†ç¡®ä½ç½®ï¼š</p>
<h3 id="3-è®¡ç®—æŠ˜çº¿ä¸Šæ‰€æœ‰æ‹ç‚¹çš„xï¼Œyå€¼ã€‚"><a href="#3-è®¡ç®—æŠ˜çº¿ä¸Šæ‰€æœ‰æ‹ç‚¹çš„xï¼Œyå€¼ã€‚" class="headerlink" title="3. è®¡ç®—æŠ˜çº¿ä¸Šæ‰€æœ‰æ‹ç‚¹çš„xï¼Œyå€¼ã€‚"></a>3. è®¡ç®—æŠ˜çº¿ä¸Šæ‰€æœ‰æ‹ç‚¹çš„xï¼Œyå€¼ã€‚</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//éå†å›¾è¡¨é‡Œæ¯æ¡æŠ˜çº¿</span></div><div class="line"><span class="comment">//è¿˜è®°å¾—chartDataå±æ€§ä¹ˆï¼Ÿå®ƒæ˜¯ç”¨æ¥ä¿å­˜å¤šç»„æŠ˜çº¿çš„æ•°æ®çš„ï¼Œåœ¨è¿™é‡Œåªæœ‰ä¸€ä¸ªæŠ˜çº¿ï¼Œæ‰€ä»¥è¿™ä¸ªå¾ªç¯åªå¾ªç¯ä¸€æ¬¡ï¼‰</span></div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSUInteger</span> lineIndex = <span class="number">0</span>; lineIndex &lt; <span class="keyword">self</span>.chartData.count; lineIndex++) &#123;</div><div class="line">   <span class="comment">//ä¿å­˜æ¯æ¡æŠ˜çº¿ä¸Šçš„æ‰€æœ‰ç‚¹çš„CGPoint  </span></div><div class="line">   <span class="built_in">NSMutableArray</span> *linePointsArray = [[<span class="built_in">NSMutableArray</span> alloc] init];</div><div class="line">    <span class="comment">//éå†æ¯æ¡æŠ˜çº¿é‡Œçš„æ¯ä¸ªç‚¹    </span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; chartData.itemCount; i++) &#123;</div><div class="line">       </div><div class="line">        <span class="comment">//ä¼ å…¥indexï¼Œè·å–yå€¼(è°ƒç”¨çš„æ˜¯ä¸Šæ–‡æåˆ°çš„block)</span></div><div class="line">        yValue = chartData.getData(i).y;</div><div class="line">        <span class="comment">//å½“å‰ç‚¹çš„xï¼š _chartMarginLeft + _xLabelWidth / 2.0ä¸º0åæ ‡ï¼Œæ¯å¤šä¸€ä¸ªç‚¹å°±å¤šä¸€ä¸ª_xLabelWidth</span></div><div class="line">        <span class="keyword">int</span> x = (<span class="keyword">int</span>) (i * _xLabelWidth + _chartMarginLeft + _xLabelWidth / <span class="number">2.0</span>);</div><div class="line">            </div><div class="line">        <span class="comment">//å½“å‰ç‚¹çš„yï¼šæ ¹æ®å½“å‰ç‚¹çš„å€¼å’Œå½“å‰ç‚¹æ‰€åœ¨çš„æ•°ç»„é‡Œçš„æœ€å¤§å€¼çš„æ¯”ä¾‹ ä»¥åŠ å›¾è¡¨çš„æ€»é«˜åº¦ï¼Œç®—å‡ºå½“å‰ç‚¹åœ¨å›¾è¡¨é‡Œçš„yåæ ‡</span></div><div class="line">        <span class="keyword">int</span> y = (<span class="keyword">int</span>)[<span class="keyword">self</span> yValuePositionInLineChart:yValue];</div><div class="line">        <span class="comment">//ä¿å­˜æ‰€æœ‰æ‹ç‚¹çš„åæ ‡</span></div><div class="line">        [linePointsArray addObject:[<span class="built_in">NSValue</span> valueWithCGPoint:<span class="built_in">CGPointMake</span>(x, y)]];</div><div class="line">    &#125;</div><div class="line">  <span class="comment">//ä¿å­˜å¤šæ¡æŠ˜çº¿çš„CGPointï¼ˆè¿™é‡Œåªæœ‰ä¸€æ¡æŠ˜çº¿ï¼Œæ‰€ä»¥è¯¥æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼‰</span></div><div class="line">  [pathPoints addObject:[linePointsArray <span class="keyword">copy</span>]];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ol>
<li>è¿™é‡Œçš„<code>pathPoints</code>å¯¹åº”çš„æ˜¯<code>lineChart</code>çš„<code>_pathPoints</code>å±æ€§ã€‚å®ƒæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œä¿å­˜æ¯æ¡æŠ˜çº¿ä¸Šæ‰€æœ‰ç‚¹çš„<code>CGPoint</code>ã€‚</li>
<li>yå€¼çš„è®¡ç®—ï¼šæ˜¯éœ€è¦ä»yçš„çœŸå®å€¼è½¬åŒ–ä¸ºè¿™ä¸ªæ‹ç‚¹åœ¨å›¾è¡¨é‡Œçš„yåæ ‡ï¼Œè½¬åŒ–æ–¹æ³•çš„å®ç°(ä»”ç»†çœ‹å‡ éå°±æ‡‚äº†)ï¼š</li>
</ol>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGFloat</span>)yValuePositionInLineChart:(<span class="built_in">CGFloat</span>)y &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> innerGrade;<span class="comment">//çœŸå®çš„æœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·® ä¸ å½“å‰ç‚¹ä¸æœ€å°å€¼çš„å·® çš„æ¯”å€¼</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (!(_yValueMax - _yValueMin)) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//ç‰¹æ®Šæƒ…å†µï¼šå½“_yValueMaxå’Œ_yValueMinç›¸ç­‰çš„æ—¶å€™</span></div><div class="line">        innerGrade = <span class="number">0.5</span>;</div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        </div><div class="line">        innerGrade = ((<span class="built_in">CGFloat</span>) y - _yValueMin) / (_yValueMax - _yValueMin);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//innerGrade ä¸ç”»å¸ƒçš„é«˜åº¦ï¼ˆ_chartCavanHeightï¼‰ç›¸ä¹˜ï¼Œå°±èƒ½å¾—å‡ºåœ¨ç”»å¸ƒä¸­çš„é«˜åº¦</span></div><div class="line">    <span class="keyword">return</span> _chartCavanHeight - (innerGrade * _chartCavanHeight) - (_yLabelHeight / <span class="number">2</span>) + _chartMarginTop;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-è®¡ç®—æ¯ä¸ªæ‹ç‚¹ä¸­é—´çš„åœ†åœˆçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰"><a href="#4-è®¡ç®—æ¯ä¸ªæ‹ç‚¹ä¸­é—´çš„åœ†åœˆçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰" class="headerlink" title="4. è®¡ç®—æ¯ä¸ªæ‹ç‚¹ä¸­é—´çš„åœ†åœˆçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰"></a>4. è®¡ç®—æ¯ä¸ªæ‹ç‚¹ä¸­é—´çš„åœ†åœˆçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//éå†å›¾è¡¨é‡Œæ¯æ¡æŠ˜çº¿</span></div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSUInteger</span> lineIndex = <span class="number">0</span>; lineIndex &lt; <span class="keyword">self</span>.chartData.count; lineIndex++) &#123;</div><div class="line">    <span class="comment">//æ¯æ¡æŠ˜çº¿æ‰€æœ‰åœ†åœˆçš„è´å¡å°”æ›²çº¿</span></div><div class="line">    <span class="built_in">UIBezierPath</span> *pointPath = [<span class="built_in">UIBezierPath</span> bezierPath];    </div><div class="line">    <span class="comment">//inflexionWidthé»˜è®¤æ˜¯6,æ˜¯ä¸¤ä¸ªçº¿æ®µä¸­é—´çš„è·ç¦»ï¼ˆå› ä¸ºä¸­é—´æœ‰ä¸€ä¸ªåœˆåœˆï¼Œæ‰€ä»¥éœ€è¦å®šä¸€ä¸ªè·ç¦»ï¼‰</span></div><div class="line">    <span class="built_in">CGFloat</span> inflexionWidth = chartData.inflexionPointWidth;</div><div class="line">    <span class="comment">//éå†æ¯æ¡æŠ˜çº¿é‡Œçš„æ¯ä¸ªç‚¹</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; chartData.itemCount; i++) &#123;  </div><div class="line">        <span class="comment">//1. è®¡ç®—åœ†åœˆçš„rectï¼šå·²å½“å‰ç‚¹ä¸ºä¸­å¿ƒï¼Œä»¥inflexionWidthä¸ºåŠå¾„</span></div><div class="line">        <span class="built_in">CGRect</span> circleRect = <span class="built_in">CGRectMake</span>(x - inflexionWidth / <span class="number">2</span>, y - inflexionWidth / <span class="number">2</span>, inflexionWidth, inflexionWidth);    </div><div class="line">        <span class="comment">//2. è®¡ç®—åœ†åœˆçš„ä¸­å¿ƒï¼šç”±åœ†åœˆçš„xï¼Œyå’ŒinflexionWidthç®—å‡º</span></div><div class="line">        <span class="built_in">CGPoint</span> circleCenter = <span class="built_in">CGPointMake</span>(circleRect.origin.x + (circleRect.size.width / <span class="number">2</span>), circleRect.origin.y + (circleRect.size.height / <span class="number">2</span>));</div><div class="line">        <span class="comment">//3.1 ç§»åŠ¨åˆ°åœ†åœˆçš„å³ä¸­éƒ¨</span></div><div class="line">        [pointPath moveToPoint:<span class="built_in">CGPointMake</span>(circleCenter.x + (inflexionWidth / <span class="number">2</span>), circleCenter.y)];        </div><div class="line">        <span class="comment">//3.2 ç”»çº¿ï¼ˆåœ†å½¢ï¼‰</span></div><div class="line">        [pointPath addArcWithCenter:circleCenter radius:inflexionWidth / <span class="number">2</span> startAngle:<span class="number">0</span> endAngle:(<span class="built_in">CGFloat</span>) (<span class="number">2</span> * M_PI) clockwise:<span class="literal">YES</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//ä¿å­˜åˆ°pointsPathæ•°ç»„é‡Œ</span></div><div class="line">    [pointsPath insertObject:pointPath atIndex:lineIndex];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œ<code>pointsPath</code>å¯¹åº”çš„æ˜¯<code>lineChart</code>çš„<code>_pointsPath</code>å±æ€§ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œä¿å­˜æ¯æ¡æŠ˜çº¿ä¸Šçš„åœ†åœˆè´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰ã€‚</p>
</blockquote>
<h3 id="5-ç”Ÿæˆæ¯ä¸ªæ‹ç‚¹ä¸Šé¢çš„Labelï¼ˆå¯æœ‰å¯æ— ï¼‰"><a href="#5-ç”Ÿæˆæ¯ä¸ªæ‹ç‚¹ä¸Šé¢çš„Labelï¼ˆå¯æœ‰å¯æ— ï¼‰" class="headerlink" title="5. ç”Ÿæˆæ¯ä¸ªæ‹ç‚¹ä¸Šé¢çš„Labelï¼ˆå¯æœ‰å¯æ— ï¼‰"></a>5. ç”Ÿæˆæ¯ä¸ªæ‹ç‚¹ä¸Šé¢çš„Labelï¼ˆå¯æœ‰å¯æ— ï¼‰</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//éå†å›¾è¡¨é‡Œæ¯æ¡æŠ˜çº¿</span></div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSUInteger</span> lineIndex = <span class="number">0</span>; lineIndex &lt; <span class="keyword">self</span>.chartData.count; lineIndex++) &#123;</div><div class="line">    <span class="comment">//éå†æ¯æ¡æŠ˜çº¿é‡Œçš„æ¯ä¸€æ®µ</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; chartData.itemCount; i++) &#123;</div><div class="line">    </div><div class="line">        <span class="keyword">if</span> (chartData.showPointLabel) &#123;</div><div class="line">            [gradePathArray addObject:[<span class="keyword">self</span> createPointLabelFor:chartData.getData(i).rawY pointCenter:circleCenter width:inflexionWidth withChartData:chartData]];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼Œåœ¨è¿™é‡Œï¼Œè¿™äº›labelçš„å®ç°æ˜¯é€šè¿‡ä¸€ä¸ª<code>CATextLayer</code>å®ç°çš„ï¼Œå¹¶ä¸æ˜¯ç”Ÿæˆä¸€ä¸ªä¸ª<code>Label</code>æ”¾åœ¨æ•°ç»„é‡Œä¿å­˜ï¼Œå…·ä½“å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CATextLayer</span> *)createPointLabelFor:(<span class="built_in">CGFloat</span>)grade pointCenter:(<span class="built_in">CGPoint</span>)pointCenter width:(<span class="built_in">CGFloat</span>)width withChartData:(PNLineChartData *)chartData &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//gradeï¼šæä¾›textLayeræ˜¾ç¤ºçš„æ•°å€¼</span></div><div class="line">    <span class="comment">//pointCenterï¼šæ ¹æ®pointCenterç®—å‡ºtextLayerçš„xï¼Œy</span></div><div class="line">    <span class="comment">//widthï¼šæ ¹æ®widthå¾—åˆ°textLayerçš„æ€»å®½åº¦</span></div><div class="line">    <span class="comment">//chartDataï¼šè·å–chartDataé‡Œä¿å­˜çš„textLayerä¸Šåº”è¯¥ä¿å­˜çš„å­—ä½“å¤§å°å’Œé¢œè‰²</span></div><div class="line">    </div><div class="line">    <span class="built_in">CATextLayer</span> *textLayer = [[<span class="built_in">CATextLayer</span> alloc] init];</div><div class="line">    [textLayer setAlignmentMode:kCAAlignmentCenter];</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®textLayerçš„èƒŒæ™¯è‰²</span></div><div class="line">    [textLayer setForegroundColor:[chartData.pointLabelColor <span class="built_in">CGColor</span>]];</div><div class="line">    [textLayer setBackgroundColor:<span class="keyword">self</span>.backgroundColor.CGColor];</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®textLayerçš„å­—ä½“å¤§å°å’Œé¢œè‰²</span></div><div class="line">    <span class="keyword">if</span> (chartData.pointLabelFont != <span class="literal">nil</span>) &#123;</div><div class="line">        [textLayer setFont:(__bridge <span class="built_in">CFTypeRef</span>) (chartData.pointLabelFont)];</div><div class="line">        textLayer.fontSize = [chartData.pointLabelFont pointSize];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®textLayerçš„é«˜åº¦</span></div><div class="line">    <span class="built_in">CGFloat</span> textHeight = (<span class="built_in">CGFloat</span>) (textLayer.fontSize * <span class="number">1.1</span>);</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> textWidth = width * <span class="number">8</span>;</div><div class="line">    <span class="built_in">CGFloat</span> textStartPosY;</div><div class="line">    </div><div class="line">    textStartPosY = pointCenter.y - textLayer.fontSize;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.layer addSublayer:textLayer];</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®textLayerçš„æ–‡å­—æ˜¾ç¤ºæ ¼å¼</span></div><div class="line">    <span class="keyword">if</span> (chartData.pointLabelFormat != <span class="literal">nil</span>) &#123;</div><div class="line">        [textLayer setString:[[<span class="built_in">NSString</span> alloc] initWithFormat:chartData.pointLabelFormat, grade]];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        [textLayer setString:[[<span class="built_in">NSString</span> alloc] initWithFormat:_yLabelFormat, grade]];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®textLayerçš„ä½ç½®å’Œscaleï¼ˆ1xï¼Œ2xï¼Œ3xï¼‰</span></div><div class="line">    [textLayer setFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, textWidth, textHeight)];</div><div class="line">    [textLayer setPosition:<span class="built_in">CGPointMake</span>(pointCenter.x, textStartPosY)];</div><div class="line">    textLayer.contentsScale = [<span class="built_in">UIScreen</span> mainScreen].scale;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> textLayer;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="6-è®¡ç®—æ¯æ¡çº¿æ®µçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰"><a href="#6-è®¡ç®—æ¯æ¡çº¿æ®µçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰" class="headerlink" title="6. è®¡ç®—æ¯æ¡çº¿æ®µçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰"></a>6. è®¡ç®—æ¯æ¡çº¿æ®µçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//éå†å›¾è¡¨é‡Œæ¯æ¡æŠ˜çº¿</span></div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSUInteger</span> lineIndex = <span class="number">0</span>; lineIndex &lt; <span class="keyword">self</span>.chartData.count; lineIndex++) &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//æ¯ä¸€æ¡çº¿æ®µçš„è´å¡å°”æ›²çº¿ï¼ˆUIBezierPathï¼‰ï¼Œç”¨æ•°ç»„è£…èµ·æ¥</span></div><div class="line">    <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">UIBezierPath</span> *&gt; *progressLines = [<span class="built_in">NSMutableArray</span> new];</div><div class="line">    </div><div class="line">    <span class="comment">//chartPathï¼ˆäºŒç»´æ•°ç»„ï¼‰ï¼šä¿å­˜æ‰€æœ‰æŠ˜çº¿ä¸Šæ‰€æœ‰çº¿æ®µçš„è´å¡å°”æ›²çº¿ã€‚ç°åœ¨åªæœ‰ä¸€æ¡æŠ˜çº¿ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªå…ƒç´ </span></div><div class="line">    [chartPath insertObject:progressLines atIndex:lineIndex];</div><div class="line">    </div><div class="line">    <span class="comment">//progressLinePathsçš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸é‡Œå­˜æ”¾æ¯ä¸€æ¡çº¿æ®µçš„ç«¯ç‚¹ï¼ˆfromï¼Œtoï¼‰</span></div><div class="line">    <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSValue</span> *&gt; *&gt; *progressLinePaths = [<span class="built_in">NSMutableArray</span> new];</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> last_x = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> last_y = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//éå†æ¯æ¡æŠ˜çº¿é‡Œçš„æ¯ä¸€æ®µ</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; chartData.itemCount; i++) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">//xï¼Œyçš„ç®—æ³•å‚è€ƒä¸Šæ–‡ç¬¬ä¸‰é¡¹</span></div><div class="line">            <span class="comment">// è®¡ç®—indexä¸º0ä»¥åçš„ç‚¹çš„ä½ç½®</span></div><div class="line">            <span class="keyword">float</span> distance = (<span class="keyword">float</span>) sqrt(pow(x - last_x, <span class="number">2</span>) + pow(y - last_y, <span class="number">2</span>));</div><div class="line">            <span class="keyword">float</span> last_x1 = last_x + (inflexionWidth / <span class="number">2</span>) / distance * (x - last_x);</div><div class="line">            <span class="keyword">float</span> last_y1 = last_y + (inflexionWidth / <span class="number">2</span>) / distance * (y - last_y);</div><div class="line">            <span class="keyword">float</span> x1 = x - (inflexionWidth / <span class="number">2</span>) / distance * (x - last_x);</div><div class="line">            <span class="keyword">float</span> y1 = y - (inflexionWidth / <span class="number">2</span>) / distance * (y - last_y);</div><div class="line">            </div><div class="line">            <span class="comment">//å½“å‰çº¿æ®µçš„ç«¯ç‚¹</span></div><div class="line">            from = [<span class="built_in">NSValue</span> valueWithCGPoint:<span class="built_in">CGPointMake</span>(last_x1, last_y1)];</div><div class="line">            to = [<span class="built_in">NSValue</span> valueWithCGPoint:<span class="built_in">CGPointMake</span>(x1, y1)];</div><div class="line">            </div><div class="line">            </div><div class="line">            <span class="keyword">if</span>(from != <span class="literal">nil</span> &amp;&amp; to != <span class="literal">nil</span>) &#123;</div><div class="line">                <span class="comment">//ä¿å­˜æ¯ä¸€æ®µçš„ç«¯ç‚¹</span></div><div class="line">                [progressLinePaths addObject:@&#123;<span class="string">@"from"</span>: from,  <span class="string">@"to"</span>:to&#125;];</div><div class="line">                <span class="comment">//ä¿å­˜æ‰€æœ‰çš„ç«¯ç‚¹</span></div><div class="line">                [lineStartEndPointsArray addObject:from];</div><div class="line">                [lineStartEndPointsArray addObject:to];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//ä¿å­˜æ‰€æœ‰æŠ˜ç‚¹çš„åæ ‡</span></div><div class="line">            [linePointsArray addObject:[<span class="built_in">NSValue</span> valueWithCGPoint:<span class="built_in">CGPointMake</span>(x, y)]];</div><div class="line">            <span class="comment">//å°†å½“å‰çš„xè½¬åŒ–ä¸ºä¸‹ä¸€ä¸ªç‚¹çš„last_xï¼ˆyä¹Ÿä¸€æ ·ï¼‰</span></div><div class="line">            last_x = x;</div><div class="line">            last_y = y;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//pointsOfPathï¼šä¿å­˜æ‰€æœ‰æŠ˜çº¿é‡Œçš„æ‰€æœ‰çº¿æ®µä¸¤ç«¯çš„ç«¯ç‚¹</span></div><div class="line">    [pointsOfPath addObject:[lineStartEndPointsArray <span class="keyword">copy</span>]];</div><div class="line">    </div><div class="line">    <span class="comment">//æ ¹æ®æ¯ä¸€æ¡çº¿æ®µçš„ä¸¤ä¸ªç«¯ç‚¹ï¼Œæˆç”Ÿæ¯æ¡çº¿æ®µçš„è´å¡å°”æ›²çº¿</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSValue</span> *&gt; *item <span class="keyword">in</span> progressLinePaths) &#123;</div><div class="line">        <span class="built_in">NSArray</span>&lt;<span class="built_in">NSDictionary</span> *&gt; *calculatedRanges =</div><div class="line">        ...</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *range <span class="keyword">in</span> calculatedRanges) &#123;</div><div class="line">            </div><div class="line">            <span class="built_in">UIBezierPath</span> *currentProgressLine = [<span class="built_in">UIBezierPath</span> bezierPath];</div><div class="line">            [currentProgressLine moveToPoint:[range[<span class="string">@"from"</span>] <span class="built_in">CGPointValue</span>]];</div><div class="line">            [currentProgressLine addLineToPoint:[range[<span class="string">@"to"</span>] <span class="built_in">CGPointValue</span>]];</div><div class="line">            [progressLines addObject:currentProgressLine];</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">        &#125;    </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="7-å°†ä¸Šé¢å¾—åˆ°çš„è´å¡å°”æ›²çº¿èµ‹ç»™æ¯æ¡çº¿æ®µå’Œåœ†åœˆçš„layerï¼ˆCAShapeLayerï¼‰ã€‚"><a href="#7-å°†ä¸Šé¢å¾—åˆ°çš„è´å¡å°”æ›²çº¿èµ‹ç»™æ¯æ¡çº¿æ®µå’Œåœ†åœˆçš„layerï¼ˆCAShapeLayerï¼‰ã€‚" class="headerlink" title="7. å°†ä¸Šé¢å¾—åˆ°çš„è´å¡å°”æ›²çº¿èµ‹ç»™æ¯æ¡çº¿æ®µå’Œåœ†åœˆçš„layerï¼ˆCAShapeLayerï¼‰ã€‚"></a>7. å°†ä¸Šé¢å¾—åˆ°çš„è´å¡å°”æ›²çº¿èµ‹ç»™æ¯æ¡çº¿æ®µå’Œåœ†åœˆçš„layerï¼ˆCAShapeLayerï¼‰ã€‚</h3><h4 id="7-1-æ‰€æœ‰çº¿æ®µçš„layerï¼š"><a href="#7-1-æ‰€æœ‰çº¿æ®µçš„layerï¼š" class="headerlink" title="7.1 æ‰€æœ‰çº¿æ®µçš„layerï¼š"></a>7.1 æ‰€æœ‰çº¿æ®µçš„layerï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)populateChartLines &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//éå†æ¯æ¡çº¿æ®µ</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> lineIndex = <span class="number">0</span>; lineIndex &lt; <span class="keyword">self</span>.chartData.count; lineIndex++) &#123;</div><div class="line">        </div><div class="line">        <span class="built_in">NSArray</span>&lt;<span class="built_in">UIBezierPath</span> *&gt; *progressLines = <span class="keyword">self</span>.chartPath[lineIndex];</div><div class="line">        </div><div class="line">        ...</div><div class="line">        </div><div class="line">        <span class="comment">//_chartLineArray:äºŒç»´æ•°ç»„ï¼Œè£…è½½æ¯ä¸ªchartDataå¯¹åº”çš„ä¸€ä¸ªæ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„çš„å…ƒç´ æ˜¯è¿™ä¸€æ¡æŠ˜çº¿ä¸Šæ‰€æœ‰çº¿æ®µå¯¹åº”çš„CAShapeLayer</span></div><div class="line">        [<span class="keyword">self</span>.chartLineArray[lineIndex] removeAllObjects];</div><div class="line">        </div><div class="line">        <span class="built_in">NSUInteger</span> progressLineIndex = <span class="number">0</span>;;</div><div class="line">        </div><div class="line">        <span class="comment">//éå†å«æœ‰UIBezierPathå¯¹è±¡å…ƒç´ çš„æ•°ç»„ã€‚åœ¨æ¯ä¸ªå¾ªç¯é‡Œæ–°å»ºä¸€ä¸ªCAShapeLayerå¯¹è±¡ï¼Œå°†UIBezierPathèµ‹ç»™å®ƒã€‚</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">UIBezierPath</span> *progressLinePath <span class="keyword">in</span> progressLines) &#123;</div><div class="line">            </div><div class="line">            PNLineChartData *chartData = <span class="keyword">self</span>.chartData[lineIndex];</div><div class="line">            <span class="built_in">CAShapeLayer</span> *chartLine = [<span class="built_in">CAShapeLayer</span> layer];</div><div class="line">            </div><div class="line">            ...</div><div class="line">            </div><div class="line">            <span class="comment">//å°†å½“å‰çº¿æ®µçš„UIBezierPathèµ‹ç»™å½“å‰çº¿æ®µçš„CAShapeLayer</span></div><div class="line">            chartLine.path = progressLinePath.CGPath;</div><div class="line">            </div><div class="line">            <span class="comment">//æ·»åŠ layer</span></div><div class="line">            [<span class="keyword">self</span>.layer addSublayer:chartLine];</div><div class="line">            </div><div class="line">            <span class="comment">//ä¿å­˜å½“å‰çº¿æ®µçš„layer</span></div><div class="line">            [<span class="keyword">self</span>.chartLineArray[lineIndex] addObject:chartLine];</div><div class="line">            progressLineIndex++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="7-2-æ‰€æœ‰åœ†åœˆçš„layerï¼š"><a href="#7-2-æ‰€æœ‰åœ†åœˆçš„layerï¼š" class="headerlink" title="7.2 æ‰€æœ‰åœ†åœˆçš„layerï¼š"></a>7.2 æ‰€æœ‰åœ†åœˆçš„layerï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)recreatePointLayers &#123;</div><div class="line">- </div><div class="line">    <span class="keyword">for</span> (PNLineChartData *chartData <span class="keyword">in</span> _chartData) &#123;</div><div class="line">    </div><div class="line">        <span class="comment">// create as many chart line layers as there are data-lines</span></div><div class="line">        [<span class="keyword">self</span>.chartLineArray addObject:[<span class="built_in">NSMutableArray</span> new]];</div><div class="line"></div><div class="line">        <span class="comment">// create point</span></div><div class="line">        <span class="built_in">CAShapeLayer</span> *pointLayer = [<span class="built_in">CAShapeLayer</span> layer];</div><div class="line">        pointLayer.strokeColor = [[chartData.color colorWithAlphaComponent:chartData.alpha] <span class="built_in">CGColor</span>];</div><div class="line">        pointLayer.lineCap = kCALineCapRound;</div><div class="line">        pointLayer.lineJoin = kCALineJoinBevel;</div><div class="line">        pointLayer.fillColor = <span class="literal">nil</span>;</div><div class="line">        pointLayer.lineWidth = chartData.lineWidth;</div><div class="line">        [<span class="keyword">self</span>.layer addSublayer:pointLayer];</div><div class="line">        [<span class="keyword">self</span>.chartPointArray addObject:pointLayer];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å°†æ‰€æœ‰åœ†åœˆçš„<code>UIBezierPath</code>èµ‹ç»™å¯¹åº”çš„<code>layer</code>ï¼Œè€Œæ˜¯åœ¨ä¸‹ä¸€æ­¥ï¼Œç»˜å›¾çš„æ—¶å€™åšçš„ã€‚</p>
</blockquote>
<h3 id="8-ç»˜åˆ¶æ‰€æœ‰æŠ˜çº¿ï¼ˆæ‰€æœ‰çº¿æ®µ-æ‰€æœ‰åœ†åœˆï¼‰-amp-amp-9-æ·»åŠ åŠ¨ç”»"><a href="#8-ç»˜åˆ¶æ‰€æœ‰æŠ˜çº¿ï¼ˆæ‰€æœ‰çº¿æ®µ-æ‰€æœ‰åœ†åœˆï¼‰-amp-amp-9-æ·»åŠ åŠ¨ç”»" class="headerlink" title="8.ç»˜åˆ¶æ‰€æœ‰æŠ˜çº¿ï¼ˆæ‰€æœ‰çº¿æ®µ+æ‰€æœ‰åœ†åœˆï¼‰&amp;&amp; 9. æ·»åŠ åŠ¨ç”»"></a>8.ç»˜åˆ¶æ‰€æœ‰æŠ˜çº¿ï¼ˆæ‰€æœ‰çº¿æ®µ+æ‰€æœ‰åœ†åœˆï¼‰&amp;&amp; 9. æ·»åŠ åŠ¨ç”»</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)strokeChart &#123;</div><div class="line">    </div><div class="line">    ...</div><div class="line">    </div><div class="line">    <span class="comment">// ç»˜åˆ¶æ‰€æœ‰æŠ˜çº¿ï¼ˆæ‰€æœ‰çº¿æ®µ+æ‰€æœ‰åœ†åœˆï¼‰</span></div><div class="line">    <span class="comment">// éå†æ‰€æœ‰æŠ˜çº¿</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> lineIndex = <span class="number">0</span>; lineIndex &lt; <span class="keyword">self</span>.chartData.count; lineIndex++) &#123;</div><div class="line">       </div><div class="line">        PNLineChartData *chartData = <span class="keyword">self</span>.chartData[lineIndex];</div><div class="line">        </div><div class="line">        <span class="comment">//å½“å‰æŠ˜çº¿çš„æ‰€æœ‰çº¿æ®µçš„CAShapeLayer</span></div><div class="line">        <span class="built_in">NSArray</span>&lt;<span class="built_in">CAShapeLayer</span> *&gt; *chartLines =<span class="keyword">self</span>.chartLineArray[lineIndex];</div><div class="line">        </div><div class="line">        <span class="comment">//å½“å‰æŠ˜çº¿çš„æ‰€æœ‰åœ†åœˆçš„CAShapeLayer</span></div><div class="line">        <span class="built_in">CAShapeLayer</span> *pointLayer = (<span class="built_in">CAShapeLayer</span> *) <span class="keyword">self</span>.chartPointArray[lineIndex];</div><div class="line">        </div><div class="line">        <span class="comment">//å¼€å§‹ç»˜åˆ¶æŠ˜çº¿</span></div><div class="line">        <span class="built_in">UIGraphicsBeginImageContext</span>(<span class="keyword">self</span>.frame.size);</div><div class="line">        </div><div class="line">        ...</div><div class="line">        </div><div class="line">        <span class="comment">//å½“å‰æŠ˜çº¿çš„æ‰€æœ‰çº¿æ®µçš„UIBezierPath</span></div><div class="line">        <span class="built_in">NSArray</span>&lt;<span class="built_in">UIBezierPath</span> *&gt; *progressLines = _chartPath[lineIndex];</div><div class="line">        </div><div class="line">        <span class="comment">//å½“å‰æŠ˜çº¿çš„æ‰€æœ‰åœ†åœˆçš„UIBezierPath</span></div><div class="line">        <span class="built_in">UIBezierPath</span> *pointPath = _pointPath[lineIndex];</div><div class="line"></div><div class="line">        <span class="comment">//7.2å°†åœ†åœˆçš„UIBezierPathèµ‹ç»™äº†åœ†åœˆçš„CAShapeLayer</span></div><div class="line">        pointLayer.path = pointPath.CGPath;</div><div class="line"></div><div class="line">        <span class="comment">//æ·»åŠ åŠ¨ç”»</span></div><div class="line">        [<span class="built_in">CATransaction</span> begin];</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> index = <span class="number">0</span>; index &lt; progressLines.count; index++) &#123;</div><div class="line">            <span class="built_in">CAShapeLayer</span> *chartLine = chartLines[index];</div><div class="line">            <span class="comment">//chartLine strokeColor is already set. no need to override here</span></div><div class="line">            [chartLine addAnimation:<span class="keyword">self</span>.pathAnimation forKey:<span class="string">@"strokeEndAnimation"</span>];</div><div class="line">            chartLine.strokeEnd = <span class="number">1.0</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// if you want cancel the point animation, comment this code, the point will show immediately</span></div><div class="line">        <span class="keyword">if</span> (chartData.inflexionPointStyle != PNLineChartPointStyleNone) &#123;</div><div class="line">            [pointLayer addAnimation:<span class="keyword">self</span>.pathAnimation forKey:<span class="string">@"strokeEndAnimation"</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//æäº¤åŠ¨ç”»</span></div><div class="line">        [<span class="built_in">CATransaction</span> commit];</div><div class="line"></div><div class="line">       ...</div><div class="line"></div><div class="line">        <span class="comment">//ç»˜åˆ¶å®Œæ¯•</span></div><div class="line">        <span class="built_in">UIGraphicsEndImageContext</span>();</div><div class="line">    &#125;</div><div class="line">    [<span class="keyword">self</span> setNeedsDisplay];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œè¦æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<blockquote>
<p>1.å¦‚æœæƒ³ç»™layeræ·»åŠ åŠ¨ç”»ï¼Œåªéœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªanimationï¼ˆåœ¨è¿™é‡Œæ˜¯<code>CABasicAnimation</code>ï¼‰å¹¶è°ƒç”¨layerçš„<code>addAnimation:</code>æ–¹æ³•å³å¯ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹å…³äº<code>CABasicAnimation</code>çš„å®ä¾‹åŒ–ä»£ç ï¼š</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CABasicAnimation</span> *)pathAnimation &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.displayAnimated &amp;&amp; !_pathAnimation) &#123;</div><div class="line">        _pathAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"strokeEnd"</span>];</div><div class="line">        <span class="comment">//æŒç»­æ—¶é—´</span></div><div class="line">        _pathAnimation.duration = <span class="number">1.0</span>;</div><div class="line">         <span class="comment">//ç±»å‹</span></div><div class="line">        _pathAnimation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div><div class="line">        _pathAnimation.fromValue = @<span class="number">0.0</span>f;</div><div class="line">        _pathAnimation.toValue = @<span class="number">1.0</span>f;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(!<span class="keyword">self</span>.displayAnimated) &#123;</div><div class="line">        _pathAnimation = <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> _pathAnimation;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>2.åœ¨è¿™é‡Œè°ƒç”¨äº†<code>setNeedsDisplay</code>æ–¹æ³•ä¹‹åï¼Œä¼šè°ƒç”¨<code>drawRectï¼š</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œå®Œæˆäº†xï¼Œyåæ ‡è½´çš„ç»˜åˆ¶ï¼š</p>
</blockquote>
<h3 id="10-ç»˜åˆ¶xï¼Œyåæ ‡è½´"><a href="#10-ç»˜åˆ¶xï¼Œyåæ ‡è½´" class="headerlink" title="10.ç»˜åˆ¶xï¼Œyåæ ‡è½´"></a>10.ç»˜åˆ¶xï¼Œyåæ ‡è½´</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//ç»˜åˆ¶åæ ‡è½´å’ŒèƒŒæ™¯ç«–çº¿</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.isShowCoordinateAxis) &#123;</div><div class="line">        </div><div class="line">        <span class="built_in">CGFloat</span> yAxisOffset = <span class="number">10.</span>f;</div><div class="line">        </div><div class="line">        <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">        <span class="built_in">UIGraphicsPopContext</span>();</div><div class="line">        <span class="built_in">UIGraphicsPushContext</span>(ctx);</div><div class="line">        <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="keyword">self</span>.axisWidth);</div><div class="line">        <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="keyword">self</span>.axisColor <span class="built_in">CGColor</span>]);</div><div class="line">        </div><div class="line">        <span class="built_in">CGFloat</span> xAxisWidth = <span class="built_in">CGRectGetWidth</span>(rect) - (_chartMarginLeft + _chartMarginRight) / <span class="number">2</span>;</div><div class="line">        <span class="built_in">CGFloat</span> yAxisHeight = _chartMarginBottom + _chartCavanHeight;</div><div class="line">        </div><div class="line">        <span class="comment">// ç»˜åˆ¶xyè½´</span></div><div class="line">        <span class="built_in">CGContextMoveToPoint</span>(ctx, _chartMarginBottom + yAxisOffset, <span class="number">0</span>);</div><div class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, _chartMarginBottom + yAxisOffset, yAxisHeight);</div><div class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, xAxisWidth, yAxisHeight);</div><div class="line">        <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">        </div><div class="line">        <span class="comment">// ç»˜åˆ¶yè½´çš„ç®­å¤´</span></div><div class="line">        <span class="built_in">CGContextMoveToPoint</span>(ctx, _chartMarginBottom + yAxisOffset - <span class="number">3</span>, <span class="number">6</span>);</div><div class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, _chartMarginBottom + yAxisOffset, <span class="number">0</span>);</div><div class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, _chartMarginBottom + yAxisOffset + <span class="number">3</span>, <span class="number">6</span>);</div><div class="line">        <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">        </div><div class="line">        <span class="comment">// ç»˜åˆ¶xè½´çš„ç®­å¤´</span></div><div class="line">        <span class="built_in">CGContextMoveToPoint</span>(ctx, xAxisWidth - <span class="number">6</span>, yAxisHeight - <span class="number">3</span>);</div><div class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, xAxisWidth, yAxisHeight);</div><div class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, xAxisWidth - <span class="number">6</span>, yAxisHeight + <span class="number">3</span>);</div><div class="line">        <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">        </div><div class="line">        <span class="comment">//ç»˜åˆ¶xè½´å’Œyè½´çš„label</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.showLabel) &#123;</div><div class="line">            </div><div class="line">            <span class="comment">// ç»˜åˆ¶xè½´çš„å°åˆ†å‰²çº¿</span></div><div class="line">            <span class="built_in">CGPoint</span> point;</div><div class="line">            <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; [<span class="keyword">self</span>.xLabels count]; i++) &#123;</div><div class="line">                point = <span class="built_in">CGPointMake</span>(<span class="number">2</span> * _chartMarginLeft + (i * _xLabelWidth), _chartMarginBottom + _chartCavanHeight);</div><div class="line">                <span class="built_in">CGContextMoveToPoint</span>(ctx, point.x, point.y - <span class="number">2</span>);</div><div class="line">                <span class="built_in">CGContextAddLineToPoint</span>(ctx, point.x, point.y);</div><div class="line">                <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="comment">// ç»˜åˆ¶yè½´çš„å°åˆ†å‰²çº¿</span></div><div class="line">            <span class="built_in">CGFloat</span> yStepHeight = _chartCavanHeight / _yLabelNum;</div><div class="line">            <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; [<span class="keyword">self</span>.xLabels count]; i++) &#123;</div><div class="line">                point = <span class="built_in">CGPointMake</span>(_chartMarginBottom + yAxisOffset, (_chartCavanHeight - i * yStepHeight + _yLabelHeight / <span class="number">2</span>));</div><div class="line">                <span class="built_in">CGContextMoveToPoint</span>(ctx, point.x, point.y);</div><div class="line">                <span class="built_in">CGContextAddLineToPoint</span>(ctx, point.x + <span class="number">2</span>, point.y);</div><div class="line">                <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">UIFont</span> *font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">11</span>];</div><div class="line">        </div><div class="line">        <span class="comment">// ç»˜åˆ¶yè½´å•ä½</span></div><div class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span>.yUnit length]) &#123;</div><div class="line">            <span class="built_in">CGFloat</span> height = [PNLineChart sizeOfString:<span class="keyword">self</span>.yUnit withWidth:<span class="number">30.</span>f font:font].height;</div><div class="line">            <span class="built_in">CGRect</span> drawRect = <span class="built_in">CGRectMake</span>(_chartMarginLeft + <span class="number">10</span> + <span class="number">5</span>, <span class="number">0</span>, <span class="number">30.</span>f, height);</div><div class="line">            [<span class="keyword">self</span> drawTextInContext:ctx text:<span class="keyword">self</span>.yUnit inRect:drawRect font:font color:<span class="keyword">self</span>.yLabelColor];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">// ç»˜åˆ¶xè½´çš„å•ä½</span></div><div class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span>.xUnit length]) &#123;</div><div class="line">            <span class="built_in">CGFloat</span> height = [PNLineChart sizeOfString:<span class="keyword">self</span>.xUnit withWidth:<span class="number">30.</span>f font:font].height;</div><div class="line">            <span class="built_in">CGRect</span> drawRect = <span class="built_in">CGRectMake</span>(<span class="built_in">CGRectGetWidth</span>(rect) - _chartMarginLeft + <span class="number">5</span>, _chartMarginBottom + _chartCavanHeight - height / <span class="number">2</span>, <span class="number">25.</span>f, height);</div><div class="line">            [<span class="keyword">self</span> drawTextInContext:ctx text:<span class="keyword">self</span>.xUnit inRect:drawRect font:font color:<span class="keyword">self</span>.xLabelColor];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//ç»˜åˆ¶ç«–çº¿</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.showYGridLines) &#123;</div><div class="line">        <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">        <span class="built_in">CGFloat</span> yAxisOffset = _showLabel ? <span class="number">10.</span>f : <span class="number">0.0</span>f;</div><div class="line">        <span class="built_in">CGPoint</span> point;</div><div class="line">        </div><div class="line">        <span class="comment">//æ¯ä¸€æ¡ç«–çº¿çš„è·¨åº¦</span></div><div class="line">        <span class="built_in">CGFloat</span> yStepHeight = _chartCavanHeight / _yLabelNum;</div><div class="line">        </div><div class="line">        <span class="comment">//é¢œè‰²</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.yGridLinesColor) &#123;</div><div class="line">            <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, <span class="keyword">self</span>.yGridLinesColor.CGColor);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> lightGrayColor].CGColor);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//ç»˜åˆ¶æ¯ä¸€æ¡ç«–çº¿</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; _yLabelNum; i++) &#123;</div><div class="line">            </div><div class="line">            <span class="comment">//æ‹¿åˆ°èµ·ç‚¹</span></div><div class="line">            point = <span class="built_in">CGPointMake</span>(_chartMarginLeft + yAxisOffset, (_chartCavanHeight - i * yStepHeight + _yLabelHeight / <span class="number">2</span>));</div><div class="line">            </div><div class="line">            <span class="comment">//å°†ç”»ç¬”ç§»åŠ¨åˆ°èµ·ç‚¹</span></div><div class="line">            <span class="built_in">CGContextMoveToPoint</span>(ctx, point.x, point.y);</div><div class="line">            </div><div class="line">            <span class="comment">//è®¾ç½®çº¿çš„å±æ€§</span></div><div class="line">            <span class="built_in">CGFloat</span> dash[] = &#123;<span class="number">6</span>, <span class="number">5</span>&#125;;</div><div class="line">            <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">0.5</span>);</div><div class="line">            <span class="built_in">CGContextSetLineCap</span>(ctx, kCGLineCapRound);</div><div class="line">            <span class="built_in">CGContextSetLineDash</span>(ctx, <span class="number">0.0</span>, dash, <span class="number">2</span>);</div><div class="line">            </div><div class="line">            <span class="comment">//è®¾ç½®è¿™æ¡çº¿çš„ç»ˆç‚¹</span></div><div class="line">            <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="built_in">CGRectGetWidth</span>(rect) - _chartMarginLeft + <span class="number">5</span>, point.y);</div><div class="line">            </div><div class="line">            <span class="comment">//ç”»çº¿</span></div><div class="line">            <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    [<span class="keyword">super</span> drawRect:rect];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œï¼Œä¸€å¼ å®Œæ•´çš„å›¾è¡¨å°±å¯ä»¥ç”»å‡ºæ¥äº†ã€‚ä½†æ˜¯å½“å‰ç»˜åˆ¶çš„å›¾è¡¨çš„æŠ˜çº¿éƒ½æ˜¯ç›´çº¿ï¼Œåœ¨ä¸Šé¢è¿˜å±•ç¤ºäº†ä¸€å¼ æ›²çº¿å›¾ã€‚é‚£ä¹ˆå¦‚æœæƒ³ç»˜åˆ¶å¸¦æœ‰æ›²çº¿çš„æŠ˜çº¿å›¾åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¯¹ï¼Œå°±æ˜¯åœ¨è´å¡å°”æ›²çº¿ä¸Šä¸‹åŠŸå¤«ã€‚</p>
<p>å½“æˆ‘ä»¬è·å–äº†æ‰€æœ‰çº¿æ®µçš„ç«¯ç‚¹æ•°ç»„åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»–ä»¬ç»˜åˆ¶å¼¯æ›²çš„è´å¡å°”æ›²çº¿ï¼ˆæ³¨æ„ï¼šè¯¥æ–¹æ³•æ˜¯å¯¹åº”ä¸Šé¢å¯¹ç¬¬6é¡¹çš„ä¸‹åŠéƒ¨åˆ†:ç”Ÿæˆæ¯ä¸€ä¸ªçº¿æ®µå¯¹è´å¡å°”æ›²çº¿ï¼‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//_showSmoothLinesæ˜¯ç”¨æ¥æ§åˆ¶æ˜¯å¦ç»˜åˆ¶æ›²çº¿æŠ˜çº¿çš„å¼€å…³å±æ€§</span></div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.showSmoothLines &amp;&amp; chartData.itemCount &gt;= <span class="number">4</span>) &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSValue</span> *&gt; *item <span class="keyword">in</span> progressLinePaths) &#123;</div><div class="line">        </div><div class="line">        ...</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *range <span class="keyword">in</span> calculatedRanges) &#123;</div><div class="line">            </div><div class="line">            <span class="built_in">UIBezierPath</span> *currentProgressLine = [<span class="built_in">UIBezierPath</span> bezierPath];</div><div class="line">            <span class="built_in">CGPoint</span> segmentP1 = [range[<span class="string">@"from"</span>] <span class="built_in">CGPointValue</span>];</div><div class="line">            <span class="built_in">CGPoint</span> segmentP2 = [range[<span class="string">@"to"</span>] <span class="built_in">CGPointValue</span>];</div><div class="line">            </div><div class="line">            [currentProgressLine moveToPoint:segmentP1];</div><div class="line">            </div><div class="line">            <span class="built_in">CGPoint</span> midPoint = [PNLineChart midPointBetweenPoint1:segmentP1 andPoint2:segmentP2];</div><div class="line">            </div><div class="line">            <span class="comment">//ä»¥æ¯æ¡çº¿æ®µä»¥ä¸­é—´ç‚¹ä¸ºåˆ†å‰²ç‚¹ï¼Œåˆ†æˆä¸¤ç»„ã€‚æ¯ä¸€ç»„å½¢æˆæŸ”å’Œçš„å¤–å‡¸æ›²çº¿ï¼Œè€Œä¸æ˜¯å†…å‡¹</span></div><div class="line">            [currentProgressLine addQuadCurveToPoint:midPoint</div><div class="line">                                        controlPoint:[PNLineChart controlPointBetweenPoint1:midPoint andPoint2:segmentP1]];</div><div class="line">            </div><div class="line">            [currentProgressLine addQuadCurveToPoint:segmentP2</div><div class="line">                                        controlPoint:[PNLineChart controlPointBetweenPoint1:midPoint andPoint2:segmentP2]];</div><div class="line">            </div><div class="line">            [progressLines addObject:currentProgressLine];</div><div class="line">            [progressLineColors addObject:range[<span class="string">@"color"</span>]];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ä¸€ä¸‹ç”Ÿæˆå¼¯æ›²çš„è´å¡å°”æ›²çº¿çš„æ–¹æ³•ï¼š<code>controlPointBetweenPoint1:andPoint2</code>:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è¿”å›çš„ç‚¹çš„xï¼šæ˜¯ä¸¤ç‚¹çš„ä¸­é—´ï¼›è¿”å›çš„ç‚¹çš„yï¼šä¸ç¬¬äºŒä¸ªç‚¹ä¿æŒä¸€è‡´</span></div><div class="line">+ (<span class="built_in">CGPoint</span>)controlPointBetweenPoint1:(<span class="built_in">CGPoint</span>)point1 andPoint2:(<span class="built_in">CGPoint</span>)point2 &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//çº¿æ®µä¸¤ç«¯çš„ä¸­é—´ç‚¹</span></div><div class="line">    <span class="built_in">CGPoint</span> controlPoint = [<span class="keyword">self</span> midPointBetweenPoint1:point1 andPoint2:point2];</div><div class="line">    </div><div class="line">    <span class="comment">//æœ«ç«¯ç‚¹ å’Œ  ä¸­é—´ç‚¹yçš„å·®</span></div><div class="line">    <span class="built_in">CGFloat</span> diffY = abs((<span class="keyword">int</span>) (point2.y - controlPoint.y));</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (point1.y &lt; point2.y)</div><div class="line">    <span class="comment">//å¦‚æœå‰ç«¯ç‚¹æ›´é«˜</span></div><div class="line">        controlPoint.y += diffY;</div><div class="line">    </div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (point1.y &gt; point2.y)</div><div class="line">    <span class="comment">//å¦‚æœåç«¯ç‚¹æ›´é«˜</span></div><div class="line">        controlPoint.y -= diffY;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> controlPoint;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>OKï¼Œè¿™æ ·ä¸€æ¥ï¼Œç›´çº¿çš„æ›²çº¿å›¾è¿˜æœ‰æ›²çº¿çš„æ›²çº¿å›¾å°±å¤§æ¦‚æŒæ¡äº†ã€‚ä¸è¿‡è¿˜å·®ä¸€ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯å›¾è¡¨å¯¹ç‚¹å‡»çš„å“åº”ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦æ€è€ƒä¸€ä¸‹ï¼šæ—¢ç„¶ä¸€å¼ å›¾è¡¨é‡Œå¯ä»¥æ˜¾ç¤ºå¤šæ¡æŠ˜çº¿ï¼Œæ‰€ä»¥ï¼Œå½“æ‰‹æŒ‡ç‚¹å‡»å›¾è¡¨ä¸Šçš„ç‚¹ä»¥åï¼Œåº”è¯¥åŒæ—¶è¿”å›ä¸¤ä¸ªæ•°æ®ï¼š</p>
<ol>
<li>ç‚¹å‡»äº†å“ªæ¡æŠ˜çº¿ä¸Šçš„è¿™ä¸ªç‚¹ã€‚</li>
<li>ç‚¹å‡»äº†è¿™æ¡æŠ˜çº¿ä¸Šçš„å“ªä¸ªç‚¹ã€‚</li>
</ol>
<p>è¯¥æ¡†æ¶çš„ä½œè€…å¾ˆå¥½åœ°å®Œæˆäº†è¿™ä¸¤ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»–æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p>
<h3 id="å“åº”ç‚¹å‡»çš„ä»£ç†æ–¹æ³•"><a href="#å“åº”ç‚¹å‡»çš„ä»£ç†æ–¹æ³•" class="headerlink" title="å“åº”ç‚¹å‡»çš„ä»£ç†æ–¹æ³•"></a>å“åº”ç‚¹å‡»çš„ä»£ç†æ–¹æ³•</h3><h4 id="ç‚¹å‡»äº†å“ªæ¡æŠ˜çº¿çš„åˆ¤æ–­"><a href="#ç‚¹å‡»äº†å“ªæ¡æŠ˜çº¿çš„åˆ¤æ–­" class="headerlink" title="ç‚¹å‡»äº†å“ªæ¡æŠ˜çº¿çš„åˆ¤æ–­"></a>ç‚¹å‡»äº†å“ªæ¡æŠ˜çº¿çš„åˆ¤æ–­</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)touchPoint:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    <span class="comment">// Get the point user touched</span></div><div class="line">    <span class="built_in">UITouch</span> *touch = [touches anyObject];</div><div class="line">    <span class="built_in">CGPoint</span> touchPoint = [touch locationInView:<span class="keyword">self</span>];</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> p = <span class="number">0</span>; p &lt; _pathPoints.count; p++) &#123;</div><div class="line">        </div><div class="line">        <span class="built_in">NSArray</span> *linePointsArray = _endPointsOfPath[p];</div><div class="line">        </div><div class="line">        <span class="comment">//éå†æ¯ä¸ªç«¯ç‚¹</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>) linePointsArray.count - <span class="number">1</span>; i += <span class="number">2</span>) &#123;</div><div class="line">            </div><div class="line">            <span class="built_in">CGPoint</span> p1 = [linePointsArray[i] <span class="built_in">CGPointValue</span>];</div><div class="line">            <span class="built_in">CGPoint</span> p2 = [linePointsArray[i + <span class="number">1</span>] <span class="built_in">CGPointValue</span>];</div><div class="line">            </div><div class="line">            <span class="comment">// Closest distance from point to line</span></div><div class="line">            <span class="comment">//è§¦æ‘¸ç‚¹åˆ°çº¿æ®µçš„è·ç¦»</span></div><div class="line">            <span class="keyword">float</span> distance = (<span class="keyword">float</span>) fabs(((p2.x - p1.x) * (touchPoint.y - p1.y)) - ((p1.x - touchPoint.x) * (p1.y - p2.y)));</div><div class="line">            distance /= hypot(p2.x - p1.x, p1.y - p2.y);</div><div class="line">            </div><div class="line">            <span class="comment">//å¦‚æœè·ç¦»å°äº5ï¼Œåˆ™åˆ¤æ–­ä¸ºâ€œç‚¹å‡»äº†å½“å‰çš„çº¿æ®µâ€ï¼Œå‰©ä¸‹çš„å·¥ä½œæ˜¯åˆ¤æ–­å…·ä½“ç‚¹å‡»äº†å“ªä¸€æ¡çº¿æ®µ</span></div><div class="line">            <span class="keyword">if</span> (distance &lt;= <span class="number">5.0</span>) &#123;</div><div class="line">                <span class="comment">// Conform to delegate parameters, figure out what bezier path this CGPoint belongs to.</span></div><div class="line">                <span class="built_in">NSUInteger</span> lineIndex = <span class="number">0</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="built_in">NSArray</span>&lt;<span class="built_in">UIBezierPath</span> *&gt; *paths <span class="keyword">in</span> _chartPath) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="built_in">UIBezierPath</span> *path <span class="keyword">in</span> paths) &#123;</div><div class="line">                        <span class="comment">//å¦‚æœå½“å‰ç‚¹å¤„äºUIBezierPathæ›²çº¿ä¸Š</span></div><div class="line">                        <span class="built_in">BOOL</span> pointContainsPath = <span class="built_in">CGPathContainsPoint</span>(path.CGPath, <span class="literal">NULL</span>, p1, <span class="literal">NO</span>);</div><div class="line">                        <span class="keyword">if</span> (pointContainsPath) &#123;</div><div class="line">                            <span class="comment">//ç‚¹å‡»äº†æŸä¸€æ¡æŠ˜çº¿</span></div><div class="line">                            [_delegate userClickedOnLinePoint:touchPoint lineIndex:lineIndex];</div><div class="line">                            <span class="keyword">return</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    lineIndex++;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç‚¹å‡»äº†å“ªä¸ªç‚¹çš„åˆ¤æ–­"><a href="#ç‚¹å‡»äº†å“ªä¸ªç‚¹çš„åˆ¤æ–­" class="headerlink" title="ç‚¹å‡»äº†å“ªä¸ªç‚¹çš„åˆ¤æ–­"></a>ç‚¹å‡»äº†å“ªä¸ªç‚¹çš„åˆ¤æ–­</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)touchKeyPoint:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    <span class="comment">// Get the point user touched</span></div><div class="line">    <span class="built_in">UITouch</span> *touch = [touches anyObject];</div><div class="line">    <span class="built_in">CGPoint</span> touchPoint = [touch locationInView:<span class="keyword">self</span>];</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> p = <span class="number">0</span>; p &lt; _pathPoints.count; p++) &#123;</div><div class="line">        <span class="built_in">NSArray</span> *linePointsArray = _pathPoints[p];</div><div class="line">        </div><div class="line">        <span class="comment">//éå†æ‰€æœ‰çš„ç‚¹</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>) linePointsArray.count - <span class="number">1</span>; i += <span class="number">1</span>) &#123;</div><div class="line">            </div><div class="line">            <span class="built_in">CGPoint</span> p1 = [linePointsArray[i] <span class="built_in">CGPointValue</span>];</div><div class="line">            <span class="built_in">CGPoint</span> p2 = [linePointsArray[i + <span class="number">1</span>] <span class="built_in">CGPointValue</span>];</div><div class="line">            </div><div class="line">            <span class="comment">//è·å–åˆ°å‰ä¸€ç‚¹çš„è·ç¦»å’Œåä¸€ç‚¹çš„è·ç¦»</span></div><div class="line">            <span class="keyword">float</span> distanceToP1 = (<span class="keyword">float</span>) fabs(hypot(touchPoint.x - p1.x, touchPoint.y - p1.y));</div><div class="line">            <span class="keyword">float</span> distanceToP2 = (<span class="keyword">float</span>) hypot(touchPoint.x - p2.x, touchPoint.y - p2.y);</div><div class="line">            </div><div class="line">            <span class="keyword">float</span> distance = MIN(distanceToP1, distanceToP2);</div><div class="line">            </div><div class="line">            <span class="comment">//å¦‚æœè¾ƒå°çš„è·ç¦»å°äº10ï¼Œåˆ™åˆ¤å®šä¸ºç‚¹å‡»äº†æŸä¸ªç‚¹</span></div><div class="line">            <span class="keyword">if</span> (distance &lt;= <span class="number">10.0</span>) &#123;</div><div class="line">                <span class="comment">//ç‚¹å‡»äº†æŸä¸€æ¡æŠ˜çº¿ä¸Šçš„æŸä¸ªç‚¹</span></div><div class="line">                [_delegate userClickedOnLineKeyPoint:touchPoint</div><div class="line">                                           lineIndex:p</div><div class="line">                                          pointIndex:(distance == distanceToP2 ? i + <span class="number">1</span> : i)];</div><div class="line">                </div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸‹å°±å®Œæ•´äº†ï¼Œä¸€ä¸ªå¸¦æœ‰å“åº”åŠŸèƒ½çš„å›¾è¡¨å°±åšå¥½å•¦ï¼</p>
<h3 id="å…³äºè‡ªå®šä¹‰UIView"><a href="#å…³äºè‡ªå®šä¹‰UIView" class="headerlink" title="å…³äºè‡ªå®šä¹‰UIView"></a>å…³äºè‡ªå®šä¹‰UIView</h3><p>è¿™é‡Œåªæ˜¯å°†å›¾è¡¨çš„<code>layer</code>åŠ åœ¨äº†<code>UIView</code>çš„layerä¸Šï¼Œé‚£å¦‚æœæƒ³å®Œå…¨è‡ªå®šä¹‰viewçš„è¯ï¼Œåªéœ€å°†å›¾è¡¨çš„<code>layer</code>å®Œå…¨èµ‹ç»™<code>UIView</code>çš„layerå³å¯ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæƒ³è¦ç”»å‡ºä»»æ„å½¢çŠ¶çš„<code>UIView</code>éƒ½å¯ä»¥ã€‚</p>
<hr>
<h2 id="ä¸‰-æœ€åçš„è¯"><a href="#ä¸‰-æœ€åçš„è¯" class="headerlink" title="ä¸‰. æœ€åçš„è¯"></a>ä¸‰. æœ€åçš„è¯</h2><p>å…³äºå›¾è¡¨çš„ç»˜åˆ¶ï¼Œç›¸å¯¹è´å¡å°”æ›²çº¿ä¸<code>CALayer</code>æ¥è¯´ï¼Œæ•°æ®çš„å¤„ç†æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„ç‚¹ã€‚ä½†æ˜¯ä¸€æ—¦å­¦ä¼šäº†æŠ˜çº¿å›¾çš„ç»˜åˆ¶ï¼Œäº†è§£äº†ç»˜å›¾åŸç†ï¼Œé‚£ä¹ˆå…¶ä»–ç±»å‹çš„å›¾è¡¨å°±å¯ä»¥è§¦ç±»æ—é€šã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€-æ¡†æ¶ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä¸€-æ¡†æ¶ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. æ¡†æ¶ä»‹ç»&quot;&gt;&lt;/a&gt;ä¸€. æ¡†æ¶ä»‹ç»&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/kevinzhow/PNChart&quot;&gt;PNChart&lt;/a&gt;æ˜¯å›½å†…å¼€å‘è€…å¼€å‘çš„iOSå›¾è¡¨æ¡†æ¶ï¼Œç°åœ¨å·²ç»7900å¤šé¢—staräº†ã€‚å®ƒæ¶µç›–äº†æŠ˜çº¿å›¾ï¼ŒæŸ±çŠ¶å›¾ï¼Œé¥¼å›¾ï¼Œæ•£ç‚¹å›¾ç­‰å›¾è¡¨ã€‚å›¾è¡¨çš„å¯å®šåˆ¶æ€§å¾ˆé«˜ï¼Œè€Œä¸”UIè®¾è®¡ç®€æ´å¤§æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ¡†æ¶åˆ†ä¸ºä¸¤å±‚ï¼šè§†å›¾å±‚å’Œæ•°æ®å±‚ã€‚è§†å›¾å±‚é‡Œæœ‰ä¸¤å±‚ç»§æ‰¿å…³ç³»ï¼Œç¬¬ä¸€å±‚æ˜¯æ‰€æœ‰ç±»å‹å›¾è¡¨çš„çˆ¶ç±»&lt;code&gt;PNGenericChart&lt;/code&gt;,ç¬¬äºŒå±‚å°±æ˜¯æ‰€æœ‰ç±»å‹çš„å›¾è¡¨ã€‚æä¾›ä¸€å¼ å›¾æ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://oih3a9o4n.bkt.clouddn.com/PNChart_00.png&quot; alt=&quot;å±‚çº§å›¾&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨è¿™å¼ å›¾é‡Œï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¸¦ç®­å¤´çš„çº¿å’Œä¸å¸¦ç®­å¤´çš„çº¿çš„åŒºåˆ«ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Data&lt;/code&gt;ç±»å¯¹åº”å›¾è¡¨çš„ä¸€ç»„æ•°æ®ï¼Œå› ä¸ºå½“å‰ç±»å‹çš„å›¾è¡¨æ”¯æŒå¤šç»„æ•°æ®ï¼ˆä¾‹å¦‚ï¼šé¥¼çŠ¶å›¾æ²¡æœ‰&lt;code&gt;Data&lt;/code&gt;ç±»ï¼Œå› ä¸ºé¥¼çŠ¶å›¾æ²¡æœ‰å¤šç»„æ•°æ®ï¼Œè€ŒæŠ˜çº¿å›¾&lt;code&gt;LineChart&lt;/code&gt;æ˜¯æ”¯æŒå¤šç»„æ•°æ®çš„ï¼Œæ‰€ä»¥æœ‰&lt;code&gt;Data&lt;/code&gt;ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Item&lt;/code&gt;ç±»è´Ÿè´£å°†ä¼ å…¥å›¾è¡¨çš„æŸä¸ªçœŸå®å€¼è½¬åŒ–ä¸ºå›¾è¡¨ä¸­æ˜¾ç¤ºçš„å€¼ï¼Œå…·ä½“åšæ³•ä¼šåœ¨ä¸‹æ–‡è¯¦ç»†è®²è§£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BarChart&lt;/code&gt;ç±»é‡Œé¢çš„æ¯ä¸€æ ¹æŸ±å­éƒ½æ˜¯&lt;code&gt;PNBar&lt;/code&gt;çš„å®ä¾‹ï¼ˆè¯¥ç±»å‹çš„å›¾è¡¨ä¸åœ¨æœ¬ç¯‡è®²è§£çš„èŒƒå›´ä¹‹å†…ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
      <category term="æºç è§£æ" scheme="https://github.com/knightsj/knightsj.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>MJRefreshæºç è§£æ</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/02/04/MJRefresh%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/02/04/MJRefresh æºç è§£æ/</id>
    <published>2017-02-04T01:30:17.000Z</published>
    <updated>2017-03-20T07:56:49.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/CoderMJLee/MJRefresh">MJRefresh</a>æ˜¯ææ˜æ°è€å¸ˆçš„ä½œå“ï¼Œåˆ°ç°åœ¨å·²ç»æœ‰9800å¤šé¢—staräº†ï¼Œæ˜¯ä¸€ä¸ªç®€å•å®ç”¨ï¼ŒåŠŸèƒ½å¼ºå¤§çš„iOSä¸‹æ‹‰åˆ·æ–°ï¼ˆä¹Ÿæ”¯æŒä¸Šæ‹‰åŠ è½½æ›´å¤šï¼‰æ§ä»¶ã€‚å®ƒçš„å¯å®šåˆ¶æ€§å¾ˆé«˜ï¼Œå‡ ä¹å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†ä¸‹æ‹‰åˆ·æ–°çš„è®¾è®¡éœ€æ±‚ï¼Œå€¼å¾—å­¦ä¹ ã€‚</p>
<p>è¯¥æ¡†æ¶çš„ç»“æ„è®¾è®¡å¾—å¾ˆæ¸…æ™°ï¼Œä½¿ç”¨ä¸€ä¸ªåŸºç±»<code>MJRefreshComponent</code>æ¥åšä¸€äº›åŸºæœ¬çš„è®¾å®šï¼Œç„¶åé€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œè®©<code>MJRefreshHeader</code>å’Œ<code>MJRefreshFooter</code>åˆ†åˆ«å…·å¤‡ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½çš„åŠŸèƒ½ã€‚ä»ç»§æ‰¿æœºæ„æ¥çœ‹å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼Œå…·ä½“å¯ä»¥ä»ä¸‹é¢çš„å›¾é‡Œçœ‹å‡ºæ¥ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/MJRefresh_1.png" alt="æ¡†æ¶ç»„ç»‡ç»“æ„å›¾"></p>
<a id="more"></a>
<p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹è¯¥æ§ä»¶çš„åŸºç±»ï¼šMJRefreshComponentï¼š</p>
<h2 id="MJRefreshComponent"><a href="#MJRefreshComponent" class="headerlink" title="MJRefreshComponent"></a>MJRefreshComponent</h2><p>è¿™ä¸ªç±»ä½œä¸ºè¯¥æ§ä»¶å‡ ç±»ï¼Œæ¶µç›–äº†åŸºç±»æ‰€å…·å¤‡çš„æˆä»½ï¼šçŠ¶æ€ï¼Œå›è°ƒblockç­‰ï¼Œå¤§è‡´åˆ†æˆä¸‹é¢è¿™5ç§èŒèƒ½ï¼š</p>
<h3 id="æœ‰å“ªäº›èŒèƒ½"><a href="#æœ‰å“ªäº›èŒèƒ½" class="headerlink" title="æœ‰å“ªäº›èŒèƒ½?"></a>æœ‰å“ªäº›èŒèƒ½?</h3><ol>
<li>å£°æ˜æ§ä»¶çš„æ‰€æœ‰çŠ¶æ€ã€‚</li>
<li>å£°æ˜æ§ä»¶çš„å›è°ƒå‡½æ•°ã€‚</li>
<li>æ·»åŠ ç›‘å¬ã€‚</li>
<li>æä¾›åˆ·æ–°ï¼Œåœæ­¢åˆ·æ–°æ¥å£ã€‚</li>
<li>æä¾›å­ç±»éœ€è¦å®ç°çš„æ–¹æ³•ã€‚</li>
</ol>
<h3 id="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ"><a href="#èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ"></a>èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ</h3><h4 id="1-å£°æ˜æ§ä»¶çš„æ‰€æœ‰çŠ¶æ€"><a href="#1-å£°æ˜æ§ä»¶çš„æ‰€æœ‰çŠ¶æ€" class="headerlink" title="1. å£°æ˜æ§ä»¶çš„æ‰€æœ‰çŠ¶æ€"></a>1. å£°æ˜æ§ä»¶çš„æ‰€æœ‰çŠ¶æ€</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** åˆ·æ–°æ§ä»¶çš„çŠ¶æ€ */</span></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, MJRefreshState) &#123;</div><div class="line">    <span class="comment">/** æ™®é€šé—²ç½®çŠ¶æ€ */</span></div><div class="line">    MJRefreshStateIdle = <span class="number">1</span>,</div><div class="line">    <span class="comment">/** æ¾å¼€å°±å¯ä»¥è¿›è¡Œåˆ·æ–°çš„çŠ¶æ€ */</span></div><div class="line">    MJRefreshStatePulling,</div><div class="line">    <span class="comment">/** æ­£åœ¨åˆ·æ–°ä¸­çš„çŠ¶æ€ */</span></div><div class="line">    MJRefreshStateRefreshing,</div><div class="line">    <span class="comment">/** å³å°†åˆ·æ–°çš„çŠ¶æ€ */</span></div><div class="line">    MJRefreshStateWillRefresh,</div><div class="line">    <span class="comment">/** æ‰€æœ‰æ•°æ®åŠ è½½å®Œæ¯•ï¼Œæ²¡æœ‰æ›´å¤šçš„æ•°æ®äº† */</span></div><div class="line">    MJRefreshStateNoMoreData</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="2-å£°æ˜æ§ä»¶çš„å›è°ƒå‡½æ•°"><a href="#2-å£°æ˜æ§ä»¶çš„å›è°ƒå‡½æ•°" class="headerlink" title="2. å£°æ˜æ§ä»¶çš„å›è°ƒå‡½æ•°"></a>2. å£°æ˜æ§ä»¶çš„å›è°ƒå‡½æ•°</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** è¿›å…¥åˆ·æ–°çŠ¶æ€çš„å›è°ƒ */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^MJRefreshComponentRefreshingBlock)();</div><div class="line"><span class="comment">/** å¼€å§‹åˆ·æ–°åçš„å›è°ƒ(è¿›å…¥åˆ·æ–°çŠ¶æ€åçš„å›è°ƒ) */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^MJRefreshComponentbeginRefreshingCompletionBlock)();</div><div class="line"><span class="comment">/** ç»“æŸåˆ·æ–°åçš„å›è°ƒ */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^MJRefreshComponentEndRefreshingCompletionBlock)();</div></pre></td></tr></table></figure>
<h4 id="3-æ·»åŠ ç›‘å¬"><a href="#3-æ·»åŠ ç›‘å¬" class="headerlink" title="3. æ·»åŠ ç›‘å¬"></a>3. æ·»åŠ ç›‘å¬</h4><p>ç›‘å¬çš„å£°æ˜ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)addObservers</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</div><div class="line">    [<span class="keyword">self</span>.scrollView addObserver:<span class="keyword">self</span> forKeyPath:MJRefreshKeyPathContentOffset options:options context:<span class="literal">nil</span>];<span class="comment">//contentOffsetå±æ€§</span></div><div class="line">    [<span class="keyword">self</span>.scrollView addObserver:<span class="keyword">self</span> forKeyPath:MJRefreshKeyPathContentSize options:options context:<span class="literal">nil</span>];<span class="comment">//contentSizeå±æ€§</span></div><div class="line">    <span class="keyword">self</span>.pan = <span class="keyword">self</span>.scrollView.panGestureRecognizer;</div><div class="line">    [<span class="keyword">self</span>.pan addObserver:<span class="keyword">self</span> forKeyPath:MJRefreshKeyPathPanState options:options context:<span class="literal">nil</span>];<span class="comment">//UIPanGestureRecognizer çš„stateå±æ€§</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯¹äºç›‘å¬çš„å¤„ç†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span> *)change context:(<span class="keyword">void</span> *)context</div><div class="line">&#123;</div><div class="line">    <span class="comment">// é‡åˆ°è¿™äº›æƒ…å†µå°±ç›´æ¥è¿”å›</span></div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.userInteractionEnabled) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="comment">// è¿™ä¸ªå°±ç®—çœ‹ä¸è§ä¹Ÿéœ€è¦å¤„ç†</span></div><div class="line">    <span class="keyword">if</span> ([keyPath isEqualToString:MJRefreshKeyPathContentSize]) &#123;</div><div class="line">        [<span class="keyword">self</span> scrollViewContentSizeDidChange:change];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// çœ‹ä¸è§</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.hidden) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ([keyPath isEqualToString:MJRefreshKeyPathContentOffset]) &#123;</div><div class="line">        [<span class="keyword">self</span> scrollViewContentOffsetDidChange:change];</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:MJRefreshKeyPathPanState]) &#123;</div><div class="line">        [<span class="keyword">self</span> scrollViewPanStateDidChange:change];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="4-æä¾›åˆ·æ–°ï¼Œåœæ­¢åˆ·æ–°æ¥å£"><a href="#4-æä¾›åˆ·æ–°ï¼Œåœæ­¢åˆ·æ–°æ¥å£" class="headerlink" title="4. æä¾›åˆ·æ–°ï¼Œåœæ­¢åˆ·æ–°æ¥å£"></a>4. æä¾›åˆ·æ–°ï¼Œåœæ­¢åˆ·æ–°æ¥å£</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#pragma mark è¿›å…¥åˆ·æ–°çŠ¶æ€</span></div><div class="line">- (<span class="keyword">void</span>)beginRefreshingWithCompletionBlock:(<span class="keyword">void</span> (^)())completionBlock</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.beginRefreshingCompletionBlock = completionBlock;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> beginRefreshing];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)beginRefreshing</div><div class="line">&#123;</div><div class="line">    [<span class="built_in">UIView</span> animateWithDuration:MJRefreshFastAnimationDuration animations:^&#123;</div><div class="line">        <span class="keyword">self</span>.alpha = <span class="number">1.0</span>;</div><div class="line">    &#125;];</div><div class="line">    <span class="keyword">self</span>.pullingPercent = <span class="number">1.0</span>;</div><div class="line">    <span class="comment">// åªè¦æ­£åœ¨åˆ·æ–°ï¼Œå°±å®Œå…¨æ˜¾ç¤º</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.window) &#123;</div><div class="line">        <span class="comment">//å°†çŠ¶æ€åˆ‡æ¢ä¸ºæ­£åœ¨åˆ·æ–°</span></div><div class="line">        <span class="keyword">self</span>.state = MJRefreshStateRefreshing;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// é¢„é˜²æ­£åœ¨åˆ·æ–°ä¸­æ—¶ï¼Œè°ƒç”¨æœ¬æ–¹æ³•ä½¿å¾—header insetå›ç½®å¤±è´¥</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.state != MJRefreshStateRefreshing) &#123;</div><div class="line">            <span class="comment">//å°†çŠ¶æ€åˆ‡æ¢ä¸ºå³å°†åˆ·æ–°</span></div><div class="line">            <span class="keyword">self</span>.state = MJRefreshStateWillRefresh;</div><div class="line">            <span class="comment">// åˆ·æ–°(é¢„é˜²ä»å¦ä¸€ä¸ªæ§åˆ¶å™¨å›åˆ°è¿™ä¸ªæ§åˆ¶å™¨çš„æƒ…å†µï¼Œå›æ¥è¦é‡æ–°åˆ·æ–°ä¸€ä¸‹)</span></div><div class="line">            [<span class="keyword">self</span> setNeedsDisplay];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark ç»“æŸåˆ·æ–°çŠ¶æ€</span></div><div class="line">- (<span class="keyword">void</span>)endRefreshing</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.state = MJRefreshStateIdle;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)endRefreshingWithCompletionBlock:(<span class="keyword">void</span> (^)())completionBlock</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.endRefreshingCompletionBlock = completionBlock;</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> endRefreshing];</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark æ˜¯å¦æ­£åœ¨åˆ·æ–°</span></div><div class="line">- (<span class="built_in">BOOL</span>)isRefreshing</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.state == MJRefreshStateRefreshing || <span class="keyword">self</span>.state == MJRefreshStateWillRefresh;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>äº¤ç»™å­ç±»å®ç°çš„æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)prepare <span class="built_in">NS_REQUIRES_SUPER</span>;</div><div class="line"><span class="comment">/** æ‘†æ”¾å­æ§ä»¶frame */</span></div><div class="line">- (<span class="keyword">void</span>)placeSubviews <span class="built_in">NS_REQUIRES_SUPER</span>;</div><div class="line"><span class="comment">/** å½“scrollViewçš„contentOffsetå‘ç”Ÿæ”¹å˜çš„æ—¶å€™è°ƒç”¨ */</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewContentOffsetDidChange:(<span class="built_in">NSDictionary</span> *)change <span class="built_in">NS_REQUIRES_SUPER</span>;</div><div class="line"><span class="comment">/** å½“scrollViewçš„contentSizeå‘ç”Ÿæ”¹å˜çš„æ—¶å€™è°ƒç”¨ */</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewContentSizeDidChange:(<span class="built_in">NSDictionary</span> *)change <span class="built_in">NS_REQUIRES_SUPER</span>;</div><div class="line"><span class="comment">/** å½“scrollViewçš„æ‹–æ‹½çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è°ƒç”¨ */</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewPanStateDidChange:(<span class="built_in">NSDictionary</span> *)change <span class="built_in">NS_REQUIRES_SUPER</span>;</div></pre></td></tr></table></figure>
<h4 id="5-æä¾›å­ç±»éœ€è¦å®ç°çš„æ–¹æ³•"><a href="#5-æä¾›å­ç±»éœ€è¦å®ç°çš„æ–¹æ³•" class="headerlink" title="5. æä¾›å­ç±»éœ€è¦å®ç°çš„æ–¹æ³•"></a>5. æä¾›å­ç±»éœ€è¦å®ç°çš„æ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#pragma mark - äº¤ç»™å­ç±»ä»¬å»å®ç°</span></div><div class="line"><span class="comment">/** åˆå§‹åŒ– */</span></div><div class="line">- (<span class="keyword">void</span>)prepare <span class="built_in">NS_REQUIRES_SUPER</span>;</div><div class="line"><span class="comment">/** æ‘†æ”¾å­æ§ä»¶frame */</span></div><div class="line">- (<span class="keyword">void</span>)placeSubviews <span class="built_in">NS_REQUIRES_SUPER</span>;</div><div class="line"><span class="comment">/** å½“scrollViewçš„contentOffsetå‘ç”Ÿæ”¹å˜çš„æ—¶å€™è°ƒç”¨ */</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewContentOffsetDidChange:(<span class="built_in">NSDictionary</span> *)change <span class="built_in">NS_REQUIRES_SUPER</span>;</div><div class="line"><span class="comment">/** å½“scrollViewçš„contentSizeå‘ç”Ÿæ”¹å˜çš„æ—¶å€™è°ƒç”¨ */</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewContentSizeDidChange:(<span class="built_in">NSDictionary</span> *)change <span class="built_in">NS_REQUIRES_SUPER</span>;</div><div class="line"><span class="comment">/** å½“scrollViewçš„æ‹–æ‹½çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è°ƒç”¨ */</span></div><div class="line">- (<span class="keyword">void</span>)scrollViewPanStateDidChange:(<span class="built_in">NSDictionary</span> *)change <span class="built_in">NS_REQUIRES_SUPER</span>;</div></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢ç­‰ç»“æ„å›¾å¯ä»¥çœ‹å‡ºï¼Œç´§æ¥ç€è¿™ä¸ªåŸºç±»ï¼Œä¸‹é¢åˆ†ä¸º<code>MJRefreshHeader</code>å’Œ<code>MJRefreshFooter</code>,è¿™é‡Œé¡ºç€<code>MJRefreshHeader</code>è¿™ä¸ªåˆ†æ”¯å‘ä¸‹å±•å¼€ï¼š</p>
<h2 id="MJRefreshHeader"><a href="#MJRefreshHeader" class="headerlink" title="MJRefreshHeader"></a>MJRefreshHeader</h2><p><code>MJRefreshHeader</code>ç»§æ‰¿äº<code>MJRefreshComponent</code>ï¼Œå®ƒåšäº†è¿™å‡ ä»¶äº‹ï¼š</p>
<h3 id="æœ‰å“ªäº›èŒèƒ½ï¼Ÿ"><a href="#æœ‰å“ªäº›èŒèƒ½ï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›èŒèƒ½ï¼Ÿ"></a>æœ‰å“ªäº›èŒèƒ½ï¼Ÿ</h3><ol>
<li>åˆå§‹åŒ–ã€‚</li>
<li>è®¾ç½®headeré«˜åº¦ã€‚</li>
<li>é‡æ–°è°ƒæ•´yå€¼ã€‚</li>
<li>æ ¹æ®<code>contentOffset</code>çš„å˜åŒ–ï¼Œæ¥åˆ‡æ¢çŠ¶æ€ï¼ˆé»˜è®¤çŠ¶æ€ï¼Œå¯ä»¥åˆ·æ–°çš„çŠ¶æ€ï¼Œæ­£åœ¨åˆ·æ–°çš„çŠ¶æ€ï¼‰ï¼Œå®ç°æ–¹æ³•æ˜¯ï¼š<code>scrollViewContentOffsetDidChange:</code>ã€‚</li>
<li>åœ¨åˆ‡æ¢çŠ¶æ€æ—¶ï¼Œæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å®ç°æ–¹æ³•æ˜¯ï¼š<code>setState:</code>ã€‚</li>
</ol>
<h3 id="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ-1"><a href="#èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ-1" class="headerlink" title="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ"></a>èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ</h3><p>####1. åˆå§‹åŒ–</p>
<p>åˆå§‹åŒ–æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">instancetype</span>)headerWithRefreshingBlock:(MJRefreshComponentRefreshingBlock)refreshingBlock</div><div class="line">&#123;</div><div class="line">    MJRefreshHeader *cmp = [[<span class="keyword">self</span> alloc] init];</div><div class="line">    <span class="comment">//ä¼ å…¥block</span></div><div class="line">    cmp.refreshingBlock = refreshingBlock;</div><div class="line">    <span class="keyword">return</span> cmp;</div><div class="line">&#125;</div><div class="line">+ (<span class="keyword">instancetype</span>)headerWithRefreshingTarget:(<span class="keyword">id</span>)target refreshingAction:(SEL)action</div><div class="line">&#123;</div><div class="line">    MJRefreshHeader *cmp = [[<span class="keyword">self</span> alloc] init];</div><div class="line">    <span class="comment">//è®¾ç½®self.refreshingTarget å’Œ self.refreshingAction</span></div><div class="line">    [cmp setRefreshingTarget:target refreshingAction:action];</div><div class="line">    <span class="keyword">return</span> cmp;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="2-è®¾ç½®headeré«˜åº¦"><a href="#2-è®¾ç½®headeré«˜åº¦" class="headerlink" title="2. è®¾ç½®headeré«˜åº¦"></a>2. è®¾ç½®headeré«˜åº¦</h4><p>é€šè¿‡é‡å†™<code>prepare</code>æ–¹æ³•æ¥è®¾ç½®headerçš„é«˜åº¦ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)prepare</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> prepare];</div><div class="line">    </div><div class="line">    <span class="comment">// è®¾ç½®ç”¨äºåœ¨NSUserDefaultsé‡Œå­˜å‚¨æ—¶é—´çš„key</span></div><div class="line">    <span class="keyword">self</span>.lastUpdatedTimeKey = MJRefreshHeaderLastUpdatedTimeKey;</div><div class="line">    </div><div class="line">    <span class="comment">// è®¾ç½®headerçš„é«˜åº¦</span></div><div class="line">    <span class="keyword">self</span>.mj_h = MJRefreshHeaderHeight;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="3-é‡æ–°è°ƒæ•´yå€¼"><a href="#3-é‡æ–°è°ƒæ•´yå€¼" class="headerlink" title="3. é‡æ–°è°ƒæ•´yå€¼"></a>3. é‡æ–°è°ƒæ•´yå€¼</h4><p>é€šè¿‡é‡å†™<code>placeSubviews</code>æ–¹æ³•æ¥é‡æ–°è°ƒæ•´yå€¼ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)placeSubviews</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> placeSubviews];</div><div class="line">    </div><div class="line">    <span class="comment">// è®¾ç½®yå€¼(å½“è‡ªå·±çš„é«˜åº¦å‘ç”Ÿæ”¹å˜äº†ï¼Œè‚¯å®šè¦é‡æ–°è°ƒæ•´Yå€¼ï¼Œæ‰€ä»¥æ”¾åˆ°placeSubviewsæ–¹æ³•ä¸­è®¾ç½®yå€¼)</span></div><div class="line">    <span class="keyword">self</span>.mj_y = - <span class="keyword">self</span>.mj_h - <span class="keyword">self</span>.ignoredScrollViewContentInsetTop;</div><div class="line">    <span class="comment">//self.ignoredScrollViewContentInsetTop å¦‚æœæ˜¯10ï¼Œé‚£ä¹ˆå°±å‘ä¸Šç§»åŠ¨10</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="4-çŠ¶æ€åˆ‡æ¢çš„ä»£ç ï¼š"><a href="#4-çŠ¶æ€åˆ‡æ¢çš„ä»£ç ï¼š" class="headerlink" title="4. çŠ¶æ€åˆ‡æ¢çš„ä»£ç ï¼š"></a>4. çŠ¶æ€åˆ‡æ¢çš„ä»£ç ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)scrollViewContentOffsetDidChange:(<span class="built_in">NSDictionary</span> *)change</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> scrollViewContentOffsetDidChange:change];</div><div class="line">    <span class="comment">// æ­£åœ¨åˆ·æ–°çš„çŠ¶æ€</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.state == MJRefreshStateRefreshing) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.window == <span class="literal">nil</span>) <span class="keyword">return</span>;</div><div class="line">        </div><div class="line">        <span class="comment">//- self.scrollView.mj_offsetYï¼š-ï¼ˆ-54-64ï¼‰= 118 ï¼š åˆ·æ–°çš„æ—¶å€™ï¼Œåç§»é‡æ˜¯ä¸åŠ¨çš„ã€‚åç§»é‡ = çŠ¶æ€æ  + å¯¼èˆªæ  + headerçš„é«˜åº¦</span></div><div class="line">        <span class="comment">//_scrollViewOriginalInset.topï¼š64 ï¼ˆçŠ¶æ€æ  + å¯¼èˆªæ ï¼‰</span></div><div class="line">        <span class="comment">//insetT å–äºŒè€…ä¹‹é—´å¤§çš„é‚£ä¸€ä¸ª</span></div><div class="line">        <span class="built_in">CGFloat</span> insetT = - <span class="keyword">self</span>.scrollView.mj_offsetY &gt; _scrollViewOriginalInset.top ? - <span class="keyword">self</span>.scrollView.mj_offsetY : _scrollViewOriginalInset.top;</div><div class="line">       </div><div class="line">        <span class="comment">//118</span></div><div class="line">        insetT = insetT &gt; <span class="keyword">self</span>.mj_h + _scrollViewOriginalInset.top ? <span class="keyword">self</span>.mj_h + _scrollViewOriginalInset.top : insetT;</div><div class="line">        </div><div class="line">        <span class="comment">//è®¾ç½®contentInset</span></div><div class="line">        <span class="keyword">self</span>.scrollView.mj_insetT = insetT;</div><div class="line">        </div><div class="line">        <span class="comment">// è®°å½•åˆ·æ–°çš„æ—¶å€™çš„åç§»é‡ -54 = 64 - 118</span></div><div class="line">        <span class="keyword">self</span>.insetTDelta = _scrollViewOriginalInset.top - insetT;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ§åˆ¶å™¨æ—¶ï¼ŒcontentInsetå¯èƒ½ä¼šå˜</span></div><div class="line">     _scrollViewOriginalInset = <span class="keyword">self</span>.scrollView.contentInset;</div><div class="line">    </div><div class="line">    <span class="comment">// è®°å½•å½“å‰çš„contentOffset</span></div><div class="line">    <span class="built_in">CGFloat</span> offsetY = <span class="keyword">self</span>.scrollView.mj_offsetY;</div><div class="line"></div><div class="line">    <span class="comment">// å¤´éƒ¨æ§ä»¶åˆšå¥½å…¨éƒ¨å‡ºç°çš„offsetY,é»˜è®¤æ˜¯-64ï¼ˆ20 + 44ï¼‰</span></div><div class="line">    <span class="built_in">CGFloat</span> happenOffsetY = - <span class="keyword">self</span>.scrollViewOriginalInset.top;</div><div class="line">    </div><div class="line">    <span class="comment">// å‘ä¸Šæ»šåŠ¨ï¼Œç›´æ¥è¿”å›</span></div><div class="line">    <span class="keyword">if</span> (offsetY &gt; happenOffsetY) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="comment">// ä»æ™®é€š åˆ° å³å°†åˆ·æ–° çš„ä¸´ç•Œè·ç¦»</span></div><div class="line">    <span class="built_in">CGFloat</span> normal2pullingOffsetY = happenOffsetY - <span class="keyword">self</span>.mj_h;<span class="comment">// -64 - 54 = -118</span></div><div class="line">    </div><div class="line">    <span class="comment">//ä¸‹æ‹‰çš„ç™¾åˆ†æ¯”ï¼šä¸‹æ‹‰çš„è·ç¦»ä¸headeré«˜åº¦çš„æ¯”å€¼</span></div><div class="line">    <span class="built_in">CGFloat</span> pullingPercent = (happenOffsetY - offsetY) / <span class="keyword">self</span>.mj_h;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.scrollView.isDragging) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//è®°å½•å½“å‰ä¸‹æ‹‰çš„ç™¾åˆ†æ¯”</span></div><div class="line">        <span class="keyword">self</span>.pullingPercent = pullingPercent;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.state == MJRefreshStateIdle &amp;&amp; offsetY &lt; normal2pullingOffsetY) &#123;</div><div class="line">            <span class="comment">// å¦‚æœå½“å‰ä¸ºé»˜è®¤çŠ¶æ€ &amp;&amp; ä¸‹æ‹‰çš„è·ç¦»å¤§äºä¸´ç•Œè·ç¦»ï¼ˆå°†tableviewä¸‹æ‹‰å¾—å¾ˆä½ï¼‰ï¼Œåˆ™å°†çŠ¶æ€åˆ‡æ¢ä¸ºå¯ä»¥åˆ·æ–°</span></div><div class="line">            <span class="keyword">self</span>.state = MJRefreshStatePulling;</div><div class="line">            </div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>.state == MJRefreshStatePulling &amp;&amp; offsetY &gt;= normal2pullingOffsetY) &#123;</div><div class="line">            <span class="comment">// å¦‚æœå½“å‰çŠ¶æ€ä¸ºå¯ä»¥åˆ·æ–° &amp;&amp; ä¸‹æ‹‰çš„è·ç¦»å°äºä¸´ç•Œè·ç¦»ï¼Œåˆ™å°†çŠ¶æ€åˆ‡æ¢ä¸ºé»˜è®¤</span></div><div class="line">            <span class="keyword">self</span>.state = MJRefreshStateIdle;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>.state == MJRefreshStatePulling) &#123;<span class="comment">// å³å°†åˆ·æ–° &amp;&amp; æ‰‹æ¾å¼€</span></div><div class="line">        <span class="comment">// æ‰‹æ¾å¼€ &amp;&amp; çŠ¶æ€ä¸ºå¯ä»¥åˆ·æ–°ï¼ˆMJRefreshStatePullingï¼‰æ—¶ å¼€å§‹åˆ·æ–°</span></div><div class="line">        [<span class="keyword">self</span> beginRefreshing];        </div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pullingPercent &lt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="comment">//æ‰‹æ¾å¼€åï¼Œé»˜è®¤çŠ¶æ€æ—¶ï¼Œæ¢å¤self.pullingPercent</span></div><div class="line">        <span class="keyword">self</span>.pullingPercent = pullingPercent;        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>éœ€è¦æ³¨æ„ä¸‰ç‚¹ï¼š</p>
<ol>
<li>è¿™é‡Œçš„çŠ¶æ€æœ‰ä¸‰ç§ï¼šé»˜è®¤çŠ¶æ€ï¼ˆMJRefreshStateIdleï¼‰ï¼Œå¯ä»¥åˆ·æ–°çš„çŠ¶æ€ï¼ˆMJRefreshStatePullingï¼‰ä»¥åŠæ­£åœ¨åˆ·æ–°çš„çŠ¶æ€ï¼ˆMJRefreshStateRefreshingï¼‰ã€‚</li>
<li>çŠ¶æ€åˆ‡æ¢çš„å› ç´ æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯ä¸‹æ‹‰çš„è·ç¦»æ˜¯å¦è¶…è¿‡ä¸´ç•Œå€¼ï¼Œå¦ä¸€ä¸ªæ˜¯ æ‰‹æŒ‡æ˜¯å¦ç¦»å¼€å±å¹•ã€‚</li>
<li>æ³¨æ„:<strong>å¯ä»¥åˆ·æ–°çš„çŠ¶æ€</strong>å’Œ<strong>æ­£åœ¨åˆ·æ–°çš„çŠ¶æ€</strong>æ˜¯ä¸åŒçš„ã€‚å› ä¸ºåœ¨æ‰‹æŒ‡è¿˜è´´åœ¨å±å¹•çš„æ—¶å€™æ˜¯ä¸èƒ½è¿›è¡Œåˆ·æ–°çš„ã€‚æ‰€ä»¥å³ä½¿åœ¨ä¸‹æ‹‰çš„è·ç¦»è¶…è¿‡äº†ä¸´ç•Œè·ç¦»ï¼ˆçŠ¶æ€æ  + å¯¼èˆªæ  + headeré«˜åº¦ï¼‰ï¼Œå¦‚æœæ‰‹æŒ‡æ²¡æœ‰ç¦»å¼€å±å¹•ï¼Œé‚£ä¹ˆä¹Ÿä¸èƒ½é©¬ä¸Šè¿›è¡Œåˆ·æ–°ï¼Œè€Œæ˜¯å°†çŠ¶æ€åˆ‡æ¢ä¸ºï¼šå¯ä»¥åˆ·æ–°ã€‚ä¸€æ—¦æ‰‹æŒ‡ç¦»å¼€äº†å±å¹•ï¼Œé©¬ä¸Šå°†çŠ¶æ€åˆ‡æ¢ä¸ºæ­£åœ¨åˆ·æ–°ã€‚ </li>
</ol>
</blockquote>
<p>è¿™é‡Œæä¾›ä¸€å¼ å›¾æ¥ä½“ç°ä¸‰ä¸ªçŠ¶æ€çš„ä¸åŒï¼š<br><img src="http://oih3a9o4n.bkt.clouddn.com/MJRefresh_2.png" alt="ä¸‰ä¸ªçŠ¶æ€"></p>
<h4 id="5-çŠ¶æ€åˆ‡æ¢æ—¶çš„ç›¸åº”æ“ä½œï¼š"><a href="#5-çŠ¶æ€åˆ‡æ¢æ—¶çš„ç›¸åº”æ“ä½œï¼š" class="headerlink" title="5. çŠ¶æ€åˆ‡æ¢æ—¶çš„ç›¸åº”æ“ä½œï¼š"></a>5. çŠ¶æ€åˆ‡æ¢æ—¶çš„ç›¸åº”æ“ä½œï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setState:(MJRefreshState)state</div><div class="line">&#123;</div><div class="line">    MJRefreshCheckState</div><div class="line">   </div><div class="line">    <span class="keyword">if</span> (state == MJRefreshStateIdle) &#123;</div><div class="line">       </div><div class="line">        <span class="comment">//============== è®¾ç½®çŠ¶æ€ä¸ºé»˜è®¤çŠ¶æ€ =============//</span></div><div class="line">        </div><div class="line">        <span class="comment">//å¦‚æœå½“å‰ä¸æ˜¯æ­£åœ¨åˆ·æ–°å°±è¿”å›ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¸»è¦é’ˆå¯¹ä»æ­£åœ¨åˆ·æ–°çŠ¶æ€ï¼ˆoldstateï¼‰åˆ°é»˜è®¤çŠ¶æ€</span></div><div class="line">        <span class="keyword">if</span> (oldState != MJRefreshStateRefreshing) <span class="keyword">return</span>;</div><div class="line">        </div><div class="line">        <span class="comment">//åˆ·æ–°å®Œæˆåï¼Œä¿å­˜åˆ·æ–°å®Œæˆçš„æ—¶é—´</span></div><div class="line">        [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] setObject:[<span class="built_in">NSDate</span> date] forKey:<span class="keyword">self</span>.lastUpdatedTimeKey];</div><div class="line">        [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] synchronize];</div><div class="line">        </div><div class="line">        <span class="comment">// æ¢å¤insetå’Œoffset</span></div><div class="line">        [<span class="built_in">UIView</span> animateWithDuration:MJRefreshSlowAnimationDuration animations:^&#123;</div><div class="line">            </div><div class="line">            <span class="comment">//118 -&gt; 64ï¼ˆå‰ªå»äº†headerçš„é«˜åº¦ï¼‰</span></div><div class="line">            <span class="keyword">self</span>.scrollView.mj_insetT += <span class="keyword">self</span>.insetTDelta;</div><div class="line">            </div><div class="line">            <span class="comment">// è‡ªåŠ¨è°ƒæ•´é€æ˜åº¦</span></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">self</span>.isAutomaticallyChangeAlpha) <span class="keyword">self</span>.alpha = <span class="number">0.0</span>;</div><div class="line">            </div><div class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</div><div class="line">            </div><div class="line">            <span class="keyword">self</span>.pullingPercent = <span class="number">0.0</span>;</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> (<span class="keyword">self</span>.endRefreshingCompletionBlock) &#123;</div><div class="line">                <span class="comment">//è°ƒç”¨åˆ·æ–°å®Œæˆçš„block</span></div><div class="line">                <span class="keyword">self</span>.endRefreshingCompletionBlock();</div><div class="line">            &#125;</div><div class="line">        &#125;];</div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == MJRefreshStateRefreshing) &#123;</div><div class="line">        </div><div class="line">         <span class="comment">//============== è®¾ç½®çŠ¶æ€ä¸ºæ­£åœ¨åˆ·æ–°çŠ¶æ€ =============//</span></div><div class="line">         <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            </div><div class="line">             [<span class="built_in">UIView</span> animateWithDuration:MJRefreshFastAnimationDuration animations:^&#123;</div><div class="line">               </div><div class="line">                <span class="built_in">CGFloat</span> top = <span class="keyword">self</span>.scrollViewOriginalInset.top + <span class="keyword">self</span>.mj_h;<span class="comment">//64 + 54 (éƒ½æ˜¯é»˜è®¤çš„é«˜åº¦)</span></div><div class="line">                <span class="comment">// é‡æ–°è®¾ç½®contentInsetï¼Œtop = 118</span></div><div class="line">                <span class="keyword">self</span>.scrollView.mj_insetT = top;</div><div class="line">                <span class="comment">// è®¾ç½®æ»šåŠ¨ä½ç½®</span></div><div class="line">                [<span class="keyword">self</span>.scrollView setContentOffset:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, -top) animated:<span class="literal">NO</span>];</div><div class="line">                 </div><div class="line">            &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</div><div class="line">                <span class="comment">//è°ƒç”¨è¿›è¡Œåˆ·æ–°çš„block</span></div><div class="line">                [<span class="keyword">self</span> executeRefreshingCallback];</div><div class="line">            &#125;];</div><div class="line">         &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ol>
<li>è¿™é‡ŒçŠ¶æ€çš„åˆ‡æ¢ï¼Œä¸»è¦å›´ç»•ç€ä¸¤ç§ï¼šé»˜è®¤çŠ¶æ€å’Œæ­£åœ¨åˆ·æ–°çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯é’ˆå¯¹<strong>å¼€å§‹åˆ·æ–°</strong>å’Œ<strong>ç»“æŸåˆ·æ–°</strong>è¿™ä¸¤ä¸ªåˆ‡æ¢ç‚¹ã€‚</li>
<li>ä»æ­£åœ¨åˆ·æ–°çŠ¶æ€çŠ¶æ€åˆ‡æ¢ä¸ºé»˜è®¤çŠ¶æ€æ—¶ï¼ˆç»“æŸåˆ·æ–°ï¼‰ï¼Œéœ€è¦è®°å½•åˆ·æ–°ç»“æŸçš„æ—¶é—´ã€‚å› ä¸ºheaderé‡Œé¢æœ‰ä¸€ä¸ªé»˜è®¤çš„labelæ˜¯ç”¨æ¥æ˜¾ç¤ºä¸Šæ¬¡åˆ·æ–°çš„æ—¶é—´çš„ã€‚</li>
</ol>
</blockquote>
<h2 id="MJRefreshStateHeader"><a href="#MJRefreshStateHeader" class="headerlink" title="MJRefreshStateHeader"></a>MJRefreshStateHeader</h2><p>è¿™ä¸ªç±»æ˜¯<code>MJRefreshHeader</code>ç±»çš„å­ç±»ï¼Œå®ƒåšäº†ä¸¤ä»¶äº‹ï¼š</p>
<h3 id="æœ‰å“ªäº›èŒèƒ½ï¼Ÿ-1"><a href="#æœ‰å“ªäº›èŒèƒ½ï¼Ÿ-1" class="headerlink" title="æœ‰å“ªäº›èŒèƒ½ï¼Ÿ"></a>æœ‰å“ªäº›èŒèƒ½ï¼Ÿ</h3><ol>
<li>ç®€å•å¸ƒå±€äº†<code>stateLabel</code>å’Œ<code>lastUpdatedTimeLabel</code>ã€‚</li>
<li>æ ¹æ®æ§ä»¶çŠ¶æ€çš„åˆ‡æ¢ï¼ˆé»˜è®¤çŠ¶æ€ï¼Œæ­£åœ¨åˆ·æ–°çŠ¶æ€ï¼‰ï¼Œå®ç°äº†è¿™ä¸¤ä¸ªlabelæ˜¾ç¤ºçš„æ–‡å­—çš„åˆ‡æ¢ã€‚</li>
</ol>
<p>ç»™ä¸€å¼ å›¾ï¼Œè®©å¤§å®¶ç›´è§‚æ„Ÿå—ä¸€ä¸‹è¿™ä¸¤ä¸ªæ§ä»¶ï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/MJRefresh_3.png" alt="ä¸¤ä¸ªLabel"></p>
<h3 id="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ-2"><a href="#èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ-2" class="headerlink" title="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ"></a>èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ</h3><p>è¿™ä¸ªç±»é€šè¿‡è¦†ç›–çˆ¶ç±»ä¸‰ä¸ªæ–¹æ³•æ¥å®ç°ä¸Šè¿°ä¸¤ä¸ªå®ç°ï¼š</p>
<h4 id="æ–¹æ³•1ï¼šprepareæ–¹æ³•"><a href="#æ–¹æ³•1ï¼šprepareæ–¹æ³•" class="headerlink" title="æ–¹æ³•1ï¼šprepareæ–¹æ³•"></a>æ–¹æ³•1ï¼šprepareæ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)prepare</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> prepare];</div><div class="line">    </div><div class="line">    <span class="comment">// åˆå§‹åŒ–é—´è·</span></div><div class="line">    <span class="keyword">self</span>.labelLeftInset = MJRefreshLabelLeftInset;</div><div class="line">    </div><div class="line">    <span class="comment">// åˆå§‹åŒ–æ–‡å­—</span></div><div class="line">    [<span class="keyword">self</span> setTitle:[<span class="built_in">NSBundle</span> mj_localizedStringForKey:MJRefreshHeaderIdleText] forState:MJRefreshStateIdle];</div><div class="line">    [<span class="keyword">self</span> setTitle:[<span class="built_in">NSBundle</span> mj_localizedStringForKey:MJRefreshHeaderPullingText] forState:MJRefreshStatePulling];</div><div class="line">    [<span class="keyword">self</span> setTitle:[<span class="built_in">NSBundle</span> mj_localizedStringForKey:MJRefreshHeaderRefreshingText] forState:MJRefreshStateRefreshing];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œå°†æ¯ä¸€ä¸ªçŠ¶æ€å¯¹åº”çš„æç¤ºæ–‡å­—æ”¾å…¥ä¸€ä¸ªå­—å…¸é‡Œé¢,keyæ˜¯çŠ¶æ€çš„NSNumberå½¢å¼</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setTitle:(<span class="built_in">NSString</span> *)title forState:(MJRefreshState)state</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (title == <span class="literal">nil</span>) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">self</span>.stateTitles[@(state)] = title;</div><div class="line">    <span class="keyword">self</span>.stateLabel.text = <span class="keyword">self</span>.stateTitles[@(<span class="keyword">self</span>.state)];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•2ï¼šplaceSubviewsæ–¹æ³•"><a href="#æ–¹æ³•2ï¼šplaceSubviewsæ–¹æ³•" class="headerlink" title="æ–¹æ³•2ï¼šplaceSubviewsæ–¹æ³•"></a>æ–¹æ³•2ï¼šplaceSubviewsæ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)placeSubviews</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> placeSubviews];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.stateLabel.hidden) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">BOOL</span> noConstrainsOnStatusLabel = <span class="keyword">self</span>.stateLabel.constraints.count == <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.lastUpdatedTimeLabel.hidden) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//å¦‚æœæ›´æ–°æ—¶é—´labelæ˜¯éšè—çš„ï¼Œåˆ™è®©çŠ¶æ€labelæ’‘æ»¡æ•´ä¸ªheader</span></div><div class="line">        <span class="keyword">if</span> (noConstrainsOnStatusLabel) <span class="keyword">self</span>.stateLabel.frame = <span class="keyword">self</span>.bounds;</div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//å¦‚æœæ›´æ–°æ—¶é—´labelä¸æ˜¯éšè—çš„ï¼Œæ ¹æ®çº¦æŸè®¾ç½®æ›´æ–°æ—¶é—´labelå’ŒçŠ¶æ€labelï¼ˆé«˜åº¦å„å ä¸€åŠï¼‰</span></div><div class="line">        <span class="built_in">CGFloat</span> stateLabelH = <span class="keyword">self</span>.mj_h * <span class="number">0.5</span>;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (noConstrainsOnStatusLabel) &#123;</div><div class="line">            <span class="keyword">self</span>.stateLabel.mj_x = <span class="number">0</span>;</div><div class="line">            <span class="keyword">self</span>.stateLabel.mj_y = <span class="number">0</span>;</div><div class="line">            <span class="keyword">self</span>.stateLabel.mj_w = <span class="keyword">self</span>.mj_w;</div><div class="line">            <span class="keyword">self</span>.stateLabel.mj_h = stateLabelH;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">// æ›´æ–°æ—¶é—´label</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.lastUpdatedTimeLabel.constraints.count == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">self</span>.lastUpdatedTimeLabel.mj_x = <span class="number">0</span>;</div><div class="line">            <span class="keyword">self</span>.lastUpdatedTimeLabel.mj_y = stateLabelH;</div><div class="line">            <span class="keyword">self</span>.lastUpdatedTimeLabel.mj_w = <span class="keyword">self</span>.mj_w;</div><div class="line">            <span class="keyword">self</span>.lastUpdatedTimeLabel.mj_h = <span class="keyword">self</span>.mj_h - <span class="keyword">self</span>.lastUpdatedTimeLabel.mj_y;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œä¸»è¦æ˜¯å¯¹<code>lastUpdatedTimeLabel</code>å’Œ<code>stateLabel</code>è¿›è¡Œå¸ƒå±€ã€‚è¦æ³¨æ„<code>lastUpdatedTimeLabel</code>éšè—çš„æƒ…å†µã€‚</p>
</blockquote>
<h4 id="æ–¹æ³•3-setState-æ–¹æ³•"><a href="#æ–¹æ³•3-setState-æ–¹æ³•" class="headerlink" title="æ–¹æ³•3: setState:æ–¹æ³•"></a>æ–¹æ³•3: setState:æ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setState:(MJRefreshState)state</div><div class="line">&#123;</div><div class="line">    MJRefreshCheckState</div><div class="line">    </div><div class="line">    <span class="comment">// è®¾ç½®çŠ¶æ€æ–‡å­—</span></div><div class="line">    <span class="keyword">self</span>.stateLabel.text = <span class="keyword">self</span>.stateTitles[@(state)];</div><div class="line">    </div><div class="line">    <span class="comment">// é‡æ–°è®¾ç½®keyï¼ˆé‡æ–°æ˜¾ç¤ºæ—¶é—´ï¼‰</span></div><div class="line">    <span class="keyword">self</span>.lastUpdatedTimeKey = <span class="keyword">self</span>.lastUpdatedTimeKey;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œæ ¹æ®ä¼ å…¥çš„stateçš„ä¸åŒï¼Œåœ¨<code>stateLabel</code>å’Œ<code>lastUpdatedTimeLabel</code>é‡Œåˆ‡æ¢ç›¸åº”çš„æ–‡å­—ã€‚</p>
<ul>
<li><code>stateLabel</code>é‡Œçš„æ–‡å­—ç›´æ¥ä»<code>stateTitles</code>å­—å…¸é‡Œå–å‡ºå³å¯ã€‚</li>
<li><code>lastUpdatedTimeLabel</code>é‡Œçš„æ–‡å­—éœ€è¦é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ¥å–å‡ºå³å¯ï¼š</li>
</ul>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setLastUpdatedTimeKey:(<span class="built_in">NSString</span> *)lastUpdatedTimeKey</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> setLastUpdatedTimeKey:lastUpdatedTimeKey];</div><div class="line">    </div><div class="line">    <span class="comment">// å¦‚æœlabeléšè—äº†ï¼Œå°±ä¸ç”¨å†å¤„ç†</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.lastUpdatedTimeLabel.hidden) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//æ ¹æ®keyï¼Œä»NSUserDefaultsè·å–å¯¹åº”çš„NSDataå‹æ—¶é—´</span></div><div class="line">    <span class="built_in">NSDate</span> *lastUpdatedTime = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] objectForKey:lastUpdatedTimeKey];</div><div class="line">    </div><div class="line">    <span class="comment">// å¦‚æœæœ‰blockï¼Œä»blocké‡Œæ‹¿æ¥æ—¶é—´ï¼Œè¿™åº”è¯¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰æ˜¾ç¤ºæ—¶é—´æ ¼å¼çš„æ¸ é“</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.lastUpdatedTimeText) &#123;</div><div class="line">        <span class="keyword">self</span>.lastUpdatedTimeLabel.text = <span class="keyword">self</span>.lastUpdatedTimeText(lastUpdatedTime);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//å¦‚æœæ²¡æœ‰blockï¼Œå°±æŒ‰ç…§ä¸‹é¢çš„é»˜è®¤æ–¹æ³•æ˜¾ç¤ºæ—¶é—´æ ¼å¼</span></div><div class="line">    <span class="keyword">if</span> (lastUpdatedTime) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">// è·å¾—äº†ä¸Šæ¬¡æ›´æ–°æ—¶é—´</span></div><div class="line">        <span class="comment">// 1.è·å¾—å¹´æœˆæ—¥</span></div><div class="line">        <span class="built_in">NSCalendar</span> *calendar = [<span class="keyword">self</span> currentCalendar];</div><div class="line">        <span class="built_in">NSUInteger</span> unitFlags = <span class="built_in">NSCalendarUnitYear</span>| <span class="built_in">NSCalendarUnitMonth</span> | <span class="built_in">NSCalendarUnitDay</span> |<span class="built_in">NSCalendarUnitHour</span> |<span class="built_in">NSCalendarUnitMinute</span>;</div><div class="line">        <span class="built_in">NSDateComponents</span> *cmp1 = [calendar components:unitFlags fromDate:lastUpdatedTime];</div><div class="line">        <span class="built_in">NSDateComponents</span> *cmp2 = [calendar components:unitFlags fromDate:[<span class="built_in">NSDate</span> date]];</div><div class="line">        </div><div class="line">        <span class="comment">// 2.æ ¼å¼åŒ–æ—¥æœŸ</span></div><div class="line">        <span class="built_in">NSDateFormatter</span> *formatter = [[<span class="built_in">NSDateFormatter</span> alloc] init];</div><div class="line">        <span class="built_in">BOOL</span> isToday = <span class="literal">NO</span>;</div><div class="line">        <span class="keyword">if</span> ([cmp1 day] == [cmp2 day]) &#123;</div><div class="line">            <span class="comment">//ä»Šå¤©ï¼Œçœå»å¹´æœˆæ—¥</span></div><div class="line">            formatter.dateFormat = <span class="string">@" HH:mm"</span>;</div><div class="line">            isToday = <span class="literal">YES</span>;</div><div class="line">            </div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([cmp1 year] == [cmp2 year]) &#123; <span class="comment">// ä»Šå¹´</span></div><div class="line">            <span class="comment">//ä»Šå¹´ï¼Œçœå»å¹´ï¼Œæ˜¾ç¤ºæœˆæ—¥</span></div><div class="line">            formatter.dateFormat = <span class="string">@"MM-dd HH:mm"</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//å…¶ä»–ï¼Œå¹´æœˆæ—¥éƒ½æ˜¾ç¤º</span></div><div class="line">            formatter.dateFormat = <span class="string">@"yyyy-MM-dd HH:mm"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">NSString</span> *time = [formatter stringFromDate:lastUpdatedTime];</div><div class="line">        </div><div class="line">        <span class="comment">// 3.æ˜¾ç¤ºæ—¥æœŸ</span></div><div class="line">        <span class="keyword">self</span>.lastUpdatedTimeLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@%@%@"</span>,</div><div class="line">                                          [<span class="built_in">NSBundle</span> mj_localizedStringForKey:MJRefreshHeaderLastTimeText],</div><div class="line">                                          isToday ? [<span class="built_in">NSBundle</span> mj_localizedStringForKey:MJRefreshHeaderDateTodayText] : <span class="string">@""</span>,</div><div class="line">                                          time];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// æ²¡æœ‰è·å¾—ä¸Šæ¬¡æ›´æ–°æ—¶é—´ï¼ˆåº”è¯¥æ˜¯ç¬¬ä¸€æ¬¡æ›´æ–°æˆ–è€…å¤šæ¬¡æ›´æ–°ï¼Œä¹‹å‰çš„æ›´æ–°éƒ½å¤±è´¥äº†ï¼‰</span></div><div class="line">        <span class="keyword">self</span>.lastUpdatedTimeLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@%@"</span>,</div><div class="line">                                          [<span class="built_in">NSBundle</span> mj_localizedStringForKey:MJRefreshHeaderLastTimeText],</div><div class="line">                                          [<span class="built_in">NSBundle</span> mj_localizedStringForKey:MJRefreshHeaderNoneLastDateText]];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œæ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ol>
<li>ä½œè€…é€šè¿‡ä½¿ç”¨blockæ¥è®©ç”¨æˆ·è‡ªå·±å®šä¹‰æ—¥æœŸç°å®çš„æ ¼å¼ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è‡ªå®šä¹‰ï¼Œå°±ä½¿ç”¨ä½œè€…æä¾›çš„é»˜è®¤æ ¼å¼ã€‚</li>
<li>åœ¨é»˜è®¤æ ¼å¼çš„è®¾ç½®é‡Œï¼Œåˆ¤æ–­äº†æ˜¯å¦æ˜¯ä»Šæ—¥ï¼Œæ˜¯å¦æ˜¯ä»Šå¹´çš„æƒ…å†µã€‚åœ¨ä»¥åè®¾è®¡æ˜¾ç¤ºæ—¶é—´çš„labeçš„æ—¶å€™å¯ä»¥å€Ÿé‰´ä¸€ä¸‹ã€‚</li>
</ol>
</blockquote>
<h2 id="MJRefreshNormalHeader"><a href="#MJRefreshNormalHeader" class="headerlink" title="MJRefreshNormalHeader"></a>MJRefreshNormalHeader</h2><h3 id="æœ‰å“ªäº›èŒèƒ½ï¼Ÿ-2"><a href="#æœ‰å“ªäº›èŒèƒ½ï¼Ÿ-2" class="headerlink" title="æœ‰å“ªäº›èŒèƒ½ï¼Ÿ"></a>æœ‰å“ªäº›èŒèƒ½ï¼Ÿ</h3><p>MJRefreshNormalHeader ç»§æ‰¿äº MJRefreshStateHeaderï¼Œå®ƒä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å®ƒåœ¨MJRefreshStateHeaderä¸Šæ·»åŠ äº†<code>_arrowView</code>å’Œ<code>loadingView</code>ã€‚</li>
<li>å¸ƒå±€äº†è¿™ä¸¤ä¸ªviewå¹¶åœ¨Refreshæ§ä»¶çš„çŠ¶æ€åˆ‡æ¢çš„æ—¶å€™æ”¹å˜è¿™ä¸¤ä¸ªviewçš„æ ·å¼ã€‚</li>
</ol>
<p>è¿˜æ˜¯ç»™ä¸€å¼ å›¾æ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹è¿™ä¸¤ä¸ªviewï¼š</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/MJRefresh_4.png" alt="ä¸¤ä¸ªview"></p>
<h3 id="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ-3"><a href="#èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ-3" class="headerlink" title="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ"></a>èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ</h3><p>åŒMJRefreshStateHeaderä¸€æ ·ï¼Œä¹Ÿæ˜¯é‡å†™äº†çˆ¶ç±»çš„ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<h4 id="æ–¹æ³•1ï¼šprepare"><a href="#æ–¹æ³•1ï¼šprepare" class="headerlink" title="æ–¹æ³•1ï¼šprepare"></a>æ–¹æ³•1ï¼šprepare</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)prepare</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> prepare];</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.activityIndicatorViewStyle = <span class="built_in">UIActivityIndicatorViewStyleGray</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•2ï¼šplaceSubviews"><a href="#æ–¹æ³•2ï¼šplaceSubviews" class="headerlink" title="æ–¹æ³•2ï¼šplaceSubviews"></a>æ–¹æ³•2ï¼šplaceSubviews</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)placeSubviews</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> placeSubviews];</div><div class="line">    </div><div class="line">    <span class="comment">// é¦–å…ˆå°†ç®­å¤´çš„ä¸­å¿ƒç‚¹xè®¾ä¸ºheaderå®½åº¦çš„ä¸€åŠ</span></div><div class="line">    <span class="built_in">CGFloat</span> arrowCenterX = <span class="keyword">self</span>.mj_w * <span class="number">0.5</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.stateLabel.hidden) &#123;</div><div class="line">        </div><div class="line">        <span class="built_in">CGFloat</span> stateWidth = <span class="keyword">self</span>.stateLabel.mj_textWith;</div><div class="line">        <span class="built_in">CGFloat</span> timeWidth = <span class="number">0.0</span>;</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">self</span>.lastUpdatedTimeLabel.hidden) &#123;</div><div class="line">            timeWidth = <span class="keyword">self</span>.lastUpdatedTimeLabel.mj_textWith;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//åœ¨stateLabelé‡Œçš„æ–‡å­—å®½åº¦å’Œæ›´æ–°æ—¶é—´é‡Œçš„æ–‡å­—å®½åº¦é‡Œå–è¾ƒå®½çš„</span></div><div class="line">        <span class="built_in">CGFloat</span> textWidth = MAX(stateWidth, timeWidth);</div><div class="line">        <span class="comment">//æ ¹æ®self.labelLeftInsetå’ŒtextWidthå‘å·¦ç§»åŠ¨ä¸­å¿ƒç‚¹x</span></div><div class="line">        arrowCenterX -= textWidth / <span class="number">2</span> + <span class="keyword">self</span>.labelLeftInset;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//ä¸­å¿ƒç‚¹yæ°¸è¿œè®¾ç½®ä¸ºheaderçš„é«˜åº¦çš„ä¸€åŠ</span></div><div class="line">    <span class="built_in">CGFloat</span> arrowCenterY = <span class="keyword">self</span>.mj_h * <span class="number">0.5</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//è·å¾—äº†æœ€ç»ˆçš„centerï¼Œè€Œè¿™ä¸ªcenteråŒæ—¶é€‚ç”¨äºarrowViewå’ŒloadingViewï¼Œå› ä¸ºäºŒè€…æ˜¯ä¸å…±å­˜çš„ã€‚</span></div><div class="line">    <span class="built_in">CGPoint</span> arrowCenter = <span class="built_in">CGPointMake</span>(arrowCenterX, arrowCenterY);</div><div class="line">    </div><div class="line">    <span class="comment">// ç®­å¤´</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.arrowView.constraints.count == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//æ§ä»¶å¤§å°ç­‰äºå›¾ç‰‡å¤§å°</span></div><div class="line">        <span class="keyword">self</span>.arrowView.mj_size = <span class="keyword">self</span>.arrowView.image.size;</div><div class="line">        <span class="keyword">self</span>.arrowView.center = arrowCenter;</div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    <span class="comment">// èŠèŠ±</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.loadingView.constraints.count == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.loadingView.center = arrowCenter;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//arrowViewçš„è‰²è°ƒä¸stateLabelçš„å­—ä½“é¢œè‰²ä¸€è‡´</span></div><div class="line">    <span class="keyword">self</span>.arrowView.tintColor = <span class="keyword">self</span>.stateLabel.textColor;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼šå› ä¸º<code>stateLabel</code>å’Œ<code>lastUpdatedTimeLabel</code>æ˜¯ä¸Šä¸‹å¹¶æ’åˆ†å¸ƒçš„ï¼Œè€Œ<code>arrowView</code>æˆ–<code>loadingView</code>æ˜¯åœ¨è¿™äºŒè€…çš„å·¦è¾¹ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…è¿™ä¸¤ç»„é‡åˆï¼Œåœ¨è®¡ç®—<code>arrowView</code>æˆ–<code>loadingView</code>çš„centerçš„æ—¶å€™ï¼Œéœ€è¦è·å–<code>stateLabel</code>å’Œ<code>lastUpdatedTimeLabel</code>ä¸¤ä¸ªæ§ä»¶çš„å®½åº¦å¹¶æ¯”è¾ƒå¤§å°ï¼Œå°†è¾ƒå¤§çš„ä¸€ä¸ªä½œä¸ºä¸¤ä¸ªlabelçš„â€˜æœ€å®½è·ç¦»â€™ï¼Œå†è®¡ç®—centerï¼Œè¿™æ ·ä¸€æ¥å°±ä¸ä¼šé‡åˆäº†ã€‚<br>è€Œå¯¹äºå¦‚ä½•è®¡ç®—å®½åº¦ï¼Œä½œè€…ç»™å‡ºäº†ä¸€ä¸ªæ–¹æ¡ˆï¼Œå¤§å®¶å¯ä»¥åœ¨ä»¥åçš„å®è·µä¸­ä½¿ç”¨ï¼š</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGFloat</span>)mj_textWith &#123;</div><div class="line">    <span class="built_in">CGFloat</span> stringWidth = <span class="number">0</span>;</div><div class="line">    <span class="built_in">CGSize</span> size = <span class="built_in">CGSizeMake</span>(MAXFLOAT, MAXFLOAT);</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.text.length &gt; <span class="number">0</span>) &#123;</div><div class="line"><span class="meta">#if defined(__IPHONE_OS_VERSION_MAX_ALLOWED) &amp;&amp; __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= 70000</span></div><div class="line">        stringWidth =[<span class="keyword">self</span>.text</div><div class="line">                      boundingRectWithSize:size</div><div class="line">                      options:<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span></div><div class="line">                      attributes:@&#123;<span class="built_in">NSFontAttributeName</span>:<span class="keyword">self</span>.font&#125;</div><div class="line">                      context:<span class="literal">nil</span>].size.width;</div><div class="line"><span class="meta">#else</span></div><div class="line">        </div><div class="line">        stringWidth = [<span class="keyword">self</span>.text sizeWithFont:<span class="keyword">self</span>.font</div><div class="line">                             constrainedToSize:size</div><div class="line">                                 lineBreakMode:<span class="built_in">NSLineBreakByCharWrapping</span>].width;</div><div class="line"><span class="meta">#endif</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> stringWidth;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ–¹æ³•3-setState"><a href="#æ–¹æ³•3-setState" class="headerlink" title="æ–¹æ³•3: setState:"></a>æ–¹æ³•3: setState:</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setState:(MJRefreshState)state</div><div class="line">&#123;</div><div class="line">    MJRefreshCheckState</div><div class="line">    </div><div class="line">    <span class="comment">// æ ¹æ®çŠ¶æ€æ›´æ–°arrowViewå’ŒloadingViewçš„æ˜¾ç¤º</span></div><div class="line">    <span class="keyword">if</span> (state == MJRefreshStateIdle) &#123;</div><div class="line">       </div><div class="line">        <span class="comment">//1. è®¾ç½®ä¸ºé»˜è®¤çŠ¶æ€</span></div><div class="line">        <span class="keyword">if</span> (oldState == MJRefreshStateRefreshing) &#123;</div><div class="line">            </div><div class="line">            <span class="comment">//1.1 ä»æ­£åœ¨åˆ·æ–°çŠ¶æ€ä¸­åˆ‡æ¢è¿‡æ¥</span></div><div class="line">            <span class="keyword">self</span>.arrowView.transform = <span class="built_in">CGAffineTransformIdentity</span>;</div><div class="line">            </div><div class="line">            [<span class="built_in">UIView</span> animateWithDuration:MJRefreshSlowAnimationDuration animations:^&#123;</div><div class="line">                <span class="comment">//éšè—èŠèŠ±</span></div><div class="line">                <span class="keyword">self</span>.loadingView.alpha = <span class="number">0.0</span>;</div><div class="line">                </div><div class="line">            &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</div><div class="line">                </div><div class="line">                <span class="comment">// å¦‚æœæ‰§è¡Œå®ŒåŠ¨ç”»å‘ç°ä¸æ˜¯idleçŠ¶æ€ï¼Œå°±ç›´æ¥è¿”å›ï¼Œè¿›å…¥å…¶ä»–çŠ¶æ€</span></div><div class="line">                <span class="keyword">if</span> (<span class="keyword">self</span>.state != MJRefreshStateIdle) <span class="keyword">return</span>;</div><div class="line">                <span class="comment">//èŠèŠ±åœæ­¢æ—‹è½¬</span></div><div class="line">                <span class="keyword">self</span>.loadingView.alpha = <span class="number">1.0</span>;</div><div class="line">                [<span class="keyword">self</span>.loadingView stopAnimating];</div><div class="line">                <span class="comment">//æ˜¾ç¤ºç®­å¤´</span></div><div class="line">                <span class="keyword">self</span>.arrowView.hidden = <span class="literal">NO</span>;</div><div class="line">            &#125;];</div><div class="line">            </div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//1.2 ä»å…¶ä»–çŠ¶æ€ä¸­åˆ‡æ¢è¿‡æ¥</span></div><div class="line">            [<span class="keyword">self</span>.loadingView stopAnimating];</div><div class="line">            <span class="comment">//æ˜¾ç¤ºç®­å¤´å¹¶è®¾ç½®ä¸ºåˆå§‹çŠ¶æ€</span></div><div class="line">            <span class="keyword">self</span>.arrowView.hidden = <span class="literal">NO</span>;</div><div class="line">            [<span class="built_in">UIView</span> animateWithDuration:MJRefreshFastAnimationDuration animations:^&#123;</div><div class="line">                <span class="keyword">self</span>.arrowView.transform = <span class="built_in">CGAffineTransformIdentity</span>;</div><div class="line">            &#125;];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == MJRefreshStatePulling) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//2. è®¾ç½®ä¸ºå¯ä»¥åˆ·æ–°çŠ¶æ€</span></div><div class="line">        [<span class="keyword">self</span>.loadingView stopAnimating];</div><div class="line">        <span class="keyword">self</span>.arrowView.hidden = <span class="literal">NO</span>;</div><div class="line">        [<span class="built_in">UIView</span> animateWithDuration:MJRefreshFastAnimationDuration animations:^&#123;</div><div class="line">            <span class="comment">//ç®­å¤´å€’ç«‹</span></div><div class="line">            <span class="keyword">self</span>.arrowView.transform = <span class="built_in">CGAffineTransformMakeRotation</span>(<span class="number">0.000001</span> - M_PI);</div><div class="line">        &#125;];</div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == MJRefreshStateRefreshing) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//3. è®¾ç½®ä¸ºæ­£åœ¨åˆ·æ–°çŠ¶æ€</span></div><div class="line">        <span class="keyword">self</span>.loadingView.alpha = <span class="number">1.0</span>; <span class="comment">// é˜²æ­¢refreshing -&gt; idleçš„åŠ¨ç”»å®Œæ¯•åŠ¨ä½œæ²¡æœ‰è¢«æ‰§è¡Œ</span></div><div class="line">        <span class="comment">//èŠèŠ±æ—‹è½¬</span></div><div class="line">        [<span class="keyword">self</span>.loadingView startAnimating];</div><div class="line">        <span class="comment">//éšè—arrowView</span></div><div class="line">        <span class="keyword">self</span>.arrowView.hidden = <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä»<code>MJRefreshComponent</code>åˆ°<code>MJRefreshNormalHeader</code>çš„å®ç°è¿‡ç¨‹çœ‹äº†ä¸€éã€‚å¯ä»¥çœ‹å‡ºï¼Œä½œè€…å°†<code>prepare</code>,<code>placeSubviews</code>ä»¥åŠ<code>setStateï¼š</code>æ–¹æ³•ä½œä¸ºåŸºç±»çš„æ–¹æ³•ï¼Œè®©ä¸‹é¢çš„å­ç±»å»ä¸€å±‚ä¸€å±‚å®ç°ã€‚</p>
<p>è€Œæ¯ä¸€å±‚çš„å­ç±»ï¼Œæ ¹æ®è‡ªèº«çš„èŒè´£ï¼Œåˆ†åˆ«æŒ‰ç…§è‡ªå·±çš„æ–¹å¼æ¥å®ç°è¿™ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>MJRefreshHeader</code>: è´Ÿè´£headerçš„é«˜åº¦å’Œè°ƒæ•´headerè‡ªèº«åœ¨å¤–éƒ¨çš„ä½ç½®ã€‚</li>
<li><code>MJRefreshStateHeader</code>:è´Ÿè´£headerå†…éƒ¨çš„<code>stateLabel</code>å’Œ<code>lastUpdatedTimeLabel</code>çš„å¸ƒå±€å’Œä¸åŒçŠ¶æ€ä¸‹å†…éƒ¨æ–‡å­—çš„æ˜¾ç¤ºã€‚</li>
<li><code>MJRefreshNormalHeader</code>:è´Ÿè´£headerå†…éƒ¨çš„<code>loadingView</code>ä»¥åŠ<code>arrowView</code>çš„å¸ƒå±€å’Œä¸åŒçŠ¶æ€ä¸‹çš„æ˜¾ç¤ºã€‚</li>
</ul>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæƒ³è¦å¢åŠ æŸç§ç±»å‹çš„headerï¼Œåªè¦åœ¨æŸä¸€å±‚ä¸Šåšæ–‡ç« å³å¯ã€‚ä¾‹å¦‚è¯¥æ¡†æ¶é‡Œçš„<code>MJRefreshGifHeader</code>,å®ƒå’Œ<code>MJRefreshNormalHeader</code>å±äºåŒä¸€çº§ï¼Œéƒ½æ˜¯ç»§æ‰¿äº<code>MJRefreshStateHeader</code>ã€‚å› ä¸ºäºŒè€…éƒ½å…·æœ‰ç›¸åŒå½¢å¼çš„<code>stateLabel</code>å’Œ<code>lastUpdatedTimeLabel</code>ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯å·¦ä¾§çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li><code>MJRefreshNormalHeader</code>çš„å·¦ä¾§æ˜¯ç®­å¤´ã€‚</li>
<li><code>MJRefreshGifHeader</code>çš„å·¦ä¾§åˆ™æ˜¯ä¸€ä¸ªgifåŠ¨ç”»ã€‚</li>
</ul>
<p>è¿˜æ˜¯æä¾›ä¸€å¼ å›¾æ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹ï¼š<br><img src="http://oih3a9o4n.bkt.clouddn.com/MJRefresh_5.png" alt="normalHeader ä¸ gifHeader"></p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹çš„å®ç°ï¼š</p>
<h2 id="MJRefreshGifHeader"><a href="#MJRefreshGifHeader" class="headerlink" title="MJRefreshGifHeader"></a>MJRefreshGifHeader</h2><p>å®ƒæä¾›äº†ä¸¤ä¸ªæ¥å£ï¼Œæ˜¯ç”¨æ¥è®¾ç½®ä¸åŒçŠ¶æ€ä¸‹ä½¿ç”¨çš„å›¾ç‰‡æ•°ç»„çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setImages:(<span class="built_in">NSArray</span> *)images duration:(<span class="built_in">NSTimeInterval</span>)duration forState:(MJRefreshState)state </div><div class="line">&#123; </div><div class="line">    <span class="keyword">if</span> (images == <span class="literal">nil</span>) <span class="keyword">return</span>; </div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®ä¸åŒçŠ¶æ€ä¸‹çš„å›¾ç‰‡ç»„å’ŒæŒç»­æ—¶é—´</span></div><div class="line">    <span class="keyword">self</span>.stateImages[@(state)] = images; </div><div class="line">    <span class="keyword">self</span>.stateDurations[@(state)] = @(duration); </div><div class="line">    </div><div class="line">    <span class="comment">/* æ ¹æ®å›¾ç‰‡è®¾ç½®æ§ä»¶çš„é«˜åº¦ */</span> </div><div class="line">    <span class="built_in">UIImage</span> *image = [images firstObject]; </div><div class="line">    <span class="keyword">if</span> (image.size.height &gt; <span class="keyword">self</span>.mj_h) &#123; </div><div class="line">        <span class="keyword">self</span>.mj_h = image.size.height; </div><div class="line">    &#125; </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setImages:(<span class="built_in">NSArray</span> *)images forState:(MJRefreshState)state </div><div class="line">&#123; </div><div class="line">   <span class="comment">//å¦‚æœæ²¡æœ‰ä¼ å…¥durationï¼Œåˆ™æ ¹æ®å›¾ç‰‡çš„å¤šå°‘æ¥è®¡ç®—</span></div><div class="line">    [<span class="keyword">self</span> setImages:images duration:images.count * <span class="number">0.1</span> forState:state]; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æœ‰å“ªäº›èŒèƒ½ï¼Ÿ-3"><a href="#æœ‰å“ªäº›èŒèƒ½ï¼Ÿ-3" class="headerlink" title="æœ‰å“ªäº›èŒèƒ½ï¼Ÿ"></a>æœ‰å“ªäº›èŒèƒ½ï¼Ÿ</h3><p>ç„¶åï¼Œå’Œ<code>MJRefreshNormalHeader</code>ä¸€æ ·ï¼Œå®ƒä¹Ÿé‡å†™äº†åŸºç±»æä¾›çš„ä¸‰ä¸ªæ–¹æ³•æ¥å®ç°æ˜¾ç¤ºgifå›¾ç‰‡çš„èŒèƒ½ã€‚</p>
<h3 id="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ-4"><a href="#èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ-4" class="headerlink" title="èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ"></a>èŒèƒ½å¦‚ä½•å®ç°ï¼Ÿ</h3><p>####1. åˆå§‹åŒ–å’Œlabelçš„é—´è·<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)prepare</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> prepare];</div><div class="line">    </div><div class="line">    <span class="comment">// åˆå§‹åŒ–é—´è·</span></div><div class="line">    <span class="keyword">self</span>.labelLeftInset = <span class="number">20</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>####2. æ ¹æ®labelçš„å®½åº¦å’Œå­˜åœ¨ä¸å¦è®¾ç½®gifçš„ä½ç½®<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)placeSubviews</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> placeSubviews];</div><div class="line">    </div><div class="line">    <span class="comment">//å¦‚æœçº¦æŸå­˜åœ¨ï¼Œå°±ç«‹å³è¿”å›</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.gifView.constraints.count) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.gifView.frame = <span class="keyword">self</span>.bounds;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.stateLabel.hidden &amp;&amp; <span class="keyword">self</span>.lastUpdatedTimeLabel.hidden) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//å¦‚æœstateLabelå’ŒlastUpdatedTimeLabeléƒ½åœ¨éšè—çŠ¶æ€ï¼Œå°†gifå‰§ä¸­æ˜¾ç¤º</span></div><div class="line">        <span class="keyword">self</span>.gifView.contentMode = <span class="built_in">UIViewContentModeCenter</span>;</div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//å¦‚æœstateLabelå’ŒlastUpdatedTimeLabelä¸­è‡³å°‘ä¸€ä¸ªå­˜åœ¨ï¼Œåˆ™æ ¹æ®labelçš„å®½åº¦è®¾ç½®gifçš„ä½ç½®</span></div><div class="line">        <span class="keyword">self</span>.gifView.contentMode = <span class="built_in">UIViewContentModeRight</span>;</div><div class="line">        </div><div class="line">        <span class="built_in">CGFloat</span> stateWidth = <span class="keyword">self</span>.stateLabel.mj_textWith;</div><div class="line">        <span class="built_in">CGFloat</span> timeWidth = <span class="number">0.0</span>;</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">self</span>.lastUpdatedTimeLabel.hidden) &#123;</div><div class="line">            timeWidth = <span class="keyword">self</span>.lastUpdatedTimeLabel.mj_textWith;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">CGFloat</span> textWidth = MAX(stateWidth, timeWidth);</div><div class="line">        <span class="keyword">self</span>.gifView.mj_w = <span class="keyword">self</span>.mj_w * <span class="number">0.5</span> - textWidth * <span class="number">0.5</span> - <span class="keyword">self</span>.labelLeftInset;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="3-æ ¹æ®ä¼ å…¥çŠ¶æ€çš„ä¸åŒæ¥è®¾ç½®åŠ¨ç”»"><a href="#3-æ ¹æ®ä¼ å…¥çŠ¶æ€çš„ä¸åŒæ¥è®¾ç½®åŠ¨ç”»" class="headerlink" title="3. æ ¹æ®ä¼ å…¥çŠ¶æ€çš„ä¸åŒæ¥è®¾ç½®åŠ¨ç”»"></a>3. æ ¹æ®ä¼ å…¥çŠ¶æ€çš„ä¸åŒæ¥è®¾ç½®åŠ¨ç”»</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setState:(MJRefreshState)state</div><div class="line">&#123;</div><div class="line">    MJRefreshCheckState</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (state == MJRefreshStatePulling || state == MJRefreshStateRefreshing) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//1. å¦‚æœä¼ è¿›æ¥çš„çŠ¶æ€æ˜¯å¯ä»¥åˆ·æ–°å’Œæ­£åœ¨åˆ·æ–°</span></div><div class="line">        <span class="built_in">NSArray</span> *images = <span class="keyword">self</span>.stateImages[@(state)];</div><div class="line">        <span class="keyword">if</span> (images.count == <span class="number">0</span>) <span class="keyword">return</span>;</div><div class="line">        </div><div class="line">        [<span class="keyword">self</span>.gifView stopAnimating];</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (images.count == <span class="number">1</span>) &#123;</div><div class="line">            <span class="comment">//1.1 å•å¼ å›¾ç‰‡</span></div><div class="line">            <span class="keyword">self</span>.gifView.image = [images lastObject];</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//1.2 å¤šå¼ å›¾ç‰‡</span></div><div class="line">            <span class="keyword">self</span>.gifView.animationImages = images;</div><div class="line">            <span class="keyword">self</span>.gifView.animationDuration = [<span class="keyword">self</span>.stateDurations[@(state)] doubleValue];</div><div class="line">            [<span class="keyword">self</span>.gifView startAnimating];</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == MJRefreshStateIdle) &#123;</div><div class="line">        <span class="comment">//2.å¦‚æœä¼ è¿›æ¥çš„çŠ¶æ€æ˜¯é»˜è®¤çŠ¶æ€</span></div><div class="line">        [<span class="keyword">self</span>.gifView stopAnimating];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>Footerç±»æ˜¯ç”¨æ¥å¤„ç†ä¸Šæ‹‰åŠ è½½çš„ï¼Œå®ç°åŸç†å’Œä¸‹æ‹‰åˆ·æ–°å¾ˆç±»ä¼¼ï¼Œåœ¨è¿™é‡Œå…ˆä¸ä»‹ç»äº†ï½</p>
<p>æ€»çš„æ¥è¯´ï¼Œè¯¥æ¡†æ¶è®¾è®¡å¾—éå¸¸å·¥æ•´ï¼šé€šè¿‡ä¸€ä¸ªåŸºç±»æ¥å®šä¹‰ä¸€äº›çŠ¶æ€å’Œä¸€äº›éœ€è¦å­ç±»å®ç°çš„æ¥å£ã€‚é€šè¿‡ä¸€å±‚ä¸€å±‚åœ°ç»§æ‰¿ï¼Œè®©æ¯ä¸€å±‚çš„å­ç±»å„å¸å…¶èŒï¼Œåªå®ŒæˆçœŸæ­£å±äºè‡ªå·±çš„ä»»åŠ¡ï¼Œæé«˜äº†æ¡†æ¶çš„å¯å®šåˆ¶æ€§ï¼Œè€Œä¸”å¯¹äºåŠŸèƒ½çš„æ‰©å±•å’Œbugçš„è¿½è¸ªä¹Ÿå¾ˆæœ‰å¸®åŠ©ï¼Œéå¸¸å€¼å¾—æˆ‘ä»¬å‚è€ƒä¸å€Ÿé‰´ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/CoderMJLee/MJRefresh&quot;&gt;MJRefresh&lt;/a&gt;æ˜¯ææ˜æ°è€å¸ˆçš„ä½œå“ï¼Œåˆ°ç°åœ¨å·²ç»æœ‰9800å¤šé¢—staräº†ï¼Œæ˜¯ä¸€ä¸ªç®€å•å®ç”¨ï¼ŒåŠŸèƒ½å¼ºå¤§çš„iOSä¸‹æ‹‰åˆ·æ–°ï¼ˆä¹Ÿæ”¯æŒä¸Šæ‹‰åŠ è½½æ›´å¤šï¼‰æ§ä»¶ã€‚å®ƒçš„å¯å®šåˆ¶æ€§å¾ˆé«˜ï¼Œå‡ ä¹å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†ä¸‹æ‹‰åˆ·æ–°çš„è®¾è®¡éœ€æ±‚ï¼Œå€¼å¾—å­¦ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ¡†æ¶çš„ç»“æ„è®¾è®¡å¾—å¾ˆæ¸…æ™°ï¼Œä½¿ç”¨ä¸€ä¸ªåŸºç±»&lt;code&gt;MJRefreshComponent&lt;/code&gt;æ¥åšä¸€äº›åŸºæœ¬çš„è®¾å®šï¼Œç„¶åé€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œè®©&lt;code&gt;MJRefreshHeader&lt;/code&gt;å’Œ&lt;code&gt;MJRefreshFooter&lt;/code&gt;åˆ†åˆ«å…·å¤‡ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½çš„åŠŸèƒ½ã€‚ä»ç»§æ‰¿æœºæ„æ¥çœ‹å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼Œå…·ä½“å¯ä»¥ä»ä¸‹é¢çš„å›¾é‡Œçœ‹å‡ºæ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://oih3a9o4n.bkt.clouddn.com/MJRefresh_1.png&quot; alt=&quot;æ¡†æ¶ç»„ç»‡ç»“æ„å›¾&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
      <category term="æºç è§£æ" scheme="https://github.com/knightsj/knightsj.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>SDWebImageæºç è§£æ</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/02/04/SDWebImage%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/02/04/SDWebImageæºç è§£æ/</id>
    <published>2017-02-04T01:24:37.000Z</published>
    <updated>2017-03-20T07:57:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç›¸ä¿¡å¯¹äºå¹¿å¤§çš„iOSå¼€å‘è€…ï¼Œå¯¹<a href="https://github.com/rs/SDWebImage">SDWebImage</a>å¹¶ä¸ä¼šé™Œç”Ÿï¼Œè¿™ä¸ªæ¡†æ¶é€šè¿‡ç»™UIImageViewå’ŒUIButtonæ·»åŠ åˆ†ç±»ï¼Œå®ç°ä¸€ä¸ªå¼‚æ­¥ä¸‹è½½å›¾ç‰‡å¹¶ä¸”æ”¯æŒç¼“å­˜çš„åŠŸèƒ½ã€‚æ•´ä¸ªæ¡†æ¶çš„æ¥å£éå¸¸ç®€æ´ï¼Œæ¯ä¸ªç±»çš„åˆ†å·¥éƒ½å¾ˆæ˜ç¡®ï¼Œæ˜¯å¾ˆå€¼å¾—å¤§å®¶å­¦ä¹ çš„ã€‚</p>
<p>åœ¨ä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªä¸‹è½½çš„urlå’Œå ä½å›¾å°±å¯ä»¥åœ¨å›è°ƒé‡Œæ‹¿åˆ°ä¸‹è½½åçš„å›¾ç‰‡ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[imageview sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"pic.jpg"</span>] placeholderImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"placeholder"</span>] completed:^(<span class="built_in">UIImage</span> * _Nullable image, <span class="built_in">NSError</span> * _Nullable error, SDImageCacheType cacheType, <span class="built_in">NSURL</span> * _Nullable imageURL) &#123;</div><div class="line">        </div><div class="line">        imageview.image = image;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å›¾ç‰‡åŠ è½½å®Œæˆ"</span>);</div><div class="line">        </div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p>è€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥ä¸è®¾ç½®å ä½å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨å›è°ƒçš„blockï¼Œéå¸¸çµæ´»:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å›¾ç‰‡ä¸‹è½½å®Œæˆåç›´æ¥æ˜¾ç¤ºä¸‹è½½åçš„å›¾ç‰‡</span></div><div class="line">[imageview sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"pic.jpg"</span>]];</div></pre></td></tr></table></figure>
<p>åœ¨æœ€å¼€å§‹å…ˆç®€å•ä»‹ç»è¿™ä¸ªæ¡†æ¶ï¼š</p>
<p>è¿™ä¸ªæ¡†æ¶çš„æ ¸å¿ƒç±»æ˜¯<code>SDWebImageManger</code>ï¼Œåœ¨å¤–éƒ¨æœ‰<code>UIImageView+WebCache</code> å’Œ <code>UIButton+WebCache</code> ä¸ºä¸‹è½½å›¾ç‰‡çš„æ“ä½œæä¾›æ¥å£ã€‚å†…éƒ¨æœ‰<code>SDWebImageManger</code>è´Ÿè´£å¤„ç†å’Œåè°ƒ <code>SDWebImageDownloader</code> å’Œ <code>SDWebImageCache</code>ï¼š<code>SDWebImageDownloader</code>è´Ÿè´£å…·ä½“çš„ä¸‹è½½ä»»åŠ¡ï¼Œ<code>SDWebImageCache</code>è´Ÿè´£å…³äºç¼“å­˜çš„å·¥ä½œï¼šæ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥è¯¢ç¼“å­˜ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å¤§è‡´çœ‹ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶çš„è°ƒç”¨æµç¨‹å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-7ad6493a2b2f0b43.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="SDWebImage"></p>
<p>ä»è¿™ä¸ªæµç¨‹å›¾é‡Œå¯ä»¥å¤§è‡´çœ‹å‡ºï¼Œè¯¥æ¡†æ¶åˆ†ä¸ºä¸¤ä¸ªå±‚ï¼šUIKitå±‚ï¼ˆè´Ÿè´£æ¥æ”¶ä¸‹è½½å‚æ•°ï¼‰å’Œå·¥å…·å±‚ï¼ˆè´Ÿè´£ä¸‹è½½æ“ä½œå’Œç¼“å­˜ï¼‰ã€‚</p>
<p>OKï½åŸºæœ¬æµç¨‹å¤§æ¦‚æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ¯ä¸ªå±‚å…·ä½“å®ç°å§ï½</p>
<a id="more"></a>
<hr>
<p>##UIKitå±‚</p>
<p>è¯¥æ¡†æ¶æœ€å¤–å±‚çš„ç±»æ˜¯<code>UIImageView +WebCache</code>ï¼Œæˆ‘ä»¬å°†å›¾ç‰‡çš„URLï¼Œå ä½å›¾ç‰‡ç›´æ¥ç»™è¿™ä¸ªç±»ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªç±»çš„å…¬å…±æ¥å£ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  UIImageView + WebCache.h ============== //</span></div><div class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url;</div><div class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">          placeholderImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)placeholder;</div><div class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">          placeholderImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)placeholder</div><div class="line">                   options:(SDWebImageOptions)options;</div><div class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                 completed:(<span class="keyword">nullable</span> SDExternalCompletionBlock)completedBlock;</div><div class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">          placeholderImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)placeholder</div><div class="line">                 completed:(<span class="keyword">nullable</span> SDExternalCompletionBlock)completedBlock;</div><div class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">          placeholderImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)placeholder</div><div class="line">                   options:(SDWebImageOptions)options</div><div class="line">                 completed:(<span class="keyword">nullable</span> SDExternalCompletionBlock)completedBlock;</div><div class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">          placeholderImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)placeholder</div><div class="line">                   options:(SDWebImageOptions)options</div><div class="line">                  progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                 completed:(<span class="keyword">nullable</span> SDExternalCompletionBlock)completedBlock;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç±»æä¾›çš„æ¥å£éå¸¸çµæ´»ï¼Œå¯ä»¥æ ¹æ®æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚æ¥è°ƒç”¨å…¶ä¸­æŸä¸€ä¸ªæ–¹æ³•ï¼Œè€Œè¿™äº›æ–¹æ³•åˆ°æœ€åéƒ½ä¼šèµ°åˆ°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ==============  UIView+ WebCache.m ============== //</span></div><div class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">          placeholderImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)placeholder</div><div class="line">                   options:(SDWebImageOptions)options</div><div class="line">                  progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                 completed:(<span class="keyword">nullable</span> SDExternalCompletionBlock)completedBlock;</div></pre></td></tr></table></figure>
<p>è€Œè¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œè°ƒç”¨çš„æ˜¯<code>UIView+WebCache</code>åˆ†ç±»çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ==============  UIView+ WebCache.m ============== //</span></div><div class="line">- (<span class="keyword">void</span>)sd_internalSetImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                  placeholderImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)placeholder</div><div class="line">                           options:(SDWebImageOptions)options</div><div class="line">                      operationKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)operationKey</div><div class="line">                     setImageBlock:(<span class="keyword">nullable</span> SDSetImageBlock)setImageBlock</div><div class="line">                          progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                         completed:(<span class="keyword">nullable</span> SDExternalCompletionBlock)completedBlock;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¸æ˜¯UIImageView+WebCacheè€Œè¦ä¸Šä¸€å±‚åˆ°UIViewçš„åˆ†ç±»é‡Œå‘¢ï¼Ÿ<br>å› ä¸ºSDWebImageæ¡†æ¶ä¹Ÿæ”¯æŒUIButtonçš„ä¸‹è½½å›¾ç‰‡ç­‰æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦åœ¨å®ƒä»¬çš„çˆ¶ç±»ï¼šUIViewé‡Œé¢ç»Ÿä¸€ä¸€ä¸ªä¸‹è½½æ–¹æ³•ã€‚</p>
</blockquote>
<p>ç®€å•çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼ˆçœç•¥çš„ä»£ç ç”¨â€¦ä»£æ›¿ï¼‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ==============  UIView+ WebCache.m ============== //</span></div><div class="line"></div><div class="line">   <span class="comment">//valid keyï¼šUIImageView || UIButton</span></div><div class="line">   <span class="built_in">NSString</span> *validOperationKey = operationKey ?: <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]);</div><div class="line">   <span class="comment">//UIView+WebCacheOperation çš„ operationDictionary</span></div><div class="line">   <span class="comment">//ä¸‹é¢è¿™è¡Œä»£ç æ˜¯ä¿è¯æ²¡æœ‰å½“å‰æ­£åœ¨è¿›è¡Œçš„å¼‚æ­¥ä¸‹è½½æ“ä½œ, ä½¿å®ƒä¸ä¼šä¸å³å°†è¿›è¡Œçš„æ“ä½œå‘ç”Ÿå†²çª</span></div><div class="line">   [<span class="keyword">self</span> sd_cancelImageLoadOperationWithKey:validOperationKey];</div><div class="line">   </div><div class="line"></div><div class="line">   <span class="comment">//æ·»åŠ ä¸´æ—¶çš„å ä½å›¾ï¼ˆåœ¨ä¸å»¶è¿Ÿæ·»åŠ å ä½å›¾çš„optionä¸‹ï¼‰</span></div><div class="line">   <span class="keyword">if</span> (!(options &amp; SDWebImageDelayPlaceholder)) &#123;</div><div class="line">       dispatch_main_async_safe(^&#123;</div><div class="line">           [<span class="keyword">self</span> sd_setImage:placeholder imageData:<span class="literal">nil</span> basedOnClassOrViaCustomSetImageBlock:setImageBlock];</div><div class="line">       &#125;);</div><div class="line">   &#125;    </div><div class="line">   <span class="comment">//å¦‚æœurlå­˜åœ¨</span></div><div class="line">   <span class="keyword">if</span> (url) &#123;     </div><div class="line">      ...</div><div class="line">       __<span class="keyword">weak</span> __<span class="keyword">typeof</span>(<span class="keyword">self</span>)wself = <span class="keyword">self</span>;</div><div class="line"></div><div class="line">      <span class="comment">//SDWebImageManagerä¸‹è½½å›¾ç‰‡</span></div><div class="line">       <span class="keyword">id</span> &lt;SDWebImageOperation&gt; operation = [SDWebImageManager.sharedManager loadImageWithURL:url options:options progress:progressBlock completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">BOOL</span> finished, <span class="built_in">NSURL</span> *imageURL) &#123;</div><div class="line">         </div><div class="line">           ...</div><div class="line">           <span class="comment">//dispatch_main_sync_safe : ä¿è¯blockèƒ½åœ¨ä¸»çº¿ç¨‹è¿›è¡Œ</span></div><div class="line">           dispatch_main_async_safe(^&#123;</div><div class="line">               </div><div class="line">               <span class="keyword">if</span> (!sself) &#123;</div><div class="line">                   <span class="keyword">return</span>;</div><div class="line">               &#125;               </div><div class="line">               <span class="keyword">if</span> (image &amp;&amp; (options &amp; SDWebImageAvoidAutoSetImage) &amp;&amp; completedBlock) &#123;</div><div class="line">                    <span class="comment">//imageï¼Œè€Œä¸”ä¸è‡ªåŠ¨æ›¿æ¢ placeholder image</span></div><div class="line">                   completedBlock(image, error, cacheType, url);</div><div class="line">                   <span class="keyword">return</span>;                    </div><div class="line">               &#125; <span class="keyword">else</span> <span class="keyword">if</span> (image) &#123;</div><div class="line">                   <span class="comment">//å­˜åœ¨imageï¼Œéœ€è¦é©¬ä¸Šæ›¿æ¢ placeholder image</span></div><div class="line">                   [sself sd_setImage:image imageData:data basedOnClassOrViaCustomSetImageBlock:setImageBlock];</div><div class="line">                   [sself sd_setNeedsLayout];                </div><div class="line">               &#125; <span class="keyword">else</span> &#123;                    </div><div class="line">                   <span class="comment">//æ²¡æœ‰imageï¼Œåœ¨å›¾ç‰‡ä¸‹è½½å®Œä¹‹åæ˜¾ç¤º placeholder image</span></div><div class="line">                   <span class="keyword">if</span> ((options &amp; SDWebImageDelayPlaceholder)) &#123;</div><div class="line">                       [sself sd_setImage:placeholder imageData:<span class="literal">nil</span> basedOnClassOrViaCustomSetImageBlock:setImageBlock];</div><div class="line">                       [sself sd_setNeedsLayout];</div><div class="line">                   &#125;</div><div class="line">               &#125;                </div><div class="line">               <span class="keyword">if</span> (completedBlock &amp;&amp; finished) &#123;</div><div class="line">                   completedBlock(image, error, cacheType, url);</div><div class="line">               &#125;</div><div class="line">           &#125;);</div><div class="line">       &#125;];</div><div class="line">       </div><div class="line">       <span class="comment">//åœ¨æ“ä½œç¼“å­˜å­—å…¸ï¼ˆoperationDictionaryï¼‰é‡Œæ·»åŠ operationï¼Œè¡¨ç¤ºå½“å‰çš„æ“ä½œæ­£åœ¨è¿›è¡Œ</span></div><div class="line">       [<span class="keyword">self</span> sd_setImageLoadOperation:operation forKey:validOperationKey];        </div><div class="line">   &#125; <span class="keyword">else</span> &#123;</div><div class="line">       <span class="comment">//å¦‚æœurlä¸å­˜åœ¨ï¼Œå°±åœ¨completedBlocké‡Œä¼ å…¥errorï¼ˆurlä¸ºç©ºï¼‰</span></div><div class="line">       dispatch_main_async_safe(^&#123;</div><div class="line">           [<span class="keyword">self</span> sd_removeActivityIndicator];</div><div class="line">           <span class="keyword">if</span> (completedBlock) &#123;</div><div class="line">               <span class="built_in">NSError</span> *error = [<span class="built_in">NSError</span> errorWithDomain:SDWebImageErrorDomain code:<span class="number">-1</span> userInfo:@&#123;<span class="built_in">NSLocalizedDescriptionKey</span> : <span class="string">@"Trying to load a nil url"</span>&#125;];</div><div class="line">               completedBlock(<span class="literal">nil</span>, error, SDImageCacheTypeNone, url);</div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨è¿™ä¸€å±‚ï¼Œä½¿ç”¨ä¸€ä¸ªå­—å…¸<code>operationDictionary</code>ä¸“é—¨ç”¨ä½œå­˜å‚¨æ“ä½œçš„ç¼“å­˜ï¼Œéšæ—¶æ·»åŠ ï¼Œåˆ é™¤æ“ä½œä»»åŠ¡ã€‚<br>è€Œè¿™ä¸ªå­—å…¸æ˜¯<code>UIView+WebCacheOperation</code>åˆ†ç±»çš„å…³è”å¯¹è±¡ï¼Œå®ƒçš„å­˜å–æ–¹æ³•ä½¿ç”¨è¿è¡Œæ—¶æ¥æ“ä½œï¼š</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  UIView+WebCacheOperation.m ============== //</span></div><div class="line"> <span class="comment">//è·å–å…³è”å¯¹è±¡ï¼šoperationsï¼ˆç”¨æ¥å­˜æ”¾æ“ä½œçš„å­—å…¸ï¼‰</span></div><div class="line">- (SDOperationsDictionary *)operationDictionary &#123;</div><div class="line">    SDOperationsDictionary *operations = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;loadOperationKey);</div><div class="line">    <span class="comment">//å­˜æ”¾æ“ä½œçš„å­—å…¸</span></div><div class="line">    <span class="keyword">if</span> (operations) &#123;</div><div class="line">        <span class="keyword">return</span> operations;</div><div class="line">    &#125;    </div><div class="line">    <span class="comment">//å¦‚æœæ²¡æœ‰ï¼Œå°±æ–°å»ºä¸€ä¸ª</span></div><div class="line">    operations = [<span class="built_in">NSMutableDictionary</span> dictionary];    </div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;loadOperationKey, operations, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">    <span class="keyword">return</span> operations;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨<code>UIImageView+WebCache</code>é‡Œç›´æ¥å…³è”è¿™ä¸ªå¯¹è±¡å‘¢ï¼Ÿæˆ‘è§‰å¾—è¿™é‡Œä½œè€…åº”è¯¥æ˜¯éµä»é¢å‘å¯¹è±¡çš„<strong>å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼šSingle responsibility principleï¼‰</strong>ï¼Œå°±è¿ç±»éƒ½è¦å±¥è¡Œè¿™ä¸ªèŒè´£ï¼Œä½•å†µåˆ†ç±»å‘¢ï¼Ÿè¿™é‡Œä½œè€…ä¸“é—¨åˆ›é€ ä¸€ä¸ªåˆ†ç±»<code>UIView+WebCacheOperation</code>æ¥ç®¡ç†æ“ä½œç¼“å­˜ï¼ˆå­—å…¸ï¼‰ã€‚</p>
</blockquote>
<p>åˆ°è¿™é‡Œï¼Œ<code>UIKit</code>å±‚ä¸Šé¢çš„ä¸œè¥¿éƒ½è®²å®Œäº†ï¼Œç°åœ¨å¼€å§‹æ­£å¼è®²è§£å·¥å…·å±‚ã€‚</p>
<h2 id="å·¥å…·å±‚"><a href="#å·¥å…·å±‚" class="headerlink" title="å·¥å…·å±‚"></a>å·¥å…·å±‚</h2><p>ä¸Šæ–‡æåˆ°è¿‡ï¼Œ<code>SDWebImageManager</code>åŒæ—¶ç®¡ç†<code>SDImageCache</code>å’Œ<code>SDWebImageDownloader</code>ä¸¤ä¸ªç±»ï¼Œå®ƒæ˜¯è¿™ä¸€å±‚çš„<strong>è€å¤§å“¥</strong>ã€‚åœ¨ä¸‹è½½ä»»åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œ<code>SDWebImageManager</code>é¦–å…ˆè®¿é—®<code>SDImageCache</code>æ¥æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œå¦‚æœæœ‰ç¼“å­˜ï¼Œç›´æ¥è¿”å›ç¼“å­˜çš„å›¾ç‰‡ã€‚å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œå°±å‘½ä»¤<code>SDWebImageDownloader</code>æ¥ä¸‹è½½å›¾ç‰‡ï¼Œä¸‹è½½æˆåŠŸåï¼Œå­˜å…¥ç¼“å­˜ï¼Œæ˜¾ç¤ºå›¾ç‰‡ã€‚ä»¥ä¸Šæ˜¯<code>SDWebImageManager</code>å¤§è‡´çš„å·¥ä½œæµç¨‹ã€‚</p>
<p>åœ¨è¯¦ç»†è®²è§£<code>SDWebImageManager</code>æ˜¯å¦‚ä½•ä¸‹è½½å›¾ç‰‡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªç±»çš„å‡ ä¸ªé‡è¦çš„å±æ€§ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  SDWebImageManager.h ============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readwrite</span>, <span class="keyword">nonnull</span>) SDImageCache *imageCache;<span class="comment">//ç®¡ç†ç¼“å­˜</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readwrite</span>, <span class="keyword">nonnull</span>) SDWebImageDownloader <span class="comment">//ä¸‹è½½å™¨*imageDownloader;</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nonnull</span>) <span class="built_in">NSMutableSet</span>&lt;<span class="built_in">NSURL</span> *&gt; *failedURLs;<span class="comment">//è®°å½•å¤±æ•ˆurlçš„åå•</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nonnull</span>) <span class="built_in">NSMutableArray</span>&lt;SDWebImageCombinedOperation *&gt; *runningOperations;<span class="comment">//è®°å½•å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ“ä½œ</span></div></pre></td></tr></table></figure>
<p><code>SDWebImageManager</code>ä¸‹è½½å›¾ç‰‡çš„æ–¹æ³•åªæœ‰ä¸€ä¸ªï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[SDWebImageManager.sharedManager loadImageWithURL:options:progress:completed:]</div></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  SDWebImageManager.m ============== //</span></div><div class="line">- (<span class="keyword">id</span> &lt;SDWebImageOperation&gt;)loadImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                                     options:(SDWebImageOptions)options</div><div class="line">                                    progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                                   completed:(<span class="keyword">nullable</span> SDInternalCompletionBlock)completedBlock &#123;</div><div class="line">     ...                             </div><div class="line">    <span class="comment">//åœ¨SDImageCacheé‡ŒæŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç¼“å­˜çš„å›¾ç‰‡</span></div><div class="line">    operation.cacheOperation = [<span class="keyword">self</span>.imageCache queryCacheOperationForKey:key done:^(<span class="built_in">UIImage</span> *cachedImage, <span class="built_in">NSData</span> *cachedData, SDImageCacheType cacheType) &#123;        </div><div class="line">        ...</div><div class="line">        <span class="comment">//ï¼ˆæ²¡æœ‰ç¼“å­˜å›¾ç‰‡ï¼‰ || ï¼ˆå³ä½¿æœ‰ç¼“å­˜å›¾ç‰‡ï¼Œä¹Ÿéœ€è¦æ›´æ–°ç¼“å­˜å›¾ç‰‡ï¼‰ || ï¼ˆä»£ç†æ²¡æœ‰å“åº”imageManager:shouldDownloadImageForURL:æ¶ˆæ¯ï¼Œé»˜è®¤è¿”å›yesï¼Œéœ€è¦ä¸‹è½½å›¾ç‰‡ï¼‰|| ï¼ˆimageManager:shouldDownloadImageForURL:è¿”å›yesï¼Œéœ€è¦ä¸‹è½½å›¾ç‰‡ï¼‰</span></div><div class="line">        <span class="keyword">if</span> ((!cachedImage || options &amp; SDWebImageRefreshCached) &amp;&amp; (![<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(imageManager:shouldDownloadImageForURL:)] || [<span class="keyword">self</span>.delegate imageManager:<span class="keyword">self</span> shouldDownloadImageForURL:url])) &#123;            </div><div class="line">            <span class="comment">//1. å­˜åœ¨ç¼“å­˜å›¾ç‰‡ &amp;&amp; å³ä½¿æœ‰ç¼“å­˜å›¾ç‰‡ä¹Ÿè¦ä¸‹è½½æ›´æ–°å›¾ç‰‡</span></div><div class="line">            <span class="keyword">if</span> (cachedImage &amp;&amp; options &amp; SDWebImageRefreshCached) &#123;</div><div class="line">                [<span class="keyword">self</span> callCompletionBlockForOperation:weakOperation completion:completedBlock image:cachedImage data:cachedData error:<span class="literal">nil</span> cacheType:cacheType finished:<span class="literal">YES</span> url:url];</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 2. å¦‚æœä¸å­˜åœ¨ç¼“å­˜å›¾ç‰‡</span></div><div class="line">            ...            </div><div class="line">            <span class="comment">//å¼€å¯ä¸‹è½½å™¨ä¸‹è½½</span></div><div class="line">            <span class="comment">//subOperationToken ç”¨æ¥æ ‡è®°å½“å‰çš„ä¸‹è½½ä»»åŠ¡ï¼Œä¾¿äºè¢«å–æ¶ˆ</span></div><div class="line">            SDWebImageDownloadToken *subOperationToken = [<span class="keyword">self</span>.imageDownloader downloadImageWithURL:url options:downloaderOptions progress:progressBlock completed:^(<span class="built_in">UIImage</span> *downloadedImage, <span class="built_in">NSData</span> *downloadedData, <span class="built_in">NSError</span> *error, <span class="built_in">BOOL</span> finished) &#123;</div><div class="line">                __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</div><div class="line">                <span class="keyword">if</span> (!strongOperation || strongOperation.isCancelled) &#123;</div><div class="line">                    <span class="comment">// 1. å¦‚æœä»»åŠ¡è¢«å–æ¶ˆï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œé¿å…å’Œå…¶ä»–çš„completedBlocké‡å¤</span></div><div class="line">                </div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error) &#123;</div><div class="line">                    </div><div class="line">                    <span class="comment">//2. å¦‚æœæœ‰é”™è¯¯</span></div><div class="line">                    <span class="comment">//2.1 åœ¨completedBlocké‡Œä¼ å…¥error</span></div><div class="line">                    [<span class="keyword">self</span> callCompletionBlockForOperation:strongOperation completion:completedBlock error:error url:url];</div><div class="line"></div><div class="line">							<span class="comment">//2.2 åœ¨é”™è¯¯urlåå•ä¸­æ·»åŠ å½“å‰çš„url</span></div><div class="line">                    <span class="keyword">if</span> (   error.code != <span class="built_in">NSURLErrorNotConnectedToInternet</span></div><div class="line">                        &amp;&amp; error.code != <span class="built_in">NSURLErrorCancelled</span></div><div class="line">                        &amp;&amp; error.code != <span class="built_in">NSURLErrorTimedOut</span></div><div class="line">                        &amp;&amp; error.code != <span class="built_in">NSURLErrorInternationalRoamingOff</span></div><div class="line">                        &amp;&amp; error.code != <span class="built_in">NSURLErrorDataNotAllowed</span></div><div class="line">                        &amp;&amp; error.code != <span class="built_in">NSURLErrorCannotFindHost</span></div><div class="line">                        &amp;&amp; error.code != <span class="built_in">NSURLErrorCannotConnectToHost</span>) &#123;</div><div class="line">                        </div><div class="line">                       <span class="keyword">@synchronized</span> (<span class="keyword">self</span>.failedURLs) &#123;</div><div class="line">                            [<span class="keyword">self</span>.failedURLs addObject:url];</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span> &#123;</div><div class="line">                    </div><div class="line">                    <span class="comment">//3. ä¸‹è½½æˆåŠŸ</span></div><div class="line">                    <span class="comment">//3.1 å¦‚æœéœ€è¦ä¸‹è½½å¤±è´¥åé‡æ–°ä¸‹è½½ï¼Œåˆ™å°†å½“å‰urlä»å¤±è´¥urlåå•é‡Œç§»é™¤</span></div><div class="line">                    <span class="keyword">if</span> ((options &amp; SDWebImageRetryFailed)) &#123;</div><div class="line">                        <span class="keyword">@synchronized</span> (<span class="keyword">self</span>.failedURLs) &#123;</div><div class="line">                            [<span class="keyword">self</span>.failedURLs removeObject:url];</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    </div><div class="line">                    <span class="comment">//3.2 è¿›è¡Œç¼“å­˜</span></div><div class="line">                    <span class="built_in">BOOL</span> cacheOnDisk = !(options &amp; SDWebImageCacheMemoryOnly);                   </div><div class="line">                    <span class="keyword">if</span> (options &amp; SDWebImageRefreshCached &amp;&amp; cachedImage &amp;&amp; !downloadedImage) &#123;</div><div class="line">                    </div><div class="line">                        <span class="comment">//ï¼ˆå³ä½¿ç¼“å­˜å­˜åœ¨ï¼Œä¹Ÿè¦åˆ·æ–°å›¾ç‰‡ï¼‰ &amp;&amp; ç¼“å­˜å›¾ç‰‡ &amp;&amp; ä¸å­˜åœ¨ä¸‹è½½åçš„å›¾ç‰‡ï¼šä¸åšæ“ä½œ</span></div><div class="line">                                           </div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (downloadedImage &amp;&amp; (!downloadedImage.images || (options &amp; SDWebImageTransformAnimatedImage)) &amp;&amp; [<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(imageManager:transformDownloadedImage:withURL:)]) &#123;</div><div class="line">                        </div><div class="line">          <span class="comment">//ï¼ˆä¸‹è½½å›¾ç‰‡æˆåŠŸ &amp;&amp; ï¼ˆæ²¡æœ‰åŠ¨å›¾||å¤„ç†åŠ¨å›¾ï¼‰ &amp;&amp; ï¼ˆä¸‹è½½ä¹‹åï¼Œç¼“å­˜ä¹‹å‰å¤„ç†å›¾ç‰‡ï¼‰               dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123;</span></div><div class="line">                            <span class="built_in">UIImage</span> *transformedImage = [<span class="keyword">self</span>.delegate imageManager:<span class="keyword">self</span> transformDownloadedImage:downloadedImage withURL:url];</div><div class="line"></div><div class="line">                            <span class="keyword">if</span> (transformedImage &amp;&amp; finished) &#123;</div><div class="line">                                <span class="built_in">BOOL</span> imageWasTransformed = ![transformedImage isEqual:downloadedImage];</div><div class="line">                                <span class="comment">// pass nil if the image was transformed, so we can recalculate the data from the image</span></div><div class="line">                                <span class="comment">//ç¼“å­˜å›¾ç‰‡</span></div><div class="line">                                [<span class="keyword">self</span>.imageCache storeImage:transformedImage imageData:(imageWasTransformed ? <span class="literal">nil</span> : downloadedData) forKey:key toDisk:cacheOnDisk completion:<span class="literal">nil</span>];</div><div class="line">                            &#125;</div><div class="line">                            <span class="comment">//å°†å›¾ç‰‡ä¼ å…¥completedBlock</span></div><div class="line">                            [<span class="keyword">self</span> callCompletionBlockForOperation:strongOperation completion:completedBlock image:transformedImage data:downloadedData error:<span class="literal">nil</span> cacheType:SDImageCacheTypeNone finished:finished url:url];</div><div class="line">                        &#125;);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        </div><div class="line">                        <span class="comment">//(å›¾ç‰‡ä¸‹è½½æˆåŠŸå¹¶ç»“æŸ)</span></div><div class="line">                        <span class="keyword">if</span> (downloadedImage &amp;&amp; finished) &#123;</div><div class="line">                            [<span class="keyword">self</span>.imageCache storeImage:downloadedImage imageData:downloadedData forKey:key toDisk:cacheOnDisk completion:<span class="literal">nil</span>];</div><div class="line">                        &#125;</div><div class="line">                        </div><div class="line">                        [<span class="keyword">self</span> callCompletionBlockForOperation:strongOperation completion:completedBlock image:downloadedImage data:downloadedData error:<span class="literal">nil</span> cacheType:SDImageCacheTypeNone finished:finished url:url];</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">					 <span class="comment">//å¦‚æœå®Œæˆï¼Œä»å½“å‰è¿è¡Œçš„æ“ä½œåˆ—è¡¨é‡Œç§»é™¤å½“å‰æ“ä½œ</span></div><div class="line">                <span class="keyword">if</span> (finished) &#123;</div><div class="line">                    [<span class="keyword">self</span> safelyRemoveOperationFromRunning:strongOperation];</div><div class="line">                &#125;</div><div class="line">            &#125;];</div><div class="line">            </div><div class="line">            <span class="comment">//å–æ¶ˆçš„block</span></div><div class="line">            operation.cancelBlock = ^&#123;</div><div class="line">            </div><div class="line">                <span class="comment">//å–æ¶ˆå½“å‰çš„token</span></div><div class="line">                [<span class="keyword">self</span>.imageDownloader cancel:subOperationToken];</div><div class="line">                __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</div><div class="line">                <span class="comment">//ä»å½“å‰è¿è¡Œçš„æ“ä½œåˆ—è¡¨é‡Œç§»é™¤å½“å‰æ“ä½œ</span></div><div class="line">                [<span class="keyword">self</span> safelyRemoveOperationFromRunning:strongOperation];</div><div class="line">            &#125;;</div><div class="line">        </div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cachedImage) &#123;</div><div class="line">            </div><div class="line">            <span class="comment">//å­˜åœ¨ç¼“å­˜å›¾ç‰‡</span></div><div class="line">            __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;            </div><div class="line">            <span class="comment">//è°ƒç”¨å®Œæˆçš„block</span></div><div class="line">            [<span class="keyword">self</span> callCompletionBlockForOperation:strongOperation completion:completedBlock image:cachedImage data:cachedData error:<span class="literal">nil</span> cacheType:cacheType finished:<span class="literal">YES</span> url:url];            </div><div class="line">            <span class="comment">//åˆ å»å½“å‰çš„çš„ä¸‹è½½æ“ä½œï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span></div><div class="line">            [<span class="keyword">self</span> safelyRemoveOperationFromRunning:operation];        </div><div class="line">        &#125; <span class="keyword">else</span> &#123;            </div><div class="line">            <span class="comment">//æ²¡æœ‰ç¼“å­˜çš„å›¾ç‰‡ï¼Œè€Œä¸”ä¸‹è½½è¢«ä»£ç†ç»ˆæ­¢äº†</span></div><div class="line">            __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</div><div class="line">           </div><div class="line">            <span class="comment">// è°ƒç”¨å®Œæˆçš„block</span></div><div class="line">            [<span class="keyword">self</span> callCompletionBlockForOperation:strongOperation completion:completedBlock image:<span class="literal">nil</span> data:<span class="literal">nil</span> error:<span class="literal">nil</span> cacheType:SDImageCacheTypeNone finished:<span class="literal">YES</span> url:url];            </div><div class="line">            <span class="comment">//åˆ å»å½“å‰çš„ä¸‹è½½æ“ä½œ</span></div><div class="line">            [<span class="keyword">self</span> safelyRemoveOperationFromRunning:operation];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> operation;                                                             </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹å®Œäº†<code>SDWebImageManager</code>çš„å›è°ƒå¤„ç†ï¼Œæˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹<br><code>SDImageCache</code>å’Œ<code>SDWebImageDownloader</code>å†…éƒ¨å…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹<code>SDImageCache</code>ï¼š</p>
<h3 id="SDImageCache"><a href="#SDImageCache" class="headerlink" title="SDImageCache"></a>SDImageCache</h3><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  SDImageCache.m ============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nonnull</span>) <span class="built_in">NSCache</span> *memCache;<span class="comment">//å†…å­˜ç¼“å­˜</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nonnull</span>) <span class="built_in">NSString</span> *diskCachePath;<span class="comment">//ç£ç›˜ç¼“å­˜è·¯å¾„</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSString</span> *&gt; *customPaths;<span class="comment">//</span></div><div class="line"><span class="keyword">@property</span> (SDDispatchQueueSetterSementics, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">dispatch_queue_t</span> <span class="comment">//ioQueueå”¯ä¸€å­çº¿ç¨‹;</span></div></pre></td></tr></table></figure>
<h4 id="æ ¸å¿ƒæ–¹æ³•ï¼šæŸ¥è¯¢ç¼“å­˜"><a href="#æ ¸å¿ƒæ–¹æ³•ï¼šæŸ¥è¯¢ç¼“å­˜" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•ï¼šæŸ¥è¯¢ç¼“å­˜"></a>æ ¸å¿ƒæ–¹æ³•ï¼šæŸ¥è¯¢ç¼“å­˜</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  SDImageCache.m ============== //</span></div><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSOperation</span> *)queryCacheOperationForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key done:(<span class="keyword">nullable</span> SDCacheQueryCompletedBlock)doneBlock &#123;   </div><div class="line">    <span class="keyword">if</span> (!key) &#123;</div><div class="line">        <span class="keyword">if</span> (doneBlock) &#123;</div><div class="line">            doneBlock(<span class="literal">nil</span>, <span class="literal">nil</span>, SDImageCacheTypeNone);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;		</div><div class="line">    <span class="comment">//================æŸ¥çœ‹å†…å­˜çš„ç¼“å­˜=================//</span></div><div class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageFromMemoryCacheForKey:key];    </div><div class="line">    <span class="comment">// å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è°ƒç”¨blockï¼Œå°†imageï¼Œdataï¼ŒCaheTypeä¼ è¿›å»</span></div><div class="line">    <span class="keyword">if</span> (image) &#123;    </div><div class="line">        <span class="built_in">NSData</span> *diskData = <span class="literal">nil</span>;        </div><div class="line">        <span class="comment">//å¦‚æœæ˜¯gifï¼Œå°±æ‹¿åˆ°dataï¼Œåé¢è¦ä¼ åˆ°doneBlocké‡Œã€‚ä¸æ˜¯gifå°±ä¼ nil</span></div><div class="line">        <span class="keyword">if</span> ([image isGIF]) &#123;</div><div class="line">            diskData = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</div><div class="line">        &#125;        </div><div class="line">        <span class="keyword">if</span> (doneBlock) &#123;</div><div class="line">            doneBlock(image, diskData, SDImageCacheTypeMemory);</div><div class="line">        &#125;        </div><div class="line">        <span class="comment">//å› ä¸ºå›¾ç‰‡æœ‰ç¼“å­˜å¯ä¾›ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸ç”¨å®ä¾‹åŒ–NSOperationï¼Œç›´æ¥èŒƒå›´nil</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//================æŸ¥çœ‹ç£ç›˜çš„ç¼“å­˜=================//</span></div><div class="line">    <span class="built_in">NSOperation</span> *operation = [<span class="built_in">NSOperation</span> new];    </div><div class="line">    <span class="comment">//å”¯ä¸€çš„å­çº¿ç¨‹ï¼šself.ioQueue</span></div><div class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;        </div><div class="line">        <span class="keyword">if</span> (operation.isCancelled) &#123;</div><div class="line">            <span class="comment">// åœ¨ç”¨ä¹‹å‰å°±åˆ¤æ–­operationæ˜¯å¦è¢«å–æ¶ˆäº†ï¼Œä½œè€…è€ƒè™‘çš„éå¸¸ä¸¥è°¨</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">@autoreleasepool</span> &#123;            </div><div class="line">            <span class="built_in">NSData</span> *diskData = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</div><div class="line">            <span class="built_in">UIImage</span> *diskImage = [<span class="keyword">self</span> diskImageForKey:key];            </div><div class="line">            <span class="keyword">if</span> (diskImage &amp;&amp; <span class="keyword">self</span>.config.shouldCacheImagesInMemory) &#123;</div><div class="line">                  <span class="comment">// cost è¢«ç”¨æ¥è®¡ç®—ç¼“å­˜ä¸­æ‰€æœ‰å¯¹è±¡çš„ä»£ä»·ã€‚å½“å†…å­˜å—é™æˆ–è€…æ‰€æœ‰ç¼“å­˜å¯¹è±¡çš„æ€»ä»£ä»·è¶…è¿‡äº†æœ€å¤§å…è®¸çš„å€¼æ—¶ï¼Œç¼“å­˜ä¼šç§»é™¤å…¶ä¸­çš„ä¸€äº›å¯¹è±¡ã€‚</span></div><div class="line">                <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(diskImage);                </div><div class="line">                <span class="comment">//å­˜å…¥å†…å­˜ç¼“å­˜ä¸­</span></div><div class="line">                [<span class="keyword">self</span>.memCache setObject:diskImage forKey:key cost:cost];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (doneBlock) &#123;</div><div class="line">                <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                    doneBlock(diskImage, diskData, SDImageCacheTypeDisk);</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> operation;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SDWebImageDownloader"><a href="#SDWebImageDownloader" class="headerlink" title="SDWebImageDownloader"></a>SDWebImageDownloader</h3><h4 id="å±æ€§-1"><a href="#å±æ€§-1" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  SDWebImageDownloader.m ============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nonnull</span>) <span class="built_in">NSOperationQueue</span> *downloadQueue;<span class="comment">//ä¸‹è½½é˜Ÿåˆ—</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">NSOperation</span> *lastAddedOperation;<span class="comment">//æœ€åæ·»åŠ çš„ä¸‹è½½æ“ä½œ</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) Class operationClass;<span class="comment">//æ“ä½œç±»</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nonnull</span>) <span class="built_in">NSMutableDictionary</span>&lt;<span class="built_in">NSURL</span> *, SDWebImageDownloaderOperation *&gt; *URLOperations;<span class="comment">//æ“ä½œæ•°ç»„</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) SDHTTPHeadersMutableDictionary *HTTPHeaders;<span class="comment">//HTTPè¯·æ±‚å¤´</span></div><div class="line"><span class="keyword">@property</span> (SDDispatchQueueSetterSementics, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">dispatch_queue_t</span> barrierQueue;<span class="comment">//ç”¨æ¥é˜»å¡å‰é¢çš„ä¸‹è½½çº¿ç¨‹ï¼ˆä¸²è¡ŒåŒ–ï¼‰</span></div></pre></td></tr></table></figure>
<h4 id="æ ¸å¿ƒæ–¹æ³•ï¼šä¸‹è½½å›¾ç‰‡"><a href="#æ ¸å¿ƒæ–¹æ³•ï¼šä¸‹è½½å›¾ç‰‡" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•ï¼šä¸‹è½½å›¾ç‰‡"></a>æ ¸å¿ƒæ–¹æ³•ï¼šä¸‹è½½å›¾ç‰‡</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  SDWebImageDownloader.m ============== //</span></div><div class="line">- (<span class="keyword">nullable</span> SDWebImageDownloadToken *)downloadImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                                                   options:(SDWebImageDownloaderOptions)options</div><div class="line">                                                  progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                                                 completed:(<span class="keyword">nullable</span> SDWebImageDownloaderCompletedBlock)completedBlock &#123;</div><div class="line">    __<span class="keyword">weak</span> SDWebImageDownloader *wself = <span class="keyword">self</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> addProgressCallback:progressBlock completedBlock:completedBlock forURL:url createCallback:^SDWebImageDownloaderOperation *&#123;</div><div class="line">        </div><div class="line">        __<span class="keyword">strong</span> __<span class="keyword">typeof</span> (wself) sself = wself;</div><div class="line">        </div><div class="line">        <span class="built_in">NSTimeInterval</span> timeoutInterval = sself.downloadTimeout;</div><div class="line">        <span class="keyword">if</span> (timeoutInterval == <span class="number">0.0</span>) &#123;</div><div class="line">            timeoutInterval = <span class="number">15.0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// In order to prevent from potential duplicate caching (NSURLCache + SDImageCache) we disable the cache for image requests if told otherwise</span></div><div class="line">        </div><div class="line">        <span class="comment">//åˆ›å»ºä¸‹è½½è¯·æ±‚</span></div><div class="line">        <span class="built_in">NSMutableURLRequest</span> *request = [[<span class="built_in">NSMutableURLRequest</span> alloc] initWithURL:url cachePolicy:(options &amp; SDWebImageDownloaderUseNSURLCache ? <span class="built_in">NSURLRequestUseProtocolCachePolicy</span> : <span class="built_in">NSURLRequestReloadIgnoringLocalCacheData</span>) timeoutInterval:timeoutInterval];</div><div class="line">        request.HTTPShouldHandleCookies = (options &amp; SDWebImageDownloaderHandleCookies);</div><div class="line">        request.HTTPShouldUsePipelining = <span class="literal">YES</span>;</div><div class="line">        <span class="keyword">if</span> (sself.headersFilter) &#123;</div><div class="line">            request.allHTTPHeaderFields = sself.headersFilter(url, [sself.HTTPHeaders <span class="keyword">copy</span>]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            request.allHTTPHeaderFields = sself.HTTPHeaders;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//åˆ›å»ºä¸‹è½½æ“ä½œï¼šSDWebImageDownloaderOperationç”¨äºè¯·æ±‚ç½‘ç»œèµ„æºçš„æ“ä½œï¼Œå®ƒæ˜¯ä¸€ä¸ª NSOperation çš„å­ç±»</span></div><div class="line">        SDWebImageDownloaderOperation *operation = [[sself.operationClass alloc] initWithRequest:request inSession:sself.session options:options];</div><div class="line">        operation.shouldDecompressImages = sself.shouldDecompressImages;</div><div class="line">        </div><div class="line">        <span class="comment">//urlè¯ä¹¦</span></div><div class="line">        <span class="keyword">if</span> (sself.urlCredential) &#123;</div><div class="line">            operation.credential = sself.urlCredential;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sself.username &amp;&amp; sself.password) &#123;</div><div class="line">            operation.credential = [<span class="built_in">NSURLCredential</span> credentialWithUser:sself.username password:sself.password persistence:<span class="built_in">NSURLCredentialPersistenceForSession</span>];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//ä¼˜å…ˆçº§</span></div><div class="line">        <span class="keyword">if</span> (options &amp; SDWebImageDownloaderHighPriority) &#123;</div><div class="line">            operation.queuePriority = <span class="built_in">NSOperationQueuePriorityHigh</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options &amp; SDWebImageDownloaderLowPriority) &#123;</div><div class="line">            operation.queuePriority = <span class="built_in">NSOperationQueuePriorityLow</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//åœ¨ä¸‹è½½é˜Ÿåˆ—é‡Œæ·»åŠ ä¸‹è½½æ“ä½œï¼Œæ‰§è¡Œä¸‹è½½æ“ä½œ</span></div><div class="line">        [sself.downloadQueue addOperation:operation];</div><div class="line">        </div><div class="line">        <span class="comment">//å¦‚æœåè¿›å…ˆå‡º</span></div><div class="line">        <span class="keyword">if</span> (sself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) &#123;</div><div class="line">            <span class="comment">// Emulate LIFO execution order by systematically adding new operations as last operation's dependency</span></div><div class="line">            <span class="comment">//addDependency:å‚æ•°opertaionå€æ·»åŠ åˆ°NSOperationQueueåï¼Œåªæœ‰ç­‰è¯¥opertionç»“æŸåæ‰èƒ½æ‰§è¡Œå…¶ä»–çš„operationï¼Œå®ç°äº†åè¿›å…ˆå‡º</span></div><div class="line">            [sself.lastAddedOperation addDependency:operation];</div><div class="line">            sself.lastAddedOperation = operation;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> operation;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ª<code>addProgressCallback: progressBlock: completedBlock: forURL: createCallback:</code>æ–¹æ³•ï¼Œç”¨æ¥ä¿å­˜<code>progressBlock</code>å’Œ<code>completedBlock</code>ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// ==============  SDWebImageDownloader.m ============== //</span></div><div class="line">- (<span class="keyword">nullable</span> SDWebImageDownloadToken *)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                                           completedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock</div><div class="line">                                                   forURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url</div><div class="line">                                           createCallback:(SDWebImageDownloaderOperation *(^)())createCallback &#123;</div><div class="line"></div><div class="line">    <span class="comment">// url ç”¨æ¥ä½œä¸ºå›è°ƒå­—å…¸çš„keyï¼Œå¦‚æœä¸ºç©ºï¼Œç«‹å³è¿”å›å¤±è´¥ </span></div><div class="line">    <span class="keyword">if</span> (url == <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (completedBlock != <span class="literal">nil</span>) &#123;</div><div class="line">            completedBlock(<span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">NO</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    __block SDWebImageDownloadToken *token = <span class="literal">nil</span>;</div><div class="line">    <span class="comment">//ä¸²è¡ŒåŒ–å‰é¢æ‰€æœ‰çš„æ“ä½œ</span></div><div class="line">    dispatch_barrier_sync(<span class="keyword">self</span>.barrierQueue, ^&#123;    </div><div class="line">        	<span class="comment">//å½“å‰ä¸‹è½½æ“ä½œä¸­å–å‡ºSDWebImageDownloaderOperationå®ä¾‹</span></div><div class="line">        SDWebImageDownloaderOperation *operation = <span class="keyword">self</span>.URLOperations[url];        </div><div class="line">        <span class="keyword">if</span> (!operation) &#123;</div><div class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰ï¼Œå°±åˆå§‹åŒ–å®ƒ</span></div><div class="line">            operation = createCallback();</div><div class="line">            <span class="keyword">self</span>.URLOperations[url] = operation;</div><div class="line">            __<span class="keyword">weak</span> SDWebImageDownloaderOperation *woperation = operation;</div><div class="line">            </div><div class="line">            operation.completionBlock = ^&#123;</div><div class="line">              SDWebImageDownloaderOperation *soperation = woperation;</div><div class="line">              <span class="keyword">if</span> (!soperation) <span class="keyword">return</span>;</div><div class="line">              <span class="keyword">if</span> (<span class="keyword">self</span>.URLOperations[url] == soperation) &#123;</div><div class="line">                  [<span class="keyword">self</span>.URLOperations removeObjectForKey:url];</div><div class="line">              &#125;;</div><div class="line">            &#125;;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">id</span> downloadOperationCancelToken = [operation addHandlersForProgress:progressBlock completed:completedBlock];</div><div class="line">        <span class="comment">//è¿™é‡Œ downloadOperationCancelToken é»˜è®¤æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå­˜æ”¾ progressBlock å’Œ completedBlock</span></div><div class="line">        token = [SDWebImageDownloadToken new];</div><div class="line">        token.url = url;</div><div class="line">        token.downloadOperationCancelToken = downloadOperationCancelToken;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> token;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡ŒçœŸæ­£ä¿å­˜ä¸¤ä¸ªblockçš„æ–¹æ³•æ˜¯<code>addHandlersForProgress: completed:</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>)addHandlersForProgress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock</div><div class="line">                            completed:(<span class="keyword">nullable</span> SDWebImageDownloaderCompletedBlock)completedBlock &#123;</div><div class="line">    <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªSDCallbacksDictionaryï¼Œå­˜æ”¾ä¸€ä¸ªprogressBlock å’Œ completedBlock</span></div><div class="line">    SDCallbacksDictionary *callbacks = [<span class="built_in">NSMutableDictionary</span> new];</div><div class="line">    <span class="keyword">if</span> (progressBlock) callbacks[kProgressCallbackKey] = [progressBlock <span class="keyword">copy</span>];</div><div class="line">    <span class="keyword">if</span> (completedBlock) callbacks[kCompletedCallbackKey] = [completedBlock <span class="keyword">copy</span>];</div><div class="line">    dispatch_barrier_async(<span class="keyword">self</span>.barrierQueue, ^&#123;</div><div class="line">        <span class="comment">//æ·»åŠ åˆ°ç¼“å­˜ä¸­ self.callbackBlocks</span></div><div class="line">        [<span class="keyword">self</span>.callbackBlocks addObject:callbacks];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> callbacks;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œ<code>SDWebImage</code>çš„æ ¸å¿ƒæ–¹æ³•éƒ½è®²è§£å®Œæ¯•äº†ï¼Œå…¶ä»–æ²¡æœ‰è®²åˆ°çš„éƒ¨åˆ†ä»¥åä¼šæ…¢æ…¢æ·»åŠ ä¸Šå»ã€‚</p>
<h2 id="æœ€åçœ‹ä¸€ä¸‹ä¸€äº›æ¯”è¾ƒé›¶æ•£çš„çŸ¥è¯†ç‚¹ï¼š"><a href="#æœ€åçœ‹ä¸€ä¸‹ä¸€äº›æ¯”è¾ƒé›¶æ•£çš„çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="æœ€åçœ‹ä¸€ä¸‹ä¸€äº›æ¯”è¾ƒé›¶æ•£çš„çŸ¥è¯†ç‚¹ï¼š"></a>æœ€åçœ‹ä¸€ä¸‹ä¸€äº›æ¯”è¾ƒé›¶æ•£çš„çŸ¥è¯†ç‚¹ï¼š</h2><hr>
<h4 id="1-è¿è¡Œæ—¶å­˜å–å…³è”å¯¹è±¡ï¼š"><a href="#1-è¿è¡Œæ—¶å­˜å–å…³è”å¯¹è±¡ï¼š" class="headerlink" title="1. è¿è¡Œæ—¶å­˜å–å…³è”å¯¹è±¡ï¼š"></a>1. è¿è¡Œæ—¶å­˜å–å…³è”å¯¹è±¡ï¼š</h4><p><strong>å­˜ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">objc_setAssociatedObject(<span class="keyword">self</span>, &amp;loadOperationKey, operations, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line"><span class="comment">//å°†operationså¯¹è±¡å…³è”ç»™selfï¼Œåœ°å€ä¸º&amp;loadOperationKeyï¼Œè¯­ä¹‰æ˜¯OBJC_ASSOCIATION_RETAIN_NONATOMICã€‚</span></div></pre></td></tr></table></figure>
<p><strong>å–ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SDOperationsDictionary *operations = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;loadOperationKey);</div><div class="line"><span class="comment">//å°†operationså¯¹è±¡é€šè¿‡åœ°å€&amp;loadOperationKeyä»selfé‡Œå–å‡ºæ¥</span></div></pre></td></tr></table></figure>
<h4 id="2-æ•°ç»„çš„å†™æ“ä½œéœ€è¦åŠ é”ï¼ˆå¤šçº¿ç¨‹è®¿é—®ï¼Œé¿å…è¦†å†™ï¼‰"><a href="#2-æ•°ç»„çš„å†™æ“ä½œéœ€è¦åŠ é”ï¼ˆå¤šçº¿ç¨‹è®¿é—®ï¼Œé¿å…è¦†å†™ï¼‰" class="headerlink" title="2. æ•°ç»„çš„å†™æ“ä½œéœ€è¦åŠ é”ï¼ˆå¤šçº¿ç¨‹è®¿é—®ï¼Œé¿å…è¦†å†™ï¼‰"></a>2. æ•°ç»„çš„å†™æ“ä½œéœ€è¦åŠ é”ï¼ˆå¤šçº¿ç¨‹è®¿é—®ï¼Œé¿å…è¦†å†™ï¼‰</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ç»™self.runningOperationsåŠ é”</span></div><div class="line"><span class="comment">//self.runningOperationsæ•°ç»„çš„æ·»åŠ æ“ä½œ</span></div><div class="line">    <span class="keyword">@synchronized</span> (<span class="keyword">self</span>.runningOperations) &#123;</div><div class="line">        [<span class="keyword">self</span>.runningOperations addObject:operation];</div><div class="line">    &#125;</div><div class="line"><span class="comment">//self.runningOperationsæ•°ç»„çš„åˆ é™¤æ“ä½œ</span></div><div class="line">- (<span class="keyword">void</span>)safelyRemoveOperationFromRunning:(<span class="keyword">nullable</span> SDWebImageCombinedOperation*)operation &#123;</div><div class="line">    <span class="keyword">@synchronized</span> (<span class="keyword">self</span>.runningOperations) &#123;</div><div class="line">        <span class="keyword">if</span> (operation) &#123;</div><div class="line">            [<span class="keyword">self</span>.runningOperations removeObject:operation];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-ç¡®ä¿åœ¨ä¸»çº¿ç¨‹çš„å®ï¼š"><a href="#3-ç¡®ä¿åœ¨ä¸»çº¿ç¨‹çš„å®ï¼š" class="headerlink" title="3. ç¡®ä¿åœ¨ä¸»çº¿ç¨‹çš„å®ï¼š"></a>3. ç¡®ä¿åœ¨ä¸»çº¿ç¨‹çš„å®ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">dispatch_main_async_safe(^&#123;</div><div class="line"> 				 <span class="comment">//å°†ä¸‹é¢è¿™æ®µä»£ç æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­</span></div><div class="line">            [<span class="keyword">self</span> sd_setImage:placeholder imageData:<span class="literal">nil</span> basedOnClassOrViaCustomSetImageBlock:setImageBlock];</div><div class="line">        &#125;);</div><div class="line"></div><div class="line"><span class="comment">//å®å®šä¹‰ï¼š</span></div><div class="line"><span class="meta">#define dispatch_main_async_safe(block)\</span></div><div class="line">    <span class="keyword">if</span> (strcmp(dispatch_queue_get_label(DISPATCH_CURRENT_QUEUE_LABEL), dispatch_queue_get_label(dispatch_get_main_queue())) == <span class="number">0</span>) &#123;\</div><div class="line">        block();\</div><div class="line">    &#125; <span class="keyword">else</span> &#123;\</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), block);\</div><div class="line">    &#125;</div><div class="line"><span class="meta">#endif</span></div></pre></td></tr></table></figure>
<h4 id="4-è®¾ç½®ä¸èƒ½ä¸ºnilçš„å‚æ•°"><a href="#4-è®¾ç½®ä¸èƒ½ä¸ºnilçš„å‚æ•°" class="headerlink" title="4. è®¾ç½®ä¸èƒ½ä¸ºnilçš„å‚æ•°"></a>4. è®¾ç½®ä¸èƒ½ä¸ºnilçš„å‚æ•°</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">nonnull</span> <span class="keyword">instancetype</span>)initWithCache:(<span class="keyword">nonnull</span> SDImageCache *)cache downloader:(<span class="keyword">nonnull</span> SDWebImageDownloader *)downloader &#123;</div><div class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">        _imageCache = cache;</div><div class="line">        _imageDownloader = downloader;</div><div class="line">        _failedURLs = [<span class="built_in">NSMutableSet</span> new];</div><div class="line">        _runningOperations = [<span class="built_in">NSMutableArray</span> new];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœåœ¨å‚æ•°é‡Œæ·»åŠ äº†nonnullå…³é”®å­—ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±å¯ä»¥æ£€æŸ¥ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºnilï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šæœ‰è­¦å‘Š</p>
</blockquote>
<h4 id="5-å®¹é”™ï¼Œå¼ºåˆ¶è½¬æ¢ç±»å‹"><a href="#5-å®¹é”™ï¼Œå¼ºåˆ¶è½¬æ¢ç±»å‹" class="headerlink" title="5. å®¹é”™ï¼Œå¼ºåˆ¶è½¬æ¢ç±»å‹"></a>5. å®¹é”™ï¼Œå¼ºåˆ¶è½¬æ¢ç±»å‹</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ([url isKindOfClass:<span class="built_in">NSString</span>.class]) &#123;</div><div class="line">        url = [<span class="built_in">NSURL</span> URLWithString:(<span class="built_in">NSString</span> *)url];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨ä¼ å…¥çš„å‚æ•°ä¸ºNSStringæ—¶ï¼ˆä½†æ˜¯æ–¹æ³•å‚æ•°è¦æ±‚æ˜¯NSURLï¼‰ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºNSURL</p>
</blockquote>
<hr>
<p>è²Œä¼¼è¿˜æœ‰å›¾ç‰‡è§£ç ç­‰å†…å®¹æ²¡æœ‰è¯¦ç»†çœ‹ï¼Œä»¥åä¼šé€æ¸è¡¥å……å“’ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç›¸ä¿¡å¯¹äºå¹¿å¤§çš„iOSå¼€å‘è€…ï¼Œå¯¹&lt;a href=&quot;https://github.com/rs/SDWebImage&quot;&gt;SDWebImage&lt;/a&gt;å¹¶ä¸ä¼šé™Œç”Ÿï¼Œè¿™ä¸ªæ¡†æ¶é€šè¿‡ç»™UIImageViewå’ŒUIButtonæ·»åŠ åˆ†ç±»ï¼Œå®ç°ä¸€ä¸ªå¼‚æ­¥ä¸‹è½½å›¾ç‰‡å¹¶ä¸”æ”¯æŒç¼“å­˜çš„åŠŸèƒ½ã€‚æ•´ä¸ªæ¡†æ¶çš„æ¥å£éå¸¸ç®€æ´ï¼Œæ¯ä¸ªç±»çš„åˆ†å·¥éƒ½å¾ˆæ˜ç¡®ï¼Œæ˜¯å¾ˆå€¼å¾—å¤§å®¶å­¦ä¹ çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªä¸‹è½½çš„urlå’Œå ä½å›¾å°±å¯ä»¥åœ¨å›è°ƒé‡Œæ‹¿åˆ°ä¸‹è½½åçš„å›¾ç‰‡ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[imageview sd_setImageWithURL:[&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; URLWithString:&lt;span class=&quot;string&quot;&gt;@&quot;pic.jpg&quot;&lt;/span&gt;] placeholderImage:[&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; imageNamed:&lt;span class=&quot;string&quot;&gt;@&quot;placeholder&quot;&lt;/span&gt;] completed:^(&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; * _Nullable image, &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; * _Nullable error, SDImageCacheType cacheType, &lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; * _Nullable imageURL) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        imageview.image = image;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;å›¾ç‰‡åŠ è½½å®Œæˆ&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥ä¸è®¾ç½®å ä½å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨å›è°ƒçš„blockï¼Œéå¸¸çµæ´»:&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//å›¾ç‰‡ä¸‹è½½å®Œæˆåç›´æ¥æ˜¾ç¤ºä¸‹è½½åçš„å›¾ç‰‡&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[imageview sd_setImageWithURL:[&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; URLWithString:&lt;span class=&quot;string&quot;&gt;@&quot;pic.jpg&quot;&lt;/span&gt;]];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨æœ€å¼€å§‹å…ˆç®€å•ä»‹ç»è¿™ä¸ªæ¡†æ¶ï¼š&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ¡†æ¶çš„æ ¸å¿ƒç±»æ˜¯&lt;code&gt;SDWebImageManger&lt;/code&gt;ï¼Œåœ¨å¤–éƒ¨æœ‰&lt;code&gt;UIImageView+WebCache&lt;/code&gt; å’Œ &lt;code&gt;UIButton+WebCache&lt;/code&gt; ä¸ºä¸‹è½½å›¾ç‰‡çš„æ“ä½œæä¾›æ¥å£ã€‚å†…éƒ¨æœ‰&lt;code&gt;SDWebImageManger&lt;/code&gt;è´Ÿè´£å¤„ç†å’Œåè°ƒ &lt;code&gt;SDWebImageDownloader&lt;/code&gt; å’Œ &lt;code&gt;SDWebImageCache&lt;/code&gt;ï¼š&lt;code&gt;SDWebImageDownloader&lt;/code&gt;è´Ÿè´£å…·ä½“çš„ä¸‹è½½ä»»åŠ¡ï¼Œ&lt;code&gt;SDWebImageCache&lt;/code&gt;è´Ÿè´£å…³äºç¼“å­˜çš„å·¥ä½œï¼šæ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥è¯¢ç¼“å­˜ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬å¤§è‡´çœ‹ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶çš„è°ƒç”¨æµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-7ad6493a2b2f0b43.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;SDWebImage&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä»è¿™ä¸ªæµç¨‹å›¾é‡Œå¯ä»¥å¤§è‡´çœ‹å‡ºï¼Œè¯¥æ¡†æ¶åˆ†ä¸ºä¸¤ä¸ªå±‚ï¼šUIKitå±‚ï¼ˆè´Ÿè´£æ¥æ”¶ä¸‹è½½å‚æ•°ï¼‰å’Œå·¥å…·å±‚ï¼ˆè´Ÿè´£ä¸‹è½½æ“ä½œå’Œç¼“å­˜ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;OKï½åŸºæœ¬æµç¨‹å¤§æ¦‚æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ¯ä¸ªå±‚å…·ä½“å®ç°å§ï½&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
      <category term="æºç è§£æ" scheme="https://github.com/knightsj/knightsj.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>MBProgressHUDæºç è§£æ</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/17/MBProgressHUD%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/17/MBProgressHUDæºç è§£æ/</id>
    <published>2017-01-17T09:02:54.000Z</published>
    <updated>2017-03-20T07:56:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¬è¿‡å¥½å¤šæ¬¡ï¼šâ€œç¨‹åºå‘˜è¦é€šè¿‡å¤šè¯»å¥½çš„æºç æ¥æå‡è‡ªå·±â€è¿™æ ·ç±»ä¼¼çš„è¯ï¼Œè€Œä¸”åˆè§‰å¾—è‡ªå·±æœ‰å¾ˆå¤šä¸ä¼šçš„ï¼Œäºæ˜¯å°±é©¬ä¸Šå¯åŠ¨äº†è‡ªå·±çš„<strong>è¯»å¥½æºç Project</strong>ã€‚</p>
<p>ä»å“ªä¸ªæ¡†æ¶å¼€å§‹å‘¢ï¼Ÿæˆ‘æƒ³åˆ°äº†<code>SDWebImage</code>ï¼Œä½†æ˜¯å¤§è‡´çœ‹ä¸‹æ¥æ–‡ä»¶å¾ˆå¤šï¼Œä»£ç ä¹Ÿä¸å°‘ï¼Œä¸çŸ¥é“ä»ä½•çœ‹èµ·ï¼Œäºæ˜¯ä½œç½¢ã€‚æ‰€ä»¥èŒ…å¡é¡¿å¼€ï¼Œè¿˜æ˜¯ä»æœ€æœ€ç®€å•çš„æ¡†æ¶å¼€å§‹å§ï½å› ä¸ºå­¦ä¹ æ›²çº¿è¦ç»™è‡ªå·±è®¾å®šå¾—å¹³ç¼“ä¸€ç‚¹æ‰æœ‰åˆ©äºç¨³æ­¥æå‡ï¼Œå°æ­¥å¿«è·‘æ‰æ˜¯ç‹é“ï½</p>
<p>æ‰¾ç€æ‰¾ç€å°±æ‰¾åˆ°äº†<code>MBProgressHUD</code>ï¼Œè¿™ä¸ªæ¡†æ¶åªæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªå¤´æ–‡ä»¶å’Œä¸€ä¸ªå®ç°æ–‡ä»¶ï¼Œå¾ˆé€‚åˆæˆ‘ç°åœ¨çš„æ°´å¹³ï¼ˆå¯¹äºä¸€ä¸ªæ²¡æ€ä¹ˆè¯»è¿‡æºç çš„é€‰æ‰‹ï¼‰ï¼Œäºæ˜¯å°±æ’¸èµ·äº†è¢–å­å¼€å§‹äº†ã€‚</p>
<p>è¿æŸ¥çŸ¥è¯†ç‚¹å¸¦è®°ç¬”è®°ä¸€å…±èŠ±äº†å¤§æ¦‚3ä¸ªå°æ—¶ï¼ˆè™½ç„¶æ–‡ä»¶å¾ˆå°‘ï¼Œä½†æ˜¯é‡Œé¢å¥½å¤šä¸œè¥¿éƒ½ä¸çŸ¥é“[æ‚è„¸]ï¼‰ã€‚æ•´ä½“è¯´æ¥ï¼Œæ”¶è·è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œé™¤äº†ä¸€äº›é›¶ç¢çš„è¯­æ³•ä¹‹å¤–ï¼Œæ¡†æ¶ä½œè€…å¯¹äºä»£ç ç»“æ„çš„è®¾è®¡å’Œå„ç§æƒ…å†µçš„è€ƒè™‘è¿˜æ˜¯å¾ˆå‡ºè‰²çš„ï¼Œå¾ˆå€¼å¾—å­¦ä¹ ï¼Œè€Œä¸”æˆ‘åœ¨ä¸‹æ–‡ä¹Ÿæœ‰ä»‹ç»ã€‚</p>
<p>è¿™ç¯‡æ€»ç»“ä¸»è¦åˆ†ä¸‰ä¸ªéƒ¨åˆ†æ¥ä»‹ç»è¿™ä¸ªæ¡†æ¶ï¼š</p>
<ol>
<li>æ ¸å¿ƒPublic API</li>
<li>æ–¹æ³•è°ƒç”¨æµç¨‹å›¾</li>
<li>æ–¹æ³•å†…éƒ¨å®ç°</li>
</ol>
<p>ä¸å¤šè¯´äº†ï¼Œå¼€å§‹å§ï½</p>
<a id="more"></a>
<h2 id="1-æ ¸å¿ƒPublic-API"><a href="#1-æ ¸å¿ƒPublic-API" class="headerlink" title="1. æ ¸å¿ƒPublic API"></a>1. æ ¸å¿ƒPublic API</h2><h3 id="å±æ€§ï¼š"><a href="#å±æ€§ï¼š" class="headerlink" title="å±æ€§ï¼š"></a>å±æ€§ï¼š</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) MBProgressHUDMode mode;<span class="comment">//HUDçš„ç±»å‹</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) MBProgressHUDAnimation animationType <span class="built_in">UI_APPEARANCE_SELECTOR</span>;<span class="comment">//åŠ¨ç”»ç±»å‹</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> graceTime;<span class="comment">//showå‡½æ•°è§¦å‘åˆ°æ˜¾ç¤ºHUDçš„æ—¶é—´æ®µ</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> minShowTime;<span class="comment">//HUDæ˜¾ç¤ºçš„æœ€çŸ­æ—¶é—´</span></div></pre></td></tr></table></figure>
<h3 id="ç±»æ–¹æ³•ï¼š"><a href="#ç±»æ–¹æ³•ï¼š" class="headerlink" title="ç±»æ–¹æ³•ï¼š"></a>ç±»æ–¹æ³•ï¼š</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">Â * åœ¨æŸä¸ªviewä¸Šæ·»åŠ HUDå¹¶æ˜¾ç¤º</div><div class="line">Â *</div><div class="line">Â * æ³¨æ„ï¼šæ˜¾ç¤ºä¹‹å‰ï¼Œå…ˆå»æ‰åœ¨å½“å‰viewä¸Šæ˜¾ç¤ºçš„HUDã€‚è¿™ä¸ªåšæ³•å¾ˆä¸¥è°¨ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæ–¹æ¡ˆæŠ½è±¡å‡ºæ¥ï¼šå¦‚æœä¸€ä¸ªæ¨¡å‹æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬éœ€è¦å°†AåŠ å…¥åˆ°Bä¸­ï¼Œä½†æ˜¯éœ€æ±‚ä¸ŠBé‡Œé¢åªå…è®¸åªæœ‰ä¸€ä¸ªAã€‚é‚£ä¹ˆæ¯æ¬¡å°†Aæ·»åŠ åˆ°Bä¹‹å‰ï¼Œéƒ½è¦å…ˆåˆ¤æ–­å½“å‰çš„bé‡Œé¢æ˜¯å¦æœ‰Aï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç§»é™¤ã€‚</div><div class="line">Â */</div><div class="line">+ (<span class="keyword">instancetype</span>)showHUDAddedTo:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated;</div><div class="line"><span class="comment">/**</span></div><div class="line">Â * æ‰¾åˆ°æŸä¸ªviewä¸Šæœ€ä¸Šå±‚çš„HUDå¹¶éšè—å®ƒã€‚</div><div class="line">Â * å¦‚æœè¿”å›å€¼æ˜¯YESçš„è¯ï¼Œå°±è¡¨æ˜HUDè¢«æ‰¾åˆ°è€Œä¸”è¢«ç§»é™¤äº†ã€‚</div><div class="line">Â */</div><div class="line">+ (<span class="built_in">BOOL</span>)hideHUDForView:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated;</div><div class="line"><span class="comment">/**</span></div><div class="line">Â * åœ¨æŸä¸ªviewä¸Šæ‰¾åˆ°æœ€ä¸Šå±‚çš„HUDå¹¶è¿”å›å®ƒã€‚</div><div class="line">Â * è¿”å›å€¼å¯ä»¥æ˜¯ç©ºï¼Œæ‰€ä»¥è¿”å›å€¼çš„å…³é”®å­—ä¸ºï¼šnullable</div><div class="line">Â */</div><div class="line">+ (<span class="keyword">nullable</span> MBProgressHUD *)HUDForView:(<span class="built_in">UIView</span> *)view;</div></pre></td></tr></table></figure>
<h3 id="å¯¹è±¡æ–¹æ³•ï¼š"><a href="#å¯¹è±¡æ–¹æ³•ï¼š" class="headerlink" title="å¯¹è±¡æ–¹æ³•ï¼š"></a>å¯¹è±¡æ–¹æ³•ï¼š</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">Â * ä¸€ä¸ªHUDçš„ä¾¿åˆ©æ„é€ å‡½æ•°ï¼Œç”¨æŸä¸ªviewæ¥åˆå§‹åŒ–HUDï¼šè¿™ä¸ªviewçš„boundså°±æ˜¯HUDçš„bounds</div><div class="line">Â */</div><div class="line">- (<span class="keyword">instancetype</span>)initWithView:(<span class="built_in">UIView</span> *)view;</div><div class="line"><span class="comment">/**Â </span></div><div class="line">Â * æ˜¾ç¤ºHUDï¼Œæœ‰æ— åŠ¨ç”»ã€‚</div><div class="line">Â */</div><div class="line">- (<span class="keyword">void</span>)showAnimated:(<span class="built_in">BOOL</span>)animated;</div><div class="line"><span class="comment">/**Â </span></div><div class="line">Â * éšè—HUDï¼Œæœ‰æ— åŠ¨ç”»ã€‚</div><div class="line">Â */</div><div class="line">- (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated;</div><div class="line"><span class="comment">/**Â </span></div><div class="line">Â * åœ¨delayçš„æ—¶é—´è¿‡åéšè—HUDï¼Œæœ‰æ— åŠ¨ç”»ã€‚</div><div class="line">Â */</div><div class="line">- (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated afterDelay:(<span class="built_in">NSTimeInterval</span>)delay;</div></pre></td></tr></table></figure>
<p>çœ‹å®Œäº†è¿™äº›æ¯”è¾ƒä¸»è¦çš„APIï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ–¹æ³•è°ƒç”¨çš„æµç¨‹å›¾ï¼š</p>
<h2 id="2-æ–¹æ³•è°ƒç”¨æµç¨‹å›¾ï¼š"><a href="#2-æ–¹æ³•è°ƒç”¨æµç¨‹å›¾ï¼š" class="headerlink" title="2. æ–¹æ³•è°ƒç”¨æµç¨‹å›¾ï¼š"></a>2. æ–¹æ³•è°ƒç”¨æµç¨‹å›¾ï¼š</h2><p>æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªç¬¬ä¸‰æ–¹æ¡†æ¶çš„æ¥å£è¿˜æ˜¯æ¯”è¾ƒæ•´é½çš„ï¼Œå¯ä»¥å¤§è‡´ä¸Šåˆ†ä¸ºä¸¤ç±»ï¼šæ˜¾ç¤ºï¼ˆshowï¼‰å’Œéšè—ï¼ˆhideï¼‰ã€‚è€Œä¸”æ— è®ºæ˜¯è°ƒç”¨æ˜¾ç¤ºæ–¹æ³•è¿˜æ˜¯éšè—æ–¹æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šèµ°åˆ°ç§æœ‰æ–¹æ³•<code>animateIn:withType: completion:</code>é‡Œï¼ˆå‰ææ˜¯é™„åŠ åŠ¨ç”»æ•ˆæœï¼‰ã€‚å¯ä»¥çœ‹ä¸€ä¸‹æ–¹æ³•è°ƒç”¨çš„æµç¨‹å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-fe3f0f393bcc3b9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–¹æ³•è°ƒç”¨æµç¨‹å›¾"></p>
<p>çœ‹å®Œæ–¹æ³•è°ƒç”¨çš„ç»“æ„ä¹‹åï¼Œæˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹æ–¹æ³•å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p>
<h2 id="3-æ–¹æ³•å†…éƒ¨å®ç°ï¼š"><a href="#3-æ–¹æ³•å†…éƒ¨å®ç°ï¼š" class="headerlink" title="3. æ–¹æ³•å†…éƒ¨å®ç°ï¼š"></a>3. æ–¹æ³•å†…éƒ¨å®ç°ï¼š</h2><p>åœ¨è®²è§£APIä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆä»‹ç»ä¸€ä¸‹HUDä½¿ç”¨çš„ä¸‰ä¸ªTimerã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSTimer</span> *graceTimer; <span class="comment">//æ‰§è¡Œä¸€æ¬¡ï¼šåœ¨showæ–¹æ³•è§¦å‘ååˆ°HUDçœŸæ­£æ˜¾ç¤ºä¹‹å‰,å‰ææ˜¯è®¾å®šäº†graceTimeï¼Œé»˜è®¤ä¸º0</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSTimer</span> *minShowTimer;<span class="comment">//æ‰§è¡Œä¸€æ¬¡ï¼šåœ¨HUDæ˜¾ç¤ºååˆ°HUDè¢«éšè—ä¹‹å‰</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSTimer</span> *hideDelayTimer;<span class="comment">//æ‰§è¡Œä¸€æ¬¡ï¼šåœ¨HUDè¢«éšè—çš„æ–¹æ³•è§¦å‘ååˆ°çœŸæ­£éšè—ä¹‹å‰</span></div></pre></td></tr></table></figure>
<ul>
<li>graceTimerï¼šç”¨æ¥æ¨è¿ŸHUDçš„æ˜¾ç¤ºã€‚å¦‚æœè®¾å®šäº†graceTimeï¼Œé‚£ä¹ˆHUDä¼šåœ¨<code>show</code>æ–¹æ³•è§¦å‘åçš„graceTimeæ—¶é—´åæ˜¾ç¤ºã€‚å®ƒçš„æ„ä¹‰æ˜¯ï¼šå¦‚æœä»»åŠ¡å®Œæˆæ‰€æ¶ˆè€—çš„æ—¶é—´éå¸¸çŸ­å¹¶ä¸”çŸ­äºgraceTimeï¼Œåˆ™HUDå°±ä¸ä¼šå‡ºç°äº†ï¼Œé¿å…HUDä¸€é—ªè€Œè¿‡çš„å·®ä½“éªŒã€‚</li>
<li>minShowTimerï¼šå¦‚æœè®¾å®šäº†minShowTimeï¼Œå°±ä¼šåœ¨<code>hide</code>æ–¹æ³•è§¦å‘ååˆ¤æ–­ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´æ˜¯å¦çŸ­äºminShowTimeã€‚å› æ­¤å³ä½¿ä»»åŠ¡åœ¨minShowTimeä¹‹å‰å®Œæˆäº†ï¼ŒHUDä¹Ÿä¸ä¼šç«‹å³æ¶ˆå¤±ï¼Œå®ƒä¼šåœ¨èµ°å®ŒminShowTimeä¹‹åæ‰æ¶ˆå¤±ï¼Œè¿™åº”è¯¥ä¹Ÿæ˜¯é¿å…HUDä¸€é—ªè€Œè¿‡çš„æƒ…å†µã€‚</li>
<li>hideDelayTimerï¼šç”¨æ¥æ¨è¿ŸHUDçš„éšè—ã€‚å¦‚æœè®¾å®šäº†delayTimeï¼Œé‚£ä¹ˆåœ¨è§¦å‘<code>hide</code>æ–¹æ³•åHUDä¹Ÿä¸ä¼šç«‹å³éšè—ï¼Œå®ƒä¼šåœ¨èµ°å®ŒdelayTimeä¹‹åæ‰éšè—ã€‚</li>
</ul>
<p>è¿™ä¸‰è€…çš„å…³ç³»å¯ä»¥ç”±ä¸‹é¢è¿™å¼ å›¾æ¥ä½“ç°ï¼ˆå¹¶æ²¡æœ‰åŒ…å«æ‰€æœ‰çš„æƒ…å†µï¼‰ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-c9f49bfcec64dd0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‰ç§timer"></p>
<p>ä¸‹é¢å¼€å§‹åˆ†åˆ«è®²è§£<code>show</code>ç³»åˆ—çš„æ–¹æ³•å’Œ<code>hide</code>ç³»åˆ—çš„æ–¹æ³•ã€‚</p>
<h3 id="showç³»åˆ—æ–¹æ³•"><a href="#showç³»åˆ—æ–¹æ³•" class="headerlink" title="showç³»åˆ—æ–¹æ³•"></a>showç³»åˆ—æ–¹æ³•</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">instancetype</span>)showHUDAddedTo:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">Â  Â  MBProgressHUD *hud = [[<span class="keyword">self</span> alloc] initWithView:view];<span class="comment">// æ¥ç€è°ƒç”¨ [self initWithFrame:view.bounds]ï¼šæ ¹æ®ä¼ è¿›æ¥çš„viewçš„frameæ¥è®¾å®šè‡ªå·±çš„frame</span></div><div class="line">Â  Â  hud.removeFromSuperViewOnHide = <span class="literal">YES</span>;<span class="comment">//removeFromSuperViewOnHide åº”è¯¥æ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œè¡¨æ˜HUDè‡ªå·±å¤„äºâ€œåº”è¯¥è¢«ç§»é™¤çš„çŠ¶æ€â€</span></div><div class="line">Â  Â  [view addSubview:hud];<span class="comment">//åœ¨viewä¸Šå°†è‡ªå·±çš„å®ä¾‹æ·»åŠ ä¸Šå»</span></div><div class="line">Â  Â  [hud showAnimated:animated];</div><div class="line">Â  Â  <span class="keyword">return</span> hud;</div><div class="line">&#125;</div><div class="line"><span class="comment">//è°ƒç”¨showAnimatedï¼š</span></div><div class="line">- (<span class="keyword">void</span>)showAnimated:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">Â  Â  MBMainThreadAssert();</div><div class="line">Â  Â  [<span class="keyword">self</span>.minShowTimer invalidate];<span class="comment">//å–æ¶ˆå½“å‰çš„minShowTimer</span></div><div class="line">Â Â  Â  <span class="keyword">self</span>.useAnimation = animated;<span class="comment">//è®¾ç½®animatedçŠ¶æ€</span></div><div class="line">Â Â  Â  <span class="keyword">self</span>.finished = <span class="literal">NO</span>;<span class="comment">//æ·»åŠ æ ‡è®°ï¼šè¡¨æ˜å½“å‰ä»»åŠ¡ä»åœ¨è¿›è¡Œ</span></div><div class="line">Â  Â  <span class="comment">// å¦‚æœè®¾å®šäº†graceTimeï¼Œå°±è¦æ¨è¿ŸHUDçš„æ˜¾ç¤º</span></div><div class="line">Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span>.graceTime &gt; <span class="number">0.0</span>) &#123;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:<span class="keyword">self</span>.graceTime target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(handleGraceTimer:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</div><div class="line">Â  Â  Â  Â  [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.graceTimer = timer;</div><div class="line">Â  Â  &#125;Â </div><div class="line">Â  Â  <span class="comment">// ... otherwise show the HUD immediately</span></div><div class="line">Â  Â  <span class="keyword">else</span> &#123;</div><div class="line">Â  Â  Â  Â  [<span class="keyword">self</span> showUsingAnimation:<span class="keyword">self</span>.useAnimation];</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//self.graceTimerè§¦å‘çš„æ–¹æ³•</span></div><div class="line">- (<span class="keyword">void</span>)handleGraceTimer:(<span class="built_in">NSTimer</span> *)theTimer &#123;</div><div class="line">Â  Â  <span class="comment">// Show the HUD only if the task is still running</span></div><div class="line">Â  Â  <span class="keyword">if</span> (!<span class="keyword">self</span>.hasFinished) &#123;</div><div class="line">Â  Â  Â  Â  [<span class="keyword">self</span> showUsingAnimation:<span class="keyword">self</span>.useAnimation];</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//æ‰€æœ‰çš„showæ–¹æ³•æœ€ç»ˆéƒ½ä¼šèµ°åˆ°è¿™ä¸ªæ–¹æ³•</span></div><div class="line">- (<span class="keyword">void</span>)showUsingAnimation:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">Â  Â  <span class="comment">// Cancel any previous animations : ç§»èµ°æ‰€æœ‰çš„åŠ¨ç”»</span></div><div class="line">Â  Â  [<span class="keyword">self</span>.bezelView.layer removeAllAnimations];</div><div class="line">Â  Â  [<span class="keyword">self</span>.backgroundView.layer removeAllAnimations];</div><div class="line">Â  Â  <span class="comment">// Cancel any scheduled hideDelayed: calls :å–æ¶ˆdelayçš„timer</span></div><div class="line">Â  Â  [<span class="keyword">self</span>.hideDelayTimer invalidate];</div><div class="line">Â  Â  <span class="comment">//è®°å¿†å¼€å§‹çš„æ—¶é—´</span></div><div class="line">Â  Â  <span class="keyword">self</span>.showStarted = [<span class="built_in">NSDate</span> date];</div><div class="line">Â  Â  <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</div><div class="line">Â  Â  <span class="comment">// Needed in case we hide and re-show with the same NSProgress object attached.</span></div><div class="line">Â  Â  [<span class="keyword">self</span> setNSProgressDisplayLinkEnabled:<span class="literal">YES</span>];</div><div class="line">Â  Â  <span class="keyword">if</span> (animated) &#123;Â Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  [<span class="keyword">self</span> animateIn:<span class="literal">YES</span> withType:<span class="keyword">self</span>.animationType completion:<span class="literal">NULL</span>];Â  Â </div><div class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;</div><div class="line">Â  Â  Â  Â  <span class="comment">//æ–¹æ³•å¼ƒç”¨è­¦å‘Š</span></div><div class="line"><span class="meta">#pragma clang diagnostic push</span></div><div class="line"><span class="meta">#pragma clang diagnostic ignored <span class="meta-string">"-Wdeprecated-declarations"</span></span></div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.bezelView.alpha = <span class="keyword">self</span>.opacity;</div><div class="line"><span class="meta">#pragma clang diagnostic pop</span></div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.backgroundView.alpha = <span class="number">1.</span>f;</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ç±»æ–¹æ³•çš„showæ–¹æ³•ï¼Œè¿˜æ˜¯å¯¹è±¡æ–¹æ³•çš„showæ–¹æ³•ï¼Œè€Œä¸”æ— è®ºæ˜¯è§¦å‘äº†<code>graceTimer</code>è¿˜æ˜¯æ²¡æœ‰è§¦å‘ï¼Œæœ€åéƒ½ä¼šèµ°åˆ°<code>showUsingAnimation:</code>æ–¹æ³•æ¥è®©HUDæ˜¾ç¤ºå‡ºæ¥ã€‚</p>
</blockquote>
<p>è¿™é‡Œè¡¥å……è®²è§£ä¸€ä¸‹NSProgressçš„ç›‘å¬æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setNSProgressDisplayLinkEnabled:(<span class="built_in">BOOL</span>)enabled &#123;</div><div class="line">Â  Â  <span class="comment">// è¿™é‡Œä½¿ç”¨ CADisplayLink æ¥åˆ·æ–°progressçš„å˜åŒ–ã€‚å› ä¸ºå¦‚æœä½¿ç”¨kvoæœºåˆ¶æ¥ç›‘å¬çš„è¯å¯èƒ½ä¼šéå¸¸æ¶ˆè€—ä¸»çº¿ç¨‹ï¼ˆå› ä¸ºé¢‘ç‡å¯èƒ½éå¸¸å¿«ï¼‰ã€‚</span></div><div class="line">Â  Â  <span class="keyword">if</span> (enabled &amp;&amp; <span class="keyword">self</span>.progressObject) &#123;</div><div class="line">Â  Â  Â  Â  <span class="comment">// Only create if not already active.</span></div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> (!<span class="keyword">self</span>.progressObjectDisplayLink) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">self</span>.progressObjectDisplayLink = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(updateProgressFromProgressObject)];</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;</div><div class="line">Â  Â  Â  Â  <span class="comment">//ä¸åˆ·æ–°</span></div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.progressObjectDisplayLink = <span class="literal">nil</span>;</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>CADisplayLinkæ˜¯ä¸€ä¸ªèƒ½è®©æˆ‘ä»¬ä»¥å’Œå±å¹•åˆ·æ–°ç‡åŒæ­¥çš„é¢‘ç‡å°†ç‰¹å®šçš„å†…å®¹ç”»åˆ°å±å¹•ä¸Šçš„å®šæ—¶å™¨ç±»ã€‚ CADisplayLinkä»¥ç‰¹å®šæ¨¡å¼æ³¨å†Œåˆ°runloopåï¼Œ æ¯å½“å±å¹•æ˜¾ç¤ºå†…å®¹åˆ·æ–°ç»“æŸçš„æ—¶å€™ï¼Œrunloopå°±ä¼šå‘ CADisplayLinkæŒ‡å®šçš„targetå‘é€ä¸€æ¬¡æŒ‡å®šçš„selectoræ¶ˆæ¯ï¼Œ  CADisplayLinkç±»å¯¹åº”çš„selectorå°±ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚<br>å‚è€ƒæ–‡ç« ï¼š<a href="http://www.tuicool.com/articles/meMVR3" target="_blank" rel="external">Core Animationç³»åˆ—ä¹‹CADisplayLink</a></p>
</blockquote>
<h3 id="hideç³»åˆ—æ–¹æ³•"><a href="#hideç³»åˆ—æ–¹æ³•" class="headerlink" title="hideç³»åˆ—æ–¹æ³•"></a>hideç³»åˆ—æ–¹æ³•</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">BOOL</span>)hideHUDForView:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">Â  Â  MBProgressHUD *hud = [<span class="keyword">self</span> HUDForView:view];<span class="comment">//è·å–å½“å‰viewçš„æœ€å‰ä¸ºæ­¢çš„HUD</span></div><div class="line">Â  Â  <span class="keyword">if</span> (hud != <span class="literal">nil</span>) &#123;</div><div class="line">Â  Â  Â  Â  hud.removeFromSuperViewOnHide = <span class="literal">YES</span>;</div><div class="line">Â  Â  Â  Â  [hud hideAnimated:animated];</div><div class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div><div class="line">+ (MBProgressHUD *)HUDForView:(<span class="built_in">UIView</span> *)view &#123;Â  Â </div><div class="line">Â  Â  <span class="built_in">NSEnumerator</span> *subviewsEnum = [view.subviews reverseObjectEnumerator]; <span class="comment">//å€’å™æ’åº</span></div><div class="line">Â  Â  <span class="keyword">for</span> (<span class="built_in">UIView</span> *subview <span class="keyword">in</span> subviewsEnum) &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> ([subview isKindOfClass:<span class="keyword">self</span>]) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">return</span> (MBProgressHUD *)subview;</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">Â  Â  MBMainThreadAssert();</div><div class="line">Â  Â  [<span class="keyword">self</span>.graceTimer invalidate];</div><div class="line">Â Â  Â  <span class="keyword">self</span>.useAnimation = animated;</div><div class="line">Â Â  Â  <span class="keyword">self</span>.finished = <span class="literal">YES</span>;</div><div class="line">Â Â  Â  <span class="comment">//å¦‚æœè®¾å®šäº†HUDæœ€å°æ˜¾ç¤ºæ—¶é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­æœ€å°æ˜¾ç¤ºæ—¶é—´å’Œå·²ç»ç»è¿‡çš„æ—¶é—´çš„å¤§å°</span></div><div class="line">Â Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span>.minShowTime &gt; <span class="number">0.0</span> &amp;&amp; <span class="keyword">self</span>.showStarted) &#123;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSTimeInterval</span> interv = [[<span class="built_in">NSDate</span> date] timeIntervalSinceDate:<span class="keyword">self</span>.showStarted];</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  <span class="comment">//å¦‚æœæœ€å°æ˜¾ç¤ºæ—¶é—´æ¯”è¾ƒå¤§ï¼Œåˆ™æš‚æ—¶ä¸è§¦å‘HUDçš„éšè—ï¼Œè€Œæ˜¯å¯åŠ¨ä¸€ä¸ªtimerï¼Œå†ç»è¿‡äºŒè€…çš„æ—¶é—´å·®çš„æ—¶é—´ä¹‹åå†è§¦å‘éšè—</span></div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> (interv &lt; <span class="keyword">self</span>.minShowTime) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:(<span class="keyword">self</span>.minShowTime - interv) target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(handleMinShowTimer:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</div><div class="line">Â  Â  Â  Â  Â  Â  [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">self</span>.minShowTimer = timer;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">return</span>;</div><div class="line">Â  Â  Â  Â  &#125;Â </div><div class="line">Â Â  Â  &#125;</div><div class="line">Â  Â  <span class="comment">//å¦‚æœæœ€å°æ˜¾ç¤ºæ—¶é—´æ¯”è¾ƒå°ï¼Œåˆ™ç«‹å³å°†HUDéšè—</span></div><div class="line">Â  Â  [<span class="keyword">self</span> hideUsingAnimation:<span class="keyword">self</span>.useAnimation];</div><div class="line">&#125;</div><div class="line"><span class="comment">//self.minShowTimerè§¦å‘çš„æ–¹æ³•</span></div><div class="line">- (<span class="keyword">void</span>)handleMinShowTimer:(<span class="built_in">NSTimer</span> *)theTimer &#123;</div><div class="line">Â  Â  [<span class="keyword">self</span> hideUsingAnimation:<span class="keyword">self</span>.useAnimation];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)hideUsingAnimation:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">Â  Â  <span class="keyword">if</span> (animated &amp;&amp; <span class="keyword">self</span>.showStarted) &#123;</div><div class="line">Â  Â  Â  Â  <span class="comment">//éšè—æ—¶ï¼Œå°†showStartedè®¾ä¸ºnil</span></div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.showStarted = <span class="literal">nil</span>;</div><div class="line">Â  Â  Â  Â  [<span class="keyword">self</span> animateIn:<span class="literal">NO</span> withType:<span class="keyword">self</span>.animationType completion:^(<span class="built_in">BOOL</span> finished) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span> done];</div><div class="line">Â  Â  Â  Â  &#125;];</div><div class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.showStarted = <span class="literal">nil</span>;</div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.bezelView.alpha = <span class="number">0.</span>f;</div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.backgroundView.alpha = <span class="number">1.</span>f;</div><div class="line">Â  Â  Â  Â  [<span class="keyword">self</span> done];</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ç±»æ–¹æ³•çš„<code>hide</code>æ–¹æ³•ï¼Œè¿˜æ˜¯å¯¹è±¡æ–¹æ³•çš„<code>hide</code>æ–¹æ³•ï¼Œè€Œä¸”æ— è®ºæ˜¯è§¦å‘è¿˜æ˜¯æ²¡æœ‰è§¦å‘<code>minShowTimer</code>,æœ€ç»ˆéƒ½ä¼šèµ°åˆ°<code>hideUsingAnimation</code>è¿™ä¸ªæ–¹æ³•é‡Œã€‚</p>
</blockquote>
<p>è€Œæ— è®ºæ˜¯<code>show</code>æ–¹æ³•ï¼Œè¿˜æ˜¯<code>hide</code>æ–¹æ³•ï¼Œåœ¨è®¾å®šanimatedå±æ€§ä¸ºYESçš„å‰æä¸‹ï¼Œæœ€ç»ˆéƒ½ä¼šèµ°åˆ°<code>animateIn: withType: completion:</code>æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)animateIn:(<span class="built_in">BOOL</span>)animatingIn withType:(MBProgressHUDAnimation)type completion:(<span class="keyword">void</span>(^)(<span class="built_in">BOOL</span> finished))completion &#123;</div><div class="line">Â  Â  <span class="comment">// Automatically determine the correct zoom animation type</span></div><div class="line">Â  Â  <span class="keyword">if</span> (type == MBProgressHUDAnimationZoom) &#123;</div><div class="line">Â  Â  Â  Â  type = animatingIn ? MBProgressHUDAnimationZoomIn : MBProgressHUDAnimationZoomOut;</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  <span class="comment">//()å†…ä»£è¡¨xå’Œyæ–¹å‘ç¼©æ”¾å€æ•°</span></div><div class="line">Â  Â  <span class="built_in">CGAffineTransform</span> small = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">0.5</span>f, <span class="number">0.5</span>f);</div><div class="line">Â  Â  <span class="built_in">CGAffineTransform</span> large = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.5</span>f, <span class="number">1.5</span>f);</div><div class="line">Â  Â  <span class="comment">// è®¾å®šåˆå§‹çŠ¶æ€</span></div><div class="line">Â  Â  <span class="built_in">UIView</span> *bezelView = <span class="keyword">self</span>.bezelView;</div><div class="line">Â  Â  <span class="keyword">if</span> (animatingIn &amp;&amp; bezelView.alpha == <span class="number">0.</span>f &amp;&amp; type == MBProgressHUDAnimationZoomIn) &#123;</div><div class="line">Â  Â  Â  Â  bezelView.transform = small;</div><div class="line">Â  Â  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (animatingIn &amp;&amp; bezelView.alpha == <span class="number">0.</span>f &amp;&amp; type == MBProgressHUDAnimationZoomOut) &#123;</div><div class="line">Â  Â  Â  Â  bezelView.transform = large;</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  <span class="comment">// åˆ›å»ºåŠ¨ç”»ä»»åŠ¡</span></div><div class="line">Â  Â  dispatch_block_t animations = ^&#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> (animatingIn) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  bezelView.transform = <span class="built_in">CGAffineTransformIdentity</span>;<span class="comment">//é‡ç½®</span></div><div class="line">Â  Â  Â  Â  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!animatingIn &amp;&amp; type == MBProgressHUDAnimationZoomIn) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  bezelView.transform = large;</div><div class="line">Â  Â  Â  Â  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!animatingIn &amp;&amp; type == MBProgressHUDAnimationZoomOut) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  bezelView.transform = small;</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line"><span class="meta">#pragma clang diagnostic push</span></div><div class="line"><span class="meta">#pragma clang diagnostic ignored <span class="meta-string">"-Wdeprecated-declarations"</span></span></div><div class="line">Â  Â  Â  Â  bezelView.alpha = animatingIn ? <span class="keyword">self</span>.opacity : <span class="number">0.</span>f;</div><div class="line"><span class="meta">#pragma clang diagnostic pop</span></div><div class="line">       <span class="comment">//å¦‚æœanimatingInæ˜¯trueï¼Œå°±æ˜¯showæ–¹æ³•ï¼Œå¦åˆ™æ˜¯hideæ–¹æ³•</span></div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.backgroundView.alpha = animatingIn ? <span class="number">1.</span>f : <span class="number">0.</span>f;</div><div class="line">Â  Â  &#125;;</div><div class="line">Â  Â  <span class="comment">// Spring animations are nicer, but only available on iOS 7+</span></div><div class="line"><span class="meta">#if __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= 70000 || TARGET_OS_TV</span></div><div class="line">Â  Â  <span class="keyword">if</span> (kCFCoreFoundationVersionNumber &gt;= kCFCoreFoundationVersionNumber_iOS_7_0) &#123;</div><div class="line">        <span class="comment">//æ‰§è¡ŒåŠ¨ç”» &gt;= iOS7</span></div><div class="line">Â  Â  Â  Â  [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> delay:<span class="number">0.</span> usingSpringWithDamping:<span class="number">1.</span>f initialSpringVelocity:<span class="number">0.</span>f options:<span class="built_in">UIViewAnimationOptionBeginFromCurrentState</span> animations:animations completion:completion];</div><div class="line">Â  Â  Â  Â  <span class="keyword">return</span>;</div><div class="line">Â  Â  &#125;</div><div class="line"><span class="meta">#endif</span></div><div class="line">Â  Â  [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> delay:<span class="number">0.</span> options:<span class="built_in">UIViewAnimationOptionBeginFromCurrentState</span> animations:animations completion:completion];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>é™¤äº†ä¸€äº›ç»†èŠ‚ä¸Šçš„è¯­æ³•ä¹‹å¤–ï¼Œæˆ‘è§‰å¾—è¯¥æ¡†æ¶æœ‰å‡ ä¸ªåœ°æ–¹å€¼å¾—æˆ‘ä»¬å€Ÿé‰´ï¼š</p>
<ol>
<li>æš´éœ²å‡ºæ¥çš„APIæœ€ç»ˆéƒ½ä¼šèµ°åˆ°åŒä¸€ä¸ªç§æœ‰æ–¹æ³•é‡Œã€‚</li>
<li>å°†çœŸæ­£æ˜¾ç¤ºçš„æ—¶é—´çš„å‰ååŠ ä¸Šç¼“å†²çš„æ—¶é—´ï¼ˆgraceTimer å’Œ hideDelayTimerï¼‰ï¼Œå¯ä»¥æé«˜å¯å®šåˆ¶æ€§å’Œç¨³å®šæ€§ã€‚</li>
<li>å¦‚æœæœ‰ä¸¤ä¸ªæ–¹æ³•æ˜¯çŸ›ç›¾çš„ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶è°ƒç”¨ï¼Œå°±éœ€è¦åœ¨å…¨å±€è®¾ç½®ä¸€ä¸ªå±æ€§æ¥åˆ¤æ–­å½“å‰çš„çŠ¶æ€ï¼ˆremoveFromSuperViewOnHideå±æ€§ï¼Œfinishedå±æ€§ï¼‰</li>
<li>ä½¿ç”¨CADisplayLinkæ¥åˆ·æ–°æ›´æ–°é¢‘ç‡å¯èƒ½å¾ˆé«˜çš„viewã€‚</li>
<li>ä½¿ç”¨NSAssertæ¥æ•è·å„ç§å¼‚å¸¸ã€‚</li>
</ol>
<p>å°±è¿™æ ·å¤§è‡´å†™å®Œäº†ï¼Œæ²¡æœ‰æ€ä¹ˆè¯»è¿‡ç¬¬ä¸‰æ–¹æ¡†æ¶çš„æºç ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡å¯èƒ½æ˜¾å¾—ç¨è®¸ä¸è¶³ã€‚æœ‰ä¸å¥½çš„åœ°æ–¹è¿˜å¸Œæœ›å¤šå¤šæŒ‡ç‚¹å“ˆï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¬è¿‡å¥½å¤šæ¬¡ï¼šâ€œç¨‹åºå‘˜è¦é€šè¿‡å¤šè¯»å¥½çš„æºç æ¥æå‡è‡ªå·±â€è¿™æ ·ç±»ä¼¼çš„è¯ï¼Œè€Œä¸”åˆè§‰å¾—è‡ªå·±æœ‰å¾ˆå¤šä¸ä¼šçš„ï¼Œäºæ˜¯å°±é©¬ä¸Šå¯åŠ¨äº†è‡ªå·±çš„&lt;strong&gt;è¯»å¥½æºç Project&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»å“ªä¸ªæ¡†æ¶å¼€å§‹å‘¢ï¼Ÿæˆ‘æƒ³åˆ°äº†&lt;code&gt;SDWebImage&lt;/code&gt;ï¼Œä½†æ˜¯å¤§è‡´çœ‹ä¸‹æ¥æ–‡ä»¶å¾ˆå¤šï¼Œä»£ç ä¹Ÿä¸å°‘ï¼Œä¸çŸ¥é“ä»ä½•çœ‹èµ·ï¼Œäºæ˜¯ä½œç½¢ã€‚æ‰€ä»¥èŒ…å¡é¡¿å¼€ï¼Œè¿˜æ˜¯ä»æœ€æœ€ç®€å•çš„æ¡†æ¶å¼€å§‹å§ï½å› ä¸ºå­¦ä¹ æ›²çº¿è¦ç»™è‡ªå·±è®¾å®šå¾—å¹³ç¼“ä¸€ç‚¹æ‰æœ‰åˆ©äºç¨³æ­¥æå‡ï¼Œå°æ­¥å¿«è·‘æ‰æ˜¯ç‹é“ï½&lt;/p&gt;
&lt;p&gt;æ‰¾ç€æ‰¾ç€å°±æ‰¾åˆ°äº†&lt;code&gt;MBProgressHUD&lt;/code&gt;ï¼Œè¿™ä¸ªæ¡†æ¶åªæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªå¤´æ–‡ä»¶å’Œä¸€ä¸ªå®ç°æ–‡ä»¶ï¼Œå¾ˆé€‚åˆæˆ‘ç°åœ¨çš„æ°´å¹³ï¼ˆå¯¹äºä¸€ä¸ªæ²¡æ€ä¹ˆè¯»è¿‡æºç çš„é€‰æ‰‹ï¼‰ï¼Œäºæ˜¯å°±æ’¸èµ·äº†è¢–å­å¼€å§‹äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿æŸ¥çŸ¥è¯†ç‚¹å¸¦è®°ç¬”è®°ä¸€å…±èŠ±äº†å¤§æ¦‚3ä¸ªå°æ—¶ï¼ˆè™½ç„¶æ–‡ä»¶å¾ˆå°‘ï¼Œä½†æ˜¯é‡Œé¢å¥½å¤šä¸œè¥¿éƒ½ä¸çŸ¥é“[æ‚è„¸]ï¼‰ã€‚æ•´ä½“è¯´æ¥ï¼Œæ”¶è·è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œé™¤äº†ä¸€äº›é›¶ç¢çš„è¯­æ³•ä¹‹å¤–ï¼Œæ¡†æ¶ä½œè€…å¯¹äºä»£ç ç»“æ„çš„è®¾è®¡å’Œå„ç§æƒ…å†µçš„è€ƒè™‘è¿˜æ˜¯å¾ˆå‡ºè‰²çš„ï¼Œå¾ˆå€¼å¾—å­¦ä¹ ï¼Œè€Œä¸”æˆ‘åœ¨ä¸‹æ–‡ä¹Ÿæœ‰ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ€»ç»“ä¸»è¦åˆ†ä¸‰ä¸ªéƒ¨åˆ†æ¥ä»‹ç»è¿™ä¸ªæ¡†æ¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¸å¿ƒPublic API&lt;/li&gt;
&lt;li&gt;æ–¹æ³•è°ƒç”¨æµç¨‹å›¾&lt;/li&gt;
&lt;li&gt;æ–¹æ³•å†…éƒ¨å®ç°&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸å¤šè¯´äº†ï¼Œå¼€å§‹å§ï½&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
      <category term="æºç è§£æ" scheme="https://github.com/knightsj/knightsj.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>2016å¹´ç»ˆæ€»ç»“ | å–„äºæ€»ç»“ï¼ŒæŠŠæ¡æ–¹å‘</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/2016%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93%20%7C%20%E5%96%84%E4%BA%8E%E6%80%BB%E7%BB%93%EF%BC%8C%E6%8A%8A%E6%8F%A1%E6%96%B9%E5%90%91/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/2016å¹´ç»ˆæ€»ç»“ | å–„äºæ€»ç»“ï¼ŒæŠŠæ¡æ–¹å‘/</id>
    <published>2017-01-13T05:55:17.000Z</published>
    <updated>2017-03-20T07:51:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å¾—å»å¹´è¿™ä¸ªæ—¶å€™çœ‹åˆ°å¾ˆå¤šåŒè¡Œå†™äº†å¹´ç»ˆæ€»ç»“ï¼Œå½“æ—¶åªå·¥ä½œäº†1ä¸ªæœˆçš„æˆ‘è§‰å¾—å¾ˆæ˜¯é«˜å¤§ä¸Šã€‚è½¬çœ¼ä¸€å¹´è¿‡å»äº†ï¼Œä»ç¬¬ä¸€å®¶å…¬å¸æ¥åˆ°ç°åœ¨çš„è¿™å®¶å…¬å¸ï¼Œæ— è®ºæŠ€æœ¯ä¸Šè¿˜æ˜¯æ€æƒ³ä¸Šéƒ½æˆç†Ÿäº†ä¸€äº›ï¼Œå·§çš„æ˜¯ç®€ä¹¦åœ¨è¿™ä¸ªæ—¶å€™ç»™æˆ‘ä»¬è¿™ä¸ªå¹³å°æ¥å†™å¹´ç»ˆæ€»ç»“ã€‚è´µåœ¨å‚ä¸ï¼Œä¹Ÿä¸ºäº†è‡ªå·±ï¼Œå†™ä¸€ç¯‡å§ï½</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-88a964d0151cb8b6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="GoodBye 2016ï¼ŒWelcome 2017"></p>
<p>2016å¹´ï¼Œæ˜¯æˆ‘äº‹ä¸šèµ·æ­¥çš„ç¬¬ä¸€å¹´ï¼Œç°åœ¨å›å¤´çœ‹å»ï¼Œè¿™ä¸€å¹´å¤§è‡´åˆ†ä¸ºäº”ä¸ªæ—¶æœŸï¼š</p>
<ol>
<li><strong>æŠ€æœ¯åŸºç¡€å»ºè®¾æœŸï¼ˆ1æœˆï½5æœˆï¼‰</strong>ï¼šä»iOSå°ç™½çš„å°ç™½åˆ°ç‹¬ç«‹ä¸Šçº¿appã€‚</li>
<li><strong>æŠ€æœ¯å¿«é€Ÿæˆé•¿æœŸï¼ˆ6æœˆï½9æœˆï¼‰</strong>ï¼šç®€ä¹¦æ›´æ–°30ç¯‡æ–‡ç« ï¼Œç²‰ä¸è¾¾åˆ°1000+ã€‚</li>
<li><strong>å†™ç®€å†æ‰¾å·¥ä½œæœŸï¼ˆ10æœˆï¼‰</strong>ï¼š8å®¶é¢è¯•ï¼Œ3ä¸ªofferã€‚</li>
<li><strong>é€‚åº”æ–°çš„å…¬å¸æœŸï¼ˆ11æœˆï¼‰</strong>ï¼šæ–°é¡¹ç›®1ä¸ªæœˆå†…ä¸Šæ¶ã€‚</li>
<li><strong>æ˜å¹´æ–¹å‘å®šä½æœŸï¼ˆ12æœˆï¼‰</strong>ï¼šå†³å®šç ”ç©¶Hybrid appå¼€å‘ã€‚</li>
</ol>
<p>ä¸‹é¢å¼€å§‹æŒ‰æ—¶é—´é¡ºåºåˆ†åˆ«æ€»ç»“ä¸€ä¸‹æ¯ä¸ªæ—¶æœŸé‡Œæˆ‘çš„æ‰€åšæ‰€æ€ã€‚</p>
<a id="more"></a>
<h2 id="åŸºç¡€å½¢æˆæœŸï¼š2016å¹´1æœˆï½5æœˆ"><a href="#åŸºç¡€å½¢æˆæœŸï¼š2016å¹´1æœˆï½5æœˆ" class="headerlink" title="åŸºç¡€å½¢æˆæœŸï¼š2016å¹´1æœˆï½5æœˆ"></a>åŸºç¡€å½¢æˆæœŸï¼š2016å¹´1æœˆï½5æœˆ</h2><hr>
<p>æˆ‘çš„ç¬¬ä¸€ä»½å·¥ä½œå°±æ˜¯iOSå¼€å‘ï¼Œä»2015å¹´11æœˆå…¥èŒï¼Œç†Ÿæ‚‰äº†ä¸€æ®µæ—¶é—´çš„é¡¹ç›®ä»£ç ï¼Œåœ¨12æœˆä»½åˆæ¥äº†ä¸€æ®µæ—¶é—´çš„æµ‹è¯•å·¥ä½œï¼Œæ‰€ä»¥çœŸæ­£å¼€å§‹åšiOSçš„æ—¶é—´åº”è¯¥æ˜¯ä»Šå¹´çš„1æœˆä»½ã€‚</p>
<p>ä»å¼€å§‹æ¥æ‰‹ç®€å•çš„éœ€æ±‚åˆ°ç‹¬ç«‹è´Ÿè´£å®Œæˆå‰å…¬å¸ç¬¬äºŒä¸ªé¡¹ç›®ä¸Šçº¿ä¸€å…±ç»å†äº†5ä¸ªæœˆçš„æ—¶é—´ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µé‡Œï¼Œæˆ‘ä»ä¸€ä¸ªè¿UITableViewçš„ä»£ç†éƒ½ä¸æ€ä¹ˆä¼šç”¨çš„å°ç™½ä¸­çš„å°ç™½é€æ¸æˆé•¿ä¸ºä¸€ä¸ªç‹¬ç«‹è´Ÿè´£appä¸Šçº¿çš„å°ç™½ã€‚</p>
<p>ç”±äºå¼€å§‹çš„æ—¶å€™åŸºç¡€å¤ªå·®ï¼Œæ¯å¤©éƒ½ç´¯å¾—ä¸è¡Œï¼Œå› ä¸ºå½“æ—¶çš„æˆ‘ï¼Œå°±ç®—ä¸€ä¸ªç‰¹åˆ«å°çš„é—®é¢˜éƒ½è¦å»é—®è°·å“¥æˆ–è€…åº¦å¨˜ï¼Œæ‰€ä»¥å‡ ä¹æ¯å¤©éƒ½å»æ— æ­¢å¢ƒåœ°åœ¨æµè§ˆå™¨é‡Œè¾“å…¥é—®é¢˜ï¼Œæœç´¢é—®é¢˜çš„ç­”æ¡ˆï¼Œå‡ ä¹æ¯å¤©éƒ½æœ‰è®°å½•ä¸‹æ¥çš„ä»£ç æ®µï¼Œå‡ ä¹æ¯å¤©éƒ½æœ‰éœ€è¦æ”¹çš„bugï¼ˆå› ä¸ºè‡ªå·±ä¹‹å‰ä»£ç å†™çš„ä¸å¥½éœ€è¦é‡å†™ï¼‰ã€‚</p>
<p>æˆ‘è®°å¾—å½“æ—¶ä¸ºäº†èµ¶ä¸Šè¿›åº¦ï¼Œä¸ç»™å¤§å®¶æ‹–åè…¿ï¼Œæ¯å¤©ç»å¸¸æ˜¯2ç‚¹ä¹‹åç¡è§‰ï¼Œè§‰å¾—ä»£ç å¯ä»¥äº†å°±åœ¨å®¶é‡Œä¸Šä¼ ä»£ç ã€‚è€Œä¸”å› ä¸ºç”¨çœ¼è¿‡åº¦+ç”¨è„‘è¿‡åº¦ï¼Œæœ‰æ—¶ä¼šçœ¼ç›ç–¼ï¼Œå¤´ç–¼ï¼Œç”šè‡³å¶å°”åœ¨ç¡è§‰ä¹‹å‰çœ¼ç›çœ‹ä¸œè¥¿çš„æ—¶å€™å‡ºç°äº†æ•£å…‰çš„æƒ…å†µã€‚</p>
<p>åœ¨å‰å…¬å¸çš„ä¸»é¡¹ç›®åœ¨æ¸¡è¿‡äº†ä¸¤æ¬¡è¿­ä»£ä¹‹åï¼Œä¹Ÿå°±æ˜¯ä»Šå¹´3æœˆä»½çš„æ—¶å€™ï¼Œç´§æ¥ç€è¦ä¸Šçº¿ä¸€ä¸ªæ–°çš„å°é¡¹ç›®ï¼Œè€ŒiOSç«¯å¼€å‘çš„ä»»åŠ¡å°±è½åœ¨æˆ‘çš„å¤´ä¸Šã€‚è™½ç„¶ä¼´éšç€å„ç§æ‡µé€¼ï¼Œå„ç§ææƒ§ï¼Œä½†æˆ‘è¿˜æ˜¯æ¬£ç„¶æ¥å—çš„ï¼Œå› ä¸ºåƒè¿™ç§çªç ´èˆ’é€‚åŒºçš„äº‹æƒ…è¿˜æ˜¯æ¥ä¸‹æ¥ä¸ºå¥½ï¼Œæˆ‘å¿ƒé‡Œè¿˜æ˜¯çŸ¥é“è¿™æ˜¯ä¸€ä¸ªéš¾å¾—çš„é”»ç‚¼è‡ªå·±çš„æœºä¼šã€‚</p>
<p>å¯èƒ½ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”ä¸€äº›åŠŸèƒ½é›†æˆäº†ç¬¬ä¸‰æ–¹çš„SDKï¼Œåœ¨å¼€å‘çš„æ—¶å€™æ¸æ¸æ²¡æœ‰æ˜¾å¾—é‚£ä¹ˆåƒåŠ›äº†ã€‚ä½†æˆ‘ä»ç„¶è®°å¾—å¾ˆæ¸…æ¥šåœ°è®°å¾—æœ‰å¥½å‡ ä¸ªå¤œæ™šæ˜¯è‡ªå·±æœ€åä»å…¬å¸èµ°å‡ºå»çš„ï¼Œå› ä¸ºå½“æ—¶å®‰å“é‚£è¾¹æ˜¯æœ‰ä¸¤ä¸ªäººä¸€èµ·åšè¿™ä¸ªé¡¹ç›®ï¼Œè€Œä¸”æ¥å£ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåç«¯çš„ç«¥é‹ä¹Ÿæ¯”è¾ƒè½»æ¾ã€‚</p>
<p>åˆ°æœ€åç»“æœè¿˜æ˜¯ä¸é”™çš„ï¼Œæˆ‘è¿™é‡Œç»“æŸå¾—æ²¡æœ‰æ¯”è®¡åˆ’æ™šï¼Œè€Œä¸”æ¯”å®‰å“ææ—©å¼€å‘å®Œæ¯•äº†ã€‚å½“æ—¶çœ‹ç€app storeé‡Œè‡ªå·±å¼€å‘çš„appä¸Šçº¿äº†ï¼Œå¿ƒé‡Œè¿˜æ˜¯å¾ˆå¼€å¿ƒçš„ï¼Œæ¯•ç«Ÿå¯¹äºä¸€ä¸ªå·¥ä½œåˆšåŠå¹´çš„äººæ¥è¯´ï¼Œè¿™ä¸ªæœºä¼šæŒºéš¾å¾—çš„ï¼Œè€Œä¸”æˆ‘æŠŠæ¡çš„è¿˜ç®—ä¸é”™ã€‚</p>
<blockquote>
<p>è¿™ä¸ªæ—¶æœŸåº”è¯¥æ˜¯æˆ‘æˆé•¿å¾—æœ€ç—›è‹¦çš„æ—¶æœŸï¼Œå› ä¸ºåœ¨è¿™ä¸ªé˜¶æ®µé‡Œï¼Œæˆ‘ç»å†äº†iOSå¼€å‘çš„â€œä»0åˆ°1â€çš„é˜¶æ®µï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºéª‘è‡ªè¡Œè½¦çš„â€œç¬¬ä¸€è¹¬â€ã€‚ä¹Ÿå°±æ˜¯ï¼Œæˆ‘â€œä¸Šè·¯â€äº†ã€‚</p>
</blockquote>
<h2 id="å¿«é€Ÿæˆé•¿æœŸï¼š2016å¹´6æœˆï½9æœˆ"><a href="#å¿«é€Ÿæˆé•¿æœŸï¼š2016å¹´6æœˆï½9æœˆ" class="headerlink" title="å¿«é€Ÿæˆé•¿æœŸï¼š2016å¹´6æœˆï½9æœˆ"></a>å¿«é€Ÿæˆé•¿æœŸï¼š2016å¹´6æœˆï½9æœˆ</h2><hr>
<p>è™½ç„¶è¯´ç¨‹åºå‘˜éœ€è¦è‡ªå­¦ï¼Œä½†æ˜¯ä»¥æˆ‘ä¹‹å‰çš„æ°´å¹³ï¼Œåªæ˜¯ææ‡‚å…¬å¸ç°æœ‰çš„ä»£ç ï¼Œå®Œæˆé¡¹ç›®éœ€æ±‚å°±å·²ç»è€—å°½äº†æˆ‘æ‰€æœ‰çš„ä¼‘æ¯æ—¶é—´ï¼Œå‡ ä¹æ²¡æœ‰å…¶ä»–çš„æ—¶é—´ç”¨æ¥å­¦ä¹ ã€‚</p>
<p>ä½†æ˜¯ç»è¿‡äº†è¿‘åŠå¹´çš„å†ç»ƒï¼Œå¯¹å…¬å¸ä¸šåŠ¡çš„é©¾è½»å°±ç†Ÿäº†ã€‚åœ¨å¼€å‘å…¬å¸é¡¹ç›®åï¼Œä½™ä¸‹çš„è‡ªå·±çš„æ—¶é—´è¶Šæ¥è¶Šå¤šäº†ï¼Œäºæ˜¯å°±æ‰¾ä¸€äº›èµ„æ–™è¿›è¡Œå­¦ä¹ ã€‚åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘çš„å­¦ä¹ æˆæœä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªï¼š</p>
<h4 id="1-ç¬¬ä¸€ä¸ªæˆæœï¼šç®€ä¹¦åšå®¢"><a href="#1-ç¬¬ä¸€ä¸ªæˆæœï¼šç®€ä¹¦åšå®¢" class="headerlink" title="1. ç¬¬ä¸€ä¸ªæˆæœï¼šç®€ä¹¦åšå®¢"></a>1. ç¬¬ä¸€ä¸ªæˆæœï¼šç®€ä¹¦åšå®¢</h4><p>æˆ‘çš„å­¦ä¹ æ–¹å¼æ˜¯é‡‡å–ä»¥ï¼š<strong>â€œé¢å‘åšå®¢å­¦ä¹ â€</strong>çš„å­¦ä¹ æ–¹æ³•ã€‚</p>
<ul>
<li>å…·ä½“è¯´æ¥å°±æ˜¯ï¼šå°†å­¦ä¹ åˆ°çš„ä¸œè¥¿è¿›è¡Œåå¤æ€»ç»“ï¼Œèƒ½è¾¾åˆ°è®©ä»»ä½•äººçœ‹æ‡‚çš„æ°´å‡†ã€‚</li>
<li>å®ƒçš„æ ¸å¿ƒæ€æƒ³ï¼šèƒ½è®©å…¶ä»–äººç†è§£äº†è‡ªå·±æ‰ç®—æ˜¯ç†è§£ã€‚</li>
<li>æœ€åæ€»ç»“ä¸€å¥å°±æ˜¯ï¼šç¬”è®°å³åšå®¢ï¼ˆç¬”è®°æ€»ç»“å®Œäº†å°±ç›´æ¥èƒ½åˆ°å‘å¸ƒåšå®¢çš„æ°´å‡†ï¼‰ã€‚</li>
</ul>
<p>é™¤äº†èƒ½æ›´å¥½åœ°ç†è§£çŸ¥è¯†ï¼Œæˆ‘è®¤ä¸ºåˆ†äº«æŠ€æœ¯çš„å¥½å¤„è¿˜æœ‰ï¼š</p>
<ol>
<li>è®¤è¯†ä¸€äº›ä¼˜ç§€çš„åŒè¡Œï¼ˆç¥äº¤çš„åŸºå‹ï¼‰ï¼š<a href="http://www.jianshu.com/users/e39da354ce50/latest_articles" target="_blank" rel="external">ç¥ç»éªšæ ‹</a> | <a href="http://www.jianshu.com/users/c68741efc396/latest_articles" target="_blank" rel="external">ç†Šçš®çš®</a> | <a href="http://www.jianshu.com/users/55c8fdc3c6e7/latest_articles" target="_blank" rel="external">TianBai</a> | <a href="http://www.jianshu.com/users/a54931de4c9b/latest_articles" target="_blank" rel="external">é˜¿æ‹‰æ–¯åŠ çš„ç‹—</a> |<a href="http://www.jianshu.com/users/bfb3a06ce1cd/latest_articles" target="_blank" rel="external">å°èœä¸€ç¢Ÿ321</a> ã€‚</li>
<li>æœ‰æ—¶ä¼šæœ‰äººæŒ‡å‡ºåšå®¢é‡Œçš„é”™è¯¯æˆ–è€…æå‡ºä¸€äº›æ›´å¥½çš„å»ºè®®ã€‚</li>
</ol>
<p><strong>ä»¥ä¸‹æ˜¯æˆ‘åˆ†äº«çš„å…¶ä¸­ä¸‰ä¸ªä¸“é¢˜ï¼š</strong></p>
<ul>
<li><p><a href="http://www.jianshu.com/notebooks/4747753/latest" target="_blank" rel="external">æ–¯å¦ç¦å…¬å¼€è¯¾ï¼ˆ18èŠ‚è¯¾çš„æ‰€æœ‰è¯¾ç¨‹çš„æ€»ç»“å’ŒDemoï¼‰</a></p>
</li>
<li><p><a href="http://www.jianshu.com/notebooks/6074358/latest" target="_blank" rel="external">ã€ŠEffective Objective-Cã€‹ è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆé‡æ•´å…¨ä¹¦çš„ç²¾åéƒ¨åˆ†ï¼‰</a></p>
</li>
<li><p><a href="http://www.jianshu.com/notebooks/3482176/latest" target="_blank" rel="external">è¯»ä¹¦ç¬”è®° - ç¨‹åºå‘˜ç´ å…»ï¼ˆã€Šé«˜æ•ˆèƒ½ç¨‹åºå‘˜çš„ä¿®ç‚¼ã€‹ç­‰ä¹¦çš„è¯»ä¹¦æ€»ç»“ï¼‰</a></p>
</li>
</ul>
<p><strong>è¿˜æœ‰å‡ ç¯‡è´¨é‡ä¸æ˜¯å¾ˆä½çš„æ–‡ç« ï¼š</strong></p>
<ul>
<li><a href="http://www.jianshu.com/p/7702f58be845" target="_blank" rel="external">é«˜åº¦å°è£…FMDBæ¡†æ¶ï¼šå„ç”¨ä¸€å¥ä»£ç æ›´æ–°ï¼ˆæ·»åŠ &amp;ä¿®æ”¹ï¼‰ï¼ŒæŸ¥è¯¢ï¼Œåˆ é™¤ç”¨æˆ·ä¿¡æ¯</a></li>
<li><a href="http://www.jianshu.com/p/bf5c0e462119" target="_blank" rel="external">è¯¦è§£ iOS å¤šå›¾ä¸‹è½½çš„ç¼“å­˜æœºåˆ¶</a></li>
<li><a href="http://www.jianshu.com/p/6e74f5438f2c" target="_blank" rel="external">æœ€æµ…æ˜¾æ˜“æ‡‚çš„iOSå¤šçº¿ç¨‹æŠ€æœ¯ - GCDçš„æ•™ç¨‹</a></li>
</ul>
<h4 id="2-ç¬¬äºŒä¸ªæˆæœï¼šå¼€æºåº“"><a href="#2-ç¬¬äºŒä¸ªæˆæœï¼šå¼€æºåº“" class="headerlink" title="2. ç¬¬äºŒä¸ªæˆæœï¼šå¼€æºåº“"></a>2. ç¬¬äºŒä¸ªæˆæœï¼šå¼€æºåº“</h4><p>å“å‘€ï¼Œè¯´å‡ºæ¥éƒ½ä¸å¥½æ„æ€ï¼Œå› ä¸ºè¿™ä¸ªåº“å¾ˆç®€å•çš„ã€‚ä½†æ˜¯å› ä¸ºæ˜¯å†™æ€»ç»“å˜›ï¼Œå°±è¦é¢é¢ä¿±åˆ°ï¼Œè™½ç„¶è´´å‡ºæ¥å¤§å®¶èƒ½çœ‹ï¼Œä½†æ˜¯æ€»ç»“æ¯•ç«Ÿè¿˜æ˜¯ç»™è‡ªå·±å†™çš„ã€‚</p>
<p>è¿™ä¸ªå¼€æºæ¡†æ¶ä¸»è¦å°è£…äº†ä¸€ä¸‹iOSçš„FMDBæ¡†æ¶ï¼Œç”¨æ¥æ“ä½œæœ¬åœ°æ•°æ®åº“çš„ã€‚å› ä¸ºä¹‹å‰å…¬å¸çš„éœ€æ±‚æ€»æ˜¯å’Œå¤šç”¨æˆ·çš„ç”¨æˆ·ä¿¡æ¯ç¦»ä¸å¼€ï¼Œæ‰€ä»¥å°±æƒ³å†™ä¸€ä¸ªå¯ä»¥éšæ—¶å¢åˆ æ”¹æŸ¥å¤šä¸ªç”¨æˆ·ä¿¡æ¯çš„æ•°æ®åº“ï¼Œæˆ‘è®°å¾—å½“æ—¶æƒ³æ³•å‡ºæ¥ä»¥åï¼Œä»å†™ä»£ç åˆ°ä¸Šä¼ åˆ°Githubï¼Œè¿ç»­å†™äº†10ä¸ªå°æ—¶ï¼Œå¤©éƒ½äº®äº†ï¼Œé¢ã€‚</p>
<p>æœ€åè¿˜æ˜¯é™„ä¸Šä¼ é€é—¨ï¼š<a href="https://github.com/knightsj/SJUserInfoManager">GitHub:SJUserInfoManager</a></p>
<blockquote>
<p>è¿™ä¸ªé˜¶æ®µæ˜¯æˆ‘æˆé•¿å¾—æœ€å¿«çš„æ—¶æœŸï¼ŒåŸºæœ¬å®Œæˆäº†ä»èœé¸Ÿåˆ°æ–°æ‰‹çš„å‡çº§ã€‚æ›´è®©äººæ¬£æ…°çš„æ˜¯ï¼Œæˆ‘çš„æˆé•¿å†ç¨‹ç•™åœ¨äº†ç®€ä¹¦åšå®¢é‡Œï¼Œå®ƒæ˜¯å¯è§çš„ï¼Œä¹Ÿä¸ºæˆ‘ä¸‹é˜¶æ®µæ¢å…¬å¸æ‰“ä¸‹äº†åŸºç¡€ï¼ˆå› ä¸ºéƒ½ä½“ç°åœ¨äº†ç®€å†é‡Œï¼Œä¸ºæˆ‘çš„æ±‚èŒæ·»åŠ äº†ç ç ï¼‰ã€‚</p>
</blockquote>
<h2 id="3-æ‰¾å·¥ä½œæœŸï¼š10æœˆã€‚"><a href="#3-æ‰¾å·¥ä½œæœŸï¼š10æœˆã€‚" class="headerlink" title="3. æ‰¾å·¥ä½œæœŸï¼š10æœˆã€‚"></a>3. æ‰¾å·¥ä½œæœŸï¼š10æœˆã€‚</h2><hr>
<p>ç”±äºä¸Šå®¶å…¬å¸å‰æ™¯ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ¸æ¸åœ°ï¼Œå¾ˆå¤šäººéƒ½ç¦»å¼€äº†ï¼Œè€Œä¸”é¡¹ç›®éœ€æ±‚ä¹Ÿæ¸æ¸å˜æˆä¿®è¾¹å¹…çš„é‚£ç§ï¼Œäºæ˜¯æˆ‘ä¹Ÿä¸ºè‡ªå·±æ‰“ç®—ï¼Œå‡†å¤‡æ¢ä¸€å®¶å…¬å¸ã€‚</p>
<p>å‡†å¤‡ç®€å†å’Œæ‰¾å·¥ä½œçš„ç»å†å°±ä¸èµ˜è¿°äº†ï¼Œå¤§å®¶å¯ä»¥çœ‹æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œè¯¦ç»†åœ°ä»‹ç»äº†10æœˆä»½æ‰¾å·¥ä½œçš„å¿ƒè·¯å†ç¨‹ï¼š<br><a href="http://www.jianshu.com/p/087027dcc942" target="_blank" rel="external">2016å¹´10æœˆæ±‚èŒè®°ï¼šiOSå·¥ä½œç»éªŒä¸åˆ°1å¹´ï¼Œåœ¨1ä¸ªæœˆå†…æ‹¿åˆ°äº†3ä¸ªoffer</a></p>
<p>è¿™ç¯‡æ–‡ç« å¯èƒ½ç”±äºæ ‡é¢˜èµ·çš„è¿˜ä¸é”™ï¼Œè€Œä¸”æˆ‘å†™çš„ä¹Ÿæ¯”è¾ƒå®åœ¨ï¼Œé˜…è¯»é‡å·²ç»4000+äº†ï¼Œæˆ‘è®°å¾—å½“æ—¶ä¸€ä¸ªä¸Šåˆä¸åˆ°3ä¸ªå°æ—¶å°±å·²ç»è¶…è¿‡2000äº†ï¼Œè€Œä¸”ç•™è¨€ä¹Ÿæœ‰å¾ˆå¤šï¼Œæˆ‘ä¹Ÿé€ä¸€è®¤çœŸå›å¤ï¼Œå› ä¸ºæˆ‘çœŸå¿ƒå¾ˆæƒ³å¸®åŠ©é‚£äº›æœ‰ç–‘é—®çš„åŒè¡Œï¼Œè®©ä»–ä»¬å°‘èµ°å¼¯è·¯ã€‚</p>
<blockquote>
<p>å¦‚æœè¿˜æ˜¯è¦åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹è¿™æ®µç»å†çš„æ„Ÿå—çš„è¯ï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼š<strong>äººè¦å‡­åšå‡ºæ¥çš„ä¸œè¥¿è¯´è¯ï¼Œå…¶ä½™çš„éƒ½æ˜¯è™šçš„ã€‚å¦‚æœæœ‰ï¼Œè¯¥å‡ºæ‰‹æ—¶å°±å‡ºæ‰‹ï¼›å¦‚æœæ²¡æœ‰ï¼Œä½ç€å¤´ï¼Œæ²‰ä½æ°”ï¼ŒæŠŠå®ƒåšå‡ºæ¥</strong>ã€‚</p>
</blockquote>
<h2 id="4-é€‚åº”æ–°å…¬å¸æœŸï¼š11æœˆ"><a href="#4-é€‚åº”æ–°å…¬å¸æœŸï¼š11æœˆ" class="headerlink" title="4. é€‚åº”æ–°å…¬å¸æœŸï¼š11æœˆ"></a>4. é€‚åº”æ–°å…¬å¸æœŸï¼š11æœˆ</h2><hr>
<p>å·¥ä½œæ‰¾äº†ä¸€ä¸ªæœˆä¹‹åï¼Œåœ¨11æœˆæ¥åˆ°äº†æ–°å…¬å¸ï¼Œè¿™é‡Œçš„è§„æ¨¡æ¯”ä¸Šä¸€å®¶å¤§ä¸€äº›ï¼ŒæŠ€æœ¯å›¢é˜Ÿ60+äººï¼Œä»…iOSç«¯å°±æœ‰10ä¸ªäººï¼Œé™¤äº†æˆ‘ä¹‹å¤–å‡ ä¹éƒ½æ˜¯2å¹´ä»¥ä¸Šå·¥ä½œç»éªŒçš„ï¼ˆæ˜¯çš„ï¼Œæˆ‘å¾ˆå¹¸è¿ï¼‰ï¼Œè€Œä¸”å…¶ä¸­ä¹Ÿæœ‰ä¼šPHPçš„ï¼Œä¼šJavaçš„ï¼Œä¼šJavascriptçš„iOSï¼Œæ„Ÿè§‰è‡ªå·±åªä¼šåšiOSå¥½lowå•Šï½ï½</p>
<p>åˆšè¿›å…¥å…¬å¸åï¼Œå°±å’Œå¦å¤–ä¸€åæ–°è¿›æ¥çš„iOSå¼€å‘è€…è”æ‰‹è´Ÿè´£äº†ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œè¿™ä¸ªæ–°é¡¹ç›®éœ€æ±‚è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¼€å‘3ä¸ªæ˜ŸæœŸå°±ç»“æŸäº†ï¼Œç¬¬4ä¸ªæ˜ŸæœŸå·²ç»åœ¨app storeå®¡æ ¸é€šè¿‡äº†ï¼Œéå¸¸é¡ºåˆ©ã€‚</p>
<p>åœ¨è¿™æ¬¡å¼€å‘ä¸­ï¼Œæˆ‘å­¦ä¼šçš„å…¨æ–°æŠ€æœ¯ç‚¹æ˜¯ï¼š</p>
<ol>
<li>MVVMæ¡†æ¶çš„å®é™…è¿ç”¨ï¼Œå¹¶ä½“ä¼šåˆ°äº†MVCæ¡†æ¶çš„ä¸è¶³ã€‚</li>
<li>iOSå›¾è¡¨çš„å®ç°ï¼ˆä½¿ç”¨CAShapeLayerå’Œè´å¡å°”æ›²çº¿ç»˜å›¾ï¼‰ã€‚</li>
</ol>
<p>è€Œä¸”åœ¨å†™ä»£ç ä¹‹å¤–ï¼Œé€šè¿‡ç§¯æåœ°æ²Ÿé€šï¼Œé€æ¸è®¤è¯†äº†ä¸€äº›è´Ÿè´£è®¾è®¡ï¼Œè´Ÿè´£æ¥å£ï¼Œå®‰å“é‚£è¾¹çš„å°ä¼™ä¼´ï¼Œä»¥åŠäº§å“ç»ç†ï¼Œå»ºç«‹äº†å¾ˆå‹å¥½çš„åˆä½œå…³ç³»ï¼Œåæ­£ä¸€åˆ‡éƒ½å¾ˆé¡ºå°±æ˜¯å•¦ï½ï½</p>
<blockquote>
<p>æ–°å…¬å¸ä¸ä¹å„è·¯é«˜æ‰‹ï¼Œåœ¨è¿™60å¤šäººçš„æŠ€æœ¯å›¢é˜Ÿé‡Œï¼Œæœ‰åšæŠ€æœ¯20å¹´+çš„æŠ€æœ¯ç»ç†ï¼Œä¹Ÿæœ‰æ¸…åé«˜æç”Ÿï¼Œä¹Ÿæœ‰ç¾å›½ï¼Œè‹±å›½ç•™å­¦ç”Ÿï¼Œä¹Ÿæœ‰ä¸€äº›æœæ°”è“¬å‹ƒåˆšå…¥èŒåœºçš„å°ä¼™ä¼´ï¼Œæ„Ÿè§‰ä»¥åå¯ä»¥å‘ä»–ä»¬å­¦ä¹ çš„ä¸œè¥¿è›®å¤šçš„ã€‚</p>
</blockquote>
<h2 id="5-ä¸‹é˜¶æ®µæ–¹å‘æŠ‰æ‹©æœŸï¼š12æœˆ"><a href="#5-ä¸‹é˜¶æ®µæ–¹å‘æŠ‰æ‹©æœŸï¼š12æœˆ" class="headerlink" title="5. ä¸‹é˜¶æ®µæ–¹å‘æŠ‰æ‹©æœŸï¼š12æœˆ"></a>5. ä¸‹é˜¶æ®µæ–¹å‘æŠ‰æ‹©æœŸï¼š12æœˆ</h2><hr>
<p>åœ¨é¡¹ç›®çš„ç¬¬ä¸€ç‰ˆæˆåŠŸä¸Šæ¶åæœ‰ä¸€æ®µæ—¶é—´æ˜¯æ¯”è¾ƒé—²çš„ï¼Œé™¤äº†ç ”ç©¶ä¸‹ä¸€ç‰ˆè¦ä½¿ç”¨çš„å›¾è¡¨ä»¥å¤–ï¼Œæˆ‘æœ‰æ—¶é—´å»æ€è€ƒä¸‹ä¸€æ­¥è¦å»å­¦ä»€ä¹ˆã€‚</p>
<p>ä¸ºä»€ä¹ˆæˆ‘åœ¨æ€è€ƒè¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå› ä¸ºiOSè¿™ä¸€è¡Œä¸šå¼€å‘è€…çªç„¶å¢å¤šçš„å®¢è§‚æƒ…å†µçš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¿ƒé‡Œéƒ½å¾ˆæ˜ç™½ä»Šåå¦‚æœåªä¼šiOSå¼€å‘å·²ç»ä¸å¤Ÿäº†ï¼Œå†µä¸”ç¨‹åºå‘˜è¿™ä¸€è¡Œä¸šæœ¬æ¥å°±å˜åŒ–å¾ˆå¿«ï¼Œæ¯ä¸€å¹´æœ€å¥½è¦æ¥è§¦ä¸€ä¸ªæ–°çš„è¯­è¨€ã€‚è€Œä¸”æˆ‘è‡ªå·±å¿ƒé‡Œä¹Ÿå¾ˆæ˜ç™½ï¼šç°åœ¨åˆ°äº†è¯¥é€‰æ‹©çš„æ—¶å€™äº†ï¼š<strong>æˆ‘è¯¥å­¦å“ªé—¨è¯­è¨€å‘¢ï¼Ÿ</strong></p>
<h3 id="Pythonï¼Ÿ"><a href="#Pythonï¼Ÿ" class="headerlink" title="Pythonï¼Ÿ"></a>Pythonï¼Ÿ</h3><p>æ–°å…¬å¸çš„æŠ€æœ¯å›¢é˜Ÿé‡Œï¼Œæœ‰20+çš„äººæ˜¯pythonå¼€å‘ï¼Œæ¥å£å°±æ˜¯ç”¨pythonå†™çš„ã€‚è€Œä¸”æ–°è®¤è¯†çš„å°ä¼™ä¼´ä¹Ÿæœ‰åšpythonçš„ï¼Œéšä¾¿èŠä¸¤å¥å°±èƒ½æŒ‡ç‚¹æˆ‘ä¸€äºŒã€‚å†è¯´ï¼Œå¦‚æœä¼šå†™è„šæœ¬ï¼Œçˆ¬è™«å•¥çš„ï¼Œå²‚ä¸æ˜¯æ„Ÿè§‰å±Œå±Œçš„ï¼Ÿè€Œä¸”æœºå™¨å­¦ä¹ ï¼Œå¤§æ•°æ®ä»€ä¹ˆçš„ä¹Ÿå¯ä»¥åšçš„ã€‚</p>
<h3 id="PHPï¼Ÿ"><a href="#PHPï¼Ÿ" class="headerlink" title="PHPï¼Ÿ"></a>PHPï¼Ÿ</h3><p>PHP7çš„æ€§èƒ½æå‡äº†å¾ˆå¤šï¼Œè€Œä¸”éƒ¨ç½²èƒ½åŠ›å¼ºï¼Œå¾ˆå¤šå…¬å¸çš„åç«¯éƒ½ç”¨PHPï¼Œæ‰€ä»¥å®ƒçš„éœ€æ±‚å¾ˆå¤§ã€‚å†µä¸”æˆ‘å·²ç»å­¦ä¼šäº†iOSï¼Œå¦‚æœå†å­¦ä¼šPHPï¼Œå²‚ä¸æ˜¯ç­‰äºå…¨æ ˆäº†ï¼Ÿ</p>
<h3 id="Javaï¼Ÿ"><a href="#Javaï¼Ÿ" class="headerlink" title="Javaï¼Ÿ"></a>Javaï¼Ÿ</h3><p>å¦‚æœå­¦ä¼šäº†javaï¼Œé‚£ä¹ˆæå®šå®‰å“å¼€å‘ä¹Ÿå°±æ˜¯æ—¶é—´é—®é¢˜äº†ã€‚å†è¯´javaä¹Ÿå¯ä»¥å†™åå°ï¼Œæ‰€ä»¥æ˜¯ä¸æ˜¯å­¦ä¼šäº†javaå°±çœŸçš„ç§»åŠ¨ç«¯å’Œåå°è‡ªå·±å…¨èƒ½åŒ…äº†ï¼Ÿ</p>
<h3 id="Javascriptï¼"><a href="#Javascriptï¼" class="headerlink" title="Javascriptï¼"></a>Javascriptï¼</h3><p>åœ¨æˆ‘ä»Šå¹´é¢è¯•æ–°å…¬å¸çš„æ—¶å€™ï¼Œè·Ÿæˆ‘äº¤æµè¿‡çš„å…¬å¸ä¸€å…±æœ‰10ä¸ªå·¦å³ï¼Œè¿™å…¶ä¸­ï¼Œé—®æˆ‘ä¼šä¸ä¼šæ··åˆå¼€å‘ï¼ˆhybrid app developï¼šnative app develop + web app developï¼‰çš„å°±æœ‰5ä¸ªã€‚è€Œä¸”æˆ‘ä¹Ÿæœ‰é—®è¿‡ä¹‹å‰çš„åŒäº‹ï¼Œä»–ä»¬çš„å…¬å¸ä¹Ÿå‡ ä¹éƒ½æœ‰æ··åˆå¼€å‘ã€‚äºæ˜¯æˆ‘è§‰å¾—è¿™æ˜¯ä¸ªè¶‹åŠ¿ï¼Œç”šè‡³å¯èƒ½å·²ç»å¼€å§‹äº†ã€‚å°±å¥½æ¯”å¾ˆå¤šå•†åŸåº”ç”¨ï¼Œå¾ˆå¤šç•Œé¢éƒ½æ˜¯é€šè¿‡H5æ¥å®ç°çš„ï¼Œåªæ˜¯åœ¨æœ¬åœ°åšäº†jsä¸OCçš„äº¤äº’ã€‚</p>
<p>æœ‰çš„æ—¶å€™äººå°±éœ€è¦ç°å®ä¸€ç‚¹ï¼šå¯¹æˆ‘æ¥è¯´ï¼Œä¸å…¶å»å­¦è·¨åº¦å¾ˆå¤§çš„åç«¯è¯­è¨€ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ç›¸åŒçš„æ—¶é—´å­¦ä¹ æ··åˆå¼€å‘å‘¢ï¼Ÿè€Œä¸”å¯¹äºæ··åˆå¼€å‘æ¥è¯´ï¼Œæˆ‘å·²ç»äº†è§£äº†native app å¼€å‘äº†ä¸æ˜¯ä¹ˆï¼Ÿ</p>
<p>æ‰€ä»¥ï¼Œæˆ‘æš‚æ—¶æ”¾å¼ƒäº†èƒ½å†™è„šæœ¬çš„Pythonï¼Œéœ€æ±‚ä»…æ¬¡äºJavaçš„PHPï¼Œèƒ½å†™å®‰å“çš„Javaï¼Œæœæ–­é€‰æ‹©äº†Javascriptï¼ˆå½“ç„¶è¿˜æœ‰Html5å’ŒCssï¼‰ï¼</p>
<p>è€Œå°±åœ¨å‰å‡ å¤©ï¼Œåœ¨å…¬å¸é¡¹ç›®ç¬¬äºŒç‰ˆå¼€å‘å®Œæˆåï¼Œé©¬ä¸ŠæŠ¥åäº†ä¼˜è¾¾å­¦è¯šçš„å‰ç«¯å·¥ç¨‹å¸ˆçº³ç±³å­¦ä½çš„è¯¾ç¨‹ï¼š<a href="https://cn.udacity.com/course/front-end-web-developer-nanodegree--nd001" target="_blank" rel="external">ä¼˜è¾¾å­¦è¯š å‰ç«¯å·¥ç¨‹å¸ˆçº³ç±³å­¦ä½</a></p>
<p>æ˜¨å¤©å·²ç»æäº¤äº†ç¬¬äºŒä¸ªä½œä¸šï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-f60daa7f617b7ea1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å‰ç«¯å·¥ç¨‹å¸ˆçº³ç±³å­¦ä½ Project2"></p>
<p>åŠ±å¿—åœ¨æ˜å¹´æˆä¸ºä¸€ä¸ªç‹¬å½“ä¸€é¢çš„hybrid app developerï½å“‡å’”å’”</p>
<h2 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h2><hr>
<p>åœ¨è¿™ä¸€å¹´é‡Œï¼Œæˆ‘ä¸æ–­æˆç†Ÿäº†è‡ªå·±çš„iOSå¼€å‘æŠ€æœ¯ï¼Œä¹Ÿå®šä¸‹æ¥äº†ä¸‹ä¸€å¹´çš„å­¦ä¹ æ–¹å‘ã€‚å½“ç„¶ï¼ŒiOSå¼€å‘è¿˜æ˜¯æ—¢éœ€è¦æ·±å…¥çš„ï¼Œå› ä¸ºæ¯•ç«Ÿnative appçš„ä¸€äº›å®ç°èƒ½åŠ›ï¼ŒçŸ­æ—¶é—´ç”¨webæŠ€æœ¯è¿˜æ˜¯å¾ˆéš¾è¶…è¶Šï¼Œæ¯”å¦‚CPUå’ŒGPUå¯†é›†å‹çš„ä»»åŠ¡è¿˜æœ‰å°±æ˜¯åº•å±‚çš„ä¼˜åŒ–ï¼Œä¸Cï¼ŒC++æ··ç¼–ç­‰ç­‰ã€‚ä½†æ˜¯æ¯•ç«Ÿç°åœ¨native ä¸webçš„ç•Œé™å˜å¾—è¶Šæ¥è¶Šæ¨¡ç³Šï¼Œæœ‰å¿…è¦å»å­¦ä¹ webçš„ä¸€äº›ä¸œè¥¿ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚</p>
<p>æœ€åç‚¹ä¸ªé¢˜ï¼š</p>
<p>å­¦ä¹ æå‡çš„å‰ææ˜¯æ€»ç»“ï¼Œæ²¡æœ‰æ€»ç»“ï¼Œå°±å¾ˆéš¾ä¸€æ­¥ä¸€ä¸ªè„šå°ï¼Œè¸è¸å®å®åœ°èµ°ä¸‹å»ã€‚å°±å¥½æ¯”èˆªæµ·ï¼Œå¦‚æœä¸ç»å¸¸çœ‹æ˜Ÿåº§ï¼Œä¸€æ­¥æ­¥æ€»ç»“ä¹‹å‰çŠ¯ä¸‹çš„é”™è¯¯ï¼Œæ‰¾æ–¹å‘ï¼Œè°ƒæ•´è·¯çº¿ï¼Œæ˜¯å¾ˆéš¾è¾¾åˆ°æœ€ç»ˆçš„ç›®çš„åœ°çš„ã€‚</p>
<p>è€Œå¯¹äºå¤§å¤šæ•°äººæ¥è¯´ï¼Œæé«˜ç”Ÿæ´»è´¨é‡çš„å”¯ä¸€é€”å¾„å°±æ˜¯é€šè¿‡å·¥ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æœå·¥ä½œæœ¬èº«å¯¹è¿™ä¸ªç¤¾ä¼šçš„ä»·å€¼ä¸æ˜¯å¾ˆå¤§ï¼Œé‚£ä¹ˆå°±å¾ˆéš¾æ‹¿åˆ°å¯è§‚çš„è–ªæ°´ï¼Œå°±ç®—è¯¥é¢†åŸŸçš„é«˜æ‰‹ï¼Œå¯èƒ½ä¹Ÿä¸å¦‚é‚£äº›å·¥èµ„é«˜çš„è¡Œä¸šçš„æ–°æ‰‹ã€‚</p>
<p>æ‰€ä»¥ï¼Œç°å®ä¸€ç‚¹æ¥è¯´ï¼Œå°±åƒé€‰æ‹©ä¸€ä¸ªé«˜è–ªçš„å·¥ä½œä¸€æ ·ï¼Œé€‰æ‹©ä¸€ä¸ªéœ€æ±‚æ¯”è¾ƒå¤§ï¼Œå‰æ™¯å¯è§‚çš„ç¼–ç¨‹è¯­è¨€è¿˜æ˜¯æ¯”è¾ƒæ­£ç¡®çš„ã€‚æˆ‘å¾ˆå®åœ¨ï¼Œè¯´çš„éƒ½æ˜¯äº›å®å®åœ¨åœ¨çš„è¯ï¼Œå½“ä½ æƒ³è½¬ä¸€ä¸ªè·¨åº¦æ¯”è¾ƒå¤§çš„è¡Œä¸šï¼Œä¸€å®šè¦é‡åŠ›è€Œè¡Œï¼Œè€Œä¸”å¥½å¥½åšåšç ”ç©¶ï¼Œç ”ç©¶ä¸€ä¸‹è¿™ä¸ªè¡Œä¸šæ˜¯ä¸æ˜¯åœ¨èµ°ä¸‹å¡è·¯ï¼Œæ¯•ç«Ÿä½ ä¸æ˜¯ä¸€ä¸ªäººï¼Œä½ èƒŒåæœ‰å…»ä½ çš„çˆ¶æ¯ï¼Œæœ‰æœ‹å‹ä¼™ä¼´ï¼Œå¯èƒ½è¿˜æœ‰ä½ çš„äººç”Ÿä¼´ä¾£ï¼ŒæŠŠæ¡å¥½æ–¹å‘å¾ˆé‡è¦ã€‚</p>
<p>å¯èƒ½ä½ ä¼šè¯´ï¼š</p>
<ul>
<li>æˆ‘å¹´è½»ï¼Œæƒ³åšä»€ä¹ˆå°±åšä»€ä¹ˆï¼›</li>
<li>è¯­è¨€åªæ˜¯å·¥å…·ï¼Œå­¦ä»€ä¹ˆéƒ½è¡Œï¼›</li>
</ul>
<p>ä½†æ˜¯æˆ‘ä¼šå‘Šè¯‰ä½ ï¼š</p>
<ul>
<li>äººç”Ÿçš„æ¯ä¸€ä¸ªé€‰æ‹©éƒ½å¾ˆé‡è¦ï¼Œä½ ç°åœ¨çš„ç”Ÿæ´»å–å†³äºä½ æ›¾ç»çš„é€‰æ‹©ï¼›ä½ ä»Šåçš„ç”Ÿæ´»å–å†³äºä½ ç°åœ¨çš„é€‰æ‹©ã€‚</li>
<li>äººçš„ç²¾åŠ›æœ‰é™ï¼Œé¢†åŸŸè·¨åº¦è¿‡å¤§çš„æ—¶å€™ä¸€å®šè¦ä»”ç»†è€ƒè™‘ï¼Œè¿™ä¸ªç¤¾ä¼šéœ€è¦çš„æ˜¯Tå‹äººæ‰ï¼Œè€Œè¿™ä¸ªTçš„æ ¹åŸºæ˜¯è¿™æ ¹ç«–ï¼</li>
</ul>
<p>äººæœ€å±é™©çš„å°±æ˜¯ä¸çŸ¥é“è‡ªå·±ä¸çŸ¥é“ï¼Œæ‰€ä»¥å˜›ï¼Œæ²¡äº‹å¤šæƒ³æƒ³ï¼Œæ²¡æœ‰åå¤„ã€‚</p>
<hr>
<p>æœ€åæ„Ÿè°¢åœ¨èº«åæ”¯æŒæˆ‘è½¬è¡Œçš„çˆ¶æ¯å’Œé™ªä¼´æˆ‘çš„å¥³æœ‹å‹ï¼Œä¹ˆä¹ˆå“’ï½</p>
<p>æœ€åçš„æœ€åé™„ä¸Šæœ¬æ¬¡äº’åŠ¨çš„é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/20707def779a" target="_blank" rel="external">ç¨‹åºå‘˜ä¸“é¢˜å¾æ–‡æ´»åŠ¨|GoodBye 2016,Welcome 2017
</a><br>è¯·å¤§å®¶å¤šå¤šå‚ä¸å•Šï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å¾—å»å¹´è¿™ä¸ªæ—¶å€™çœ‹åˆ°å¾ˆå¤šåŒè¡Œå†™äº†å¹´ç»ˆæ€»ç»“ï¼Œå½“æ—¶åªå·¥ä½œäº†1ä¸ªæœˆçš„æˆ‘è§‰å¾—å¾ˆæ˜¯é«˜å¤§ä¸Šã€‚è½¬çœ¼ä¸€å¹´è¿‡å»äº†ï¼Œä»ç¬¬ä¸€å®¶å…¬å¸æ¥åˆ°ç°åœ¨çš„è¿™å®¶å…¬å¸ï¼Œæ— è®ºæŠ€æœ¯ä¸Šè¿˜æ˜¯æ€æƒ³ä¸Šéƒ½æˆç†Ÿäº†ä¸€äº›ï¼Œå·§çš„æ˜¯ç®€ä¹¦åœ¨è¿™ä¸ªæ—¶å€™ç»™æˆ‘ä»¬è¿™ä¸ªå¹³å°æ¥å†™å¹´ç»ˆæ€»ç»“ã€‚è´µåœ¨å‚ä¸ï¼Œä¹Ÿä¸ºäº†è‡ªå·±ï¼Œå†™ä¸€ç¯‡å§ï½&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-88a964d0151cb8b6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;GoodBye 2016ï¼ŒWelcome 2017&quot;&gt;&lt;/p&gt;
&lt;p&gt;2016å¹´ï¼Œæ˜¯æˆ‘äº‹ä¸šèµ·æ­¥çš„ç¬¬ä¸€å¹´ï¼Œç°åœ¨å›å¤´çœ‹å»ï¼Œè¿™ä¸€å¹´å¤§è‡´åˆ†ä¸ºäº”ä¸ªæ—¶æœŸï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯åŸºç¡€å»ºè®¾æœŸï¼ˆ1æœˆï½5æœˆï¼‰&lt;/strong&gt;ï¼šä»iOSå°ç™½çš„å°ç™½åˆ°ç‹¬ç«‹ä¸Šçº¿appã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯å¿«é€Ÿæˆé•¿æœŸï¼ˆ6æœˆï½9æœˆï¼‰&lt;/strong&gt;ï¼šç®€ä¹¦æ›´æ–°30ç¯‡æ–‡ç« ï¼Œç²‰ä¸è¾¾åˆ°1000+ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™ç®€å†æ‰¾å·¥ä½œæœŸï¼ˆ10æœˆï¼‰&lt;/strong&gt;ï¼š8å®¶é¢è¯•ï¼Œ3ä¸ªofferã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚åº”æ–°çš„å…¬å¸æœŸï¼ˆ11æœˆï¼‰&lt;/strong&gt;ï¼šæ–°é¡¹ç›®1ä¸ªæœˆå†…ä¸Šæ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜å¹´æ–¹å‘å®šä½æœŸï¼ˆ12æœˆï¼‰&lt;/strong&gt;ï¼šå†³å®šç ”ç©¶Hybrid appå¼€å‘ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢å¼€å§‹æŒ‰æ—¶é—´é¡ºåºåˆ†åˆ«æ€»ç»“ä¸€ä¸‹æ¯ä¸ªæ—¶æœŸé‡Œæˆ‘çš„æ‰€åšæ‰€æ€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Career" scheme="https://github.com/knightsj/knightsj.github.io/categories/Career/"/>
    
    
      <category term="Life" scheme="https://github.com/knightsj/knightsj.github.io/tags/Life/"/>
    
      <category term="Job" scheme="https://github.com/knightsj/knightsj.github.io/tags/Job/"/>
    
  </entry>
  
  <entry>
    <title>2016å¹´10æœˆæ±‚èŒè®° | iOSå·¥ä½œç»éªŒä¸åˆ°1å¹´ï¼Œåœ¨1ä¸ªæœˆå†…æ‹¿åˆ°äº†3ä¸ªoffer</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/2016%E5%B9%B410%E6%9C%88%E6%B1%82%E8%81%8C%E8%AE%B0%EF%BC%9AiOS%E5%B7%A5%E4%BD%9C%E7%BB%8F%E9%AA%8C%E4%B8%8D%E5%88%B01%E5%B9%B4%EF%BC%8C%E5%9C%A81%E4%B8%AA%E6%9C%88%E5%86%85%E6%8B%BF%E5%88%B0%E4%BA%863%E4%B8%AAoffer/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/2016å¹´10æœˆæ±‚èŒè®°ï¼šiOSå·¥ä½œç»éªŒä¸åˆ°1å¹´ï¼Œåœ¨1ä¸ªæœˆå†…æ‹¿åˆ°äº†3ä¸ªoffer/</id>
    <published>2017-01-13T05:54:44.000Z</published>
    <updated>2017-03-20T07:51:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>çœŸçš„æ˜¯éå¸¸éå¸¸æ„Ÿè°¢æˆ‘çš„æ–°ä¸œå®¶ï¼Œåœ¨æˆ‘æœ€éœ€è¦æ–°å·¥ä½œçš„æ—¶å€™ç»™æˆ‘æŠ›æ¥æ©„æ¦„æ~</p>
<p>æ–°ä¸œå®¶çš„çŸ¥ååº¦å¾ˆé«˜ï¼Œä½†å¹¶ä¸æ˜¯åšäº’è”ç½‘èµ·å®¶çš„ï¼Œæ˜¯ä¸€å®¶æœ‰è‡ªå·±çº¿ä¸‹äº§ä¸šçš„å¤§å…¬å¸ï¼Œåˆ›ç«‹æ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…ï¼Œæ–°é¡¹ç›®ï¼ˆäº’è”ç½‘ï¼‰çš„æŠ€æœ¯å›¢é˜Ÿç»„æˆéå¸¸ä¼˜ç§€ï¼Œæ‰€ä»¥è™½ç„¶ç»™æˆ‘çš„å¾…é‡å¹¶æ²¡æœ‰å¾ˆå¤šï¼Œä½†è¿˜æ˜¯æ¯«ä¸çŠ¹è±«é€‰æ‹©äº†è¿™ä¸€å®¶ã€‚ä¸ºæ­¤è¿˜è°¢ç»äº†åé¢çš„é¢è¯•é‚€è¯·ï¼ˆå› ä¸ºè¦å‡†å¤‡ä¸€äº›å…¥èŒææ–™å’Œå…¥èŒä¹‹å‰çš„ç›¸å…³å­¦ä¹ ï¼‰ã€‚</p>
<p>ç¬”è€…åœ¨å›½åº†èŠ‚æœŸé—´å‡†å¤‡ç®€å†ï¼Œåœ¨å›½åº†èŠ‚åå¼€å§‹æŠ•é€’ç®€å†ã€‚ä»æœ€å¼€å§‹æŠ•é€’ç®€å†åˆ°æ‹¿åˆ°æœ€åä¸€ä¸ªofferå†æ—¶3å‘¨å¤šã€‚å› ä¸ºåœ¨è¿™æ®µæ±‚èŒæ—¶é—´é‡Œæ„Ÿè§¦å¾ˆå¤šï¼Œæ‰€ä»¥æƒ³ä¸“é—¨å†™ä¸€ç¯‡åšå®¢æ¥è®²è¿°ä¸€ä¸‹è‡ªå·±çš„æ±‚èŒå¿ƒå¾—ï¼Œå¸Œæœ›èƒ½ç»™å„ä½å¹´åº•æ±‚èŒçš„å°ä¼™ä¼´ï¼Œç‰¹åˆ«æ˜¯åšiOSçš„åŒè¡Œä¸€äº›å€¼å¾—å€Ÿé‰´çš„ä¸œè¥¿ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-23f60ab52ef7bafa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼špixabay.com"></p>
<a id="more"></a>
<h3 id="1-æ€»æ±‚èŒæ•°æ®ï¼š"><a href="#1-æ€»æ±‚èŒæ•°æ®ï¼š" class="headerlink" title="1. æ€»æ±‚èŒæ•°æ®ï¼š"></a>1. æ€»æ±‚èŒæ•°æ®ï¼š</h3><hr>
<ol>
<li>ä»å†™ç®€å†åˆ°æ‹¿åˆ°æœ€åä¸€ä¸ªofferå†æ—¶26å¤©ã€‚</li>
<li>æ€»é¢è¯•é€šçŸ¥æ•°ï¼š11ä¸ª</li>
<li>æ€»é¢è¯•æ¬¡æ•°ï¼š8æ¬¡</li>
<li>æ€»offeræ•°ï¼š3ä¸ª</li>
</ol>
<h4 id="æœ‰è¶£çš„3ä¸ªç‚¹ï¼š"><a href="#æœ‰è¶£çš„3ä¸ªç‚¹ï¼š" class="headerlink" title="æœ‰è¶£çš„3ä¸ªç‚¹ï¼š"></a>æœ‰è¶£çš„3ä¸ªç‚¹ï¼š</h4><ol>
<li>ç®€å†çš„æœ€åˆç¨¿çš„å®Œæˆå†æ—¶2å¤©å¹¶å¼€å§‹æŠ•é€’ï¼Œåœ¨ç¬¬10å¤©æ‰æœ€ç»ˆå®šç¨¿ã€‚</li>
<li>åœ¨ç®€å†å¼€å§‹æŠ•é€’åçš„ç¬¬ä¸€ä¸ªæ˜ŸæœŸé‡Œæ²¡æœ‰æ”¶åˆ°ä»»ä½•é¢è¯•é€šçŸ¥ã€‚</li>
<li>åœ¨3ä¸ªofferé‡Œï¼Œåªæœ‰ä¸€å®¶æ˜¯å°å…¬å¸ï¼ˆä¸åˆ°50äººï¼‰ï¼Œå…¶ä»–ä¸¤ä¸ªéƒ½æ˜¯å…·æœ‰ç›¸å½“è§„æ¨¡çš„å¤§å…¬å¸ã€‚</li>
</ol>
<p>ä¸‹é¢å†™ä¸€ä¸‹æ•´ä¸ªæ±‚èŒè¿‡ç¨‹çš„å¿ƒå¾—ï¼š</p>
<h3 id="1-ç®€å†éœ€è¦æŒç»­æ›´æ–°"><a href="#1-ç®€å†éœ€è¦æŒç»­æ›´æ–°" class="headerlink" title="1. ç®€å†éœ€è¦æŒç»­æ›´æ–°"></a>1. ç®€å†éœ€è¦æŒç»­æ›´æ–°</h3><hr>
<p>è™½ç„¶å¼€å§‹ç®€å†çš„åˆç‰ˆå®Œæˆçš„æŒºå¿«çš„ï¼Œä½†æ˜¯åæ¥å´ä¸æ–­å‘ç°æœ‰å¾ˆå¤šä¸å¦¥çš„åœ°æ–¹ï¼š</p>
<ol>
<li>ä¸åº”è¯¥æ·»åŠ æˆ‘è‡ªå·±çš„è¯ä»¶ç…§ï¼šå…¶å®é™¤äº†ç¾å¥³ï¼Œæ˜¯ä¸å»ºè®®æœ‰è‡ªå·±çš„è¯æ˜ç…§çš„ã€‚</li>
<li>ä¸åº”è¯¥æ·»åŠ é¡¹ç›®çš„iconï¼šå¯¼è‡´æ’ç‰ˆæ˜¾å¾—å¾ˆä¹±ï¼Œåº”è¯¥å»æ‰ã€‚</li>
<li>é¡¹ç›®ç»éªŒçš„æŠ€æœ¯ç‚¹ä¸å¤Ÿå…·ä½“ï¼Œè€Œä¸”ä¸»æ¬¡æ²¡æœ‰é¡ºåºï¼šæœ€å¥½å°†æŠ€æœ¯äº®ç‚¹æ”¾åœ¨æœ€å‰é¢ï¼Œè€Œä¸”è¦ç»†è‡´ä¸€ç‚¹ã€‚</li>
<li>æŠ€èƒ½æ¸…å•å¤ªè¿‡ä¿—å¥—ï¼Œä¸å¤Ÿå…·ä½“ï¼šæ¯”å¦‚ä¸èƒ½åªå†™â€œç†Ÿæ‚‰RunLoopçš„ä½¿ç”¨â€ï¼Œå»ºè®®è¿™ä¹ˆå†™ï¼šâ€œç†Ÿæ‚‰RunLoopçš„æœºåˆ¶ï¼Œåˆ›å»ºå¸¸é©»çº¿ç¨‹æ‰§è¡Œä»»åŠ¡â€ï¼Œä¹Ÿå°±æ˜¯å°†å…·ä½“çš„æŠ€æœ¯ç‚¹å’Œå…·ä½“çš„åº”ç”¨ç»“åˆèµ·æ¥å†™ä¸€ä¸‹ä¼šå¥½ä¸€äº›ã€‚</li>
<li>ä¸ªäººä¼˜åŠ¿ä¸çªå‡ºï¼šå› ä¸ºé¡¹ç›®ç»éªŒå°‘è€Œä¸”æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´åšå®¢å’Œå¼€æºé¡¹ç›®å°±æ˜¯æˆ‘çš„ä¼˜åŠ¿ï¼Œè€Œè¿™äº› ä¼˜åŠ¿æˆ‘ç”šè‡³æ²¡æœ‰åœ¨åˆç‰ˆç®€å†ä¸­å†™æ˜ï¼Œåæ¥åœ¨æ›´æ–°ç®€å†çš„æ—¶å€™æ‰å†™å‡ºæ¥æ”¾åœ¨ååçš„ä½ç½®ã€‚ä½†æ˜¯å†åæ¥ï¼Œ<a href="http://www.jianshu.com/users/55c8fdc3c6e7/latest_articles" target="_blank" rel="external">TianBai</a>å¤§å¤§å»ºè®®æˆ‘å¼€æºé¡¹ç›®çš„åœ°å€å’Œä¼˜ç§€åšå®¢æ–‡ç« æœ€å¥½æ”¾åœ¨æ˜¾è‘—ä½ç½®ï¼Œæˆ‘æ‰é¼“èµ·å‹‡æ°”å°†å®ƒä»¬æ”¾åœ¨ä¸ªäººä¿¡æ¯çš„ä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯ç®€å†çš„ç¬¬äºŒé¡¹ã€‚</li>
<li>é™¤äº†ç®€å†çš„æ’°å†™æŠ€å·§ä¹‹å¤–ï¼Œç¬”è€…ä¹Ÿåœ¨ä¸æ–­è‡ªå­¦æ¥å¢æ·»ç®€å†ä¸Šçš„æŠ€æœ¯ç‚¹ï¼šåœ¨å­¦ä¹ å‰ä¸¤å¤©åœ¨ç®€å†ä¸Šæ·»åŠ è¦å­¦ä¹ çš„æŠ€æœ¯ç‚¹ï¼Œä¿è¯å°†æ¥é¢è¯•çš„æ—¶å€™å¯ä»¥ç”¨ä¸Šã€‚</li>
</ol>
<blockquote>
<p>åœ¨ç®€å†çš„åˆç‰ˆå®Œæˆä¹‹åå°±å¼€å§‹æŠ•é€’äº†ï¼Œä¹‹åä¹Ÿåœ¨ä¸æ–­æ›´æ–°è‡ªå·±çš„ç®€å†ï¼Œç›´åˆ°10å¤©åæ›´æ–°æ‰è¶‹äºç¨³å®šã€‚</p>
</blockquote>
<h3 id="2-ç®€å†è¦çªå‡ºä¸ªäººä¼˜åŠ¿"><a href="#2-ç®€å†è¦çªå‡ºä¸ªäººä¼˜åŠ¿" class="headerlink" title="2. ç®€å†è¦çªå‡ºä¸ªäººä¼˜åŠ¿"></a>2. ç®€å†è¦çªå‡ºä¸ªäººä¼˜åŠ¿</h3><hr>
<p>ä¹‹å‰æåˆ°è¿‡ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ˜ŸæœŸé‡Œï¼Œæˆ‘æ²¡æœ‰æ”¶åˆ°ä»»ä½•é¢è¯•é€šçŸ¥ï¼Œç›´åˆ°ç¬¬äºŒä¸ªæ˜ŸæœŸçš„æ˜ŸæœŸä¸‰æˆ‘æ‰æ”¶åˆ°äº†ç¬¬ä¸€ä¸ªé¢è¯•é€šçŸ¥ã€‚è€Œè¿™ä¸ªæ—¶é—´ç‚¹ï¼Œä¹Ÿæ­£æ˜¯ç®€å†æœ€ç»ˆå®šç¨¿ä¹‹åçš„2ï¼Œ3å¤©ã€‚è€Œä¸”åæ¥ï¼Œé¢è¯•é€šçŸ¥å°±â€œæºæºä¸æ–­â€äº†ï¼šä¸¤å‘¨é‡Œæœ‰11ä¸ªé¢è¯•é€šçŸ¥ï¼Œè€Œä¸”è¶Šåˆ°åé¢è¶Šå¤šã€‚</p>
<p>è™½ç„¶å¯èƒ½ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œä½†æˆ‘ä¸ªäººè§‰å¾—ï¼šå°†æˆ‘çš„åšå®¢ä¼˜ç§€æ–‡ç« é“¾æ¥å’Œå¼€æºé¡¹ç›®åœ°å€æ”¾ï¼ˆå¹¶åŠ ä¸Šç®€å•ä»‹ç»ï¼‰åœ¨ç®€å†çš„å‰é¢ä¹‹åï¼Œæˆ‘çš„ç®€å†å˜å¾—â€œæ‹›äººå–œæ¬¢äº†â€ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œåœ¨å†™ç®€å†çš„æ—¶å€™ï¼Œå°±è¦æƒ³ï¼šåˆ°åº•è‡ªå·±çš„ä¼˜åŠ¿ç‚¹åœ¨å“ªé‡Œï¼Ÿå“ªä¸ªæœ€æœ‰äº®ç‚¹ï¼Œå°±æ¯«ä¸çŠ¹è±«åœ°å†™åœ¨æœ€å‰é¢å§ï¼</p>
<ul>
<li>å¦‚æœä½ çš„ä¼˜åŠ¿æ˜¯å…¬å¸é¡¹ç›®é‡Œçš„æŸä¸ªåŠŸèƒ½æ¨¡å—ï¼ˆä¸èƒ½å¤ªç®€å•ï¼‰ï¼Œå°±æŠŠè¿™ä¸ªæ¨¡å—å†™å‡ºæ¥å¥½å¥½æè¿°ä¸€ä¸‹ã€‚</li>
<li>å¦‚æœä½ åœ¨githubä¸Šæœ‰æ˜Ÿæ˜Ÿï¼Œå°±æŠŠå®ƒæ”¾åœ¨ç®€å†å‰é¢ï¼Œå¤šå•°å—¦å‡ å¥ã€‚</li>
<li>å¦‚æœä½ çš„æ–‡ç« å¾ˆçƒ­ï¼Œæˆ–è€…è¢«çŸ¥åç½‘ç«™è½¬è½½è¿‡ï¼Œä¹ŸæŠŠå®ƒæ”¾åœ¨ç®€å†å‰é¢ï¼Œå¤šå•°å—¦å‡ å¥ã€‚</li>
<li>å¦‚æœä½ ä¸Šé¢ä¸‰ç‚¹éƒ½æ²¡æœ‰ï¼Œå°±å°†ä½ ç ”ç©¶è¿‡æˆ–è€…å‚ä¸è¿‡çš„å¼€æºæ¡†æ¶æ‹¿å‡ºæ¥ï¼Œå†™ä¸€å†™ä½ éƒ½ä»ä¸­å­¦åˆ°äº†ä»€ä¹ˆã€‚</li>
</ul>
</blockquote>
<h3 id="3-å¤§å…¬å¸å’Œå°å…¬å¸çš„ç”¨äººä¾§é‡ç‚¹ä¸ä¸€æ ·"><a href="#3-å¤§å…¬å¸å’Œå°å…¬å¸çš„ç”¨äººä¾§é‡ç‚¹ä¸ä¸€æ ·" class="headerlink" title="3. å¤§å…¬å¸å’Œå°å…¬å¸çš„ç”¨äººä¾§é‡ç‚¹ä¸ä¸€æ ·"></a>3. å¤§å…¬å¸å’Œå°å…¬å¸çš„ç”¨äººä¾§é‡ç‚¹ä¸ä¸€æ ·</h3><hr>
<p>ç®€å†å†™å¾—å†å¥½ï¼Œå®ƒçš„æ€§è´¨ä¹Ÿåªæ˜¯é¢è¯•çš„æ•²é—¨ç –ï¼ŒçœŸæ­£è€ƒéªŒä½ çš„è¿˜æ˜¯é¢è¯•ã€‚è¿™æ®µæ—¶é—´æˆ‘çš„é¢è¯•æ¬¡æ•°æ˜¯8æ¬¡ï¼Œä½†æ˜¯åªæ‹¿åˆ°äº†2ä¸ªofferï¼Œæˆç»©å¾ˆä¸€èˆ¬ã€‚</p>
<p>æˆ‘åˆ†æäº†ä¸€ä¸‹è‡ªå·±çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼š</p>
<h4 id="æˆ‘çš„ä¼˜åŠ¿ï¼š"><a href="#æˆ‘çš„ä¼˜åŠ¿ï¼š" class="headerlink" title="æˆ‘çš„ä¼˜åŠ¿ï¼š"></a>æˆ‘çš„ä¼˜åŠ¿ï¼š</h4><ol>
<li>å­¦å†é«˜ï¼šæµ·å¤–ç¡•å£«ï¼ˆéç§‘ç­ï¼‰ã€‚</li>
<li>è‡ªå­¦èƒ½åŠ›å¼ºï¼šiOSå®Œå…¨è‡ªå­¦ï¼Œè€Œä¸”æŒç»­æ›´æ–°åšå®¢ï¼Œæœ‰å¼€æºé¡¹ç›®ï¼ˆå¾ˆæ¸£ï¼‰ã€‚å…¥èŒå››ä¸ªæœˆåç‹¬ç«‹è´Ÿè´£ä¸€ä¸ªæ–°é¡¹ç›®ã€‚</li>
</ol>
<h4 id="æˆ‘çš„åŠ£åŠ¿ï¼š"><a href="#æˆ‘çš„åŠ£åŠ¿ï¼š" class="headerlink" title="æˆ‘çš„åŠ£åŠ¿ï¼š"></a>æˆ‘çš„åŠ£åŠ¿ï¼š</h4><ol>
<li>å·¥ä½œç»éªŒå°‘ï¼šä¸¥æ ¼æ¥è®²åªæœ‰10ä¸ªæœˆã€‚</li>
<li>é¡¹ç›®ç»éªŒå°‘ï¼šè€Œä¸”é¡¹ç›®æŠ€æœ¯ç‚¹éš¾åº¦åä½ã€‚</li>
</ol>
<p>æ•´ä½“æ¥è¯´å°±æ˜¯ï¼šç»éªŒå°‘ä¸€äº›ï¼Œæ½œåŠ›å¤§ä¸€ç‚¹ã€‚</p>
<p>æœ‰æ„æ€çš„æ˜¯ï¼Œè¿™8å®¶é¢è¯•æˆ‘çš„å…¬å¸é‡Œæœ‰3å®¶æ˜¯æœ‰ç›¸å½“è§„æ¨¡çš„å¤§å…¬å¸ï¼Œè€Œå…¶ä¸­2å®¶éƒ½ç»™äº†æˆ‘offerã€‚è€Œä¸”åœ¨æˆ‘é¢è¯•çš„è¿‡ç¨‹ä¸­ï¼Œæ˜æ˜¾è§‰å¾—è‡ªå·±æ¯”è¾ƒå—å¤§å…¬å¸é’çï¼Œè€Œå°å…¬å¸å´åå·®æ¯”è¾ƒå¤§ã€‚</p>
<h4 id="ç»“åˆæˆ‘çš„ç‰¹ç‚¹å’Œé¢è¯•ç»“æœæœ‰ä¸€ä¸ªç»“è®ºï¼š"><a href="#ç»“åˆæˆ‘çš„ç‰¹ç‚¹å’Œé¢è¯•ç»“æœæœ‰ä¸€ä¸ªç»“è®ºï¼š" class="headerlink" title="ç»“åˆæˆ‘çš„ç‰¹ç‚¹å’Œé¢è¯•ç»“æœæœ‰ä¸€ä¸ªç»“è®ºï¼š"></a>ç»“åˆæˆ‘çš„ç‰¹ç‚¹å’Œé¢è¯•ç»“æœæœ‰ä¸€ä¸ªç»“è®ºï¼š</h4><p>å¤§å…¬å¸æ‹›äººå¤§å¤šè¿˜æ˜¯ä»¥<strong>åŸ¹å…»</strong>ä¸ºç›®çš„ã€‚<br>å°å…¬å¸æ‹›äººå¤§å¤šæ˜¯ä»¥<strong>ä¸Šæ‰‹</strong>ä¸ºç›®çš„ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œ<br>å¦‚æœä½ è§‰å¾—ä½ æŠ€æœ¯å¾ˆç‰›ï¼Œèƒ½ç‹¬å½“ä¸€é¢çš„è¯ï¼Œå¤§å…¬å¸å’Œå°å…¬å¸éƒ½å¯ä»¥å°è¯•ï¼›<br>å¦‚æœä½ ç»éªŒå°‘ï¼Œä½†æ˜¯æ½œåŠ›ç›¸å¯¹å¤§ä¸€ç‚¹ï¼Œå°å…¬å¸è¿˜æ˜¯ç›¸å¯¹ä¸é€‚åˆçš„ã€‚<br>å¦‚æœä½ ç»éªŒå°‘ï¼Œæ½œåŠ›ä¹Ÿä¸æ˜¯å¾ˆå¤§ï¼Œä¸å»ºè®®é©¬ä¸Šè·³æ§½ï¼ŒæŠŠå‰ä¸¤ç‚¹çš„æŸä¸€ç‚¹æˆ–è€…å…¶ä¸­ä¸€ç‚¹å¼ºåŒ–å†è¯´ã€‚</p>
</blockquote>
<h3 id="4-é¢è¯•é¢˜çš„å‡†å¤‡æœ‰ç‚¹è™å¿ƒ"><a href="#4-é¢è¯•é¢˜çš„å‡†å¤‡æœ‰ç‚¹è™å¿ƒ" class="headerlink" title="4. é¢è¯•é¢˜çš„å‡†å¤‡æœ‰ç‚¹è™å¿ƒ"></a>4. é¢è¯•é¢˜çš„å‡†å¤‡æœ‰ç‚¹è™å¿ƒ</h3><hr>
<p>ç¬”è€…åœ¨ç¬¬ä¸€ç¬¬äºŒæ˜ŸæœŸçš„æ—¶é—´é‡Œä¸€ç›´åœ¨åˆ·ç½‘ä¸Šçš„iOSé¢è¯•é¢˜ï¼Œä¸æ–­åœ°æŸ¥ç¼ºè¡¥æ¼ã€‚åœ¨2ä¸ªæ˜ŸæœŸçš„æ—¶é—´é‡Œï¼Œç¬”è®°æ•°é‡å¢åŠ äº†100+æ¡ï¼Œéƒ½æ˜¯è®°å½•é¢è¯•é¢˜å’Œç›¸å…³åŸºç¡€çŸ¥è¯†çš„ï¼Œåæ¥å®åœ¨æ˜¯çœ‹ä¸ä¸‹å»äº†ï¼Œå·²ç»çœ‹åäº†ã€‚</p>
<p>ä¸è¿‡å¯ç¬‘çš„æ˜¯ï¼š<br>åœ¨é¢è¯•å°å…¬å¸çš„æ—¶å€™ï¼Œé—®çš„é—®é¢˜åŠå…¶åˆé’»ä»¥è‡³äºæˆ‘çš„â€œiOSé¢è¯•é¢˜åº“â€å‡ ä¹å½¢åŒè™šè®¾ï¼Œç½‘ä¸Šçœ‹çš„iOSé¢è¯•é¢˜å·²ç»åº”ä»˜ä¸äº†äº†ã€‚<br>è€Œé¢è¯•å¤§å…¬å¸çš„æ—¶å€™ï¼Œå‡ ä¹éƒ½æ²¡æœ‰é—®å¤ªå¤šiOSç›¸å…³çš„é—®é¢˜ï¼Œè€Œä¸”é—®é¢˜éƒ½ä¸éš¾ã€‚</p>
<blockquote>
<p>è™½ç„¶æˆ‘æœ€ç»ˆè¦å»çš„å…¬å¸é¢è¯•æˆ‘çš„æ—¶å€™æ²¡æœ‰é—®æˆ‘å‡ ä¸ªiOSçš„é¢è¯•é¢˜ï¼Œä¸è¿‡é¢è¯•é¢˜è¿˜æ˜¯éœ€è¦å‡†å¤‡çš„ã€‚è¿™æ®µæ—¶é—´æ€»ç»“çš„100å¤šæ¡ç¬”è®°è™½ç„¶ä¸€æ–¹é¢æ˜¯ä¸ºäº†åœ¨é¢è¯•çš„æ—¶å€™å‘æŒ¥ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå·©å›ºäº†è‡ªå·±çš„åŸºç¡€çŸ¥è¯†ï¼Œè€Œä¸”æ•ˆæœå¾ˆå¥½ã€‚</p>
</blockquote>
<h3 id="5-è¦ä¹ˆåšï¼Œè¦ä¹ˆèµ°"><a href="#5-è¦ä¹ˆåšï¼Œè¦ä¹ˆèµ°" class="headerlink" title="5. è¦ä¹ˆåšï¼Œè¦ä¹ˆèµ°"></a>5. è¦ä¹ˆåšï¼Œè¦ä¹ˆèµ°</h3><hr>
<p>åœ¨æ±‚èŒçš„è¿‡ç¨‹ä¸­çœ‹åˆ°è¿‡è¿™ä¹ˆä¸€å¥è¯ï¼šâ€œä¸æ˜¯äº’è”ç½‘ä¸è¡Œï¼Œè€Œæ˜¯ä½ ä¸è¡Œâ€ã€‚<br>éšåæˆ‘å°±è‡ªè¡Œè„‘è¡¥ï¼šâ€œä¸æ˜¯iOSå½¢åŠ¿ä¸è¡Œï¼Œè€Œæ˜¯ä½ ä¸è¡Œâ€ã€‚<br>é‚£ä¹ˆæ˜¯å¦å¯ä»¥é€šç”¨ä¸€ä¸‹å‘¢ï¼šâ€œä¸æ˜¯<em>__</em>å½¢åŠ¿ä¸è¡Œï¼Œè€Œæ˜¯ä½ ä¸è¡Œâ€ï¼Ÿ</p>
<p>éš¾é“äº’è”ç½‘èµ„æœ¬å¯’å†¬ï¼Œäº’è”ç½‘ä»ä¸šè€…å°±ä¸€å®šä¼šå¤±ä¸šä¹ˆï¼Ÿ<br>éš¾é“iOSå½¢åŠ¿ä¸å¥½ï¼ŒiOSå¼€å‘è€…å°±ä¸€å®šå¾ˆéš¾æ‰¾åˆ°å·¥ä½œæˆ–è€…è·³æ§½ä¹ˆï¼Ÿ</p>
<p>ä¸è¦å¬åˆ°ä¸€äº›â€œä»€ä¹ˆä»€ä¹ˆå½¢åŠ¿ä¸å¥½â€å°±ç»™è‡ªå·±æ‰¾ä¸åˆ°å·¥ä½œæ‰¾å€Ÿå£ï¼Œç»™è‡ªå·±å—ä¼¤çš„å¿ƒçµæŠ¹ä¸Šä¸€ç‚¹è‡ªæ¬ºæ¬ºäººçš„ç³–ã€‚</p>
<p>ä¸ºä»€ä¹ˆç®€å†çŸ³æ²‰å¤§æµ·ï¼Ÿ<br>ä¸ºä»€ä¹ˆé¢è¯•å±¡å±¡ä¸ä¸­ï¼Ÿ</p>
<p>æŒºèµ·èƒ¸è†›è§£å†³é—®é¢˜å¥½ä¹ˆï¼Ÿï¼</p>
<p>ä¸è¦å»æŠ±æ€¨ï¼Œä½ æŠ±æ€¨çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰äººåœ¨é»˜é»˜åˆ·é¢˜ï¼Œé»˜é»˜åˆ·å¼€æºæ¡†æ¶ã€‚å¯¹è‡ªå·±è¦æ±‚ä¸é«˜ï¼Œå¿…å®šä¼šè¢«æ·˜æ±°ã€‚</p>
<p>è®¤æ¸…ç°å®å§ï¼ä»¥å‰iOSè¿™è¾¹â€œä¼šæ‹‰ä¸ªçº¿å°±èƒ½æœˆè–ªè¿‡ä¸‡â€çš„æ—¶ä»£å·²ç»ä¸€å»ä¸å¤è¿”äº†ï¼Œå¦‚ä»Šæ­£æ˜¯æ·˜æ±°æµ‘æ°´æ‘¸é±¼çš„äººçš„é˜¶æ®µã€‚ä½†è¿™æ˜¯ä¸€ä¸ªå¥½ç°è±¡ï¼Œè¯´æ˜è¿™ä¸ªè¡Œä¸šç»ˆäºèµ°ä¸Šæ­£è½¨äº†ã€‚</p>
<p>å¦‚æœè§‰å¾—åšä¸ä¸‹å»äº†ï¼Œæœ€å¥½å°½æ—©ç¦»å¼€ï¼›<br>å¦‚æœå†³å®šåšæŒåšä¸‹å»ï¼Œå°±è¦æ‹¿å‡ºä½ çš„æœ¬äº‹è®©äººå®¶çœ‹çœ‹ã€‚</p>
<p>æ€ä¹ˆçœ‹ï¼Ÿå½“ç„¶ä¸æ˜¯é è¯´çš„ï¼Œè€Œæ˜¯é ä½ åšè¿‡ä»€ä¹ˆã€‚</p>
<p>ç°åœ¨è¿™ä¸ªæ—¶ä»£çŸ¥è¯†çš„å…±äº«å¤ªå®¹æ˜“äº†ï¼Œç»å¤§å¤šæ•°ç§‘ç›®çš„å…¥é—¨èµ„æ–™åœ¨ç½‘ä¸Šéƒ½èƒ½è½»è€Œæ˜“ä¸¾åœ°çœ‹åˆ°ã€‚å¾ˆå¤šäººçœ‹å¾—å¤šäº†ï¼Œä¼šè¯´äº†ï¼Œå°±ä»¥ä¸ºè‡ªå·±æ‡‚äº†ã€‚å› æ­¤è¿™ä¸ªæ—¶ä»£ä¹Ÿè¿‡äºæµ®èºï¼Œå°¤å…¶æ˜¯æœ‰ä¸€äº›ä¼šä¸Šç½‘çš„å¹´è½»äººã€‚</p>
<p>ä½†æ˜¯ï¼ŒæŠ€æœ¯é¢†åŸŸï¼Œå¯¹ä¸€ä¸ªäººçš„è®¤å¯å¹¶ä¸æ˜¯é è¯´çš„ï¼Œè€Œæ˜¯ä½ åšè¿‡äº†ä»€ä¹ˆï¼Œæˆ–æ˜¯èƒ½æ‹¿å‡ºä»€ä¹ˆèƒ½è¯æ˜ä½ ä»¥åèƒ½åšä»€ä¹ˆã€‚</p>
<p>ä¸¾ä¸¤ä¸ªä¸‰å›½æ­¦å°†çš„ä¾‹å­ï¼š<br>ä»ä»€ä¹ˆæ—¶å€™äººä»¬è§‰å¾—å…³ç¾½å‰å®³ï¼Ÿ- æ¸©é…’æ–©åé›„<br>ä»ä»€ä¹ˆæ—¶å€™äººä»¬è§‰å¾—å•å¸ƒå‰å®³ï¼Ÿ- ä¸‰è‹±æˆ˜å•å¸ƒ</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-b6810305d1803032.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…³äºŒçˆ·"></p>
<p>çœ‹å‡ºé—®é¢˜äº†ä¹ˆï¼Ÿ<br>çœ‹è°ç‰›ä¸ç‰›ï¼Œæ˜¯å›´ç»•ç€â€œäº‹ä»¶â€è¯´çš„ï¼Œè€Œä¸æ˜¯å›´ç»•èŠ±é‡Œèƒ¡å“¨çš„<strong>é’é¾™åƒæœˆåˆ€</strong>å’Œ<strong>æ–¹å¤©ç”»æˆŸ</strong>è¿™äº›è¡¨é¢ä¸Šçš„ä¸œè¥¿è¯´çš„ï¼ˆè™½ç„¶èƒ½èˆå¾—åŠ¨è¿™äº›çš„ä¹Ÿèƒ½ç®—æ˜¯ä¸å¼±ï¼‰ã€‚</p>
<p>è§‰å¾—èˆåˆ€å¼„æªç¦»è‡ªå·±å¤ªè¿œï¼Ÿä¸¾ä¸¤ä¸ªç¨‹åºå‘˜ç•Œçš„ä¾‹å­ï¼š<br>Pythonçš„ä½œè€…æ±‚èŒè°·æ­Œçš„æ—¶å€™åªåœ¨ç®€å†ä¸Šå†™äº†ä¸‰ä¸ªè¯ï¼šâ€œI wrote Python.â€<br>åœ¨iOSç•Œå®¶å–»æˆ·æ™“çš„ç½‘ç»œè¯·æ±‚ç¬¬ä¸‰æ–¹æ¡†æ¶AFNetworkingçš„ä½œè€…å¬è¯´å·²ç»è¢«è‹¹æœæ”¶ç¼–äº†ã€‚<br>ï¼ˆæˆ‘ä¹Ÿæ˜¯å¬åˆ«äººè¯´çš„ï¼ŒçœŸçš„å‡çš„ä¸çŸ¥é“ï¼Œä½†æˆ‘å°±æ˜¯è¦è¯´ï¼Œä¸å–œæ¬¢æ¥æ‰“æˆ‘å‘€ï¼‰</p>
<p>å¾ˆç°å®çš„é—®é¢˜ï¼š<br>æ­¦å°†å‰ä¸å‰å®³ï¼Œæ‹¿æˆ˜åŠŸè¯´äº‹å„¿ï¼›<br>æŠ€æœ¯å·¥ä½œè€…å‰ä¸å‰å®³ï¼Œæ‹¿ä½œå“è¯´äº‹å„¿ã€‚ä½ çš„ä½œå“ï¼Œåæ˜ äº†ä½ çš„æ°´å¹³ï¼Œä¹Ÿèƒ½åæ˜ ä½ çš„æ½œåŠ›</p>
<p>æ‰€ä»¥ï¼Œå¯¹äºiOSç¨‹åºå‘˜æ¥è¯´ï¼Œå¦‚æœæƒ³åœ¨è¿™ç›˜æ·˜æ±°èµ›ä¸­ä¸è¢«æŠ›å¼ƒï¼Œç°åœ¨å°±ç€æ‰‹æ„æ€çœŸæ­£å±äºè‡ªå·±çš„é¡¹ç›®ã€‚æˆ–è€…ç”¨åšå®¢è®°å½•ä¸€ä¸‹è‡ªå·±çš„å­¦ä¹ å†ç¨‹ï¼Œå‹¾å‹’å‡ºè‡ªå·±çš„æˆé•¿è½¨è¿¹ï¼šâ€œè®©åˆ«äººçŸ¥é“ä½ çŸ¥é“â€å¾ˆé‡è¦ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æ€è·¯ï¼Œæ²¡æœ‰å…³ç³»ï¼Œçœ‹ä¸€äº›å·²ç»å¼€æºçš„å¥½çš„appå’Œæ¡†æ¶ï¼Œç›¸ä¿¡æˆ‘ï¼Œä¸ä¹…ä½ å°±ä¼šæœ‰è‡ªå·±çš„æƒ³æ³•ã€‚å› ä¸ºåˆ›é€ æ— éå°±æ˜¯æ‹¼å‡‘ï¼Œä½ æ‡‚å¾—å¤šäº†ï¼Œè‡ªç„¶å°±ä¼šâ€œæ‹¼â€äº†ï¼ˆæ­¤å¤„åŒå…³[æ©é¢]ï¼‰ã€‚</p>
<h3 id="6-å¿ƒå¾—å†™å®Œäº†ï¼Œä»¥åè¦æ€ä¹ˆåšå‘¢ï¼Ÿ"><a href="#6-å¿ƒå¾—å†™å®Œäº†ï¼Œä»¥åè¦æ€ä¹ˆåšå‘¢ï¼Ÿ" class="headerlink" title="6. å¿ƒå¾—å†™å®Œäº†ï¼Œä»¥åè¦æ€ä¹ˆåšå‘¢ï¼Ÿ"></a>6. å¿ƒå¾—å†™å®Œäº†ï¼Œä»¥åè¦æ€ä¹ˆåšå‘¢ï¼Ÿ</h3><hr>
<p>ä¸Šé¢è¯´è¿‡ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰è¿™æ¬¡é¢è¯•æˆåŠŸç‡ä¸æ˜¯å¾ˆé«˜ï¼Œè€ŒåŸå› ä¹Ÿæš´éœ²çš„å¾ˆæ˜æ˜¾ï¼šé¡¹ç›®ç»éªŒä¸è¶³ã€‚</p>
<p>å› æ­¤ï¼Œç¬”è€…æ‰“ç®—ä»Šååœ¨ä¸å½±å“å·¥ä½œè´¨é‡çš„æƒ…å†µä¸‹å¥½å¥½ç ”ç©¶ä¸€äº›æ¯”è¾ƒå¥½çš„å¼€æºappå’Œç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œä»”ç»†é˜…è¯»æºç ï¼Œä»ä¸­æŠ½å–å‡ºå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼Œä¸æ–­æé«˜è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ï¼Œè€Œä¸ä»…ä»…åœç•™åœ¨å…¬å¸é¡¹ç›®ä¸­ã€‚</p>
<p>ç›®çš„å¹¶ä¸æ˜¯ä¸ºäº†ä¸‹æ¬¡è·³æ§½ï¼Œè€Œæ˜¯ä¸ºäº†ä¸æ–­æ­å»ºè‡ªå·±çš„æŠ€æœ¯å£å’ï¼Œå–å„å®¶ä¹‹æ‰€é•¿ï¼Œå€Ÿæ­¤æ¥æ‰“é€ ä¸€ä¸ªæ— æ³•å–ä»£çš„è‡ªå·±ï¼š</p>
<p>å°±å¥½æ¯”æ®µèª‰ï¼šåªä¼šå…­è„‰ç¥å‰‘æˆ–è€…å‡Œæ³¢å¾®æ­¥è¿˜ä¸è¶³ä»¥ç‹¬æ­¥æ­¦æ—ï¼Œä½†æ˜¯å°†äºŒè€…ç»“åˆåœ¨ä¸€èµ·å°±èƒ½ä¸è§å¤§ä¾ æŠ—è¡¡äº†ã€‚</p>
<h2 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h2><hr>
<p>æ•´ä¸ªæ±‚èŒè¿‡ç¨‹ä¸­å¿ƒæƒ…è¿˜æ˜¯æœ‰ä½è½çš„æ—¶å€™çš„ï¼Œç‰¹åˆ«æ˜¯ç¬¬ä¸€ä¸ªæ˜ŸæœŸï¼Œé¢è¯•é€šçŸ¥ä¸æ¯«æ²¡æœ‰åŠ¨é™ã€‚ä¸è¿‡è¿˜å¥½æœ‰ä¸€äº›â€œé“ä¸Šâ€çš„æœ‹å‹ç»™æˆ‘é¼“åŠ±å’Œæ”¯æŒã€‚åœ¨è¿™é‡Œç‰¹åˆ«æ„Ÿè°¢åœ¨ç®€ä¹¦ä¸Šè®¤è¯†çš„åŒè¡Œ<a href="http://www.jianshu.com/users/55c8fdc3c6e7/latest_articles" target="_blank" rel="external">TianBai</a>ï¼Œ <a href="http://www.jianshu.com/users/a54931de4c9b/latest_articles" target="_blank" rel="external">é˜¿æ‹‰æ–¯åŠ çš„ç‹—</a>ï¼Œ<a href="http://www.jianshu.com/users/e39da354ce50/latest_articles" target="_blank" rel="external">ç¥ç»éªšæ ‹</a>ï¼Œ<a href="http://www.jianshu.com/users/c68741efc396/latest_articles" target="_blank" rel="external">ç†Šçš®çš®</a>çš„æ”¯æŒå’Œé¼“åŠ±ï¼Œä»–ä»¬éƒ½æ˜¯å¾ˆä¼˜ç§€çš„iOSå¼€å‘è€…ï¼Œè€Œä¸”å¾ˆæœ‰æ½œåŠ›ï¼Œæœ‰å¾ˆå¤šæˆ‘éœ€è¦å­¦ä¹ çš„åœ°æ–¹ã€‚</p>
<p>å¦‚æœæœ‰å°ä¼™ä¼´æœ‰é—®é¢˜æƒ³é—®æˆ‘ï¼Œè¯„è®ºæœ¬æ–‡ï¼Œå‘ç®€ä¿¡ï¼ŒåŠ æˆ‘å¾®ä¿¡ï¼ˆç®€ä¹¦ä¸»é¡µæœ‰æˆ‘çš„å¾®ä¿¡äºŒç»´ç ï¼‰éƒ½å¯ä»¥ã€‚<br>ä¸è¿‡å› ä¸ºæ–°ä¸œå®¶çš„çŸ¥ååº¦æ¯”è¾ƒé«˜ï¼Œå…·ä½“æ–°ä¸œå®¶æ˜¯è°å°±ä¸æ–¹ä¾¿è¯´å•¦ï¼Œè¯·è°…è§£~</p>
<p>æœ€åè¿˜æ˜¯ç¥æ„¿åœ¨æœ€è¿‘æ‰¾å·¥ä½œçš„å°ä¼™ä¼´ä»¬é©¬åˆ°åŠŸæˆ~</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-784af8ebfba85366.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼špixabay.com"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;çœŸçš„æ˜¯éå¸¸éå¸¸æ„Ÿè°¢æˆ‘çš„æ–°ä¸œå®¶ï¼Œåœ¨æˆ‘æœ€éœ€è¦æ–°å·¥ä½œçš„æ—¶å€™ç»™æˆ‘æŠ›æ¥æ©„æ¦„æ~&lt;/p&gt;
&lt;p&gt;æ–°ä¸œå®¶çš„çŸ¥ååº¦å¾ˆé«˜ï¼Œä½†å¹¶ä¸æ˜¯åšäº’è”ç½‘èµ·å®¶çš„ï¼Œæ˜¯ä¸€å®¶æœ‰è‡ªå·±çº¿ä¸‹äº§ä¸šçš„å¤§å…¬å¸ï¼Œåˆ›ç«‹æ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…ï¼Œæ–°é¡¹ç›®ï¼ˆäº’è”ç½‘ï¼‰çš„æŠ€æœ¯å›¢é˜Ÿç»„æˆéå¸¸ä¼˜ç§€ï¼Œæ‰€ä»¥è™½ç„¶ç»™æˆ‘çš„å¾…é‡å¹¶æ²¡æœ‰å¾ˆå¤šï¼Œä½†è¿˜æ˜¯æ¯«ä¸çŠ¹è±«é€‰æ‹©äº†è¿™ä¸€å®¶ã€‚ä¸ºæ­¤è¿˜è°¢ç»äº†åé¢çš„é¢è¯•é‚€è¯·ï¼ˆå› ä¸ºè¦å‡†å¤‡ä¸€äº›å…¥èŒææ–™å’Œå…¥èŒä¹‹å‰çš„ç›¸å…³å­¦ä¹ ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç¬”è€…åœ¨å›½åº†èŠ‚æœŸé—´å‡†å¤‡ç®€å†ï¼Œåœ¨å›½åº†èŠ‚åå¼€å§‹æŠ•é€’ç®€å†ã€‚ä»æœ€å¼€å§‹æŠ•é€’ç®€å†åˆ°æ‹¿åˆ°æœ€åä¸€ä¸ªofferå†æ—¶3å‘¨å¤šã€‚å› ä¸ºåœ¨è¿™æ®µæ±‚èŒæ—¶é—´é‡Œæ„Ÿè§¦å¾ˆå¤šï¼Œæ‰€ä»¥æƒ³ä¸“é—¨å†™ä¸€ç¯‡åšå®¢æ¥è®²è¿°ä¸€ä¸‹è‡ªå·±çš„æ±‚èŒå¿ƒå¾—ï¼Œå¸Œæœ›èƒ½ç»™å„ä½å¹´åº•æ±‚èŒçš„å°ä¼™ä¼´ï¼Œç‰¹åˆ«æ˜¯åšiOSçš„åŒè¡Œä¸€äº›å€¼å¾—å€Ÿé‰´çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-23f60ab52ef7bafa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;å›¾ç‰‡æ¥è‡ªï¼špixabay.com&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Career" scheme="https://github.com/knightsj/knightsj.github.io/categories/Career/"/>
    
    
      <category term="Life" scheme="https://github.com/knightsj/knightsj.github.io/tags/Life/"/>
    
      <category term="Job" scheme="https://github.com/knightsj/knightsj.github.io/tags/Job/"/>
    
  </entry>
  
  <entry>
    <title>é«˜åº¦å°è£…FMDBæ¡†æ¶ï¼šå„ç”¨ä¸€å¥ä»£ç æ›´æ–°ï¼ˆæ·»åŠ &amp;ä¿®æ”¹ï¼‰ï¼ŒæŸ¥è¯¢ï¼Œåˆ é™¤ç”¨æˆ·ä¿¡æ¯</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/%E9%AB%98%E5%BA%A6%E5%B0%81%E8%A3%85FMDB%E6%A1%86%E6%9E%B6%EF%BC%9A%E5%90%84%E7%94%A8%E4%B8%80%E5%8F%A5%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%96%B0%EF%BC%88%E6%B7%BB%E5%8A%A0&amp;%E4%BF%AE%E6%94%B9%EF%BC%89%EF%BC%8C%E6%9F%A5%E8%AF%A2%EF%BC%8C%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/é«˜åº¦å°è£…FMDBæ¡†æ¶ï¼šå„ç”¨ä¸€å¥ä»£ç æ›´æ–°ï¼ˆæ·»åŠ &amp;ä¿®æ”¹ï¼‰ï¼ŒæŸ¥è¯¢ï¼Œåˆ é™¤ç”¨æˆ·ä¿¡æ¯/</id>
    <published>2017-01-13T05:54:08.000Z</published>
    <updated>2017-03-20T07:52:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç§»åŠ¨å¼€å‘ä¸­ï¼Œæœ‰æ—¶ä¸å¾—ä¸åœ¨å®¢æˆ·ç«¯æœ¬åœ°ä¿å­˜ä¸€äº›æ•°æ®ã€‚åœ¨iOSç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨plistï¼Œå±æ€§åˆ—è¡¨ç­‰æŠ€æœ¯æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œç›¸æ¯”è€Œä¸‹æ›´é«˜ç«¯ä¸€ç‚¹çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<strong>æ•°æ®åº“</strong>æ¥å­˜å‚¨æ•°æ®ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯ï¼Œå¾ˆå¤šiOSå¼€å‘è€…æ²¡æœ‰å»é€‰æ‹©ä½¿ç”¨è‹¹æœè‡ªå®¶çš„Core DataæŠ€æœ¯æ¥æ“ä½œæ•°æ®åº“ï¼Œè€Œæ˜¯é€‰æ‹©äº†<a href="[https://github.com/ccgus/fmdb](https://github.com/ccgus/fmdb">FMDB</a>)è¿™ä¸ªç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚</p>
<p>è¯¥æ¡†æ¶å¾ˆå¥½åœ°å°è£…äº†æ“ä½œç¹ççš„SQLiteè¯­å¥ï¼Œè®©æ•°æ®åº“çš„æ“ä½œæ›´åŠ é¢å‘å¯¹è±¡ï¼Œè€Œä¸”ä¸Šæ‰‹å¿«ï¼Œé—¨æ§›ä½ï¼Œä¸ç”¨å­¦ä¹ æ•°æ®åº“çš„ç›¸å…³çŸ¥è¯†å°±å¯ä»¥ä½¿ç”¨è‡ªå¦‚ã€‚å¦‚æ­¤ä¼˜ç§€æµè¡Œçš„æ¡†æ¶æ˜¯å€¼å¾—å­¦ä¹ çš„ï¼Œäºæ˜¯ç¬”è€…è¿™ä¸¤å¤©ç ”ç©¶äº†ä¸€ä¸‹FMDBã€‚ç ”ç©¶åï¼Œç•¥æœ‰æ‰€æ€ï¼Œå°†å®ƒå°è£…äº†ä¸€ä¸‹ï¼Œå†™äº†ä¸€ä¸ª<code>Manager</code>ç±»ï¼Œæœ€åç»“åˆäº†ä¸€ä¸ªDemoæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç±»ã€‚</p>
<p>è¯¥åšå®¢åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:ç¬¬ä¸€ä¸ªéƒ¨åˆ†è®²è§£ç¬”è€…å°è£…çš„è¿™ä¸ª<code>Manager</code>ç±»ï¼›ç¬¬äºŒéƒ¨åˆ†ç»“åˆDemoæ¥ä½“ç°è¯¥ç±»çš„å®ç”¨æ€§ã€‚</p>
<a id="more"></a>
<h1 id="1-å°è£…FMDB"><a href="#1-å°è£…FMDB" class="headerlink" title="1. å°è£…FMDB"></a>1. å°è£…FMDB</h1><hr>
<h2 id="1-1-å°è£…ç±»çš„åŠŸèƒ½"><a href="#1-1-å°è£…ç±»çš„åŠŸèƒ½" class="headerlink" title="1.1 å°è£…ç±»çš„åŠŸèƒ½"></a>1.1 å°è£…ç±»çš„åŠŸèƒ½</h2><p>é¦–å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªç±»çš„å¤§åï¼šSJUserInfoManager</p>
<ul>
<li>SJï¼šç¬”è€…çš„åå­—ç¼©å†™ï¼Œä½œä¸ºå‰ç¼€ï¼Œéƒ½æ‡‚å¾—ã€‚</li>
<li>UserInfo:è¯´æ˜è¿™ä¸ªç±»ç”¨äºæ“ä½œç”¨æˆ·ä¿¡æ¯ã€‚</li>
<li>Manager:è¿™ä¸ªç±»åªå…·æœ‰å·¥å‚æ–¹æ³•ï¼Œçœå†…å­˜ï¼Œè€Œä¸”æ–¹ä¾¿ä½¿ç”¨ã€‚</li>
</ul>
<p><strong>è¿™ä¸ªç±»çš„åŠŸèƒ½æ˜¯ï¼šå®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ªå…³äºç”¨æˆ·ä¿¡æ¯çš„è¡¨ï¼ˆæ•°æ®åº“ï¼‰ï¼Œå¯ä»¥ä¿å­˜ï¼Œä¿®æ”¹ï¼Œè¯»å–ï¼Œåˆ é™¤ç”¨æˆ·ä¿¡æ¯</strong>ã€‚</p>
<blockquote>
<p>ç°åœ¨å‡ ä¹æ¯ä¸ªappéƒ½æœ‰ç™»å½•åŠŸèƒ½ï¼Œæœ‰ç™»å½•å°±æ„å‘³ç€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸€äº›ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿ä»Šåçš„è¯»å–å’Œæ“ä½œã€‚</p>
<p>è€Œå¯¹äºç”¨æˆ·ä¿¡æ¯ï¼Œå‡ ä¹æ°¸è¿œä¸å˜çš„ä¸€é¡¹å°±æ˜¯ç”¨æˆ·idï¼Œå› ä¸ºç”¨æˆ·å¯ä»¥æ”¹è‡ªå·±çš„åå­—ï¼Œè‡ªå·±çš„æ³¨å†Œæ‰‹æœºå·ï¼Œç”¨æˆ·ç­¾åç­‰ç­‰ï¼Œç„¶è€Œç”¨æˆ·idæ˜¯å”¯ä¸€ä¸€æˆä¸å˜çš„ï¼Œåç«¯æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ä¸€èˆ¬éƒ½é€šè¿‡ç”¨æˆ·idæ¥æŸ¥æ‰¾ï¼Œè¿™ä¸éš¾ç†è§£ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œè¿™ä¸ªå°è£…ç±»åŸºäºç”¨æˆ·idï¼ˆuser_idï¼‰ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥è‡ªä¸»æ·»åŠ <strong>ä¸€é¡¹</strong>è‡ªå®šä¹‰çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¯ä»¥æ˜¯ç”¨æˆ·åï¼Œç”¨æˆ·ç­¾åï¼Œç”¨æˆ·æ€§åˆ«ç­‰ç­‰ï¼‰ï¼Œä»è€Œå½¢æˆä¸€ä¸ªåªå…·æœ‰ä¸¤ä¸ªçºµè¡Œçš„è¡¨ï¼ˆç¬¬ä¸€ä¸ªçºµè¡Œæ˜¯é»˜è®¤çš„å­—æ®µï¼šuser_id,ç¬¬äºŒä¸ªçºµè¡Œæ˜¯è‡ªå®šä¹‰å­—æ®µï¼Œå¯ä»¥æ˜¯user_nameç­‰ç­‰ï¼‰ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”Ÿæˆå¾ˆå¤šåŸºäºç”¨æˆ·idçš„è¡¨ï¼šå¯ä»¥æ˜¯ç”¨æˆ·å§“åçš„è¡¨ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·å‡ºç”Ÿæ—¥æœŸçš„è¡¨ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·æ‰‹æœºå·çš„è¡¨ç­‰ç­‰ã€‚</p>
<h2 id="1-2-APIä»‹ç»"><a href="#1-2-APIä»‹ç»" class="headerlink" title="1.2 APIä»‹ç»"></a>1.2 APIä»‹ç»</h2><p>è¯¥å°è£…ç±»çš„APIä¸€å…±æœ‰äº”ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>åˆ›å»ºè¡¨æ ¼</li>
<li>æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆæ·»åŠ &amp;ä¿®æ”¹ï¼‰</li>
<li>æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯</li>
<li>æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·çš„ä¿¡æ¯</li>
<li>åˆ é™¤æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯</li>
</ol>
<p>ä¸‹é¢å¼€å§‹ä¸€ä¸€è®²è§£ï¼š</p>
<h4 id="1-åˆ›å»ºè¡¨æ ¼"><a href="#1-åˆ›å»ºè¡¨æ ¼" class="headerlink" title="1. åˆ›å»ºè¡¨æ ¼"></a>1. åˆ›å»ºè¡¨æ ¼</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">Â ********** Create table with tableName and fieldName **********</div><div class="line">Â *</div><div class="line">Â * @param Â  dataBaseNameÂ  Â  tableNameString (è¡¨çš„åå­—)</div><div class="line">Â * @param Â  userInfoField Â  fieldNameStringï¼ˆè‡ªå®šä¹‰å­—æ®µåï¼‰</div><div class="line">Â *</div><div class="line">Â * @returnÂ  if the table is successfully created</div><div class="line">Â *</div><div class="line">Â */</div><div class="line">+ (<span class="built_in">BOOL</span>)createDataBaseWithName:(<span class="built_in">NSString</span> *)dataBaseName andUserInfoField:(<span class="built_in">NSString</span> *)userInfoField;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªæ–¹æ³•çš„æ„å›¾å¾ˆæ˜æ˜¾ï¼Œåªè¦ä¼ è¿›å»è¡¨çš„åå­—å’Œè‡ªå®šä¹‰å­—æ®µçš„åå­—å°±èƒ½åˆ›é€ ä¸€ä¸ªè¡¨ã€‚</p>
<ul>
<li>åˆ›å»ºæˆåŠŸï¼Œè¿”å›YESï¼›</li>
<li>åˆ›å»ºå¤±è´¥ï¼Œè¿”å›NOã€‚</li>
</ul>
<p>è€Œä¸”è¿™ä¸ªè¡¨æœ‰ä¸€ä¸ªé»˜è®¤çš„å­—æ®µï¼šuser_idã€‚å› ä¸ºé€šè¿‡è¿™ä¸ªç±»åˆ›å»ºç”¨æˆ·ä¿¡æ¯çš„è¡¨æ˜¯åŸºäºç”¨æˆ·idæ¥æ“ä½œçš„ï¼Œå‰é¢å·²æœ‰è¯´æ˜ã€‚</p>
</blockquote>
<h4 id="2-æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆæ·»åŠ -amp-ä¿®æ”¹ï¼‰"><a href="#2-æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆæ·»åŠ -amp-ä¿®æ”¹ï¼‰" class="headerlink" title="2. æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆæ·»åŠ &amp;ä¿®æ”¹ï¼‰"></a>2. æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆæ·»åŠ &amp;ä¿®æ”¹ï¼‰</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">Â ********** update specific userInfo with specific userID and userInfoField and userInfoValue **********</div><div class="line">Â *</div><div class="line">Â * @param Â  dataBaseNameÂ  Â  tableNameString (è¡¨çš„åå­—)</div><div class="line">Â * @param Â  userIDÂ  Â  Â  Â  Â  userIDStringï¼ˆç”¨æˆ·idçš„å€¼ï¼‰</div><div class="line">Â * @param Â  userInfoField Â  fieldNameStringï¼ˆè‡ªå®šä¹‰å­—æ®µåï¼‰</div><div class="line">Â * @param Â  userInfoValue Â  userInfoValueStringï¼ˆå­—æ®µå¯¹åº”çš„å€¼ï¼‰</div><div class="line">Â *</div><div class="line">Â * @returnÂ  the result of updating specific userInfo </div><div class="line">Â *</div><div class="line">Â */</div><div class="line">+ (<span class="built_in">NSString</span> *)updateUserInfoIntoDataBase:(<span class="built_in">NSString</span> *)dataBaseName withUserID:(<span class="built_in">NSString</span> *)userID andUserInfoField:(<span class="built_in">NSString</span> *)userInfoField andUserInfoValue:(<span class="built_in">NSString</span> *)userInfoValue;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªæ–¹æ³•ç”¨äºæ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Œä¼ å…¥è¡¨çš„åå­—ï¼Œç”¨æˆ·idï¼Œè‡ªå®šä¹‰å­—æ®µåï¼Œå’Œè‡ªå®šä¹‰å­—æ®µå¯¹åº”çš„å€¼ã€‚</p>
<ul>
<li>å¦‚æœè¾“å…¥çš„è¡¨ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</li>
<li>å¦‚æœè¾“å…¥çš„ç”¨æˆ·idå·²ç»å­˜åœ¨ï¼Œå°±æ›´æ–°å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ã€‚</li>
<li>å¦‚æœè¾“å…¥çš„ç”¨æˆ·idä¸å­˜åœ¨ï¼Œå°±æ·»åŠ è¿™ä¸ªç”¨æˆ·çš„ä¿¡æ¯ã€‚</li>
</ul>
</blockquote>
<h4 id="3-æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯"><a href="#3-æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯" class="headerlink" title="3. æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯"></a>3. æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">Â ********** Query specific userInfoValue with tableName and userID and userInfoField **********</div><div class="line">Â *</div><div class="line">Â * @param Â  dataBaseNameÂ  Â  tableNameString (è¡¨çš„åå­—)</div><div class="line">Â * @param Â  userIDÂ  Â  Â  Â  Â  userIDStringï¼ˆç”¨æˆ·idçš„å€¼ï¼‰</div><div class="line">Â * @param Â  userInfoField Â  fieldNameStringï¼ˆè‡ªå®šä¹‰å­—æ®µåï¼‰</div><div class="line">Â *</div><div class="line">Â * @returnÂ  specific userInfoValue ï¼ˆè¡¨å†…æŸç”¨æˆ·idå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ï¼‰</div><div class="line">Â *</div><div class="line">Â */</div><div class="line">+ (<span class="built_in">NSString</span> *)queryUserInfoInDataBase:(<span class="built_in">NSString</span> *)dataBaseName WithUserID:(<span class="built_in">NSString</span> *)userId andUserInfoField:(<span class="built_in">NSString</span> *)userInfoField;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¯¥æ–¹æ³•ç”¨äºæŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¼ å…¥è¡¨çš„åå­—ï¼Œç”¨æˆ·idå’Œè‡ªå®šä¹‰å­—æ®µåã€‚</p>
<ul>
<li>å¦‚æœè¾“å…¥çš„è¡¨ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</li>
<li>å¦‚æœè¾“å…¥çš„ç”¨æˆ·idå­˜åœ¨ï¼Œåˆ™è¿”å›å¯¹åº”çš„ä¿¡æ¯ã€‚</li>
<li>å¦‚æœè¾“å…¥çš„ç”¨æˆ·idä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
</blockquote>
<h4 id="4-æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·çš„ä¿¡æ¯"><a href="#4-æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·çš„ä¿¡æ¯" class="headerlink" title="4. æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·çš„ä¿¡æ¯"></a>4. æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·çš„ä¿¡æ¯</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">Â ********** Query all userInfos in this table with userInfoField **********</div><div class="line">Â *</div><div class="line">Â * @param Â  dataBaseNameÂ  Â  tableNameString (è¡¨çš„åå­—)</div><div class="line">Â * @param Â  userInfoField Â  fieldNameStringï¼ˆè‡ªå®šä¹‰å­—æ®µåï¼‰</div><div class="line">Â *</div><div class="line">Â * @returnÂ  all the userInfos in this table ï¼ˆè¡¨å†…æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ï¼‰</div><div class="line">Â *</div><div class="line">Â */</div><div class="line">+ (<span class="built_in">NSDictionary</span> *)queryUserInfosInDataBase:(<span class="built_in">NSString</span> *)dataBaseName andUserInfoField:(<span class="built_in">NSString</span> *)userInfoField;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¯¥æ–¹æ³•ç”¨æˆ·è·å–æŸä¸ªè¡¨å†…çš„æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œä¼ å…¥è¡¨çš„åå­—å’Œè‡ªå®šä¹‰å­—æ®µåå³å¯ã€‚<br>è¿”å›çš„å­—å…¸é‡ŒåŒ…å«ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ä¸ºè¡¨çš„æ¯ä¸€è¡Œçš„ä¿¡æ¯ã€‚æ¯ä¸€è¡Œçš„ä¿¡æ¯æ˜¯ä¸€ä¸ªå­—å…¸ï¼š</p>
<ul>
<li>å…¶ä¸­ä¸€ä¸ªkeyä¸ºé»˜è®¤çš„å­—æ®µåï¼šuser_idï¼Œå®ƒçš„å€¼ä¸ºå¯¹åº”çš„user_idçš„å€¼ã€‚</li>
<li>å¦ä¸€ä¸ªkeyä¸ºæ·»åŠ çš„è‡ªå®šä¹‰å­—æ®µåï¼Œå®ƒå¯¹åº”çš„å€¼ä¸ºè¯¥å­—æ®µå¯¹åº”çš„å€¼ã€‚</li>
</ul>
</blockquote>
<h4 id="5-åˆ é™¤æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯"><a href="#5-åˆ é™¤æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯" class="headerlink" title="5. åˆ é™¤æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯"></a>5. åˆ é™¤æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">Â ********** Delete specific userInfo with specific userID **********</div><div class="line">Â *</div><div class="line">Â * @param Â  dataBaseNameÂ  Â  tableNameString (è¡¨çš„åå­—)</div><div class="line">Â * @param Â  userIdÂ  Â  Â  Â  Â  userIDStringï¼ˆç”¨æˆ·idçš„å€¼ï¼‰</div><div class="line">Â *</div><div class="line">Â * @returnÂ  the result of deleting specific userInfo ï¼ˆåˆ é™¤çš„ç»“æœï¼‰</div><div class="line">Â *</div><div class="line">Â */</div><div class="line">+ (<span class="built_in">NSString</span> *)deleteUserInfoInDataBase:(<span class="built_in">NSString</span> *)dataBaseName WithUserID:(<span class="built_in">NSString</span> *)userId;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¯¥æ–¹æ³•ç”¨äºåˆ é™¤è¡¨é‡Œçš„æŸä¸ªç”¨æˆ·ä¿¡æ¯ï¼Œåªè¦ä¼ å…¥è¡¨çš„åå­—å’Œç”¨æˆ·idå³å¯ï¼Œå¯ä»¥åˆ é™¤è¡¨ä¸­å¯¹åº”çš„ä¸€æ•´è¡Œä¿¡æ¯ã€‚åŒæ ·åœ°ï¼Œå¦‚æœè¾“å…¥çš„è¡¨ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
</blockquote>
<p>å¦‚æœè§‰å¾—æœ‰ç‚¹æŠ½è±¡çš„è¯ï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªDemoï¼Œå¯ä»¥çœ‹åˆ°è¯¥å°è£…ç±»çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ã€‚</p>
<h1 id="2-Demoæ¼”ç¤º"><a href="#2-Demoæ¼”ç¤º" class="headerlink" title="2. Demoæ¼”ç¤º"></a>2. Demoæ¼”ç¤º</h1><hr>
<p>åœ¨è¿™ä¸ªDemoä¸­ï¼Œæˆ‘ä»¬è¦åœ¨è¡¨é‡Œæ·»åŠ çš„è‡ªå®šä¹‰å­—æ®µå(fieldNameString)ä¸ºï¼šâ€œuser_nameâ€ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¡¨å°†ä¿å­˜ç”¨æˆ·idå’Œç”¨æˆ·åä¿¡æ¯ã€‚</p>
<h2 id="2-1-éœ€æ±‚"><a href="#2-1-éœ€æ±‚" class="headerlink" title="2.1 éœ€æ±‚"></a>2.1 éœ€æ±‚</h2><ol>
<li>åœ¨æ’å…¥æ¿å—ä¸­æ’å…¥ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·idå’Œç”¨æˆ·åï¼‰ã€‚</li>
<li>åœ¨æŸ¥è¯¢æ¿å—ä¸­ï¼Œæ ¹æ®è¾“å…¥çš„ç”¨æˆ·idï¼Œå¯ä»¥æ˜¾ç¤ºå¯¹åº”çš„ç”¨æˆ·åã€‚å¦‚æœæ²¡æœ‰å¯¹åº”çš„ç”¨æˆ·idï¼Œåˆ™æ˜¾ç¤ºâ€œæ²¡æœ‰å¯¹åº”idâ€ã€‚</li>
<li>åœ¨åˆ é™¤æ¿å—ä¸­ï¼Œæ ¹æ®è¾“å…¥çš„ç”¨æˆ·idï¼Œå¯ä»¥åˆ é™¤å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç”¨æˆ·idå’Œç”¨æˆ·åï¼Œä¹Ÿå°±æ˜¯åˆ é™¤äº†è¡¨çš„ä¸€æ•´è¡Œï¼‰ã€‚å¦‚æœæ²¡æœ‰å¯¹åº”çš„ç”¨æˆ·idï¼Œåˆ™æ˜¾ç¤ºâ€œæ²¡æœ‰å¯¹åº”idâ€ã€‚</li>
<li>ç‚¹å‡»å¯¼èˆªæ å³ä¾§çš„æŒ‰é’®ï¼Œè¿›å…¥â€œç”¨æˆ·ä¿¡æ¯åˆ—è¡¨é¡µâ€ã€‚åœ¨è¿™ä¸€é¡µæ˜¾ç¤ºå½“å‰è¡¨é‡Œçš„å…¨éƒ¨ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆåœ¨cellçš„textLabelé‡Œæ˜¾ç¤ºç”¨æˆ·åï¼›åœ¨cellçš„detailTextLabelé‡Œæ˜¾ç¤ºç”¨æˆ·idï¼‰ã€‚</li>
</ol>
<h2 id="2-2-æ•ˆæœå›¾"><a href="#2-2-æ•ˆæœå›¾" class="headerlink" title="2.2 æ•ˆæœå›¾"></a>2.2 æ•ˆæœå›¾</h2><p><img src="http://upload-images.jianshu.io/upload_images/859001-404e4004af3b981a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å·¦å›¾ï¼šæ•°æ®åº“æ“ä½œé¡µé¢ï¼ˆæ’å…¥ï¼ŒæŸ¥è¯¢ï¼Œåˆ é™¤æ¿å—ï¼‰| å³å›¾ï¼šæ•°æ®åº“å…¨éƒ¨ç”¨æˆ·ä¿¡æ¯"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-f32a934c4eb45af6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ¬åœ°æ²™ç›’ä¸­sqliteè¡¨æ–‡ä»¶å†…å®¹"></p>
<h3 id="2-3-ä»£ç è®²è§£"><a href="#2-3-ä»£ç è®²è§£" class="headerlink" title="2.3 ä»£ç è®²è§£"></a>2.3 ä»£ç è®²è§£</h3><p><strong>1. æœ€å…ˆå¯¼å…¥è¿™ä¸ªå°è£…ç±»å’ŒFMDBæ¡†æ¶ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"SJUserInfoManager.h"</span></span></div></pre></td></tr></table></figure>
<p><strong>2. å› ä¸ºè¡¨çš„åå­—å’Œè‡ªå®šä¹‰å­—æ®µæ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å°±ä»¥å®æ¥å®šä¹‰äº†ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define DATABASENAME  @<span class="meta-string">"userInfoTable"</span> //è¡¨çš„åå­—</span></div><div class="line"><span class="meta">#define USERINFOFIELD @<span class="meta-string">"user_name"</span>     //è‡ªå®šä¹‰å­—æ®µçš„åå­—</span></div></pre></td></tr></table></figure>
<p><strong>3. æ·»åŠ å‡ ä¸ªè¾“å…¥æ¡†çš„å±æ€§ï¼Œè·å–è¾“å…¥æ¡†çš„å†…å®¹ï¼›å’ŒæŸ¥è¯¢ç»“æœæ˜¾ç¤º</strong>Labelï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *insertUserIdTextfield;       <span class="comment">//æ’å…¥è¾“å…¥æ¡†ï¼šè¾“å…¥ç”¨æˆ·id</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *insertUserInfoValueTextfiled;<span class="comment">//æ’å…¥æ”¶å…¥æ¡†ï¼šè¾“å…¥ç”¨æˆ·å</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *queryUserIdTextfield;        <span class="comment">//æŸ¥è¯¢è¾“å…¥æ¡†ï¼šè¾“å…¥ç”¨æˆ·id</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *queryUserInfoValueLabel;         <span class="comment">//æŸ¥è¯¢ç»“æœæ˜¾ç¤ºLabel:æ˜¾ç¤ºç”¨æˆ·idå¯¹åº”çš„ç”¨æˆ·å</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *deleteUserIdTextField;       <span class="comment">//åˆ é™¤è¾“å…¥æ¡†ï¼šè¾“å…¥ç”¨æˆ·id</span></div></pre></td></tr></table></figure>
<p><strong>4. ä¸‹é¢çœ‹ä¸€ä¸‹å°è£…çš„å¢æ”¹&amp;æŸ¥&amp;åˆ çš„ä»£ç ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ’å…¥ç”¨æˆ·ä¿¡æ¯</span></div><div class="line">- (<span class="keyword">IBAction</span>)insertAction:(<span class="keyword">id</span>)sender &#123;</div><div class="line">Â  Â </div><div class="line">Â  Â  <span class="built_in">NSString</span> *result = <span class="string">@""</span>;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span>.insertUserInfoValueTextfiled.text.length == <span class="number">0</span>) &#123;</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â Â  Â  Â  Â  result = <span class="string">@"Please Input UserID!"</span>;<span class="comment">//æ²¡æœ‰è¾“å…¥ç”¨æˆ·idå°±ç‚¹å‡»äº†æ’å…¥æŒ‰é’®</span></div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  &#125;<span class="keyword">else</span>&#123;</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â Â  Â  Â  Â  result = [SJUserInfoManager updateUserInfoIntoDataBase:DATABASENAME withUserID:<span class="keyword">self</span>.insertUserIdTextfield.text andUserInfoField:USERINFOFIELD andUserInfoValue:<span class="keyword">self</span>.insertUserInfoValueTextfiled.text];</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â </div><div class="line">Â Â  [<span class="keyword">self</span> showAlertWithTitle:result];</div><div class="line">Â Â  Â </div><div class="line">&#125;</div><div class="line"><span class="comment">//æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></div><div class="line">- (<span class="keyword">IBAction</span>)queryUserInfoValue:(<span class="built_in">UIButton</span> *)sender &#123;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="built_in">NSString</span> *result = <span class="string">@""</span>;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span>.queryUserIdTextfield.text.length == <span class="number">0</span>) &#123;</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  result = <span class="string">@"Please Input UserID!"</span>;<span class="comment">//æ²¡æœ‰è¾“å…¥ç”¨æˆ·idå°±ç‚¹å‡»äº†æŸ¥è¯¢æŒ‰é’®</span></div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.queryUserInfoValueLabel.text = <span class="string">@""</span>;<span class="comment">//é‡ç½®æŸ¥è¯¢è¾“å…¥æ¡†</span></div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  &#125;<span class="keyword">else</span>&#123;</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  result =Â  [SJUserInfoManager queryUserInfoInDataBase:DATABASENAME WithUserID:<span class="keyword">self</span>.queryUserIdTextfield.text andUserInfoField:USERINFOFIELD];</div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.queryUserInfoValueLabel.text = result;</div><div class="line">Â  Â  Â  Â  [<span class="keyword">self</span> showAlertWithTitle:result];</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  &#125;Â Â  Â </div><div class="line">Â  Â  [<span class="keyword">self</span> showAlertWithTitle:result];</div><div class="line">&#125;</div><div class="line"><span class="comment">//åˆ é™¤ç”¨æˆ·ä¿¡æ¯</span></div><div class="line">- (<span class="keyword">IBAction</span>)deleteUserInfoWithUserID:(<span class="built_in">UIButton</span> *)sender &#123;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="built_in">NSString</span> *result = <span class="string">@""</span>;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span>.deleteUserIdTextField.text.length == <span class="number">0</span>) &#123;</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  result = <span class="string">@"Please Input UserID!"</span>;</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  &#125;<span class="keyword">else</span>&#123;</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  result =Â  [SJUserInfoManager deleteUserInfoInDataBase:DATABASENAME WithUserID:<span class="keyword">self</span>.deleteUserIdTextField.text];</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  [<span class="keyword">self</span> showAlertWithTitle:result];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å…¶å®ä¸éš¾çœ‹å‡ºï¼Œé™¤äº†å¤„ç†é”™è¯¯ä¿¡æ¯çš„ä»£ç ä»¥å¤–ï¼Œæ•°æ®åº“çš„æ“ä½œä»£ç æ˜¯éå¸¸ç®€æ´çš„:éƒ½æ˜¯ä¸€è¡Œç»“æŸï¼Œè€Œä¸”è¿”å›ä¸€ä¸ªç»“æœå­—ç¬¦ä¸²æˆ–è€…å¸ƒå°”å€¼ã€‚</p>
</blockquote>
<p><strong>5. åœ¨è¿›å…¥ç¬¬äºŒé¡µä¹‹å‰ï¼Œéœ€è¦æŸ¥è¯¢è¡¨å†…æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯å¹¶ä¼ é€’ç»™ç¬¬äºŒä¸ªé¡µé¢çš„VCï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="keyword">if</span> ([segue.destinationViewController isKindOfClass:[DataListTableViewController <span class="keyword">class</span>]]) &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> ([segue.identifier isEqualToString:<span class="string">@"userInfosList"</span>]) &#123;</div><div class="line">Â Â  Â  Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSDictionary</span> *userInfosDict = [SJUserInfoManager queryUserInfosInDataBase:DATABASENAME andUserInfoField:USERINFOFIELD];</div><div class="line">Â  Â  Â  Â  Â  Â  DataListTableViewController *dataListVc = (DataListTableViewController *)segue.destinationViewController;</div><div class="line">Â  Â  Â  Â  Â  Â  dataListVc.userInfosDict = userInfosDict;</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  &#125;Â Â  Â </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>6. åœ¨ç¬¬äºŒé¡µçš„viewDidLoadæ–¹æ³•é‡Œè·å–ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ï¼Œå¹¶åˆ·æ–°è¡¨æ ¼å°†å…¶æ˜¾ç¤ºå‡ºæ¥ï¼š</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  [<span class="keyword">super</span> viewDidLoad];</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="built_in">NSString</span> *alertTitle = [<span class="keyword">self</span>.userInfosDict objectForKey:<span class="string">@"result"</span>];</div><div class="line">Â  Â  [<span class="keyword">self</span> showAlertWithTitle:alertTitle];</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="built_in">NSArray</span> *userInfosArray = [<span class="keyword">self</span>.userInfosDict objectForKey:<span class="string">@"userInfosArray"</span>];</div><div class="line">Â  Â  <span class="keyword">if</span> ([userInfosArray count] != <span class="number">0</span>) &#123;</div><div class="line">Â Â  Â  Â  Â  <span class="keyword">self</span>.userInfosArray = userInfosArray;</div><div class="line">Â  Â  Â  Â  [<span class="keyword">self</span>.tableView reloadData];</div><div class="line">Â  Â  &#125;</div><div class="line">Â Â  Â </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æƒ³çŸ¥é“Demoæ˜¯å¦‚ä½•å®ç°çš„ä¹ˆï¼Ÿ</p>
<p>Demoä¼ é€é—¨ï¼š<a href="https://github.com/Shijie0111/SJUserInfoManager">SJUserInfoManager - GitHub</a></p>
<p>å¦‚æœå¯ä»¥ç»™æ˜Ÿæ˜Ÿï¼Œæˆ–è€…ç»™ç¬”è€…ææ„è§ï¼Œé‚£å°±å†å¥½ä¸è¿‡å•¦~</p>
<h1 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h1><hr>
<p>è¯´æ¥æƒ­æ„§ï¼Œç¬”è€…å°è£…çš„è¿™ä¸ªç±»çš„åŠŸèƒ½è¿˜æ˜¯å¾ˆæœ‰å±€é™æ€§çš„ï¼š</p>
<ol>
<li>æ“ä½œè¡¨æ ¼å‰å¿…é¡»åˆ›å»ºä¸€æ¬¡è¡¨æ ¼ï¼ˆä¸€æ¬¡å°±å¯ä»¥ï¼‰ã€‚</li>
<li>åªæ”¯æŒNSStringç±»å‹çš„å€¼ã€‚</li>
<li>é™¤user_idå­—æ®µä»¥å¤–åªæ”¯æŒä¸€ä¸ªè‡ªå®šä¹‰å­—æ®µã€‚</li>
<li>ä¸åŒçš„è‡ªå®šä¹‰å­—æ®µå¿…é¡»å¯¹åº”ä¸åŒçš„è¡¨æ ¼åï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„è‡ªå®šä¹‰å­—æ®µä¸èƒ½å¯¹åº”åŒä¸€ä¸ªè¡¨æ ¼åã€‚</li>
<li>æ•°æ®åº“æ“ä½œAPIçš„è¿”å›å€¼è¿˜ä¸å¤Ÿå®Œå–„ï¼Œæœ€å¥½ä»¥æšä¸¾ç±»å‹è¿”å›ï¼Œæœ‰å¾…æ”¹è¿›ã€‚</li>
<li>æ²¡æœ‰ä½¿ç”¨FMDBçš„é˜Ÿåˆ—APIã€‚</li>
</ol>
<p>è™½ç„¶è¿™ä¸ªå°è£…å¾ˆç®€å•ï¼Œä½†æ˜¯ç¬”è€…å§‹ç»ˆèµåŒ<strong>å­¦ä¹ çš„æœ€ç»ˆç›®çš„åœ¨äºåº”ç”¨å’Œåˆ›é€ </strong>è¿™å¥è¯ã€‚å¦‚æœåªæ˜¯ç”¨çœ¼ç›çœ‹FMDBæ¡†æ¶çš„APIæˆ–æ˜¯å¤åˆ¶ç²˜è´´ä¸€äº›åˆ«äººå†™å¥½çš„FMDBçš„åº”ç”¨ä»£ç ï¼Œé‚£ä¹ˆå…¶å®æ˜¯æ„ä¹‰ä¸å¤§çš„ã€‚</p>
<p>å¦‚æœåœ¨å­¦ä¹ åï¼Œå¯ä»¥èä¼šè´¯é€šï¼Œå°†å­¦åˆ°çš„çŸ¥è¯†å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ„å›¾åŠ ä»¥æ”¹è¿›å’Œè¿ç”¨çš„è¯ï¼Œé‚£ä¹ˆç›¸å¯¹äºâ€œæ¬è¿å·¥â€å¼å­¦ä¹ æ¥è¯´ï¼Œæ˜¾ç„¶æ”¶è·æ›´å¤§ã€‚</p>
<p>è¿™æ˜¯ç¬”è€…ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè™½ç„¶ç®€å•ï¼Œç®—ä¸Šä¼˜åŒ–å’Œæ”¹bugåªå†™äº†å¤§æ¦‚3ä¸ªå°æ—¶ï¼Œä½†æ˜¯æ¯•ç«Ÿæ˜¯å¼€æºçš„ç¬¬ä¸€æ­¥ï¼Œå¯¹è‡ªå·±çš„é¼“åŠ±è¿˜æ˜¯è›®å¤§çš„ï¼Œä»¥åè¿˜ä¼šå°è£…ä¼˜åŒ–æ›´å¤šçš„åº“ï¼ŒåŠ æ²¹~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ç§»åŠ¨å¼€å‘ä¸­ï¼Œæœ‰æ—¶ä¸å¾—ä¸åœ¨å®¢æˆ·ç«¯æœ¬åœ°ä¿å­˜ä¸€äº›æ•°æ®ã€‚åœ¨iOSç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨plistï¼Œå±æ€§åˆ—è¡¨ç­‰æŠ€æœ¯æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œç›¸æ¯”è€Œä¸‹æ›´é«˜ç«¯ä¸€ç‚¹çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;strong&gt;æ•°æ®åº“&lt;/strong&gt;æ¥å­˜å‚¨æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰è¶£çš„æ˜¯ï¼Œå¾ˆå¤šiOSå¼€å‘è€…æ²¡æœ‰å»é€‰æ‹©ä½¿ç”¨è‹¹æœè‡ªå®¶çš„Core DataæŠ€æœ¯æ¥æ“ä½œæ•°æ®åº“ï¼Œè€Œæ˜¯é€‰æ‹©äº†&lt;a href=&quot;[https://github.com/ccgus/fmdb](https://github.com/ccgus/fmdb&quot;&gt;FMDB&lt;/a&gt;)è¿™ä¸ªç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ¡†æ¶å¾ˆå¥½åœ°å°è£…äº†æ“ä½œç¹ççš„SQLiteè¯­å¥ï¼Œè®©æ•°æ®åº“çš„æ“ä½œæ›´åŠ é¢å‘å¯¹è±¡ï¼Œè€Œä¸”ä¸Šæ‰‹å¿«ï¼Œé—¨æ§›ä½ï¼Œä¸ç”¨å­¦ä¹ æ•°æ®åº“çš„ç›¸å…³çŸ¥è¯†å°±å¯ä»¥ä½¿ç”¨è‡ªå¦‚ã€‚å¦‚æ­¤ä¼˜ç§€æµè¡Œçš„æ¡†æ¶æ˜¯å€¼å¾—å­¦ä¹ çš„ï¼Œäºæ˜¯ç¬”è€…è¿™ä¸¤å¤©ç ”ç©¶äº†ä¸€ä¸‹FMDBã€‚ç ”ç©¶åï¼Œç•¥æœ‰æ‰€æ€ï¼Œå°†å®ƒå°è£…äº†ä¸€ä¸‹ï¼Œå†™äº†ä¸€ä¸ª&lt;code&gt;Manager&lt;/code&gt;ç±»ï¼Œæœ€åç»“åˆäº†ä¸€ä¸ªDemoæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç±»ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥åšå®¢åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:ç¬¬ä¸€ä¸ªéƒ¨åˆ†è®²è§£ç¬”è€…å°è£…çš„è¿™ä¸ª&lt;code&gt;Manager&lt;/code&gt;ç±»ï¼›ç¬¬äºŒéƒ¨åˆ†ç»“åˆDemoæ¥ä½“ç°è¯¥ç±»çš„å®ç”¨æ€§ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Production" scheme="https://github.com/knightsj/knightsj.github.io/categories/Production/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠEffective Objective-Cã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸‰ï¼‰ï¼šæŠ€å·§ç¯‡</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/%E3%80%8AEffective%20Objective-C%E3%80%8B%E8%B6%85%E7%BA%A7%E5%B9%B2%E8%B4%A7%E4%B8%89%E9%83%A8%E6%9B%B2%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E6%8A%80%E5%B7%A7%E7%AF%87/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/ã€ŠEffective Objective-Cã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸‰ï¼‰ï¼šæŠ€å·§ç¯‡/</id>
    <published>2017-01-13T05:52:57.000Z</published>
    <updated>2017-03-20T07:48:16.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/859001-4696272b0a4ffe42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ã€ŠEffective Objective-C ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹"></p>
<p>ã€ŠEffective Objective-C ã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ç³»åˆ—è¿æ¥äº†æœ€åä¸€ç¯‡ï¼šæŠ€å·§ç¯‡ï¼Œè¿™ä¸€ç¯‡æ€»ç»“æ±‡æ€»äº†è¿™æœ¬ä¹¦ä¸­ä¸€äº›ç”¨æ¥è§£å†³é—®é¢˜çš„åå‘â€œè®¾è®¡æ¨¡å¼â€çš„çŸ¥è¯†ç‚¹ã€‚</p>
<p>ä¸çŸ¥é“ç¬”è€…æ‰€è°“çš„ä¸‰éƒ¨æ›²çš„ç«¥é‹ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¿™å¼ å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-0599d987732d932e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‰éƒ¨æ›²åˆ†å¸ƒå›¾"></p>
<p>å‰ä¸¤ç¯‡ä¼ é€é—¨ï¼š<br><a href="http://www.jianshu.com/p/9c93c7ab734d" target="_blank" rel="external">ã€ŠEffective Objective-C ã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸€ï¼‰ï¼šæ¦‚å¿µç¯‡</a><br><a href="http://www.jianshu.com/p/0b895e39eca1" target="_blank" rel="external">ã€ŠEffective Objective-C ã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆäºŒï¼‰ï¼šè§„èŒƒç¯‡</a></p>
<a id="more"></a>
<h1 id="ç¬¬9æ¡-ä»¥â€œç±»æ—æ¨¡å¼â€œéšè—å®ç°ç»†èŠ‚"><a href="#ç¬¬9æ¡-ä»¥â€œç±»æ—æ¨¡å¼â€œéšè—å®ç°ç»†èŠ‚" class="headerlink" title="ç¬¬9æ¡ ä»¥â€œç±»æ—æ¨¡å¼â€œéšè—å®ç°ç»†èŠ‚"></a>ç¬¬9æ¡ ä»¥â€œç±»æ—æ¨¡å¼â€œéšè—å®ç°ç»†èŠ‚</h1><hr>
<p>åœ¨iOSå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šä½¿ç”¨â€œç±»æ—â€(class cluster)è¿™ä¸€è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡â€œæŠ½è±¡åŸºç±»â€æ¥å®ä¾‹åŒ–ä¸åŒçš„å®ä½“å­ç±»ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ° ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">UIButton</span> *)buttonWithType:(<span class="built_in">UIButtonType</span>)type;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªéœ€è¦è¾“å…¥ä¸åŒçš„æŒ‰é’®ç±»å‹(UIButtonType)å°±å¯ä»¥å¾—åˆ°ä¸åŒçš„UIButtonçš„å­ç±»ã€‚åœ¨OCæ¡†æ¶ä¸­æ™®éä½¿ç”¨è¿™ä¸€è®¾è®¡æ¨¡å¼ã€‚</p>
</blockquote>
<h4 id="ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢"><a href="#ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢?"></a>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢?</h4><p>ç¬”è€…è®¤ä¸ºè¿™ä¹ˆåšçš„åŸå› æ˜¯ä¸ºäº†â€œå¼±åŒ–â€å­ç±»çš„å…·ä½“ç±»å‹ï¼Œè®©å¼€å‘è€…æ— éœ€å…³å¿ƒåˆ›å»ºå‡ºæ¥çš„å­ç±»å…·ä½“å±äºå“ªä¸ªç±»ã€‚ï¼ˆè¿™é‡Œè§‰å¾—è¿˜æœ‰ç‚¹ä»€ä¹ˆï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æƒ³åˆ°ï¼Œæ¬¢è¿è¡¥å……ï¼ï¼‰</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š<br>å¯¹äºâ€œå‘˜å·¥â€è¿™ä¸ªç±»ï¼Œå¯ä»¥æœ‰å„ç§ä¸åŒçš„â€œå­ç±»å‹â€ï¼šå¼€å‘å‘˜å·¥ï¼Œè®¾è®¡å‘˜å·¥å’Œè´¢æ”¿å‘˜å·¥ã€‚è¿™äº›â€œå®ä½“ç±»â€å¯ä»¥ç”±â€œå‘˜å·¥â€è¿™ä¸ªæŠ½è±¡åŸºç±»æ¥è·å¾—ï¼š</p>
<h4 id="1-æŠ½è±¡åŸºç±»"><a href="#1-æŠ½è±¡åŸºç±»" class="headerlink" title="1. æŠ½è±¡åŸºç±»"></a>1. æŠ½è±¡åŸºç±»</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//EOCEmployee.h</span></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSUInteger</span>, EOCEmployeeType) &#123;</div><div class="line">    EOCEmployeeTypeDeveloper,</div><div class="line">    EOCEmployeeTypeDesigner,</div><div class="line">    EOCEmployeeTypeFinance,</div><div class="line">&#125;;</div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCEmployee</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line"><span class="keyword">@property</span> <span class="built_in">NSUInteger</span> salary;</div><div class="line"><span class="comment">// Helper for creating Employee objects</span></div><div class="line">+ (EOCEmployee*)employeeWithType:(EOCEmployeeType)type;</div><div class="line"><span class="comment">// Make Employees do their respective day's work</span></div><div class="line">- (<span class="keyword">void</span>)doADaysWork;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//EOCEmployee.m</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCEmployee</span></span></div><div class="line">+ (EOCEmployee*)employeeWithType:(EOCEmployeeType)type &#123;</div><div class="line">     <span class="keyword">switch</span> (type) &#123;</div><div class="line">         <span class="keyword">case</span> EOCEmployeeTypeDeveloper:</div><div class="line">            <span class="keyword">return</span> [EOCEmployeeDeveloper new];</div><div class="line">         <span class="keyword">break</span>; </div><div class="line">        <span class="keyword">case</span> EOCEmployeeTypeDesigner:</div><div class="line">             <span class="keyword">return</span> [EOCEmployeeDesigner new];</div><div class="line">         <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> EOCEmployeeTypeFinance:</div><div class="line">             <span class="keyword">return</span> [EOCEmployeeFinance new];</div><div class="line">         <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)doADaysWork &#123;</div><div class="line"> <span class="comment">// éœ€è¦å­ç±»æ¥å®ç°</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå°†EOCEmployeeä½œä¸ºæŠ½è±¡åŸºç±»ï¼Œè¿™ä¸ªæŠ½è±¡åŸºç±»æœ‰ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¤šç§åŸºäºè¿™ä¸ªæŠ½è±¡åŸºç±»çš„å®ä½“å­ç±»:</p>
</blockquote>
<h4 id="2-å®ä½“å­ç±»ï¼ˆconcrete-subclassï¼‰"><a href="#2-å®ä½“å­ç±»ï¼ˆconcrete-subclassï¼‰" class="headerlink" title="2. å®ä½“å­ç±»ï¼ˆconcrete subclassï¼‰:"></a>2. å®ä½“å­ç±»ï¼ˆconcrete subclassï¼‰:</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCEmployeeDeveloper</span> : <span class="title">EOCEmployee</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCEmployeeDeveloper</span></span></div><div class="line">- (<span class="keyword">void</span>)doADaysWork &#123;</div><div class="line">    [<span class="keyword">self</span> writeCode];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong><br>å¦‚æœå¯¹è±¡æ‰€å±çš„ç±»ä½äºæŸä¸ªç±»æ—ä¸­ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢ç±»å‹ä¿¡æ¯æ—¶å°±è¦å°å¿ƒã€‚å› ä¸ºç±»æ—ä¸­çš„å®ä½“å­ç±»å¹¶ä¸ä¸å…¶åŸºç±»å±äºåŒä¸€ä¸ªç±»ã€‚</p>
</blockquote>
<h1 id="ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®"><a href="#ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®" class="headerlink" title="ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®"></a>ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®</h1><hr>
<p>æˆ‘ä»¬å¯ä»¥é€šâ€œå…³è”å¯¹è±¡â€æœºåˆ¶æ¥æŠŠä¸¤ä¸ªå¯¹è±¡è¿æ¥èµ·æ¥ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»æŸä¸ªå¯¹è±¡ä¸­è·å–ç›¸åº”çš„å…³è”å¯¹è±¡çš„å€¼ã€‚</p>
<p>å…ˆçœ‹ä¸€ä¸‹å…³è”å¯¹è±¡çš„è¯­æ³•ï¼š</p>
<h4 id="1-ä¸ºæŸä¸ªå¯¹è±¡è®¾ç½®å…³è”å¯¹è±¡çš„å€¼ï¼š"><a href="#1-ä¸ºæŸä¸ªå¯¹è±¡è®¾ç½®å…³è”å¯¹è±¡çš„å€¼ï¼š" class="headerlink" title="1. ä¸ºæŸä¸ªå¯¹è±¡è®¾ç½®å…³è”å¯¹è±¡çš„å€¼ï¼š"></a>1. ä¸ºæŸä¸ªå¯¹è±¡è®¾ç½®å…³è”å¯¹è±¡çš„å€¼ï¼š</h4><p><code>void objc_setAssociatedObject(id object, void *key, id value, objc_AssociationPolicy policy)</code></p>
<blockquote>
<p>è¿™é‡Œï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸»å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯é”®ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å…³è”çš„å¯¹è±¡ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯å­˜å‚¨ç­–ç•¥:æ˜¯æšä¸¾ï¼Œå®šä¹‰äº†å†…å­˜ç®¡ç†è¯­ä¹‰ã€‚</p>
</blockquote>
<h4 id="2-æ ¹æ®ç»™å®šçš„é”®ä»æŸå¯¹è±¡ä¸­è·å–ç›¸åº”çš„å…³è”å¯¹è±¡å€¼ï¼š"><a href="#2-æ ¹æ®ç»™å®šçš„é”®ä»æŸå¯¹è±¡ä¸­è·å–ç›¸åº”çš„å…³è”å¯¹è±¡å€¼ï¼š" class="headerlink" title="2. æ ¹æ®ç»™å®šçš„é”®ä»æŸå¯¹è±¡ä¸­è·å–ç›¸åº”çš„å…³è”å¯¹è±¡å€¼ï¼š"></a>2. æ ¹æ®ç»™å®šçš„é”®ä»æŸå¯¹è±¡ä¸­è·å–ç›¸åº”çš„å…³è”å¯¹è±¡å€¼ï¼š</h4><p><code>id objc_getAssociatedObject(id object, void *key)</code></p>
<h4 id="3-ç§»é™¤æŒ‡å®šå¯¹è±¡çš„å…³è”å¯¹è±¡ï¼š"><a href="#3-ç§»é™¤æŒ‡å®šå¯¹è±¡çš„å…³è”å¯¹è±¡ï¼š" class="headerlink" title="3. ç§»é™¤æŒ‡å®šå¯¹è±¡çš„å…³è”å¯¹è±¡ï¼š"></a>3. ç§»é™¤æŒ‡å®šå¯¹è±¡çš„å…³è”å¯¹è±¡ï¼š</h4><p><code>void objc_removeAssociatedObjects(id object)</code></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"><span class="keyword">static</span> <span class="keyword">void</span> *EOCMyAlertViewKey = <span class="string">"EOCMyAlertViewKey"</span>;</div><div class="line">- (<span class="keyword">void</span>)askUserAQuestion &#123;</div><div class="line">         <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc] initWithTitle:<span class="string">@"Question"</span></div><div class="line">                                                         message:<span class="string">@"What do you want to do?"</span></div><div class="line">                                                        delegate:<span class="keyword">self</span></div><div class="line">                                               cancelButtonTitle:<span class="string">@"Cancel"</span></div><div class="line">                                               otherButtonTitles:<span class="string">@"Continue"</span>, <span class="literal">nil</span>];</div><div class="line">         <span class="keyword">void</span> (^block)(<span class="built_in">NSInteger</span>) = ^(<span class="built_in">NSInteger</span> buttonIndex)&#123;</div><div class="line">                     <span class="keyword">if</span> (buttonIndex == <span class="number">0</span>) &#123;</div><div class="line">                            [<span class="keyword">self</span> doCancel];</div><div class="line">                     &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            [<span class="keyword">self</span> doContinue];</div><div class="line">                    &#125;</div><div class="line">         &#125;;</div><div class="line">         <span class="comment">//å°†alertå’Œblockå…³è”åœ¨äº†ä¸€èµ·</span></div><div class="line">         objc_setAssociatedObject(alert,EOCMyAlertViewKey,block, OBJC_ASSOCIATION_COPY);</div><div class="line">         [alert show];</div><div class="line">&#125;</div><div class="line"><span class="comment">// UIAlertViewDelegate protocol method</span></div><div class="line">- (<span class="keyword">void</span>)alertView:(<span class="built_in">UIAlertView</span>*)alertView clickedButtonAtIndex:(<span class="built_in">NSInteger</span>)buttonIndex</div><div class="line">&#123;</div><div class="line">     <span class="comment">//alertå–å‡ºå…³è”çš„block</span></div><div class="line">      <span class="keyword">void</span> (^block)(<span class="built_in">NSInteger</span>) = objc_getAssociatedObject(alertView, EOCMyAlertViewKey)</div><div class="line">     <span class="comment">//ç»™blockä¼ å…¥indexå€¼</span></div><div class="line">      block(buttonIndex);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="ç¬¬13æ¡ï¼šç”¨â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€è°ƒè¯•â€œé»‘ç›’æ–¹æ³•â€"><a href="#ç¬¬13æ¡ï¼šç”¨â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€è°ƒè¯•â€œé»‘ç›’æ–¹æ³•â€" class="headerlink" title="ç¬¬13æ¡ï¼šç”¨â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€è°ƒè¯•â€œé»‘ç›’æ–¹æ³•â€"></a>ç¬¬13æ¡ï¼šç”¨â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€è°ƒè¯•â€œé»‘ç›’æ–¹æ³•â€</h1><hr>
<p>ä¸é€‰æ‹©å­åç§°ç›¸å¯¹åº”çš„æ–¹æ³•æ˜¯å¯ä»¥åœ¨è¿è¡ŒæœŸè¢«æ”¹å˜çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨é€šè¿‡ç»§æ‰¿ç±»å¹¶è¦†å†™æ–¹æ³•å°±èƒ½æ”¹å˜è¿™ä¸ªç±»æœ¬èº«çš„åŠŸèƒ½ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•åœ¨è¿è¡ŒæœŸæ”¹å˜é€‰æ‹©å­å¯¹åº”çš„æ–¹æ³•å‘¢ï¼Ÿ<br>ç­”ï¼šé€šè¿‡æ“çºµç±»çš„æ–¹æ³•åˆ—è¡¨çš„IMPæŒ‡é’ˆ</p>
<p>ä»€ä¹ˆæ˜¯ç±»æ–¹æ³•è¡¨ï¼Ÿä»€ä¹ˆæ˜¯IMPæŒ‡é’ˆå‘¢ï¼Ÿ</p>
<blockquote>
<p>ç±»çš„æ–¹æ³•åˆ—è¡¨ä¼šæŠŠ<strong>é€‰æ‹©å­</strong>çš„åç§°æ˜ å°„åˆ°ç›¸å…³çš„æ–¹æ³•å®ç°ä¸Šï¼Œä½¿å¾—â€œåŠ¨æ€æ¶ˆæ¯æ´¾å‘ç³»ç»Ÿâ€èƒ½å¤Ÿæ®æ­¤æ‰¾åˆ°åº”è¯¥è°ƒç”¨çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å‡ä»¥å‡½æ•°æŒ‡é’ˆçš„å½¢å¼æ¥è¡¨ç¤ºï¼Œè¿™äº›æŒ‡é’ˆå«åšIMPã€‚ä¾‹å¦‚NSStringç±»çš„é€‰æ‹©å­åˆ—è¡¨ï¼š</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-c58274453996f2c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç±»æ–¹æ³•è¡¨çš„æ˜ å°„"></p>
<p>æœ‰äº†è¿™å¼ è¡¨ï¼ŒOCçš„è¿è¡ŒæœŸç³»ç»Ÿæä¾›çš„å‡ ä¸ªæ–¹æ³•å°±èƒ½æ“çºµå®ƒã€‚å¼€å‘è€…å¯ä»¥å‘å…¶ä¸­å¢åŠ é€‰æ‹©å­ï¼Œä¹Ÿå¯ä»¥æ”¹å˜æŸé€‰æ‹©å­å¯¹åº”çš„æ–¹æ³•å®ç°ï¼Œä¹Ÿå¯ä»¥äº¤æ¢ä¸¤ä¸ªé€‰æ‹©å­æ‰€æ˜ å°„åˆ°çš„æŒ‡é’ˆä»¥è¾¾åˆ°äº¤æ¢æ–¹æ³•å®ç°çš„ç›®çš„ã€‚</p>
<p>ä¸¾ä¸ª ï¼šäº¤æ¢<code>lowercaseString</code>å’Œ<code>uppercaseString</code>æ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Method originalMethod = class_getInstanceMethod([<span class="built_in">NSString</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(lowercaseString));</div><div class="line">Method swappedMethod = class_getInstanceMethod([<span class="built_in">NSString</span> <span class="keyword">class</span>],<span class="keyword">@selector</span>(uppercaseString));</div><div class="line">method_exchangeImplementations(originalMethod, swappedMethod);</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ ·ä¸€æ¥ï¼Œç±»æ–¹æ³•è¡¨çš„æ˜ å°„å…³ç³»å°±å˜æˆäº†ä¸‹å›¾ï¼š</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-10ddc4e1634625b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="äº¤æ¢ä¸¤ä¸ªæ–¹æ³•"></p>
<blockquote>
<p>è¿™æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨lowercaseStringæ–¹æ³•å°±ä¼šå®é™…è°ƒç”¨uppercaseStringçš„æ–¹æ³•ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
</blockquote>
<p><strong>ç„¶è€Œï¼</strong><br>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåªäº¤æ¢å·²ç»å­˜åœ¨çš„ä¸¤ä¸ªæ–¹æ³•æ˜¯æ²¡æœ‰å¤ªå¤§æ„ä¹‰çš„ã€‚æˆ‘ä»¬åº”è¯¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥ç»™æ—¢æœ‰çš„æ–¹æ³•æ·»åŠ æ–°åŠŸèƒ½ï¼ˆå¬ä¸Šå»åŠåŠçš„ï¼‰ï¼š</p>
<p>å®ƒçš„å®ç°åŸç†æ˜¯ï¼šå…ˆé€šè¿‡åˆ†ç±»å¢åŠ ä¸€ä¸ªæ–°æ–¹æ³•ï¼Œç„¶åå°†è¿™ä¸ªæ–°æ–¹æ³•å’Œè¦å¢åŠ åŠŸèƒ½çš„æ—§æ–¹æ³•æ›¿æ¢ï¼ˆæ—§æ–¹æ³•å å¯¹åº”æ–°æ–¹æ³•çš„å®ç°ï¼‰ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨äº†æ—§æ–¹æ³•ï¼Œå°±ä¼šå®ç°æ–°æ–¹æ³•äº†ã€‚</p>
<p>ä¸çŸ¥é“è¿™ä¹ˆè¯´æ˜¯å¦æŠ½è±¡ã€‚è¿˜æ˜¯ä¸¾ä¸ª ï¼š</p>
<p><strong>éœ€æ±‚ï¼š</strong>æˆ‘ä»¬è¦åœ¨åŸæœ‰çš„lowercaseStringæ–¹æ³•ä¸­æ·»åŠ ä¸€æ¡è¾“å‡ºè¯­å¥ã€‚</p>
<h4 id="æ­¥éª¤ä¸€ï¼šæˆ‘ä»¬å…ˆå°†æ–°æ–¹æ³•å†™åœ¨NSStringçš„åˆ†ç±»é‡Œï¼š"><a href="#æ­¥éª¤ä¸€ï¼šæˆ‘ä»¬å…ˆå°†æ–°æ–¹æ³•å†™åœ¨NSStringçš„åˆ†ç±»é‡Œï¼š" class="headerlink" title="æ­¥éª¤ä¸€ï¼šæˆ‘ä»¬å…ˆå°†æ–°æ–¹æ³•å†™åœ¨NSStringçš„åˆ†ç±»é‡Œï¼š"></a>æ­¥éª¤ä¸€ï¼šæˆ‘ä»¬å…ˆå°†æ–°æ–¹æ³•å†™åœ¨NSStringçš„åˆ†ç±»é‡Œï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSString</span> (<span class="title">EOCMyAdditions</span>)</span></div><div class="line">- (<span class="built_in">NSString</span>*)eoc_myLowercaseString;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSString</span> (<span class="title">EOCMyAdditions</span>)</span></div><div class="line">- (<span class="built_in">NSString</span>*)eoc_myLowercaseString &#123;</div><div class="line">     <span class="built_in">NSString</span> *lowercase = [<span class="keyword">self</span> eoc_myLowercaseString];<span class="comment">//eoc_myLowercaseStringæ–¹æ³•ä¼šåœ¨å°†æ¥æ–¹æ³•è°ƒæ¢åæ‰§è¡ŒlowercaseStringçš„æ–¹æ³•</span></div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"%@ =&gt; %@"</span>, <span class="keyword">self</span>, lowercase);<span class="comment">//è¾“å‡ºè¯­å¥ï¼Œä¾¿äºè°ƒè¯•</span></div><div class="line">     <span class="keyword">return</span> lowercase;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h4 id="æ­¥éª¤äºŒï¼šäº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ï¼ˆæ“çºµè°ƒæ¢IMPæŒ‡é’ˆï¼‰"><a href="#æ­¥éª¤äºŒï¼šäº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ï¼ˆæ“çºµè°ƒæ¢IMPæŒ‡é’ˆï¼‰" class="headerlink" title="æ­¥éª¤äºŒï¼šäº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ï¼ˆæ“çºµè°ƒæ¢IMPæŒ‡é’ˆï¼‰"></a>æ­¥éª¤äºŒï¼šäº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ï¼ˆæ“çºµè°ƒæ¢IMPæŒ‡é’ˆï¼‰</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Method originalMethod =</div><div class="line"> class_getInstanceMethod([<span class="built_in">NSString</span> <span class="keyword">class</span>],</div><div class="line"> <span class="keyword">@selector</span>(lowercaseString));</div><div class="line">Method swappedMethod =</div><div class="line"> class_getInstanceMethod([<span class="built_in">NSString</span> <span class="keyword">class</span>],</div><div class="line"> <span class="keyword">@selector</span>(eoc_myLowercaseString));</div><div class="line">method_exchangeImplementations(originalMethod, swappedMethod);</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å¦‚æœäº¤æ¢äº†<code>lowercaseString</code>å’Œ<code>eoc_myLowercaseString</code>çš„æ–¹æ³•å®ç°ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨åŸæ¥çš„<code>lowercaseString</code>æ–¹æ³•åå°±å¯ä»¥è¾“å‡ºæ–°å¢çš„è¯­å¥äº†ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *string = <span class="string">@"ThIs iS tHe StRiNg"</span>;</div><div class="line"><span class="built_in">NSString</span> *lowercaseString = [string lowercaseString];</div><div class="line"><span class="comment">// Output: ThIs iS tHe StRiNg =&gt; this is the stringâ€</span></div></pre></td></tr></table></figure>
<h1 id="ç¬¬16æ¡ï¼šæä¾›â€å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•â€"><a href="#ç¬¬16æ¡ï¼šæä¾›â€å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•â€" class="headerlink" title="ç¬¬16æ¡ï¼šæä¾›â€å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•â€"></a>ç¬¬16æ¡ï¼šæä¾›â€å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•â€</h1><hr>
<p>æœ‰æ—¶ï¼Œç”±äºè¦å®ç°å„ç§è®¾è®¡éœ€æ±‚ï¼Œä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªåˆ›å»ºå®ä¾‹çš„åˆå§‹åŒ–æ–¹æ³•ã€‚æˆ‘ä»¬åº”è¯¥<strong>é€‰å®šå…¶ä¸­ä¸€ä¸ª</strong>ä½œä¸º<strong>å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•</strong>ï¼Œä»¤å…¶ä»–åˆå§‹åŒ–æ–¹æ³•éƒ½æ¥è°ƒç”¨å®ƒã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>åªæœ‰åœ¨è¿™ä¸ªå…¨èƒ½åˆå§‹åŒ–æ–¹æ³•é‡Œé¢æ‰èƒ½å­˜å‚¨å†…éƒ¨æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“åº•å±‚æ•°æ®å­˜å‚¨æœºåˆ¶æ”¹å˜æ—¶ï¼Œåªéœ€ä¿®æ”¹æ­¤æ–¹æ³•çš„ä»£ç å°±å¥½ï¼Œæ— éœ€æ”¹åŠ¨å…¶ä»–åˆå§‹åŒ–æ–¹æ³•ã€‚</li>
<li>å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•æ˜¯æ‰€æœ‰åˆå§‹åŒ–æ–¹æ³•é‡Œå‚æ•°æœ€å¤šçš„ä¸€ä¸ªï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†å°½å¯èƒ½å¤šçš„åˆå§‹åŒ–æ‰€éœ€è¦çš„å‚æ•°ï¼Œä»¥ä¾¿å…¶ä»–çš„æ–¹æ³•æ¥è°ƒç”¨è‡ªå·±ã€‚</li>
<li>åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªå…¨èƒ½åˆå§‹åŒ–æ–¹æ³•åï¼Œæœ€å¥½è¿˜æ˜¯è¦è¦†å†™initæ–¹æ³•æ¥è®¾ç½®é»˜è®¤å€¼ã€‚</li>
</ul>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•</span></div><div class="line">- (<span class="keyword">id</span>)initWithWidth:(<span class="keyword">float</span>)width andHeight:(<span class="keyword">float</span>)height</div><div class="line">&#123;</div><div class="line">     <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">        _width = width;</div><div class="line">        _height = height;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//initæ–¹æ³•ä¹Ÿè°ƒç”¨äº†å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•</span></div><div class="line">- (<span class="keyword">id</span>)init &#123;</div><div class="line">     <span class="keyword">return</span> [<span class="keyword">self</span> initWithWidth:<span class="number">5.0</span>f andHeight:<span class="number">10.0</span>f];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦åˆ›é€ ä¸€ä¸ªsqureç±»ç»§æ‰¿è¿™ä¸Šé¢è¿™ä¸ªractangleç±»,å®ƒæœ‰è‡ªå·±çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)initWithDimension: (<span class="keyword">float</span>)dimension&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> initWithWidth:dimension andHeight:dimension];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="è¿™é‡Œæœ‰é—®é¢˜ï¼"><a href="#è¿™é‡Œæœ‰é—®é¢˜ï¼" class="headerlink" title="è¿™é‡Œæœ‰é—®é¢˜ï¼"></a>è¿™é‡Œæœ‰é—®é¢˜ï¼</h4><p>ç„¶è€Œï¼Œå› ä¸ºsquareç±»æ˜¯rectangleç±»çš„å­ç±»ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯ä»¥ä½¿ç”¨<code>initWithWidth: andHeight:</code>æ–¹æ³•ï¼Œæ›´å¯ä»¥ä½¿ç”¨<code>init</code>æ–¹æ³•ã€‚é‚£ä¹ˆè¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ˜¾ç„¶æ˜¯æ— æ³•ç¡®ä¿åˆå§‹åŒ–çš„å›¾å½¢æ˜¯æ­£æ–¹å½¢ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œè¦†å†™squareçš„çˆ¶ç±»rectangleçš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)initWithWidth:(<span class="keyword">float</span>)width andHeight:(<span class="keyword">float</span>)height</div><div class="line">&#123;</div><div class="line">    <span class="keyword">float</span> dimension = MAX(width, height);</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithDimension:dimension];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œå½“squareç”¨<code>initWithWidth: andHeight:</code>æ–¹æ³•åˆå§‹åŒ–æ—¶ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªæ­£æ–¹å½¢ã€‚</p>
<p>å¹¶ä¸”ï¼Œå¦‚æœç”¨<code>init</code>æ–¹æ³•æ¥åˆå§‹åŒ–squareçš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°ä¸€ä¸ªé»˜è®¤çš„æ­£æ–¹å½¢ã€‚å› ä¸ºåœ¨rectangleç±»é‡Œè¦†å†™äº†initæ–¹æ³•ï¼Œè€Œè¿™ä¸ªinitæ–¹æ³•åˆè°ƒç”¨äº†<code>initWithWidth: andHeight:</code>æ–¹æ³•ï¼Œå¹¶ä¸”squareç±»åˆè¦†å†™äº†<code>initWithWidth: andHeight:</code>æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç„¶å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ­£æ–¹å½¢ã€‚</p>
<p>è€Œä¸”ï¼Œä¸ºäº†è®©squareçš„initæ–¹æ³•å¾—åˆ°ä¸€ä¸ªé»˜è®¤çš„æ­£æ–¹å½¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¦†å†™å®ƒè‡ªå·±çš„åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)init&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithDimension:<span class="number">5.0</span>f];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åšä¸ªæ€»ç»“ï¼š</p>
<p>å› ä¸ºå­ç±»çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼ˆinitWithDimension:ï¼‰å’Œå…¶çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•å¹¶ä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å­ç±»é‡Œè¦†å†™<code>initWithWidth: andHeight:</code>æ–¹æ³•ã€‚</p>
<h4 id="è¿˜å·®ä¸€ç‚¹ï¼šinitWithCoder-çš„åˆå§‹åŒ–"><a href="#è¿˜å·®ä¸€ç‚¹ï¼šinitWithCoder-çš„åˆå§‹åŒ–" class="headerlink" title="è¿˜å·®ä¸€ç‚¹ï¼šinitWithCoder:çš„åˆå§‹åŒ–"></a>è¿˜å·®ä¸€ç‚¹ï¼šinitWithCoder:çš„åˆå§‹åŒ–</h4><p>æœ‰æ—¶ï¼Œéœ€è¦å®šä¹‰ä¸¤ç§å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼Œå› ä¸ºå¯¹è±¡æœ‰å¯èƒ½æœ‰ä¸¤ç§å®Œå…¨ä¸åŒçš„åˆ›å»ºæ–¹å¼ï¼Œä¾‹å¦‚<code>initWithCoder:</code>æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬ä»ç„¶éœ€è¦è°ƒç”¨è¶…ç±»çš„åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<p>åœ¨rectangleç±»ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Initializer from NSCoding</span></div><div class="line">- (<span class="keyword">id</span>)initWithCoder:(<span class="built_in">NSCoder</span>*)decoder &#123;</div><div class="line">     <span class="comment">// Call through to super's designated initializer</span></div><div class="line">         <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">            _width = [decoder decodeFloatForKey:<span class="string">@"width"</span>];</div><div class="line">            _height = [decoder decodeFloatForKey:<span class="string">@"height"</span>];</div><div class="line">        &#125;</div><div class="line">     <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨squareç±»ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Initializer from NSCoding</span></div><div class="line">- (<span class="keyword">id</span>)initWithCoder:(<span class="built_in">NSCoder</span>*)decoder &#123;</div><div class="line"> <span class="comment">// Call through to super's designated initializer</span></div><div class="line">      <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> initWithCoder:decoder])) &#123;</div><div class="line">     <span class="comment">// EOCSquare's specific initializer</span></div><div class="line">    &#125;</div><div class="line">     <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¯ä¸ªå­ç±»çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•éƒ½åº”è¯¥è°ƒç”¨å…¶è¶…ç±»çš„å¯¹åº”æ–¹æ³•ï¼Œå¹¶é€å±‚å‘ä¸Šã€‚åœ¨è°ƒç”¨äº†è¶…ç±»çš„åˆå§‹åŒ–æ–¹æ³•åï¼Œå†æ‰§è¡Œä¸æœ¬ç±»ç›¸å…³çš„æ–¹æ³•ã€‚</p>
<h1 id="ç¬¬17æ¡ï¼šå®ç°descriptionæ–¹æ³•"><a href="#ç¬¬17æ¡ï¼šå®ç°descriptionæ–¹æ³•" class="headerlink" title="ç¬¬17æ¡ï¼šå®ç°descriptionæ–¹æ³•"></a>ç¬¬17æ¡ï¼šå®ç°descriptionæ–¹æ³•</h1><hr>
<p>åœ¨æ‰“å°æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»çš„å®ä¾‹å¯¹è±¡æ—¶ï¼Œåœ¨æ§åˆ¶å°è¾“å‡ºçš„ç»“æœå¾€å¾€æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">object = &lt;EOCPerson: 0x7fd9a1600600&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡ŒåªåŒ…å«äº†ç±»åå’Œå†…å­˜åœ°å€ï¼Œå®ƒçš„ä¿¡æ¯æ˜¾ç„¶æ˜¯ä¸å…·ä½“çš„,è¿œè¾¾ä¸åˆ°è°ƒè¯•çš„è¦æ±‚ã€‚</p>
</blockquote>
<p><strong>ä½†æ˜¯ï¼</strong>å¦‚æœåœ¨æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»è¦†å†™descriptionæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ‰“å°è¿™ä¸ªç±»çš„å®ä¾‹æ—¶è¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSString</span>*)description &#123;</div><div class="line">     <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"&lt;%@: %p, %@ %@&gt;"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">self</span>, firstName, lastName];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæ˜¾ç¤ºäº†å†…å­˜åœ°å€ï¼Œè¿˜æœ‰è¯¥ç±»çš„æ‰€æœ‰å±æ€§ã€‚</p>
<p>è€Œä¸”ï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™äº›å±æ€§å€¼æ”¾åœ¨å­—å…¸é‡Œæ‰“å°ï¼Œåˆ™æ›´å…·æœ‰å¯è¯»æ€§ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSString</span>*)description &#123;</div><div class="line">     <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"&lt;%@: %p, %@&gt;"</span>,[<span class="keyword">self</span> <span class="keyword">class</span>],<span class="keyword">self</span>,</div><div class="line">    @&#123;    <span class="string">@"title"</span>:_title,</div><div class="line">       <span class="string">@"latitude"</span>:@(_latitude),</div><div class="line">      <span class="string">@"longitude"</span>:@(_longitude)&#125;</div><div class="line">    ];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">location = &lt;EOCLocation: 0x7f98f2e01d20, &#123;</div><div class="line">    latitude = &quot;51.506&quot;;</div><div class="line">   longitude = 0;</div><div class="line">       title = London;</div><div class="line">&#125;&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡é‡å†™<code>description</code>æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬æ›´åŠ äº†è§£å¯¹è±¡çš„æƒ…å†µï¼Œä¾¿äºåæœŸçš„è°ƒè¯•ï¼ŒèŠ‚çœå¼€å‘æ—¶é—´ã€‚</p>
</blockquote>
<h1 id="ç¬¬28æ¡-é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡"><a href="#ç¬¬28æ¡-é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡" class="headerlink" title="ç¬¬28æ¡:é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡"></a>ç¬¬28æ¡:é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡</h1><hr>
<p>åŒ¿åå¯¹è±¡ï¼ˆAnnonymous objectï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œæ²¡æœ‰åå­—çš„å¯¹è±¡â€ã€‚æœ‰æ—¶æˆ‘ä»¬ç”¨åè®®æ¥æä¾›åŒ¿åå¯¹è±¡ï¼Œç›®çš„åœ¨äºè¯´æ˜å®ƒä»…ä»…è¡¨ç¤ºâ€œéµä»æŸä¸ªåè®®çš„å¯¹è±¡â€ï¼Œè€Œä¸æ˜¯â€œå±äºæŸä¸ªç±»çš„å¯¹è±¡â€ã€‚</p>
<p>å®ƒçš„è¡¨ç¤ºæ–¹æ³•ä¸ºï¼š<code>id&lt;protocol&gt;</code>ã€‚<br>é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>ä½œä¸ºå±æ€§</li>
<li>ä½œä¸ºæ–¹æ³•å‚æ•°</li>
</ul>
<h4 id="1-åŒ¿åå¯¹è±¡ä½œä¸ºå±æ€§"><a href="#1-åŒ¿åå¯¹è±¡ä½œä¸ºå±æ€§" class="headerlink" title="1. åŒ¿åå¯¹è±¡ä½œä¸ºå±æ€§"></a>1. åŒ¿åå¯¹è±¡ä½œä¸ºå±æ€§</h4><p>åœ¨è®¾å®šæŸä¸ªç±»ä¸ºè‡ªå·±çš„ä»£ç†å±æ€§æ—¶ï¼Œå¯ä»¥ä¸å£°æ˜ä»£ç†çš„ç±»ï¼Œè€Œæ˜¯ç”¨id<protocol>ï¼Œå› ä¸º<strong>æˆä¸º</strong>ä»£ç†çš„ç»ˆç‚¹å¹¶ä¸æ˜¯<strong>æŸä¸ªç±»çš„å®ä¾‹</strong>ï¼Œè€Œæ˜¯<strong>éµå¾ªäº†æŸä¸ªåè®®</strong>ã€‚</protocol></p>
<p>ä¸¾ä¸ª ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span> &lt;EOCDelegate&gt; delegate;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œä½¿ç”¨åŒ¿åå¯¹è±¡çš„åŸå› æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li>å°†æ¥å¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸åŒç±»çš„å®ä¾‹å¯¹è±¡ä½œä¸ºè¯¥ç±»çš„ä»£ç†ã€‚</li>
<li>æˆ‘ä»¬ä¸æƒ³æŒ‡æ˜å…·ä½“è¦ä½¿ç”¨å“ªä¸ªç±»æ¥ä½œä¸ºè¿™ä¸ªç±»çš„ä»£ç†ã€‚</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œèƒ½ä½œä¸ºè¯¥ç±»çš„ä»£ç†çš„æ¡ä»¶åªæœ‰ä¸€ä¸ªï¼šå®ƒéµä»äº† <eocdelegate>åè®®ã€‚</eocdelegate></p>
<h4 id="2-åŒ¿åå¯¹è±¡ä½œä¸ºæ–¹æ³•å‚æ•°"><a href="#2-åŒ¿åå¯¹è±¡ä½œä¸ºæ–¹æ³•å‚æ•°" class="headerlink" title="2. åŒ¿åå¯¹è±¡ä½œä¸ºæ–¹æ³•å‚æ•°"></a>2. åŒ¿åå¯¹è±¡ä½œä¸ºæ–¹æ³•å‚æ•°</h4><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨æ„æ–¹æ³•é‡ŒæŸä¸ªå‚æ•°çš„å…·ä½“ç±»å‹ï¼Œè€Œæ˜¯éµå¾ªäº†æŸç§åè®®ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨åŒ¿åå¯¹è±¡æ¥ä½œä¸ºæ–¹æ³•å‚æ•°ã€‚</p>
<p>ä¸¾ä¸ª ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)object forKey:(<span class="keyword">id</span>&lt;<span class="built_in">NSCopying</span>&gt;)key;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•æ˜¯NSDictionaryçš„è®¾å€¼æ–¹æ³•ï¼Œå®ƒçš„å‚æ•°åªè¦éµä»äº†<nscopying>åè®®ï¼Œå°±å¯ä»¥ä½œä¸ºå‚æ•°ä¼ è¿›å»,ä½œä¸ºNSDictionaryçš„é”®ã€‚</nscopying></p>
<h1 id="ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜"><a href="#ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜" class="headerlink" title="ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜"></a>ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜</h1><hr>
<p>åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶çš„å†…å­˜ç®¡ç†éœ€è¦ä»”ç»†è€ƒè™‘å†…å­˜ç®¡ç†çš„é—®é¢˜ï¼š</p>
<blockquote>
<p>åœ¨tryå—ä¸­ï¼Œå¦‚æœå…ˆä¿ç•™äº†æŸä¸ªå¯¹è±¡ï¼Œç„¶ååœ¨é‡Šæ”¾å®ƒä¹‹å‰åˆæŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆé™¤éåœ¨catchå—ä¸­èƒ½å¤„ç†æ­¤é—®é¢˜ï¼Œå¦åˆ™å¯¹è±¡æ‰€å å†…å­˜å°±å°†æ³„æ¼ã€‚</p>
</blockquote>
<h4 id="åœ¨MRCç¯å¢ƒä¸‹ï¼š"><a href="#åœ¨MRCç¯å¢ƒä¸‹ï¼š" class="headerlink" title="åœ¨MRCç¯å¢ƒä¸‹ï¼š"></a>åœ¨MRCç¯å¢ƒä¸‹ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@try</span> &#123;</div><div class="line">     EOCSomeClass *object = [[EOCSomeClass alloc] init];</div><div class="line">      [object doSomethingThatMayThrow];</div><div class="line">      [object release];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@catch</span> (...) &#123;</div><div class="line">         <span class="built_in">NSLog</span>(<span class="string">@"Whoops, there was an error. Oh well..."</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨releaseæ–¹æ³•é‡Šæ”¾äº†tryä¸­çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™æ ·åšä»ç„¶æœ‰é—®é¢˜ï¼šå¦‚æœåœ¨<code>doSomthingThatMayThrow</code>æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸äº†å‘¢ï¼Ÿ</p>
<p>è¿™æ ·å°±æ— æ³•æ‰§è¡Œ<code>release</code>æ–¹æ³•äº†ã€‚</p>
<p>è§£å†³åŠæ³•æ˜¯ä½¿ç”¨@finnalyå—ï¼Œæ— è®ºæ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œå…¶ä¸­çš„ä»£ç éƒ½èƒ½è¿è¡Œï¼š</p>
<figure class="highlight plain"><figcaption><span>*object;</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@try &#123;</div><div class="line">    object = [[EOCSomeClass alloc] init];</div><div class="line">    [object doSomethingThatMayThrow];</div><div class="line">&#125;</div><div class="line">@catch (...) &#123;</div><div class="line">     NSLog(@&quot;Whoops, there was an error. Oh well...&quot;);</div><div class="line">&#125;</div><div class="line">@finally &#123;</div><div class="line">    [object release];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####åœ¨ARCç¯å¢ƒä¸‹å‘¢ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@try</span> &#123;</div><div class="line">     EOCSomeClass *object = [[EOCSomeClass alloc] init];</div><div class="line">     [object doSomethingThatMayThrow];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@catch</span> (...) &#123;</div><div class="line"> <span class="built_in">NSLog</span>(<span class="string">@"Whoops, there was an error. Oh well..."</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ—¶ï¼Œæˆ‘ä»¬æ— æ³•æ‰‹åŠ¨ä½¿ç”¨<code>release</code>æ–¹æ³•äº†ï¼Œè§£å†³åŠæ³•æ˜¯ä½¿ç”¨ï¼š-fobjc-arc-exceptions æ ‡å¿—æ¥åŠ å…¥æ¸…ç†ä»£ç ï¼Œä¸è¿‡ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå˜å¤§ï¼Œè€Œä¸”ä¼šé™ä½è¿è¡Œæ•ˆç‡ã€‚</p>
<h1 id="ç¬¬33æ¡ï¼šä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯"><a href="#ç¬¬33æ¡ï¼šä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯" class="headerlink" title="ç¬¬33æ¡ï¼šä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯"></a>ç¬¬33æ¡ï¼šä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯</h1><hr>
<p>å¯¹è±¡ä¹‹é—´éƒ½ç”¨å¼ºæŒ‡é’ˆå¼•ç”¨å¯¹æ–¹çš„è¯ä¼šé€ æˆä¿ç•™ç¯ã€‚</p>
<h4 id="ä¸¤ä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼š"><a href="#ä¸¤ä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼š" class="headerlink" title="ä¸¤ä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼š"></a>ä¸¤ä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼š</h4><p>ä¸¤ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯¹æ–¹çš„å®ä¾‹æ¥ä½œä¸ºè‡ªå·±çš„å±æ€§ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCClassA</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) EOCClassB *other;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCClassB</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) EOCClassA *other;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-4e1aa0647dee51fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸¤ä¸ªå¯¹è±¡çš„ä¿ç•™ç¯"></p>
<p>ä¸¤ä¸ªå¯¹è±¡éƒ½æœ‰æŒ‡å‘å¯¹æ–¹çš„å¼ºæŒ‡é’ˆï¼Œè¿™æ ·ä¼šå¯¼è‡´è¿™ä¸¤ä¸ªå±æ€§é‡Œçš„å¯¹è±¡æ— æ³•è¢«é‡Šæ”¾æ‰ã€‚</p>
<h4 id="å¤šä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼š"><a href="#å¤šä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼š" class="headerlink" title="å¤šä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼š"></a>å¤šä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼š</h4><p>å¦‚æœä¿ç•™ç¯è¿æ¥äº†å¤šä¸ªå¯¹è±¡ï¼Œè€Œè¿™é‡Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡è¢«å¤–ç•Œå¼•ç”¨ï¼Œé‚£ä¹ˆå½“è¿™ä¸ªå¼•ç”¨è¢«ç§»é™¤åï¼Œæ•´ä¸ªä¿ç•™ç¯å°±æ³„æ¼äº†ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-d99033df1cf5e1ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤šä¸ªå¯¹è±¡çš„ä¿ç•™ç¯ï¼šå­¤å²›"></p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¼±å¼•ç”¨ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//EOCClassB.m</span></div><div class="line"><span class="comment">//ç¬¬ä¸€ç§å¼±å¼•ç”¨ï¼šunsafe_unretained</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">unsafe_unretained</span>) EOCClassA *other;</div><div class="line"><span class="comment">//ç¬¬äºŒç§å¼±å¼•ç”¨ï¼šweak</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) EOCClassA *other;</div></pre></td></tr></table></figure>
<p>è¿™ä¸¤ç§å¼±å¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>unsafe_unretained:å½“æŒ‡å‘EOCClassAå®ä¾‹çš„å¼•ç”¨ç§»é™¤åï¼Œunsafe_unretainedå±æ€§ä»ç„¶æŒ‡å‘é‚£ä¸ªå·²ç»å›æ”¶çš„å®ä¾‹ï¼Œ</p>
<p>è€ŒweakæŒ‡å‘nilï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-afc3b538527f93da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="unsafe_unretained å’Œ weakçš„åŒºåˆ«"></p>
<p>æ˜¾ç„¶ï¼Œç”¨weakå­—æ®µåº”è¯¥æ˜¯æ›´å®‰å…¨çš„ï¼Œå› ä¸ºä¸å†ä½¿ç”¨çš„å¯¹è±¡æŒ‰ç†è¯´åº”è¯¥è®¾ç½®ä¸ºnil,è€Œä¸åº”è¯¥äº§ç”Ÿä¾èµ–ã€‚</p>
<h1 id="ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å¿«â€é™ä½å†…å­˜å³°å€¼"><a href="#ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å¿«â€é™ä½å†…å­˜å³°å€¼" class="headerlink" title="ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å¿«â€é™ä½å†…å­˜å³°å€¼"></a>ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å¿«â€é™ä½å†…å­˜å³°å€¼</h1><hr>
<p>é‡Šæ”¾å¯¹è±¡çš„ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>è°ƒç”¨release:ä¿ç•™è®¡æ•°é€’å‡</li>
<li>è°ƒç”¨autoreleaseå°†å…¶åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ã€‚åœ¨å°†æ¥æ¸…ç©ºè‡ªåŠ¨é‡Šæ”¾æ± æ—¶ï¼Œç³»ç»Ÿä¼šå‘å…¶ä¸­çš„å¯¹è±¡å‘é€releaseæ¶ˆæ¯ã€‚</li>
</ul>
<p>å†…å­˜å³°å€¼ï¼ˆhigh-memory waterlineï¼‰æ˜¯æŒ‡åº”ç”¨ç¨‹åºåœ¨æŸä¸ªé™å®šæ—¶æ®µå†…çš„æœ€å¤§å†…å­˜ç”¨é‡ï¼ˆhighest memory footprintï¼‰ã€‚æ–°å¢çš„è‡ªåŠ¨é‡Šæ”¾æ± å—å¯ä»¥å‡å°‘è¿™ä¸ªå³°å€¼ï¼š</p>
<p>ä¸ç”¨è‡ªåŠ¨é‡Šæ”¾æ± å‡å°‘å³°å€¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</div><div class="line">      [<span class="keyword">self</span> doSomethingWithInt:i];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œ<code>doSomethingWithInt:</code>æ–¹æ³•å¯èƒ½ä¼šåˆ›å»ºä¸´æ—¶å¯¹è±¡ã€‚éšç€å¾ªç¯æ¬¡æ•°çš„å¢åŠ ï¼Œä¸´æ—¶å¯¹è±¡çš„æ•°é‡ä¹Ÿä¼šé£™å‡ï¼Œè€Œåªæœ‰åœ¨æ•´ä¸ªforå¾ªç¯ç»“æŸåï¼Œè¿™äº›ä¸´æ—¶å¯¹è±¡æ‰ä¼šå¾—æ„é‡Šæ”¾ã€‚</p>
<p>è¿™ç§æƒ…å†µæ˜¯ä¸ç†æƒ³çš„ï¼Œå°¤å…¶åœ¨æˆ‘ä»¬æ— æ³•æ§åˆ¶å¾ªç¯é•¿åº¦çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä¸æ–­å ç”¨å†…å­˜å¹¶çªç„¶é‡Šæ”¾æ‰å®ƒä»¬ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç”¨è‡ªåŠ¨é‡Šæ”¾æ± æ¥é™ä½è¿™ç§çªå…€çš„å˜åŒ–ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *databaseRecords = <span class="comment">/* ... */</span>;</div><div class="line"><span class="built_in">NSMutableArray</span> *people = [<span class="built_in">NSMutableArray</span> new];</div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *record <span class="keyword">in</span> databaseRecords) &#123;</div><div class="line">     <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">             EOCPerson *person = [[EOCPerson alloc] initWithRecord:record];</div><div class="line">            [people addObject:person];</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ¯æ¬¡å¾ªç¯ç»“æŸï¼Œæˆ‘ä»¬éƒ½ä¼šå°†ä¸´æ—¶å¯¹è±¡æ”¾åœ¨è¿™ä¸ªæ± é‡Œé¢ï¼Œè€Œä¸æ˜¯çº¿ç¨‹çš„ä¸»æ± é‡Œé¢ã€‚</p>
</blockquote>
<h1 id="ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜"><a href="#ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜" class="headerlink" title="ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜"></a>ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜</h1><hr>
<p>æŸä¸ªå¯¹è±¡è¢«å›æ”¶åï¼Œå†å‘å®ƒå‘é€æ¶ˆæ¯æ˜¯ä¸å®‰å…¨çš„ï¼Œè¿™å¹¶ä¸ä¸€å®šä¼šå¼•èµ·ç¨‹åºå´©æºƒã€‚</p>
<p>å¦‚æœç¨‹åºæ²¡æœ‰å´©æºƒï¼Œå¯èƒ½æ˜¯å› ä¸ºï¼š</p>
<ul>
<li>è¯¥å†…å­˜çš„éƒ¨åˆ†åŸæ•°æ®æ²¡æœ‰è¢«è¦†å†™ã€‚</li>
<li>è¯¥å†…å­˜æ°å¥½è¢«å¦ä¸€ä¸ªå¯¹è±¡å æ®ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å¯ä»¥åº”ç­”è¿™ä¸ªæ–¹æ³•ã€‚</li>
</ul>
<p>å¦‚æœè¢«å›æ”¶çš„å¯¹è±¡å ç”¨çš„åŸå†…å­˜è¢«æ–°çš„å¯¹è±¡å æ®ï¼Œé‚£ä¹ˆæ”¶åˆ°æ¶ˆæ¯çš„å¯¹è±¡å°±ä¸ä¼šæ˜¯æˆ‘ä»¬é¢„æƒ³çš„é‚£ä¸ªå¯¹è±¡ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æ— æ³•å“åº”é‚£ä¸ªæ–¹æ³•çš„è¯ï¼Œç¨‹åºä¾æ—§ä¼šå´©æºƒã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥é€šè¿‡ä¸€ç§æ–¹æ³•æ•æ‰åˆ°<strong>å¯¹è±¡è¢«é‡Šæ”¾åæ”¶åˆ°æ¶ˆæ¯çš„æƒ…å†µ</strong>ã€‚</p>
<p>è¿™ç§æ–¹æ³•å°±æ˜¯<strong>åˆ©ç”¨åƒµå°¸å¯¹è±¡ï¼</strong></p>
<p>Cocoaæä¾›äº†â€œåƒµå°¸å¯¹è±¡â€çš„åŠŸèƒ½ã€‚å¦‚æœå¼€å¯äº†è¿™ä¸ªåŠŸèƒ½ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠæ‰€æœ‰å·²ç»å›æ”¶çš„å®ä¾‹è½¬åŒ–æˆç‰¹æ®Šçš„â€œåƒµå°¸å¯¹è±¡â€ï¼ˆé€šè¿‡ä¿®æ”¹isaæŒ‡é’ˆï¼Œä»¤å…¶æŒ‡å‘ç‰¹æ®Šçš„åƒµå°¸ç±»ï¼‰ï¼Œè€Œä¸ä¼šçœŸæ­£å›æ”¶å®ƒä»¬ï¼Œè€Œä¸”å®ƒä»¬æ‰€å æ®çš„æ ¸å¿ƒå†…å­˜å°†æ— æ³•è¢«é‡ç”¨ï¼Œè¿™æ ·ä¹Ÿå°±é¿å…äº†è¦†å†™çš„æƒ…å†µã€‚</p>
<p>åœ¨åƒµå°¸å¯¹è±¡æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå®ƒä¼šè¯´æ˜å‘é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œä¹Ÿä¼šæè¿°å›æ”¶ä¹‹å‰çš„é‚£ä¸ªå¯¹è±¡ã€‚</p>
<h1 id="ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef"><a href="#ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef" class="headerlink" title="ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef"></a>ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef</h1><hr>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦é‡å¤åˆ›å»ºæŸç§å—ï¼ˆç›¸åŒå‚æ•°ï¼Œè¿”å›å€¼ï¼‰çš„å˜é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡typedefæ¥ç»™æŸä¸€ç§å—å®šä¹‰å±äºå®ƒè‡ªå·±çš„æ–°ç±»å‹</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> (^variableName)(<span class="built_in">BOOL</span> flag, <span class="keyword">int</span> value) =^(<span class="built_in">BOOL</span> flag, <span class="keyword">int</span> value)&#123;</div><div class="line">     <span class="comment">// Implementation</span></div><div class="line">     <span class="keyword">return</span> someInt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªå—æœ‰ä¸€ä¸ªboolå‚æ•°å’Œä¸€ä¸ªintå‚æ•°ï¼Œå¹¶è¿”å›intç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥ç»™å®ƒå®šä¹‰ç±»å‹ï¼š</p>
<p><code>typedef int(^EOCSomeBlock)(BOOL flag, int value);</code></p>
<p>å†æ¬¡å®šä¹‰çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡ç®€å•çš„èµ‹å€¼æ¥å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">EOCSomeBlock block = ^(<span class="built_in">BOOL</span> flag, <span class="keyword">int</span> value)&#123;</div><div class="line">     <span class="comment">// Implementation</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>å®šä¹‰ä½œä¸ºå‚æ•°çš„å—ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)startWithCompletionHandler: (<span class="keyword">void</span>(^)(<span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error))completion;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„å—æœ‰ä¸€ä¸ªNSDataå‚æ•°ï¼Œä¸€ä¸ªNSErrorå‚æ•°å¹¶æ²¡æœ‰è¿”å›å€¼</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^EOCCompletionHandler)(<span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error);</div><div class="line">- (<span class="keyword">void</span>)startWithCompletionHandler:(EOCCompletionHandler)completion;â€</div></pre></td></tr></table></figure>
<p>é€šè¿‡typedefå®šä¹‰å—ç­¾åçš„å¥½å¤„æ˜¯:å¦‚æœè¦æŸç§å—å¢åŠ å‚æ•°ï¼Œé‚£ä¹ˆåªä¿®æ”¹å®šä¹‰ç­¾åçš„é‚£è¡Œä»£ç å³å¯ã€‚</p>
<h1 id="ç¬¬39æ¡ï¼šç”¨handlerå—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦"><a href="#ç¬¬39æ¡ï¼šç”¨handlerå—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦" class="headerlink" title="ç¬¬39æ¡ï¼šç”¨handlerå—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦"></a>ç¬¬39æ¡ï¼šç”¨handlerå—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦</h1><hr>
<p>ä¸‹è½½ç½‘ç»œæ•°æ®æ—¶ï¼Œå¦‚æœä½¿ç”¨ä»£ç†æ–¹æ³•ï¼Œä¼šä½¿å¾—ä»£ç åˆ†å¸ƒä¸ç´§å‡‘ï¼Œè€Œä¸”å¦‚æœæœ‰å¤šä¸ªä¸‹è½½ä»»åŠ¡çš„è¯ï¼Œè¿˜è¦åœ¨å›è°ƒçš„ä»£ç†ä¸­åˆ¤æ–­å½“å‰è¯·æ±‚çš„ç±»å‹ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨blockçš„è¯ï¼Œå°±å¯ä»¥è®©ç½‘ç»œä¸‹è½½çš„ä»£ç å’Œå›è°ƒå¤„ç†çš„ä»£ç å†™åœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±å¯ä»¥åŒæ—¶è§£å†³ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<h4 id="ç”¨ä»£ç†ä¸‹è½½ï¼š"><a href="#ç”¨ä»£ç†ä¸‹è½½ï¼š" class="headerlink" title="ç”¨ä»£ç†ä¸‹è½½ï¼š"></a>ç”¨ä»£ç†ä¸‹è½½ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)fetchFooData &#123;</div><div class="line">     <span class="built_in">NSURL</span> *url = [[<span class="built_in">NSURL</span> alloc] initWithString:<span class="string">@"http://www.example.com/foo.dat"</span>];</div><div class="line">    _fooFetcher = [[EOCNetworkFetcher alloc] initWithURL:url];</div><div class="line">    _fooFetcher.delegate = <span class="keyword">self</span>;</div><div class="line">    [_fooFetcher start];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)fetchBarData &#123;</div><div class="line">     <span class="built_in">NSURL</span> *url = [[<span class="built_in">NSURL</span> alloc] initWithString: <span class="string">@"http://www.example.com/bar.dat"</span>];</div><div class="line">    _barFetcher = [[EOCNetworkFetcher alloc] initWithURL:url];</div><div class="line">    _barFetcher.delegate = <span class="keyword">self</span>;</div><div class="line">    [_barFetcher start];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)networkFetcher:(EOCNetworkFetcher*)networkFetcher didFinishWithData:(<span class="built_in">NSData</span>*)data</div><div class="line">&#123;   <span class="comment">//åˆ¤æ–­ä¸‹è½½å™¨ç±»å‹</span></div><div class="line">     <span class="keyword">if</span> (networkFetcher == _fooFetcher) &#123;</div><div class="line">        _fetchedFooData = data;</div><div class="line">        _fooFetcher = <span class="literal">nil</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (networkFetcher == _barFetcher) &#123;</div><div class="line">        _fetchedBarData = data;</div><div class="line">        _barFetcher = <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç”¨å—ä¸‹è½½ï¼š"><a href="#ç”¨å—ä¸‹è½½ï¼š" class="headerlink" title="ç”¨å—ä¸‹è½½ï¼š"></a>ç”¨å—ä¸‹è½½ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)fetchFooData &#123;</div><div class="line">     <span class="built_in">NSURL</span> *url = [[<span class="built_in">NSURL</span> alloc] initWithString:<span class="string">@"http://www.example.com/foo.dat"</span>];</div><div class="line">     EOCNetworkFetcher *fetcher =</div><div class="line">     [[EOCNetworkFetcher alloc] initWithURL:url];</div><div class="line">     [fetcher startWithCompletionHandler:^(<span class="built_in">NSData</span> *data)&#123;</div><div class="line">            _fetchedFooData = data;</div><div class="line">   &#125;];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)fetchBarData &#123;</div><div class="line">     <span class="built_in">NSURL</span> *url = [[<span class="built_in">NSURL</span> alloc] initWithString: <span class="string">@"http://www.example.com/bar.dat"</span>];</div><div class="line">     EOCNetworkFetcher *fetcher =[[EOCNetworkFetcher alloc] initWithURL:url];</div><div class="line">    [fetcher startWithCompletionHandler:^(<span class="built_in">NSData</span> *data)&#123;</div><div class="line">            _fetchedBarData = data;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥å°†å¤„ç†æˆåŠŸçš„ä»£ç æ”¾åœ¨ä¸€ä¸ªå—é‡Œï¼Œå¤„ç†å¤±è´¥çš„ä»£ç æ”¾åœ¨å¦ä¸€ä¸ªå—ä¸­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">â€œ<span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@class</span> <span class="title">EOCNetworkFetcher</span>;</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^EOCNetworkFetcherCompletionHandler)(<span class="built_in">NSData</span> *data);</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^EOCNetworkFetcherErrorHandler)(<span class="built_in">NSError</span> *error);</div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCNetworkFetcher</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="keyword">id</span>)initWithURL:(<span class="built_in">NSURL</span>*)url;</div><div class="line">- (<span class="keyword">void</span>)startWithCompletionHandler: (EOCNetworkFetcherCompletionHandler)completion failureHandler: (EOCNetworkFetcherErrorHandler)failure;</div><div class="line"><span class="keyword">@end</span></div><div class="line">EOCNetworkFetcher *fetcher =[[EOCNetworkFetcher alloc] initWithURL:url];</div><div class="line">[fetcher startWithCompletionHander:^(<span class="built_in">NSData</span> *data)&#123;</div><div class="line">     <span class="comment">// Handle success</span></div><div class="line">&#125;</div><div class="line"> failureHandler:^(<span class="built_in">NSError</span> *error)&#123;</div><div class="line"> <span class="comment">// Handle failure</span></div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ ·å†™çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤„ç†æˆåŠŸå’Œå¤±è´¥çš„ä»£ç åˆ†å¼€æ¥å†™ï¼Œçœ‹ä¸Šå»æ›´åŠ æ¸…æ™°ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å°† æˆåŠŸå’Œå¤±è´¥çš„ä»£ç éƒ½æ”¾åœ¨åŒä¸€ä¸ªå—é‡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">â€œ<span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@class</span> <span class="title">EOCNetworkFetcher</span>;</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^EOCNetworkFetcherCompletionHandler)(<span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error);</div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCNetworkFetcher</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="keyword">id</span>)initWithURL:(<span class="built_in">NSURL</span>*)url;</div><div class="line">- (<span class="keyword">void</span>)startWithCompletionHandler:(EOCNetworkFetcherCompletionHandler)completion;</div><div class="line"><span class="keyword">@end</span></div><div class="line">EOCNetworkFetcher *fetcher =[[EOCNetworkFetcher alloc] initWithURL:url];</div><div class="line">[fetcher startWithCompletionHander:</div><div class="line">^(<span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error)&#123;</div><div class="line"><span class="keyword">if</span> (error) &#123;</div><div class="line">     <span class="comment">// Handle failure</span></div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">     <span class="comment">// Handle success</span></div><div class="line">&#125;</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœåŠæ—¶ä¸‹è½½å¤±è´¥æˆ–ä¸­æ–­äº†ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å–åˆ°å½“å‰æ‰€ä¸‹è½½çš„dataã€‚è€Œä¸”ï¼Œå¦‚æœåœ¨éœ€æ±‚ä¸ŠæŒ‡å‡ºï¼šä¸‹è½½æˆåŠŸåå¾—åˆ°çš„æ•°æ®å¾ˆå°‘ï¼Œä¹Ÿè§†ä¸ºå¤±è´¥ï¼Œé‚£ä¹ˆå•ä¸€å—çš„å†™æ³•å°±å¾ˆé€‚ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å–å¾—æ•°æ®åï¼ˆæˆåŠŸï¼‰å†åˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸‹è½½æˆåŠŸçš„ã€‚</p>
</blockquote>
<h1 id="ç¬¬40æ¡ï¼šç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯"><a href="#ç¬¬40æ¡ï¼šç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯" class="headerlink" title="ç¬¬40æ¡ï¼šç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯"></a>ç¬¬40æ¡ï¼šç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯</h1><hr>
<p>å¦‚æœå—æ•è·çš„å¯¹è±¡ç›´æ¥æˆ–é—´æ¥åœ°ä¿ç•™äº†å—æœ¬èº«ï¼Œé‚£ä¹ˆå°±éœ€è¦å°å¿ƒä¿ç•™ç¯é—®é¢˜:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCClass</span> </span>&#123;</div><div class="line">     EOCNetworkFetcher *_networkFetcher;</div><div class="line">     <span class="built_in">NSData</span> *_fetchedData;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)downloadData &#123;</div><div class="line">     <span class="built_in">NSURL</span> *url = [[<span class="built_in">NSURL</span> alloc] initWithString:<span class="string">@"http://www.example.com/something.dat"</span>];</div><div class="line">    _networkFetcher =[[EOCNetworkFetcher alloc] initWithURL:url];</div><div class="line">    [_networkFetcher startWithCompletionHandler:^(<span class="built_in">NSData</span> *data)&#123;</div><div class="line">             <span class="built_in">NSLog</span>(<span class="string">@"Request URL %@ finished"</span>, _networkFetcher.url);</div><div class="line">            _fetchedData = data;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œå‡ºç°äº†ä¿ç•™ç¯ï¼šå—è¦è®¾ç½®_fetchedDataå˜é‡ï¼Œå°±éœ€è¦æ•è·selfå˜é‡ã€‚è€Œselfï¼ˆEOCClasså®ä¾‹ï¼‰é€šè¿‡å®ä¾‹å˜é‡ä¿ç•™äº†è·å–å™¨_networkFetcherï¼Œè€Œ_networkFetcheråˆä¿ç•™äº†å—ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯ï¼šåœ¨å—ä¸­å–å¾—äº†dataåï¼Œå°†_networkFetcherè®¾ä¸ºnilã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)downloadData &#123;</div><div class="line">     <span class="built_in">NSURL</span> *url = [[<span class="built_in">NSURL</span> alloc] initWithString:<span class="string">@"http://www.example.com/something.dat"</span>];</div><div class="line">    _networkFetcher =[[EOCNetworkFetcher alloc] initWithURL:url];</div><div class="line">    [_networkFetcher startWithCompletionHandler:^(<span class="built_in">NSData</span> *data)&#123;</div><div class="line">             <span class="built_in">NSLog</span>(<span class="string">@"Request URL %@ finished"</span>, _networkFetcher.url);</div><div class="line">            _fetchedData = data;</div><div class="line">            _networkFetcher = <span class="literal">nil</span>;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”"><a href="#ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”" class="headerlink" title="ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”"></a>ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”</h1><hr>
<p>å¤šä¸ªçº¿ç¨‹æ‰§è¡ŒåŒä¸€ä»½ä»£ç æ—¶ï¼Œå¾ˆå¯èƒ½ä¼šé€ æˆæ•°æ®ä¸åŒæ­¥ã€‚ä½œè€…å»ºè®®ä½¿ç”¨GCDæ¥ä¸ºä»£ç åŠ é”çš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h4 id="æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ä¸²è¡ŒåŒæ­¥é˜Ÿåˆ—æ¥å°†è¯»å†™æ“ä½œéƒ½å®‰æ’åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼š"><a href="#æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ä¸²è¡ŒåŒæ­¥é˜Ÿåˆ—æ¥å°†è¯»å†™æ“ä½œéƒ½å®‰æ’åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼š" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ä¸²è¡ŒåŒæ­¥é˜Ÿåˆ—æ¥å°†è¯»å†™æ“ä½œéƒ½å®‰æ’åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼š"></a>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ä¸²è¡ŒåŒæ­¥é˜Ÿåˆ—æ¥å°†è¯»å†™æ“ä½œéƒ½å®‰æ’åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">_syncQueue = dispatch_queue_create(<span class="string">"com.effectiveobjectivec.syncQueue"</span>, <span class="literal">NULL</span>);</div><div class="line"><span class="comment">//è¯»å–å­—ç¬¦ä¸²</span></div><div class="line">- (<span class="built_in">NSString</span>*)someString &#123;</div><div class="line">         __block <span class="built_in">NSString</span> *localSomeString;</div><div class="line">         <span class="built_in">dispatch_sync</span>(_syncQueue, ^&#123;</div><div class="line">            localSomeString = _someString;</div><div class="line">        &#125;);</div><div class="line">         <span class="keyword">return</span> localSomeString;</div><div class="line">&#125;</div><div class="line"><span class="comment">//è®¾ç½®å­—ç¬¦ä¸²</span></div><div class="line">- (<span class="keyword">void</span>)setSomeString:(<span class="built_in">NSString</span>*)someString &#123;</div><div class="line">     <span class="built_in">dispatch_sync</span>(_syncQueue, ^&#123;</div><div class="line">        _someString = someString;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œè¯»å†™æ“ä½œéƒ½åœ¨ä¸²è¡Œé˜Ÿåˆ—è¿›è¡Œï¼Œå°±ä¸å®¹æ˜“å‡ºé”™ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è®©æ€§èƒ½æ›´é«˜ï¼š</p>
<h4 id="æ–¹æ¡ˆäºŒï¼šå°†å†™æ“ä½œæ”¾å…¥æ …æ å¿«ä¸­ï¼Œè®©ä»–ä»¬å•ç‹¬æ‰§è¡Œï¼›å°†è¯»å–æ“ä½œå¹¶å‘æ‰§è¡Œã€‚"><a href="#æ–¹æ¡ˆäºŒï¼šå°†å†™æ“ä½œæ”¾å…¥æ …æ å¿«ä¸­ï¼Œè®©ä»–ä»¬å•ç‹¬æ‰§è¡Œï¼›å°†è¯»å–æ“ä½œå¹¶å‘æ‰§è¡Œã€‚" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šå°†å†™æ“ä½œæ”¾å…¥æ …æ å¿«ä¸­ï¼Œè®©ä»–ä»¬å•ç‹¬æ‰§è¡Œï¼›å°†è¯»å–æ“ä½œå¹¶å‘æ‰§è¡Œã€‚"></a>æ–¹æ¡ˆäºŒï¼šå°†<strong>å†™æ“ä½œ</strong>æ”¾å…¥æ …æ å¿«ä¸­ï¼Œè®©ä»–ä»¬å•ç‹¬æ‰§è¡Œï¼›å°†<strong>è¯»å–æ“ä½œ</strong>å¹¶å‘æ‰§è¡Œã€‚</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">_syncQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div><div class="line"><span class="comment">//è¯»å–å­—ç¬¦ä¸²</span></div><div class="line">- (<span class="built_in">NSString</span>*)someString &#123;</div><div class="line">     __block <span class="built_in">NSString</span> *localSomeString;</div><div class="line">     <span class="built_in">dispatch_sync</span>(_syncQueue, ^&#123;</div><div class="line">        localSomeString = _someString;</div><div class="line">    &#125;);</div><div class="line">     <span class="keyword">return</span> localSomeString;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è®¾ç½®å­—ç¬¦ä¸²</span></div><div class="line">- (<span class="keyword">void</span>)setSomeString:(<span class="built_in">NSString</span>*)someString &#123;</div><div class="line">     dispatch_barrier_async(_syncQueue, ^&#123;</div><div class="line">        _someString = someString;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ˜¾ç„¶ï¼Œæ•°æ®çš„æ­£ç¡®æ€§ä¸»è¦å–å†³äºå†™å…¥æ“ä½œï¼Œé‚£ä¹ˆåªè¦ä¿è¯å†™å…¥æ—¶ï¼Œçº¿ç¨‹æ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆå³ä¾¿è¯»å–æ“ä½œæ˜¯å¹¶å‘çš„ï¼Œä¹Ÿå¯ä»¥ä¿è¯æ•°æ®æ˜¯åŒæ­¥çš„ã€‚</p>
<p>è¿™é‡Œçš„<code>dispatch_barrier_async</code>æ–¹æ³•ä½¿å¾—æ“ä½œæ”¾åœ¨äº†åŒæ­¥é˜Ÿåˆ—é‡Œâ€œæœ‰åºè¿›è¡Œâ€ï¼Œä¿è¯äº†å†™å…¥æ“ä½œçš„ä»»åŠ¡æ˜¯åœ¨ä¸²è¡Œé˜Ÿåˆ—é‡Œã€‚</p>
</blockquote>
<h1 id="ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨performSelectorç³»åˆ—æ–¹æ³•"><a href="#ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨performSelectorç³»åˆ—æ–¹æ³•" class="headerlink" title="ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨performSelectorç³»åˆ—æ–¹æ³•"></a>ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨performSelectorç³»åˆ—æ–¹æ³•</h1><hr>
<p>åœ¨iOSå¼€å‘ä¸­ï¼Œæœ‰æ—¶ä¼šä½¿ç”¨performSelectoræ¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œä½†æ˜¯performSelectorç³»åˆ—çš„æ–¹æ³•èƒ½å¤„ç†çš„é€‰æ‹©å­å¾ˆå±€é™ï¼š</p>
<ul>
<li>å®ƒæ— æ³•å¤„ç†å¸¦æœ‰å¤šä¸ªå‚æ•°çš„é€‰æ‹©å­ã€‚</li>
<li>è¿”å›å€¼åªèƒ½æ˜¯voidæˆ–è€…å¯¹è±¡ç±»å‹ã€‚</li>
</ul>
<p>ä½†æ˜¯å¦‚æœå°†æ–¹æ³•æ”¾åœ¨å—ä¸­ï¼Œé€šè¿‡GCDæ¥æ“ä½œå°±èƒ½å¾ˆå¥½åœ°è§£å†³è¿™äº›é—®é¢˜ã€‚å°¤å…¶æ˜¯æˆ‘ä»¬å¦‚æœæƒ³è¦è®©ä¸€ä¸ªä»»åŠ¡åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œæœ€å¥½åº”è¯¥å°†ä»»åŠ¡æ”¾åˆ°å—é‡Œï¼Œäº¤ç»™GCDæ¥å®ç°ï¼Œè€Œä¸æ˜¯é€šè¿‡performSelectoræ–¹æ³•ã€‚</p>
<p>ä¸¾å‡ ä¸ª æ¥æ¯”è¾ƒè¿™ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<h4 id="1-å»¶åæ‰§è¡ŒæŸä¸ªä»»åŠ¡çš„æ–¹æ³•ï¼š"><a href="#1-å»¶åæ‰§è¡ŒæŸä¸ªä»»åŠ¡çš„æ–¹æ³•ï¼š" class="headerlink" title="1. å»¶åæ‰§è¡ŒæŸä¸ªä»»åŠ¡çš„æ–¹æ³•ï¼š"></a>1. å»¶åæ‰§è¡ŒæŸä¸ªä»»åŠ¡çš„æ–¹æ³•ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ä½¿ç”¨ performSelector:withObject:afterDelay:</span></div><div class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(doSomething) withObject:<span class="literal">nil</span> afterDelay:<span class="number">5.0</span>];</div><div class="line"><span class="comment">// ä½¿ç”¨ dispatch_after</span></div><div class="line">dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">5.0</span> * <span class="built_in">NSEC_PER_SEC</span>));</div><div class="line">dispatch_after(time, dispatch_get_main_queue(), ^(<span class="keyword">void</span>)&#123;</div><div class="line">    [<span class="keyword">self</span> doSomething];</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="2-å°†ä»»åŠ¡æ”¾åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼š"><a href="#2-å°†ä»»åŠ¡æ”¾åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼š" class="headerlink" title="2. å°†ä»»åŠ¡æ”¾åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼š"></a>2. å°†ä»»åŠ¡æ”¾åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ä½¿ç”¨ performSelectorOnMainThread:withObject:waitUntilDone:</span></div><div class="line">[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(doSomething) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span>];</div><div class="line"><span class="comment">// ä½¿ç”¨ dispatch_async</span></div><div class="line"><span class="comment">// (or if waitUntilDone is YES, then dispatch_sync)</span></div><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        [<span class="keyword">self</span> doSomething];</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼š<br>å¦‚æœwaitUntilDoneçš„å‚æ•°æ˜¯Yesï¼Œé‚£ä¹ˆå°±å¯¹åº”GCDçš„dispatch_syncæ–¹æ³•ã€‚<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨GCDçš„æ–¹å¼å¯ä»¥å°†çº¿ç¨‹æ“ä½œä»£ç å’Œæ–¹æ³•è°ƒç”¨ä»£ç å†™åœ¨åŒä¸€å¤„ï¼Œä¸€ç›®äº†ç„¶ï¼›è€Œä¸”å®Œå…¨ä¸å—è°ƒç”¨æ–¹æ³•çš„é€‰æ‹©å­å’Œæ–¹æ³•å‚æ•°ä¸ªæ•°çš„é™åˆ¶ã€‚</p>
</blockquote>
<h1 id="ç¬¬43æ¡ï¼šæŒæ¡GCDåŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº"><a href="#ç¬¬43æ¡ï¼šæŒæ¡GCDåŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº" class="headerlink" title="ç¬¬43æ¡ï¼šæŒæ¡GCDåŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº"></a>ç¬¬43æ¡ï¼šæŒæ¡GCDåŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº</h1><hr>
<p>é™¤äº†GCDï¼Œæ“ä½œé˜Ÿåˆ—ï¼ˆNSOperationQueueï¼‰ä¹Ÿæ˜¯è§£å†³å¤šçº¿ç¨‹ä»»åŠ¡ç®¡ç†é—®é¢˜çš„ä¸€ä¸ªæ–¹æ¡ˆã€‚å¯¹äºä¸åŒçš„ç¯å¢ƒï¼Œæˆ‘ä»¬è¦é‡‡å–ä¸åŒçš„ç­–ç•¥æ¥è§£å†³é—®é¢˜ï¼šæœ‰æ—¶å€™ä½¿ç”¨GCDå¥½äº›ï¼Œæœ‰æ—¶åˆ™æ˜¯ä½¿ç”¨æ“ä½œé˜Ÿåˆ—æ›´åŠ åˆç†ã€‚</p>
<p>ä½¿ç”¨NSOperationå’ŒNSOperationQueueçš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å¯ä»¥å–æ¶ˆæ“ä½œï¼šåœ¨è¿è¡Œä»»åŠ¡å‰ï¼Œå¯ä»¥åœ¨NSOperationå¯¹è±¡è°ƒç”¨cancelæ–¹æ³•ï¼Œæ ‡æ˜æ­¤ä»»åŠ¡ä¸éœ€è¦æ‰§è¡Œã€‚ä½†æ˜¯GCDé˜Ÿåˆ—æ˜¯æ— æ³•å–æ¶ˆçš„ï¼Œå› ä¸ºå®ƒéµå¾ªâ€œå®‰æ’å¥½ä¹‹åå°±ä¸ç®¡äº†ï¼ˆfire and forgetï¼‰â€çš„åŸåˆ™ã€‚</li>
<li>å¯ä»¥æŒ‡å®šæ“ä½œé—´çš„ä¾èµ–å…³ç³»ï¼šä¾‹å¦‚ä»æœåŠ¡å™¨ä¸‹è½½å¹¶å¤„ç†æ–‡ä»¶çš„åŠ¨ä½œå¯ä»¥ç”¨æ“ä½œæ¥è¡¨ç¤ºã€‚è€Œåœ¨å¤„ç†å…¶ä»–æ–‡ä»¶ä¹‹å‰å¿…é¡»å…ˆä¸‹è½½â€œæ¸…å•æ–‡ä»¶â€ã€‚è€Œåç»­çš„ä¸‹è½½å·¥ä½œï¼Œéƒ½è¦ä¾èµ–äºå…ˆä¸‹è½½çš„æ¸…å•æ–‡ä»¶è¿™ä¸€æ“ä½œã€‚</li>
<li>ç›‘æ§NSOperationå¯¹è±¡çš„å±æ€§ï¼šå¯ä»¥é€šè¿‡KVOæ¥ç›‘å¬NSOperationçš„å±æ€§ï¼šå¯ä»¥é€šè¿‡isCancelledå±æ€§æ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å–æ¶ˆï¼›é€šè¿‡isFinishedå±æ€§æ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆã€‚</li>
<li>å¯ä»¥æŒ‡å®šæ“ä½œçš„ä¼˜å…ˆçº§ï¼šæ“ä½œçš„ä¼˜å…ˆçº§è¡¨ç¤ºæ­¤æ“ä½œä¸é˜Ÿåˆ—ä¸­å…¶ä»–æ“ä½œä¹‹é—´çš„ä¼˜å…ˆå…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šå®ƒã€‚</li>
</ol>
<h1 id="ç¬¬44æ¡ï¼šé€šè¿‡Dispath-Groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡"><a href="#ç¬¬44æ¡ï¼šé€šè¿‡Dispath-Groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡" class="headerlink" title="ç¬¬44æ¡ï¼šé€šè¿‡Dispath Groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡"></a>ç¬¬44æ¡ï¼šé€šè¿‡Dispath Groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡</h1><hr>
<p>æœ‰æ—¶éœ€è¦<strong>ç­‰å¾…</strong>å¤šä¸ªå¹¶è¡Œä»»åŠ¡ç»“æŸçš„é‚£ä¸€åˆ»æ‰§è¡ŒæŸä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨dispath groupå‡½æ•°æ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼š</p>
<p>é€šè¿‡dispath groupå‡½æ•°ï¼Œå¯ä»¥æŠŠå¹¶å‘æ‰§è¡Œçš„å¤šä¸ªä»»åŠ¡åˆä¸ºä¸€ç»„ï¼Œäºæ˜¯è°ƒç”¨è€…å°±å¯ä»¥çŸ¥é“è¿™äº›ä»»åŠ¡ä½•æ—¶æ‰èƒ½å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ä¸€ä¸ªä¼˜å…ˆçº§ä½çš„å¹¶å‘é˜Ÿåˆ—</span></div><div class="line"><span class="built_in">dispatch_queue_t</span> lowPriorityQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, <span class="number">0</span>);</div><div class="line"><span class="comment">//ä¸€ä¸ªä¼˜å…ˆçº§é«˜çš„å¹¶å‘é˜Ÿåˆ—</span></div><div class="line"><span class="built_in">dispatch_queue_t</span> highPriorityQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>);</div><div class="line"><span class="comment">//åˆ›å»ºdispatch_group</span></div><div class="line">dispatch_group_t dispatchGroup = dispatch_group_create();</div><div class="line"><span class="comment">//å°†ä¼˜å…ˆçº§ä½çš„é˜Ÿåˆ—æ”¾å…¥dispatch_group</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">id</span> object <span class="keyword">in</span> lowPriorityObjects) &#123;</div><div class="line"> dispatch_group_async(dispatchGroup,lowPriorityQueue,^&#123; [object performTask]; &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">//å°†ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—æ”¾å…¥dispatch_group</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">id</span> object <span class="keyword">in</span> highPriorityObjects) &#123;</div><div class="line"> dispatch_group_async(dispatchGroup,highPriorityQueue,^&#123; [object performTask]; &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">//dispatch_groupé‡Œçš„ä»»åŠ¡éƒ½ç»“æŸåè°ƒç”¨å—ä¸­çš„ä»£ç </span></div><div class="line"><span class="built_in">dispatch_queue_t</span> notifyQueue = dispatch_get_main_queue();</div><div class="line">dispatch_group_notify(dispatchGroup,notifyQueue,^&#123;</div><div class="line">     <span class="comment">// Continue processing after completing tasks</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h1 id="ç¬¬45æ¡ï¼šä½¿ç”¨dispatch-onceæ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç "><a href="#ç¬¬45æ¡ï¼šä½¿ç”¨dispatch-onceæ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç " class="headerlink" title="ç¬¬45æ¡ï¼šä½¿ç”¨dispatch_onceæ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç "></a>ç¬¬45æ¡ï¼šä½¿ç”¨dispatch_onceæ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç </h1><hr>
<p>æœ‰æ—¶æˆ‘ä»¬å¯èƒ½åªéœ€è¦å°†æŸæ®µä»£ç æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡dispatch_onceå‡½æ•°æ¥è§£å†³ã€‚</p>
<p>dispatch_onceå‡½æ•°æ¯”è¾ƒé‡è¦çš„ä½¿ç”¨ä¾‹å­æ˜¯å•ä¾‹æ¨¡å¼ï¼š<br>æˆ‘ä»¬åœ¨åˆ›å»ºå•ä¾‹æ¨¡å¼çš„å®ä¾‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨dispatch_onceå‡½æ•°æ¥ä»¤åˆå§‹åŒ–ä»£ç åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å†…éƒ¨æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>è€Œä¸”ï¼Œå¯¹äºæ‰§è¡Œä¸€æ¬¡çš„blockæ¥è¯´ï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„æ ‡è®°éƒ½å¿…é¡»å®Œå…¨ç›¸åŒï¼Œé€šå¸¸æ ‡è®°å˜é‡å£°æ˜åœ¨staticæˆ–globalä½œç”¨åŸŸé‡Œã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">id</span>)sharedInstance &#123;</div><div class="line">     <span class="keyword">static</span> EOCClass *sharedInstance = <span class="literal">nil</span>;</div><div class="line">     <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">     <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">ï»¿            sharedInstance = [[<span class="keyword">self</span> alloc] init];</div><div class="line">    &#125;);</div><div class="line">     <span class="keyword">return</span> sharedInstance;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼šåœ¨dispatch_onceå—ä¸­çš„ä»£ç åœ¨ç¨‹åºå¯åŠ¨åˆ°ç»ˆæ­¢çš„è¿‡ç¨‹é‡Œï¼Œåªè¦è¿è¡Œäº†ä¸€æ¬¡åï¼Œå°±ç»™è‡ªå·±åŠ ä¸Šäº†æ³¨é‡Šç¬¦å·ï¼Œä¸å†å­˜åœ¨äº†ã€‚</p>
</blockquote>
<h1 id="ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectionä½¿ç”¨æ— ç¼æ¡¥æ¥"><a href="#ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectionä½¿ç”¨æ— ç¼æ¡¥æ¥" class="headerlink" title="ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectionä½¿ç”¨æ— ç¼æ¡¥æ¥"></a>ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectionä½¿ç”¨æ— ç¼æ¡¥æ¥</h1><hr>
<p>é€šè¿‡æ— ç¼æ¡¥æ¥æŠ€æœ¯ï¼Œå¯ä»¥å†Foundationæ¡†æ¶ä¸­çš„OCå¯¹è±¡å’ŒCoreFoundationæ¡†æ¶ä¸­çš„Cè¯­è¨€æ•°æ®ç»“æ„ä¹‹é—´æ¥å›è½¬æ¢ã€‚</p>
<p>åˆ›å»ºCoreFoundationä¸­çš„collectionæ—¶ï¼Œå¯ä»¥æŒ‡å®šå¦‚ä½•å¤„ç†å…¶ä¸­çš„å…ƒç´ ã€‚ç„¶ååˆ©ç”¨æ— ç¼æ¡¥æ¥æŠ€æœ¯ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸ºOCcollectionã€‚</p>
<p>ç®€å•çš„æ— ç¼æ¡¥æ¥æ¼”ç¤ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *anNSArray = @[@<span class="number">1</span>, @<span class="number">2</span>, @<span class="number">3</span>, @<span class="number">4</span>, @<span class="number">5</span>];</div><div class="line"><span class="built_in">CFArrayRef</span> aCFArray = (__bridge <span class="built_in">CFArrayRef</span>)anNSArray;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"Size of array = %li"</span>, <span class="built_in">CFArrayGetCount</span>(aCFArray));</div></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œ<code>__bridge</code>è¡¨ç¤ºARCä»ç„¶å…·å¤‡è¿™ä¸ªOCå¯¹è±¡çš„æ‰€æœ‰æƒã€‚<code>CFArrayGetCount</code>ç”¨æ¥è·å–æ•°ç»„çš„é•¿é«˜åº¦ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ— ç¼æ¡¥æ¥æŠ€æœ¯å‘¢ï¼Ÿå› ä¸ºæœ‰äº›OCå¯¹è±¡çš„ç‰¹æ€§æ˜¯å…¶å¯¹åº”çš„CFæ•°æ®ç»“æ„ä¸å…·å¤‡çš„ï¼Œåä¹‹äº¦ç„¶ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡æ— ç¼æ¡¥æ¥æŠ€æœ¯æ¥è®©è¿™ä¸¤è€…è¿›è¡ŒåŠŸèƒ½ä¸Šçš„â€œäº’è¡¥â€ã€‚</p>
<h1 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h1><hr>
<p>ç»ˆäºæ€»ç»“å®Œäº†ï¼Œè¿˜æ˜¯æœ‰ä¸ªåˆ«çŸ¥è¯†ç‚¹ç†è§£å¾—ä¸æ˜¯å¾ˆé€å½»ï¼Œéœ€è¦åå¤é˜…è¯»å’Œç†è§£æ¶ˆåŒ–ã€‚å¸Œæœ›å„ä½å°ä¼™ä¼´å¤šå¤šæå‡ºå®è´µæ„è§ï¼Œäº¤æµå­¦ä¹ ~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-4696272b0a4ffe42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;ã€ŠEffective Objective-C ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹&quot;&gt;&lt;/p&gt;
&lt;p&gt;ã€ŠEffective Objective-C ã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ç³»åˆ—è¿æ¥äº†æœ€åä¸€ç¯‡ï¼šæŠ€å·§ç¯‡ï¼Œè¿™ä¸€ç¯‡æ€»ç»“æ±‡æ€»äº†è¿™æœ¬ä¹¦ä¸­ä¸€äº›ç”¨æ¥è§£å†³é—®é¢˜çš„åå‘â€œè®¾è®¡æ¨¡å¼â€çš„çŸ¥è¯†ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸çŸ¥é“ç¬”è€…æ‰€è°“çš„ä¸‰éƒ¨æ›²çš„ç«¥é‹ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¿™å¼ å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-0599d987732d932e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;ä¸‰éƒ¨æ›²åˆ†å¸ƒå›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;å‰ä¸¤ç¯‡ä¼ é€é—¨ï¼š&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/9c93c7ab734d&quot;&gt;ã€ŠEffective Objective-C ã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸€ï¼‰ï¼šæ¦‚å¿µç¯‡&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/0b895e39eca1&quot;&gt;ã€ŠEffective Objective-C ã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆäºŒï¼‰ï¼šè§„èŒƒç¯‡&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠEffective Objective-Cã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆäºŒï¼‰ï¼šè§„èŒƒç¯‡</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/%E3%80%8AEffective%20Objective-C%E3%80%8B%E8%B6%85%E7%BA%A7%E5%B9%B2%E8%B4%A7%E4%B8%89%E9%83%A8%E6%9B%B2%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E8%A7%84%E8%8C%83%E7%AF%87/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/ã€ŠEffective Objective-Cã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆäºŒï¼‰ï¼šè§„èŒƒç¯‡/</id>
    <published>2017-01-13T05:52:04.000Z</published>
    <updated>2017-03-20T07:47:52.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/859001-4696272b0a4ffe42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ã€ŠEffective Objective-C ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹"></p>
<p>ç»§ä¸Šä¸€ç¯‡<a href="http://www.jianshu.com/p/9c93c7ab734d" target="_blank" rel="external">ã€ŠEffective Objective-C ã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸€ï¼‰ï¼šæ¦‚å¿µç¯‡</a>ä¹‹åï¼Œæœ¬ç¯‡å³æ˜¯ä¸‰éƒ¨æ›²çš„ç¬¬äºŒç¯‡ï¼šè§„èŒƒç¯‡ã€‚<br>æ²¡çœ‹è¿‡ä¸‰éƒ¨æ›²ç¬¬ä¸€ç¯‡çš„å°ä¼™ä¼´å¯èƒ½ä¸çŸ¥é“æˆ‘åœ¨è¯´ç¥é©¬ï¼Œåœ¨è¿™é‡Œè¿˜æ˜¯å…ˆå•°å—¦ä¸€ä¸‹ä¸‰éƒ¨æ›²æ˜¯å’‹å›äº‹ï¼šç¬”è€…å°†ã€ŠEffective Objective-C ã€‹è¿™æœ¬ä¹¦çš„52ä¸ªçŸ¥è¯†ç‚¹åˆ†ä¸ºä¸‰å¤§ç±»è¿›è¡Œäº†å½’ç±»æ•´ç†ï¼š</p>
<ul>
<li>æ¦‚å¿µç±»ï¼šè®²è§£äº†ä¸€äº›æ¦‚å¿µæ€§çŸ¥è¯†ã€‚</li>
<li>è§„èŒƒç±»ï¼šè®²è§£äº†ä¸€äº›ä¸ºäº†é¿å…ä¸€äº›é—®é¢˜æˆ–è€…ä¸ºåç»­å¼€å‘æä¾›ä¾¿åˆ©æ‰€éœ€è¦éµå¾ªçš„è§„èŒƒæ€§çŸ¥è¯†ã€‚</li>
<li>æŠ€å·§ç±»ï¼šè®²è§£äº†ä¸€äº›ä¸ºäº†è§£å†³æŸäº›ç‰¹å®šé—®é¢˜è€Œéœ€è¦ç”¨åˆ°çš„æŠ€å·§æ€§çŸ¥è¯†ã€‚</li>
</ul>
<p>ç„¶åç”¨æ€ç»´å¯¼å›¾æ•´ç†äº†ä¸€ä¸‹ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/859001-0599d987732d932e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‰éƒ¨æ›²åˆ†å¸ƒå›¾"></p>
<p>ä½œä¸ºä¸‰éƒ¨æ›²çš„ç¬¬äºŒç¯‡ï¼Œæœ¬ç¯‡æ€»ç»“æŠ½å–äº†ã€ŠEffective Objective-C ã€‹è¿™æœ¬ä¹¦ä¸­è®²è§£è§„èŒƒæ€§çŸ¥è¯†çš„éƒ¨åˆ†ï¼šè¿™äº›çŸ¥è¯†ç‚¹éƒ½æ˜¯ä¸ºäº†é¿å…åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜æˆ–ç»™å¼€å‘æä¾›ä¾¿åˆ©çš„è§„èŒƒæ€§çŸ¥è¯†ç‚¹ã€‚æŒæ¡è¿™äº›çŸ¥è¯†æœ‰åŠ©äºå½¢æˆç§‘å­¦åœ°å†™OCä»£ç çš„ä¹ æƒ¯ï¼Œä½¿å¾—ä»£ç æ›´åŠ å®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•ï¼Œå­¦ä¹ è¿™ç±»çŸ¥è¯†æ˜¯iOSåˆå­¦è€…è¿›é˜¶çš„å¿…ç»ä¹‹è·¯ã€‚</p>
<p>å¥½å§ï¼Œä¸è´¹è¯äº†ï¼Œå¼€å§‹äº†ï¼</p>
<a id="more"></a>
<h1 id="ç¬¬2æ¡ï¼š-åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å°½é‡å°‘å¼•ç”¨å…¶ä»–å¤´æ–‡ä»¶"><a href="#ç¬¬2æ¡ï¼š-åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å°½é‡å°‘å¼•ç”¨å…¶ä»–å¤´æ–‡ä»¶" class="headerlink" title="ç¬¬2æ¡ï¼š åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å°½é‡å°‘å¼•ç”¨å…¶ä»–å¤´æ–‡ä»¶"></a>ç¬¬2æ¡ï¼š åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å°½é‡å°‘å¼•ç”¨å…¶ä»–å¤´æ–‡ä»¶</h1><hr>
<p>æœ‰æ—¶ï¼Œç±»Aéœ€è¦å°†ç±»Bçš„å®ä¾‹å˜é‡ä½œä¸ºå®ƒå…¬å…±APIçš„å±æ€§ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å¼•å…¥ç±»Bçš„å¤´æ–‡ä»¶ï¼Œè€Œåº”è¯¥ä½¿ç”¨å‘å‰å£°æ˜ï¼ˆforward declaringï¼‰ä½¿ç”¨classå…³é”®å­—ï¼Œå¹¶ä¸”åœ¨Açš„å®ç°æ–‡ä»¶å¼•ç”¨Bçš„å¤´æ–‡ä»¶ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// EOCPerson.h</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@class</span> <span class="title">EOCEmployer</span>;</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *firstName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *lastName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) EOCEmployer *employer;<span class="comment">//å°†EOCEmployerä½œä¸ºå±æ€§</span></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="comment">// EOCPerson.m</span></div><div class="line"><span class="meta">#import <span class="meta-string">"EOCEmployer.h"</span></span></div></pre></td></tr></table></figure>
<p>è¿™æ ·åšæœ‰ä»€ä¹ˆä¼˜ç‚¹å‘¢ï¼š</p>
<blockquote>
<ul>
<li>ä¸åœ¨Açš„å¤´æ–‡ä»¶ä¸­å¼•å…¥Bçš„å¤´æ–‡ä»¶ï¼Œå°±ä¸ä¼šä¸€å¹¶å¼•å…¥Bçš„å…¨éƒ¨å†…å®¹ï¼Œè¿™æ ·å°±å‡å°‘äº†ç¼–è¯‘æ—¶é—´ã€‚</li>
<li>å¯ä»¥é¿å…å¾ªç¯å¼•ç”¨ï¼šå› ä¸ºå¦‚æœä¸¤ä¸ªç±»åœ¨è‡ªå·±çš„å¤´æ–‡ä»¶ä¸­éƒ½å¼•å…¥äº†å¯¹æ–¹çš„å¤´æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å…¶ä¸­ä¸€ä¸ªç±»æ— æ³•è¢«æ­£ç¡®ç¼–è¯‘ã€‚</li>
</ul>
</blockquote>
<p>ä½†æ˜¯ä¸ªåˆ«çš„æ—¶å€™ï¼Œå¿…é¡»åœ¨å¤´æ–‡ä»¶ä¸­å¼•å…¥å…¶ä»–ç±»çš„å¤´æ–‡ä»¶:</p>
<blockquote>
<p>ä¸»è¦æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>è¯¥ç±»ç»§æ‰¿äºæŸä¸ªç±»ï¼Œåˆ™åº”è¯¥å¼•å…¥çˆ¶ç±»çš„å¤´æ–‡ä»¶ã€‚</li>
<li>è¯¥ç±»éµä»æŸä¸ªåè®®ï¼Œåˆ™åº”è¯¥å¼•å…¥è¯¥åè®®çš„å¤´æ–‡ä»¶ã€‚è€Œä¸”æœ€å¥½å°†åè®®å•ç‹¬æ”¾åœ¨ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ã€‚</li>
</ol>
</blockquote>
<h1 id="ç¬¬3æ¡ï¼šå¤šç”¨å­—é¢é‡è¯­æ³•ï¼Œå°‘ç”¨ä¸ä¹‹ç­‰ä»·çš„æ–¹æ³•"><a href="#ç¬¬3æ¡ï¼šå¤šç”¨å­—é¢é‡è¯­æ³•ï¼Œå°‘ç”¨ä¸ä¹‹ç­‰ä»·çš„æ–¹æ³•" class="headerlink" title="ç¬¬3æ¡ï¼šå¤šç”¨å­—é¢é‡è¯­æ³•ï¼Œå°‘ç”¨ä¸ä¹‹ç­‰ä»·çš„æ–¹æ³•"></a>ç¬¬3æ¡ï¼šå¤šç”¨å­—é¢é‡è¯­æ³•ï¼Œå°‘ç”¨ä¸ä¹‹ç­‰ä»·çš„æ–¹æ³•</h1><hr>
<h2 id="1-å£°æ˜æ—¶çš„å­—é¢é‡è¯­æ³•ï¼š"><a href="#1-å£°æ˜æ—¶çš„å­—é¢é‡è¯­æ³•ï¼š" class="headerlink" title="1. å£°æ˜æ—¶çš„å­—é¢é‡è¯­æ³•ï¼š"></a>1. å£°æ˜æ—¶çš„å­—é¢é‡è¯­æ³•ï¼š</h2><p>åœ¨å£°æ˜NSNumberï¼ŒNSArrayï¼ŒNSDictionaryæ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨ç®€æ´å­—é¢é‡è¯­æ³•ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSNumber</span> *intNumber = @<span class="number">1</span>;</div><div class="line"><span class="built_in">NSNumber</span> *floatNumber = @<span class="number">2.5</span>f;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *animals =[<span class="built_in">NSArray</span> arrayWithObjects:<span class="string">@"cat"</span>, <span class="string">@"dog"</span>,<span class="string">@"mouse"</span>, <span class="string">@"badger"</span>, <span class="literal">nil</span>];</div><div class="line">Dictionary *dict = @&#123;<span class="string">@"animal"</span>:<span class="string">@"tiger"</span>,<span class="string">@"phone"</span>:<span class="string">@"iPhone 6"</span>&#125;;</div></pre></td></tr></table></figure>
<h2 id="2-é›†åˆç±»å–ä¸‹æ ‡çš„å­—é¢é‡è¯­æ³•ï¼š"><a href="#2-é›†åˆç±»å–ä¸‹æ ‡çš„å­—é¢é‡è¯­æ³•ï¼š" class="headerlink" title="2. é›†åˆç±»å–ä¸‹æ ‡çš„å­—é¢é‡è¯­æ³•ï¼š"></a>2. é›†åˆç±»å–ä¸‹æ ‡çš„å­—é¢é‡è¯­æ³•ï¼š</h2><p>NSArrayï¼ŒNSDictionaryï¼ŒNSMutableArrayï¼ŒNSMutableDictionary çš„å–ä¸‹æ ‡æ“ä½œä¹Ÿåº”è¯¥å°½é‡ä½¿ç”¨å­—é¢é‡è¯­æ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSString *cat = animals[0];</div><div class="line">NSString *iphone = dict[@&quot;phone&quot;];</div></pre></td></tr></table></figure></p>
<blockquote>
<p>ä½¿ç”¨å­—é¢é‡è¯­æ³•çš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>ä»£ç çœ‹èµ·æ¥æ›´åŠ ç®€æ´ã€‚</li>
<li>å¦‚æœå­˜åœ¨nilå€¼ï¼Œåˆ™ä¼šç«‹å³æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœåœ¨ä¸ç”¨å­—é¢é‡è¯­æ³•å®šä¹‰æ•°ç»„çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ•°ç»„å†…éƒ¨å­˜åœ¨nilï¼Œåˆ™ç³»ç»Ÿä¼šå°†å…¶è®¾ä¸ºæ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ å¹¶ç»ˆæ­¢ã€‚æ‰€ä»¥å½“è¿™ä¸ªnilä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ çš„è¯ï¼Œå°±ä¼šå‡ºç°éš¾ä»¥æ’æŸ¥çš„é”™è¯¯ã€‚</li>
</ol>
<p><strong>æ³¨æ„</strong>:<br>å­—é¢é‡è¯­æ³•åˆ›å»ºå‡ºæ¥çš„å­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œå­—å…¸å¯¹è±¡éƒ½æ˜¯ä¸å¯å˜çš„ã€‚</p>
</blockquote>
<h1 id="ç¬¬4æ¡ï¼šå¤šç”¨ç±»å‹å¸¸é‡ï¼Œå°‘ç”¨-defineé¢„å¤„ç†å‘½ä»¤"><a href="#ç¬¬4æ¡ï¼šå¤šç”¨ç±»å‹å¸¸é‡ï¼Œå°‘ç”¨-defineé¢„å¤„ç†å‘½ä»¤" class="headerlink" title="ç¬¬4æ¡ï¼šå¤šç”¨ç±»å‹å¸¸é‡ï¼Œå°‘ç”¨#defineé¢„å¤„ç†å‘½ä»¤"></a>ç¬¬4æ¡ï¼šå¤šç”¨ç±»å‹å¸¸é‡ï¼Œå°‘ç”¨#defineé¢„å¤„ç†å‘½ä»¤</h1><hr>
<p>åœ¨OCä¸­ï¼Œå®šä¹‰å¸¸é‡é€šå¸¸ä½¿ç”¨é¢„å¤„ç†å‘½ä»¤ï¼Œä½†æ˜¯å¹¶ä¸å»ºè®®ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯ä½¿ç”¨ç±»å‹å¸¸é‡çš„æ–¹æ³•ã€‚<br>é¦–å…ˆæ¯”è¾ƒä¸€ä¸‹è¿™ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«ï¼š</p>
<ul>
<li>é¢„å¤„ç†å‘½ä»¤ï¼šç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼Œä¸åŒ…æ‹¬ç±»å‹ä¿¡æ¯ï¼Œå¹¶ä¸”å¯è¢«ä»»æ„ä¿®æ”¹ã€‚</li>
<li>ç±»å‹å¸¸é‡ï¼šåŒ…æ‹¬ç±»å‹ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®å…¶ä½¿ç”¨èŒƒå›´ï¼Œè€Œä¸”ä¸å¯è¢«ä¿®æ”¹ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œä½¿ç”¨é¢„å¤„ç†è™½ç„¶èƒ½è¾¾åˆ°æ›¿æ¢æ–‡æœ¬çš„ç›®çš„ï¼Œä½†æ˜¯æœ¬èº«è¿˜æ˜¯æœ‰å±€é™æ€§çš„ï¼šä¸å…·å¤‡ç±»å‹ + å¯ä»¥è¢«ä»»æ„ä¿®æ”¹ï¼Œæ€»ä¹‹ç»™äººä¸€ç§ä¸å®‰å…¨çš„æ„Ÿè§‰ã€‚</p>
<p>çŸ¥é“äº†å®ƒä»¬çš„é•¿çŸ­å¤„ï¼Œæˆ‘ä»¬å†æ¥ç®€å•çœ‹ä¸€ä¸‹å®ƒä»¬çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼š</p>
<h4 id="é¢„å¤„ç†å‘½ä»¤ï¼š"><a href="#é¢„å¤„ç†å‘½ä»¤ï¼š" class="headerlink" title="é¢„å¤„ç†å‘½ä»¤ï¼š"></a>é¢„å¤„ç†å‘½ä»¤ï¼š</h4><p><code>#define W_LABEL (W_SCREEN - 2*GAP)</code></p>
<blockquote>
<p>è¿™é‡Œï¼Œ(W_SCREEN - 2*GAP)æ›¿æ¢äº†W_LABELï¼Œå®ƒä¸å…·å¤‡W_LABELçš„ç±»å‹ä¿¡æ¯ã€‚è€Œä¸”è¦æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœæ›¿æ¢å¼ä¸­å­˜åœ¨è¿ç®—ç¬¦å·ï¼Œä»¥ç¬”è€…çš„ç»éªŒæœ€å¥½ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œä¸ç„¶å®¹æ˜“å‡ºç°é”™è¯¯ï¼ˆæœ‰ä½“ä¼šï¼‰ã€‚</p>
</blockquote>
<h4 id="ç±»å‹å¸¸é‡ï¼š"><a href="#ç±»å‹å¸¸é‡ï¼š" class="headerlink" title="ç±»å‹å¸¸é‡ï¼š"></a>ç±»å‹å¸¸é‡ï¼š</h4><p><code>static const NSTimeIntervalDuration = 0.3;</code></p>
<blockquote>
<p>è¿™é‡Œ:<br>const å°†å…¶è®¾ç½®ä¸ºå¸¸é‡ï¼Œä¸å¯æ›´æ”¹ã€‚<br>staticæ„å‘³ç€è¯¥å˜é‡ä»…ä»…åœ¨å®šä¹‰æ­¤å˜é‡çš„ç¼–è¯‘å•å…ƒä¸­å¯è§ã€‚å¦‚æœä¸å£°æ˜static,ç¼–è¯‘å™¨ä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¤–éƒ¨ç¬¦å·ï¼ˆexternal symbolï¼‰ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¯¹å¤–å…¬å¼€çš„å¸¸é‡çš„å£°æ˜æ–¹æ³•ï¼š</p>
</blockquote>
<h4 id="å¯¹å¤–å…¬å¼€æŸä¸ªå¸¸é‡ï¼š"><a href="#å¯¹å¤–å…¬å¼€æŸä¸ªå¸¸é‡ï¼š" class="headerlink" title="å¯¹å¤–å…¬å¼€æŸä¸ªå¸¸é‡ï¼š"></a>å¯¹å¤–å…¬å¼€æŸä¸ªå¸¸é‡ï¼š</h4><p>å¦‚æœæˆ‘ä»¬éœ€è¦å‘é€é€šçŸ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨ä¸åŒçš„åœ°æ–¹æ‹¿åˆ°é€šçŸ¥çš„â€œé¢‘é“â€å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæ˜¾ç„¶è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸èƒ½è¢«è½»æ˜“æ›´æ”¹ï¼Œè€Œä¸”å¯ä»¥åœ¨ä¸åŒçš„åœ°æ–¹è·å–ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦å®šä¹‰ä¸€ä¸ªå¤–ç•Œå¯è§çš„å­—ç¬¦ä¸²å¸¸é‡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//header file</span></div><div class="line"><span class="keyword">extern</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> NotificationString;</div><div class="line"><span class="comment">//implementation file</span></div><div class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span>  NotificationString = <span class="string">@"Finish Download"</span>;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡ŒNSString *const NotificationStringæ˜¯æŒ‡é’ˆå¸¸é‡ã€‚<br>externå…³é”®å­—å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œåœ¨å…¨å±€ç¬¦å·è¡¨ä¸­å°†ä¼šæœ‰ä¸€ä¸ªåå«NotificationStringçš„ç¬¦å·ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬é€šå¸¸åœ¨å¤´æ–‡ä»¶å£°æ˜å¸¸é‡ï¼Œåœ¨å…¶å®ç°æ–‡ä»¶é‡Œå®šä¹‰è¯¥å¸¸é‡ã€‚ç”±å®ç°æ–‡ä»¶ç”Ÿæˆç›®æ ‡æ–‡ä»¶æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨â€œæ•°æ®æ®µâ€ä¸ºå­—ç¬¦ä¸²åˆ†é…å­˜å‚¨ç©ºé—´ã€‚</p>
<p>æœ€åæ³¨æ„ä¸€ä¸‹å…¬å¼€å’Œéå…¬å¼€çš„å¸¸é‡çš„å‘½åè§„èŒƒï¼š</p>
<blockquote>
<p>å…¬å¼€çš„å¸¸é‡ï¼šå¸¸é‡çš„åå­—æœ€å¥½ç”¨ä¸ä¹‹ç›¸å…³çš„ç±»ååšå‰ç¼€ã€‚<br>éå…¬å¼€çš„å¸¸é‡ï¼šå±€é™äºæŸä¸ªç¼–è¯‘å•å…ƒï¼ˆtanslation unitï¼Œå®ç°æ–‡ä»¶ implementation fileï¼‰å†…ï¼Œåœ¨ç­¾ååŠ ä¸Šå­—æ¯kã€‚</p>
</blockquote>
<h1 id="ç¬¬5æ¡ï¼šç”¨æšä¸¾è¡¨ç¤ºçŠ¶æ€ï¼Œé€‰é¡¹ï¼ŒçŠ¶æ€ç "><a href="#ç¬¬5æ¡ï¼šç”¨æšä¸¾è¡¨ç¤ºçŠ¶æ€ï¼Œé€‰é¡¹ï¼ŒçŠ¶æ€ç " class="headerlink" title="ç¬¬5æ¡ï¼šç”¨æšä¸¾è¡¨ç¤ºçŠ¶æ€ï¼Œé€‰é¡¹ï¼ŒçŠ¶æ€ç "></a>ç¬¬5æ¡ï¼šç”¨æšä¸¾è¡¨ç¤ºçŠ¶æ€ï¼Œé€‰é¡¹ï¼ŒçŠ¶æ€ç </h1><hr>
<p>æˆ‘ä»¬ç»å¸¸éœ€è¦ç»™ç±»å®šä¹‰å‡ ä¸ªçŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€ç å¯ä»¥ç”¨æšä¸¾æ¥ç®¡ç†ã€‚ä¸‹é¢æ˜¯å…³äºç½‘ç»œè¿æ¥çŠ¶æ€çš„çŠ¶æ€ç æšä¸¾ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSUInteger</span>, EOCConnectionState) &#123;</div><div class="line">  EOCConnectionStateDisconnected,</div><div class="line">  EOCConnectionStateConnecting,</div><div class="line">  EOCConnectionStateConnected,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼š<br>åœ¨æšä¸¾ç±»å‹çš„switchè¯­å¥ä¸­ä¸è¦å®ç°defaultåˆ†æ”¯ã€‚å®ƒçš„å¥½å¤„æ˜¯ï¼Œå½“æˆ‘ä»¬ç»™æšä¸¾å¢åŠ æˆå‘˜æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šæç¤ºå¼€å‘è€…ï¼šswitchè¯­å¥å¹¶æœªå¤„ç†æ‰€æœ‰çš„æšä¸¾ã€‚å¯¹æ­¤ï¼Œç¬”è€…æœ‰ä¸ªæ•™è®­ï¼Œåˆä¸€æ¬¡åœ¨switchè¯­å¥ä¸­å°†â€œé»˜è®¤åˆ†æ”¯â€è®¾ç½®ä¸ºæšä¸¾ä¸­çš„ç¬¬ä¸€é¡¹ï¼Œè‡ªä»¥ä¸ºè¿™æ ·å†™å¯ä»¥è®©ç¨‹åºæ›´å¥å£®ï¼Œç»“æœåæ¥å¯¼è‡´äº†ä¸¥é‡çš„å´©æºƒã€‚</p>
<h1 id="ç¬¬7æ¡ï¼š-åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡"><a href="#ç¬¬7æ¡ï¼š-åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡" class="headerlink" title="ç¬¬7æ¡ï¼š åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡"></a>ç¬¬7æ¡ï¼š åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡</h1><hr>
<p>å…³äºå®ä¾‹å˜é‡çš„è®¿é—®ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å±æ€§çš„æ–¹å¼(ç‚¹è¯­æ³•)æ¥è®¿é—®ã€‚ä¹¦ä¸­ä½œè€…å»ºè®®åœ¨è¯»å–å®ä¾‹å˜é‡æ—¶é‡‡ç”¨ç›´æ¥è®¿é—®çš„å½¢å¼ï¼Œè€Œåœ¨è®¾ç½®å®ä¾‹å˜é‡çš„æ—¶å€™é€šè¿‡å±æ€§æ¥åšã€‚</p>
<h4 id="ç›´æ¥è®¿é—®å±æ€§çš„ç‰¹ç‚¹ï¼š"><a href="#ç›´æ¥è®¿é—®å±æ€§çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="ç›´æ¥è®¿é—®å±æ€§çš„ç‰¹ç‚¹ï¼š"></a>ç›´æ¥è®¿é—®å±æ€§çš„ç‰¹ç‚¹ï¼š</h4><ul>
<li>ç»•è¿‡setï¼Œgetè¯­ä¹‰ï¼Œé€Ÿåº¦å¿«ï¼›</li>
</ul>
<h4 id="é€šè¿‡å±æ€§è®¿é—®å±æ€§çš„ç‰¹ç‚¹ï¼š"><a href="#é€šè¿‡å±æ€§è®¿é—®å±æ€§çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="é€šè¿‡å±æ€§è®¿é—®å±æ€§çš„ç‰¹ç‚¹ï¼š"></a>é€šè¿‡å±æ€§è®¿é—®å±æ€§çš„ç‰¹ç‚¹ï¼š</h4><ul>
<li>ä¸ä¼šç»•è¿‡å±æ€§å®šä¹‰çš„å†…å­˜ç®¡ç†è¯­ä¹‰</li>
<li>æœ‰åŠ©äºæ‰“æ–­ç‚¹æ’æŸ¥é”™è¯¯</li>
<li>å¯ä»¥è§¦å‘KVO</li>
</ul>
<p>å› æ­¤ï¼Œæœ‰ä¸ªå…³äºæŠ˜ä¸­çš„æ–¹æ¡ˆï¼š</p>
<blockquote>
<p>è®¾ç½®å±æ€§ï¼šé€šè¿‡å±æ€§<br>è¯»å–å±æ€§ï¼šç›´æ¥è®¿é—®</p>
</blockquote>
<p>ä¸è¿‡æœ‰ä¸¤ä¸ªç‰¹ä¾‹ï¼š</p>
<ol>
<li>åˆå§‹åŒ–æ–¹æ³•å’Œdeallocæ–¹æ³•ä¸­ï¼Œéœ€è¦ç›´æ¥è®¿é—®å®ä¾‹å˜é‡æ¥è¿›è¡Œè®¾ç½®å±æ€§æ“ä½œã€‚å› ä¸ºå¦‚æœåœ¨è¿™é‡Œæ²¡æœ‰ç»•è¿‡setæ–¹æ³•ï¼Œå°±æœ‰å¯èƒ½è§¦å‘å…¶ä»–ä¸å¿…è¦çš„æ“ä½œã€‚</li>
<li>æƒ°æ€§åˆå§‹åŒ–ï¼ˆlazy initializationï¼‰çš„å±æ€§ï¼Œå¿…é¡»é€šè¿‡å±æ€§æ¥è¯»å–æ•°æ®ã€‚å› ä¸ºæƒ°æ€§åˆå§‹åŒ–æ˜¯é€šè¿‡é‡å†™getæ–¹æ³•æ¥åˆå§‹åŒ–å®ä¾‹å˜é‡çš„ï¼Œå¦‚æœä¸é€šè¿‡å±æ€§æ¥è¯»å–è¯¥å®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå®ä¾‹å˜é‡å°±æ°¸è¿œä¸ä¼šè¢«åˆå§‹åŒ–ã€‚</li>
</ol>
<h1 id="ç¬¬15æ¡ï¼šç”¨å‰ç¼€-é¿å…å‘½åç©ºé—´å†²çª"><a href="#ç¬¬15æ¡ï¼šç”¨å‰ç¼€-é¿å…å‘½åç©ºé—´å†²çª" class="headerlink" title="ç¬¬15æ¡ï¼šç”¨å‰ç¼€ é¿å…å‘½åç©ºé—´å†²çª"></a>ç¬¬15æ¡ï¼šç”¨å‰ç¼€ é¿å…å‘½åç©ºé—´å†²çª</h1><hr>
<p>Appleå®£ç§°å…¶ä¿ç•™ä½¿ç”¨æ‰€æœ‰â€ä¸¤å­—æ¯å‰ç¼€â€çš„æƒåˆ©ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰ç”¨çš„å‰ç¼€åº”è¯¥æ˜¯ä¸‰ä¸ªå­—æ¯çš„ã€‚<br>è€Œä¸”ï¼Œå¦‚æœè‡ªå·±å¼€å‘çš„ç¨‹åºä½¿ç”¨åˆ°äº†ç¬¬ä¸‰æ–¹åº“ï¼Œä¹Ÿåº”è¯¥åŠ ä¸Šå‰ç¼€ã€‚</p>
<h1 id="ç¬¬18æ¡ï¼šå°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡"><a href="#ç¬¬18æ¡ï¼šå°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡" class="headerlink" title="ç¬¬18æ¡ï¼šå°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡"></a>ç¬¬18æ¡ï¼šå°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡</h1><hr>
<p>ä¹¦ä¸­ä½œè€…å»ºè®®å°½é‡æŠŠå¯¹å¤–å…¬å¸ƒå‡ºæ¥çš„å±æ€§è®¾ç½®ä¸ºåªè¯»ï¼Œåœ¨å®ç°æ–‡ä»¶å†…éƒ¨è®¾ä¸ºè¯»å†™ã€‚å…·ä½“åšæ³•æ˜¯ï¼š</p>
<p>åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œè®¾ç½®å¯¹è±¡å±æ€§ä¸º<code>readonly</code>ï¼Œåœ¨å®ç°æ–‡ä»¶ä¸­è®¾ç½®ä¸º<code>readwrite</code>ã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨å¤–éƒ¨å°±åªèƒ½è¯»å–è¯¥æ•°æ®ï¼Œè€Œä¸èƒ½ä¿®æ”¹å®ƒï¼Œä½¿å¾—è¿™ä¸ªç±»çš„å®ä¾‹æ‰€æŒæœ‰çš„æ•°æ®æ›´åŠ å®‰å…¨ã€‚</p>
<p>è€Œä¸”ï¼Œå¯¹äºé›†åˆç±»çš„å¯¹è±¡ï¼Œæ›´åº”è¯¥ä»”ç»†è€ƒè™‘æ˜¯å¦å¯ä»¥å°†å…¶è®¾ä¸ºå¯å˜çš„ã€‚</p>
<p>å¦‚æœåœ¨å…¬å¼€éƒ¨åˆ†åªèƒ½è®¾ç½®å…¶ä¸ºåªè¯»å±æ€§ï¼Œé‚£ä¹ˆå°±åœ¨éå…¬å¼€éƒ¨åˆ†å­˜å‚¨ä¸€ä¸ªå¯å˜å‹ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“åœ¨å¤–éƒ¨è·å–è¿™ä¸ªå±æ€§æ—¶ï¼Œè·å–çš„åªæ˜¯å†…éƒ¨å¯å˜å‹çš„ä¸€ä¸ªä¸å¯å˜ç‰ˆæœ¬,ä¾‹å¦‚ï¼š</p>
<p>åœ¨å…¬å…±APIä¸­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *firstName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *lastName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSSet</span> *friends <span class="comment">//å‘å¤–å…¬å¼€çš„ä¸å¯å˜é›†åˆ</span></div><div class="line">- (<span class="keyword">id</span>)initWithFirstName:(<span class="built_in">NSString</span>*)firstName andLastName:(<span class="built_in">NSString</span>*)lastName;</div><div class="line">- (<span class="keyword">void</span>)addFriend:(EOCPerson*)person;</div><div class="line">- (<span class="keyword">void</span>)removeFriend:(EOCPerson*)person;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†friendså±æ€§è®¾ç½®ä¸ºä¸å¯å˜çš„setã€‚ç„¶åï¼Œæä¾›äº†æ¥å¢åŠ å’Œåˆ é™¤è¿™ä¸ªseté‡Œçš„å…ƒç´ çš„å…¬å…±æ¥å£ã€‚</p>
</blockquote>
<p>åœ¨å®ç°æ–‡ä»¶é‡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> ()</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readwrite</span>) <span class="built_in">NSString</span> *firstName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readwrite</span>) <span class="built_in">NSString</span> *lastName;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCPerson</span> </span>&#123;</div><div class="line">     <span class="built_in">NSMutableSet</span> *_internalFriends;  <span class="comment">//å®ç°æ–‡ä»¶é‡Œçš„å¯å˜é›†åˆ</span></div><div class="line">&#125;</div><div class="line">- (<span class="built_in">NSSet</span>*)friends &#123;</div><div class="line">     <span class="keyword">return</span> [_internalFriends <span class="keyword">copy</span>]; <span class="comment">//getæ–¹æ³•è¿”å›çš„æ°¸è¿œæ˜¯å¯å˜setçš„ä¸å¯å˜å‹</span></div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)addFriend:(EOCPerson*)person &#123;</div><div class="line">    [_internalFriends addObject:person]; <span class="comment">//åœ¨å¤–éƒ¨å¢åŠ é›†åˆå…ƒç´ çš„æ“ä½œ</span></div><div class="line">    <span class="comment">//do something when add element</span></div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)removeFriend:(EOCPerson*)person &#123;</div><div class="line">    [_internalFriends removeObject:person]; <span class="comment">//åœ¨å¤–éƒ¨ç§»é™¤å…ƒç´ çš„æ“ä½œ</span></div><div class="line">    <span class="comment">//do something when remove element</span></div><div class="line">&#125;</div><div class="line">- (<span class="keyword">id</span>)initWithFirstName:(<span class="built_in">NSString</span>*)firstName andLastName:(<span class="built_in">NSString</span>*)lastName &#123;</div><div class="line">     <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">        _firstName = firstName;</div><div class="line">        _lastName = lastName;</div><div class="line">        _internalFriends = [<span class="built_in">NSMutableSet</span> new];</div><div class="line">    &#125;</div><div class="line"> <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®ç°æ–‡ä»¶é‡Œï¼Œä¿å­˜ä¸€ä¸ªå¯å˜setæ¥è®°å½•å¤–éƒ¨çš„å¢åˆ æ“ä½œã€‚</p>
<p>è¿™é‡Œæœ€é‡è¦çš„ä»£ç æ˜¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSSet</span>*)friends &#123;</div><div class="line"> <span class="keyword">return</span> [_internalFriends <span class="keyword">copy</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªæ˜¯friendså±æ€§çš„è·å–æ–¹æ³•ï¼šå®ƒå°†å½“å‰ä¿å­˜çš„å¯å˜setå¤åˆ¶äº†ä¸€ä¸å¯å˜çš„setå¹¶è¿”å›ã€‚å› æ­¤ï¼Œå¤–éƒ¨è¯»å–åˆ°çš„setéƒ½å°†æ˜¯ä¸å¯å˜çš„ç‰ˆæœ¬ã€‚</p>
</blockquote>
<h4 id="ç­‰ä¸€ä¸‹ï¼Œæœ‰ä¸ªç–‘é—®ï¼šåœ¨å…¬å…±æ¥å£è®¾ç½®ä¸å¯å˜set-å’Œ-å°†å¢åˆ çš„ä»£ç æ”¾åœ¨å…¬å…±æ¥å£ä¸­æ˜¯å¦çŸ›ç›¾çš„ï¼Ÿ"><a href="#ç­‰ä¸€ä¸‹ï¼Œæœ‰ä¸ªç–‘é—®ï¼šåœ¨å…¬å…±æ¥å£è®¾ç½®ä¸å¯å˜set-å’Œ-å°†å¢åˆ çš„ä»£ç æ”¾åœ¨å…¬å…±æ¥å£ä¸­æ˜¯å¦çŸ›ç›¾çš„ï¼Ÿ" class="headerlink" title="ç­‰ä¸€ä¸‹ï¼Œæœ‰ä¸ªç–‘é—®ï¼šåœ¨å…¬å…±æ¥å£è®¾ç½®ä¸å¯å˜set å’Œ å°†å¢åˆ çš„ä»£ç æ”¾åœ¨å…¬å…±æ¥å£ä¸­æ˜¯å¦çŸ›ç›¾çš„ï¼Ÿ"></a>ç­‰ä¸€ä¸‹ï¼Œæœ‰ä¸ªç–‘é—®ï¼šåœ¨å…¬å…±æ¥å£è®¾ç½®ä¸å¯å˜set å’Œ å°†å¢åˆ çš„ä»£ç æ”¾åœ¨å…¬å…±æ¥å£ä¸­æ˜¯å¦çŸ›ç›¾çš„ï¼Ÿ</h4><h4 id="ç­”æ¡ˆï¼šå¹¶ä¸çŸ›ç›¾"><a href="#ç­”æ¡ˆï¼šå¹¶ä¸çŸ›ç›¾" class="headerlink" title="ç­”æ¡ˆï¼šå¹¶ä¸çŸ›ç›¾!"></a>ç­”æ¡ˆï¼š<strong>å¹¶ä¸çŸ›ç›¾!</strong></h4><p>å› ä¸ºå¦‚æœå°†friendså±æ€§è®¾ç½®ä¸ºå¯å˜çš„ï¼Œé‚£ä¹ˆå¤–éƒ¨å°±å¯ä»¥éšä¾¿æ›´æ”¹seté›†åˆé‡Œçš„æ•°æ®ï¼Œè¿™é‡Œçš„æ›´æ”¹ï¼Œä»…ä»…æ˜¯åº•å±‚æ•°æ®çš„æ›´æ”¹ï¼Œå¹¶ä¸ä¼´éšå…¶ä»–ä»»ä½•æ“ä½œã€‚<br>ç„¶è€Œæœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ›´æ”¹setæ•°æ®çš„åŒæ—¶<strong>è¦æ‰§è¡Œéšç§˜åœ¨å®ç°æ–‡ä»¶é‡Œçš„å…¶ä»–å·¥ä½œ</strong>ï¼Œé‚£ä¹ˆå¦‚æœåœ¨å¤–éƒ¨éšæ„æ›´æ”¹è¿™ä¸ªå±æ€§çš„è¯ï¼Œæ˜¾ç„¶æ˜¯è¾¾ä¸åˆ°è¿™ç§éœ€æ±‚çš„ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ç»™å¤–ç•Œ<strong>æˆ‘ä»¬å®šåˆ¶çš„</strong>å¢åˆ çš„æ–¹æ³•ï¼Œå¹¶ä¸è®©å¤–éƒ¨â€è‡ªè¡Œâ€œå¢åˆ ã€‚</p>
<h1 id="ç¬¬19æ¡ï¼šä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼"><a href="#ç¬¬19æ¡ï¼šä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼" class="headerlink" title="ç¬¬19æ¡ï¼šä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼"></a>ç¬¬19æ¡ï¼šä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼</h1><hr>
<p>åœ¨ç»™OCçš„æ–¹æ³•å–åå­—çš„æ—¶å€™è¦å……åˆ†åˆ©ç”¨OCæ–¹æ³•çš„å‘½åä¼˜åŠ¿ï¼Œå–ä¸€ä¸ª<strong>è¯­ä¹‰æ¸…æ™°</strong>çš„æ–¹æ³•åï¼ä»€ä¹ˆå«è¯­ä¹‰æ¸…æ™°å‘¢?å°±æ˜¯è¯´è¯»èµ·æ¥åƒæ˜¯ä¸€å¥è¯ä¸€æ ·ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>å…ˆçœ‹åå­—å–å¾—ä¸å¥½çš„ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ–¹æ³•å®šä¹‰</span></div><div class="line">- (<span class="keyword">id</span>)initWithSize:(<span class="keyword">float</span>)width :(<span class="keyword">float</span>)height;</div><div class="line"><span class="comment">//æ–¹æ³•è°ƒç”¨</span></div><div class="line">EOCRectangle *aRectangle =[[EOCRectangle alloc] initWithSize:<span class="number">5.0</span>f :<span class="number">10.0</span>f];</div></pre></td></tr></table></figure></p>
<blockquote>
<p>è¿™é‡Œå®šä¹‰äº†Rectangleçš„åˆå§‹åŒ–æ–¹æ³•ã€‚è™½ç„¶ç›´è§‚ä¸Šå¯ä»¥çŸ¥é“è¿™ä¸ªæ–¹æ³•é€šè¿‡ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°æ¥ç»„æˆçŸ©å½¢çš„sizeï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“å“ªä¸ªæ˜¯çŸ©å½¢çš„å®½ï¼Œå“ªä¸ªæ˜¯çŸ©å½¢çš„é«˜ã€‚<br>æ¥çœ‹ä¸€ä¸‹æ­£ç¡®çš„ğŸŒ° ï¼š</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ–¹æ³•å®šä¹‰</span></div><div class="line">- (<span class="keyword">id</span>)initWithWidth:(<span class="keyword">float</span>)width andHeight:(<span class="keyword">float</span>)height;</div><div class="line"><span class="comment">//æ–¹æ³•è°ƒç”¨</span></div><div class="line">EOCRectangle *aRectangle =[[EOCRectangle alloc] initWithWidth:<span class="number">5.0</span>f andHeight:<span class="number">10.0</span>f];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªæ–¹æ³•åå°±å¾ˆå¥½çš„è¯ é‡Šäº†è¯¥æ–¹æ³•çš„æ„å›¾ï¼šè¿™ä¸ªç±»çš„åˆå§‹åŒ–æ˜¯éœ€è¦å®½åº¦å’Œé«˜åº¦çš„ã€‚è€Œä¸”ï¼Œå“ªä¸ªå‚æ•°æ˜¯é«˜åº¦ï¼Œå“ªä¸ªå‚æ•°æ˜¯å®½åº¦ï¼Œçœ‹å¾—äººä¸€æ¸…äºŒæ¥šã€‚æ°¸è¿œè¦è®°å¾—ï¼š<strong>ä»£ç æ˜¯ç»™äººçœ‹çš„</strong>ã€‚</p>
</blockquote>
<p>ç¬”è€…è‡ªå·±æ€»ç»“çš„æ–¹æ³•å‘½åè§„åˆ™ï¼š</p>
<blockquote>
<p>æ¯ä¸ªå†’å·å·¦è¾¹çš„æ–¹æ³•éƒ¨åˆ†æœ€å¥½ä¸å³è¾¹çš„å‚æ•°åä¸€è‡´ã€‚</p>
</blockquote>
<p>å¯¹äºè¿”å›å€¼æ˜¯å¸ƒå°”å€¼çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ³¨æ„å‘½åçš„è§„èŒƒï¼š</p>
<ul>
<li>è·å–â€æ˜¯å¦â€œçš„å¸ƒå°”å€¼ï¼Œåº”è¯¥å¢åŠ â€œisâ€å‰ç¼€ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- hasPrefix:</div></pre></td></tr></table></figure>
<p>è·å–â€œæ˜¯å¦æœ‰â€çš„å¸ƒå°”å€¼ï¼Œåº”è¯¥å¢åŠ â€œhasâ€å‰ç¼€ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- isEqualToString:</div></pre></td></tr></table></figure>
<h1 id="ç¬¬20æ¡ï¼šä¸ºç§æœ‰æ–¹æ³•ååŠ å‰ç¼€"><a href="#ç¬¬20æ¡ï¼šä¸ºç§æœ‰æ–¹æ³•ååŠ å‰ç¼€" class="headerlink" title="ç¬¬20æ¡ï¼šä¸ºç§æœ‰æ–¹æ³•ååŠ å‰ç¼€"></a>ç¬¬20æ¡ï¼šä¸ºç§æœ‰æ–¹æ³•ååŠ å‰ç¼€</h1><hr>
<p>å»ºè®®åœ¨å®ç°æ–‡ä»¶é‡Œå°†éå…¬å¼€çš„æ–¹æ³•éƒ½åŠ ä¸Šå‰ç¼€ï¼Œä¾¿äºè°ƒè¯•ï¼Œè€Œä¸”è¿™æ ·ä¸€æ¥ä¹Ÿå¾ˆå®¹æ˜“åŒºåˆ†å“ªäº›æ˜¯å…¬å…±æ–¹æ³•ï¼Œå“ªäº›æ˜¯ç§æœ‰æ–¹æ³•ã€‚å› ä¸ºå¾€å¾€å…¬å…±æ–¹æ³•æ˜¯ä¸ä¾¿äºä»»æ„ä¿®æ”¹çš„ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œä½œè€…ä¸¾äº†ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCObject</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="keyword">void</span>)publicMethod;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCObject</span></span></div><div class="line">- (<span class="keyword">void</span>)publicMethod &#123;</div><div class="line"> <span class="comment">/* ... */</span></div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)p_privateMethod &#123;</div><div class="line"> <span class="comment">/* ... */</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<br>ä¸è¦ç”¨ä¸‹åˆ’çº¿æ¥åŒºåˆ†ç§æœ‰æ–¹æ³•å’Œå…¬å…±æ–¹æ³•ï¼Œå› ä¸ºä¼šå’Œè‹¹æœå…¬å¸çš„APIé‡å¤ã€‚</p>
</blockquote>
<h1 id="ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡"><a href="#ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡" class="headerlink" title="ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡"></a>ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡</h1><hr>
<p>å¦‚æœç»™å§”æ‰˜å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¿…é¡»æå‰åˆ¤æ–­è¯¥å§”æ‰˜å¯¹è±¡æ˜¯å¦å®ç°äº†è¯¥æ¶ˆæ¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSData</span> *data = <span class="comment">/* data obtained from network */</span>;</div><div class="line"><span class="keyword">if</span> ([_delegate respondsToSelector: <span class="keyword">@selector</span>(networkFetcher:didReceiveData:)])</div><div class="line">&#123;</div><div class="line">        [_delegate networkFetcher:<span class="keyword">self</span> didReceiveData:data];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è€Œä¸”ï¼Œæœ€å¥½å†åŠ ä¸Šä¸€ä¸ªåˆ¤æ–­ï¼šåˆ¤æ–­å§”æ‰˜å¯¹è±¡æ˜¯å¦å­˜åœ¨<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSData</span> *data = <span class="comment">/* data obtained from network */</span>;</div><div class="line"><span class="keyword">if</span> ( (_delegate) &amp;&amp; ([_delegate respondsToSelector: <span class="keyword">@selector</span>(networkFetcher:didReceiveData:)]))</div><div class="line">&#123;</div><div class="line">        [_delegate networkFetcher:<span class="keyword">self</span> didReceiveData:data];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯¹äºä»£ç†æ¨¡å¼ï¼Œåœ¨iOSä¸­åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>æ™®é€šçš„å§”æ‰˜æ¨¡å¼:ä¿¡æ¯ä»ç±»æµå‘å§”æ‰˜è€…</li>
<li>ä¿¡æ¯æºæ¨¡å¼:ä¿¡æ¯ä»æ•°æ®æºæµå‘ç±»</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-d9349b44ab6fba52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ™®é€šçš„å§”æ‰˜ | ä¿¡æ¯æº"></p>
<blockquote>
<p>å°±å¥½æ¯”tableviewå‘Šè¯‰å®ƒçš„ä»£ç†ï¼ˆdelegateï¼‰â€œæˆ‘è¢«ç‚¹å‡»äº†â€ï¼›è€Œå®ƒçš„æ•°æ®æºï¼ˆdata Sourceï¼‰å‘Šè¯‰å®ƒâ€œä½ æœ‰è¿™äº›æ•°æ®â€ã€‚ä»”ç»†å›å‘³ä¸€ä¸‹ï¼Œè¿™ä¸¤ä¸ªä¿¡æ¯çš„ä¼ é€’æ–¹å‘æ˜¯ç›¸åçš„ã€‚</p>
</blockquote>
<h1 id="ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¸­"><a href="#ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¸­" class="headerlink" title="ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¸­"></a>ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¸­</h1><hr>
<p>é€šå¸¸ä¸€ä¸ªç±»ä¼šæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œè€Œè¿™äº›æ–¹æ³•å¾€å¾€å¯ä»¥ç”¨æŸç§ç‰¹æœ‰çš„é€»è¾‘æ¥åˆ†ç»„ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨OCçš„åˆ†ç±»æœºåˆ¶ï¼Œå°†ç±»çš„è¿™äº›æ–¹æ³•æŒ‰ä¸€å®šçš„é€»è¾‘åˆ’å…¥å‡ ä¸ªåˆ†åŒºä¸­ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<p>æ— åˆ†ç±»çš„ç±»ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *firstName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *lastName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span> *friends;</div><div class="line">- (<span class="keyword">id</span>)initWithFirstName:(<span class="built_in">NSString</span>*)firstName andLastName:(<span class="built_in">NSString</span>*)lastName;</div><div class="line"><span class="comment">/* Friendship methods */</span></div><div class="line">- (<span class="keyword">void</span>)addFriend:(EOCPerson*)person;</div><div class="line">- (<span class="keyword">void</span>)removeFriend:(EOCPerson*)person;</div><div class="line">- (<span class="built_in">BOOL</span>)isFriendsWith:(EOCPerson*)person;</div><div class="line"><span class="comment">/* Work methods */</span></div><div class="line">- (<span class="keyword">void</span>)performDaysWork;</div><div class="line">- (<span class="keyword">void</span>)takeVacationFromWork;</div><div class="line"><span class="comment">/* Play methods */</span></div><div class="line">- (<span class="keyword">void</span>)goToTheCinema;</div><div class="line">- (<span class="keyword">void</span>)goToSportsGame;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>åˆ†ç±»ä¹‹åï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *firstName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *lastName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span> *friends;</div><div class="line">- (<span class="keyword">id</span>)initWithFirstName:(<span class="built_in">NSString</span>*)firstName</div><div class="line">andLastName:(<span class="built_in">NSString</span>*)lastName;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> (<span class="title">Friendship</span>)</span></div><div class="line">- (<span class="keyword">void</span>)addFriend:(EOCPerson*)person;</div><div class="line">- (<span class="keyword">void</span>)removeFriend:(EOCPerson*)person;</div><div class="line">- (<span class="built_in">BOOL</span>)isFriendsWith:(EOCPerson*)person;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> (<span class="title">Work</span>)</span></div><div class="line">- (<span class="keyword">void</span>)performDaysWork;</div><div class="line">- (<span class="keyword">void</span>)takeVacationFromWork;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> (<span class="title">Play</span>)</span></div><div class="line">- (<span class="keyword">void</span>)goToTheCinema;</div><div class="line">- (<span class="keyword">void</span>)goToSportsGame;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼ŒFriendShipåˆ†ç±»çš„å®ç°ä»£ç å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// EOCPerson+Friendship.h</span></div><div class="line"><span class="meta">#import <span class="meta-string">"EOCPerson.h"</span></span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> (<span class="title">Friendship</span>)</span></div><div class="line">- (<span class="keyword">void</span>)addFriend:(EOCPerson*)person;</div><div class="line">- (<span class="keyword">void</span>)removeFriend:(EOCPerson*)person;</div><div class="line">- (<span class="built_in">BOOL</span>)isFriendsWith:(EOCPerson*)person;</div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="comment">// EOCPerson+Friendship.m</span></div><div class="line"><span class="meta">#import <span class="meta-string">"EOCPerson+Friendship.h"</span></span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCPerson</span> (<span class="title">Friendship</span>)</span></div><div class="line">- (<span class="keyword">void</span>)addFriend:(EOCPerson*)person &#123;</div><div class="line"> <span class="comment">/* ... */</span></div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)removeFriend:(EOCPerson*)person &#123;</div><div class="line"> <span class="comment">/* ... */</span></div><div class="line">&#125;</div><div class="line">- (<span class="built_in">BOOL</span>)isFriendsWith:(EOCPerson*)person &#123;</div><div class="line"> <span class="comment">/* ... */</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨æ–°å»ºåˆ†ç±»æ–‡ä»¶æ—¶ï¼Œä¸€å®šè¦å¼•å…¥è¢«åˆ†ç±»çš„ç±»æ–‡ä»¶ã€‚</p>
</blockquote>
<p>é€šè¿‡åˆ†ç±»æœºåˆ¶ï¼Œå¯ä»¥æŠŠç±»ä»£ç åˆ†æˆå¾ˆå¤šä¸ªæ˜“äºç®¡ç†çš„åŠŸèƒ½åŒºï¼ŒåŒæ—¶ä¹Ÿä¾¿äºè°ƒè¯•ã€‚å› ä¸ºåˆ†ç±»çš„æ–¹æ³•åç§°ä¼šåŒ…å«åˆ†ç±»çš„åç§°ï¼Œå¯ä»¥é©¬ä¸Šçœ‹åˆ°è¯¥æ–¹æ³•å±äºå“ªä¸ªåˆ†ç±»ä¸­ã€‚</p>
<p>åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºåä¸ºPrivateçš„åˆ†ç±»ï¼Œå°†æ‰€æœ‰ç§æœ‰æ–¹æ³•éƒ½æ”¾åœ¨è¯¥ç±»é‡Œã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®privateä¸€è¯çš„å‡ºç°ä½ç½®æ¥åˆ¤æ–­è°ƒç”¨çš„åˆç†æ€§ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ç¼–å†™â€œè‡ªæˆ‘æè¿°å¼ä»£ç ï¼ˆself-documentingï¼‰â€çš„åŠæ³•ã€‚</p>
<h1 id="ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€"><a href="#ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€" class="headerlink" title="ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€"></a>ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€</h1><hr>
<p>åˆ†ç±»æœºåˆ¶è™½ç„¶å¼ºå¤§ï¼Œä½†æ˜¯å¦‚æœåˆ†ç±»é‡Œçš„æ–¹æ³•ä¸åŸæ¥çš„æ–¹æ³•åç§°ä¸€è‡´ï¼Œé‚£ä¹ˆåˆ†ç±»çš„æ–¹æ³•å°±ä¼šè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•ï¼Œè€Œä¸”æ€»æ˜¯ä»¥æœ€åä¸€æ¬¡è¢«è¦†ç›–ä¸ºåŸºå‡†ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥ä»¥å‘½åç©ºé—´æ¥åŒºåˆ«å„ä¸ªåˆ†ç±»çš„åç§°ä¸å…¶ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚åœ¨OCé‡Œçš„åšæ³•å°±æ˜¯ç»™è¿™äº›æ–¹æ³•åŠ ä¸ŠæŸä¸ªå…±ç”¨çš„å‰ç¼€ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSString</span> (<span class="title">ABC_HTTP</span>)</span></div><div class="line"><span class="comment">// Encode a string with URL encoding</span></div><div class="line">- (<span class="built_in">NSString</span>*)abc_urlEncodedString;</div><div class="line"><span class="comment">// Decode a URL encoded string</span></div><div class="line">- (<span class="built_in">NSString</span>*)abc_urlDecodedString;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç»™ç¬¬ä¸‰æ–¹åº“æˆ–è€…iOSæ¡†æ¶é‡Œçš„ç±»æ·»åŠ åˆ†ç±»æ—¶ï¼Œæœ€å¥½å°†åˆ†ç±»åå’Œæ–¹æ³•ååŠ ä¸Šå‰ç¼€ã€‚</p>
<h1 id="ç¬¬26æ¡-å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§"><a href="#ç¬¬26æ¡-å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§" class="headerlink" title="ç¬¬26æ¡:å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§"></a>ç¬¬26æ¡:å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§</h1><hr>
<p>é™¤äº†å®ç°æ–‡ä»¶é‡Œçš„class-continuationåˆ†ç±»ä¸­å¯ä»¥å£°æ˜å±æ€§å¤–ï¼Œå…¶ä»–åˆ†ç±»æ— æ³•å‘ç±»ä¸­æ–°å¢å®ä¾‹å˜é‡ã€‚</p>
<p>å› æ­¤ï¼Œç±»æ‰€å°è£…çš„å…¨éƒ¨æ•°æ®éƒ½åº”è¯¥å®šä¹‰åœ¨ä¸»æ¥å£ä¸­ï¼Œè¿™é‡Œæ˜¯å”¯ä¸€èƒ½å¤Ÿå®šä¹‰å®ä¾‹å˜é‡çš„åœ°æ–¹ã€‚</p>
<p>å…³äºåˆ†ç±»ï¼Œéœ€è¦å¼ºè°ƒä¸€ç‚¹ï¼š</p>
<blockquote>
<p>åˆ†ç±»æœºåˆ¶ï¼Œç›®æ ‡åœ¨äºæ‰©å±•ç±»çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯å°è£…æ•°æ®ã€‚</p>
</blockquote>
<h2 id="ç¬¬27æ¡ï¼šä½¿ç”¨class-continuationåˆ†ç±»-éšè—å®ç°ç»†èŠ‚"><a href="#ç¬¬27æ¡ï¼šä½¿ç”¨class-continuationåˆ†ç±»-éšè—å®ç°ç»†èŠ‚" class="headerlink" title="#ç¬¬27æ¡ï¼šä½¿ç”¨class-continuationåˆ†ç±» éšè—å®ç°ç»†èŠ‚"></a>#ç¬¬27æ¡ï¼šä½¿ç”¨class-continuationåˆ†ç±» éšè—å®ç°ç»†èŠ‚</h2><p>é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦å‡å°‘åœ¨å…¬å…±æ¥å£ä¸­å‘å¤–æš´éœ²çš„éƒ¨åˆ†(åŒ…æ‹¬å±æ€§å’Œæ–¹æ³•)ï¼Œè€Œå› æ­¤å¸¦ç»™æˆ‘ä»¬çš„å±€é™æ€§å¯ä»¥åˆ©ç”¨class-continuationåˆ†ç±»çš„ç‰¹æ€§æ¥è¡¥å¿ï¼š</p>
<ul>
<li>å¯ä»¥åœ¨class-continuationåˆ†ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ã€‚</li>
<li>å¯ä»¥åœ¨class-continuationåˆ†ç±»ä¸­å°†å…¬å…±æ¥å£çš„åªè¯»å±æ€§è®¾ç½®ä¸ºè¯»å†™ã€‚</li>
<li>å¯ä»¥åœ¨class-continuationåˆ†ç±»ä¸­éµå¾ªåè®®ï¼Œä½¿å…¶ä¸ä¸ºäººçŸ¥ã€‚</li>
</ul>
<h1 id="ç¬¬31æ¡ï¼šåœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬"><a href="#ç¬¬31æ¡ï¼šåœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬" class="headerlink" title="ç¬¬31æ¡ï¼šåœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬"></a>ç¬¬31æ¡ï¼šåœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬</h1><hr>
<p>æ°¸è¿œä¸è¦è‡ªå·±è°ƒç”¨deallocæ–¹æ³•ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šåœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨å®ƒã€‚æ ¹æ®æ€§èƒ½éœ€æ±‚æˆ‘ä»¬æœ‰æ—¶éœ€è¦åœ¨deallocæ–¹æ³•ä¸­åšä¸€äº›æ“ä½œã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨deallocæ–¹æ³•é‡Œåšä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ul>
<li>é‡Šæ”¾å¯¹è±¡æ‰€æ‹¥æœ‰çš„æ‰€æœ‰å¼•ç”¨ï¼Œä¸è¿‡ARCä¼šè‡ªåŠ¨æ·»åŠ è¿™äº›é‡Šæ”¾ä»£ç ï¼Œå¯ä»¥ä¸å¿…æ“å¿ƒã€‚</li>
<li>è€Œä¸”å¯¹è±¡æ‹¥æœ‰çš„å…¶ä»–éOCå¯¹è±¡ä¹Ÿè¦é‡Šæ”¾ï¼ˆCoreFoundationå¯¹è±¡å°±å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼‰</li>
<li>é‡Šæ”¾åŸæ¥çš„è§‚æµ‹è¡Œä¸ºï¼šæ³¨é”€é€šçŸ¥ã€‚å¦‚æœæ²¡æœ‰åŠæ—¶æ³¨é”€ï¼Œå°±ä¼šå‘å…¶å‘é€é€šçŸ¥ï¼Œä½¿å¾—ç¨‹åºå´©æºƒã€‚</li>
</ul>
<p>ä¸¾ä¸ªç®€å•çš„ğŸŒ° ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)dealloc &#123;</div><div class="line"></div><div class="line">     <span class="built_in">CFRelease</span>(coreFoundationObject);</div><div class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>å°¤å…¶æ³¨æ„</strong>ï¼šåœ¨deallocæ–¹æ³•ä¸­ä¸åº”è¯¥è°ƒç”¨å…¶ä»–çš„æ–¹æ³•ï¼Œå› ä¸ºå¦‚æœè¿™äº›æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”å›è°ƒä¸­è¿˜è¦ä½¿ç”¨å½“å‰å¯¹è±¡ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å½“å‰å¯¹è±¡å·²ç»è¢«é‡Šæ”¾äº†ï¼Œä¼šå¯¼è‡´å´©æºƒã€‚</p>
<p>å¹¶ä¸”åœ¨deallocæ–¹æ³•ä¸­ä¹Ÿä¸èƒ½è°ƒç”¨å±æ€§çš„å­˜å–æ–¹æ³•ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½åœ¨è¿™äº›æ–¹æ³•é‡Œè¿˜æœ‰å…¶ä»–æ“ä½œã€‚è€Œä¸”è¿™ä¸ªå±æ€§è¿˜æœ‰å¯èƒ½å¤„äºé”®å€¼è§‚å¯ŸçŠ¶æ€ï¼Œè¯¥å±æ€§çš„è§‚å¯Ÿè€…å¯èƒ½ä¼šåœ¨å±æ€§æ”¹å˜æ—¶ä¿ç•™æˆ–è€…ä½¿ç”¨è¿™ä¸ªå³å°†å›æ”¶çš„å¯¹è±¡ã€‚</p>
</blockquote>
<h1 id="ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨retainCount"><a href="#ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨retainCount" class="headerlink" title="ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨retainCount"></a>ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨retainCount</h1><hr>
<p>åœ¨éARCå¾—ç¯å¢ƒä¸‹ä½¿ç”¨retainCountå¯ä»¥è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œä½†æ˜¯åœ¨ARCç¯å¢ƒä¸‹è°ƒç”¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºè¯¥æ–¹æ³•å·²ç»è¢«åºŸå¼ƒäº† ã€‚</p>
<p>å®ƒè¢«åºŸå¼ƒçš„åŸå› æ˜¯å› ä¸ºå®ƒæ‰€è¿”å›çš„å¼•ç”¨è®¡æ•°åªèƒ½åæ˜ å¯¹è±¡æŸä¸€æ—¶åˆ»çš„å¼•ç”¨è®¡æ•°ï¼Œè€Œæ— æ³•â€œé¢„çŸ¥â€å¯¹è±¡å°†æ¥å¼•ç”¨è®¡æ•°çš„å˜åŒ–ï¼ˆæ¯”å¦‚å¯¹è±¡å½“å‰å¤„äºè‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œé‚£ä¹ˆå°†æ¥å°±ä¼šè‡ªåŠ¨é€’å‡å¼•ç”¨è®¡æ•°ï¼‰ã€‚</p>
<h1 id="ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨dispatch-get-current-queue"><a href="#ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨dispatch-get-current-queue" class="headerlink" title="ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨dispatch_get_current_queue"></a>ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨dispatch_get_current_queue</h1><hr>
<p>æˆ‘ä»¬æ— æ³•ç”¨æŸä¸ªé˜Ÿåˆ—æ¥æè¿°â€œå½“å‰é˜Ÿåˆ—â€è¿™ä¸€å±æ€§ï¼Œå› ä¸ºæ´¾å‘é˜Ÿåˆ—æ˜¯æŒ‰ç…§å±‚çº§æ¥ç»„ç»‡çš„ã€‚</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯é˜Ÿåˆ—çš„å±‚çº§å‘¢?</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-e880be58b75c49c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é˜Ÿåˆ—çš„å±‚åŠåˆ†å¸ƒ"></p>
<p>å®‰æ’åœ¨æŸæ¡é˜Ÿåˆ—ä¸­çš„å¿«ï¼Œä¼šåœ¨å…¶ä¸Šå±‚é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œè€Œå±‚çº§åœ°ä½æœ€é«˜çš„é‚£ä¸ªé˜Ÿåˆ—æ€»æ˜¯å…¨å±€å¹¶å‘é˜Ÿåˆ—ã€‚</p>
<p>åœ¨è¿™é‡Œï¼ŒBï¼ŒCä¸­çš„å—ä¼šåœ¨Aé‡Œæ‰§è¡Œã€‚ä½†æ˜¯Dä¸­çš„å—ï¼Œå¯èƒ½ä¸Aé‡Œçš„å—å¹¶è¡Œï¼Œå› ä¸ºAå’ŒDçš„ç›®æ ‡é˜Ÿåˆ—æ˜¯å¹¶å‘é˜Ÿåˆ—ã€‚</p>
<p>æ­£å› ä¸ºæœ‰äº†è¿™ç§å±‚çº§å…³ç³»ï¼Œæ‰€ä»¥æ£€æŸ¥å½“å‰é˜Ÿåˆ—æ˜¯å¹¶å‘çš„è¿˜æ˜¯éå¹¶å‘çš„å°±ä¸ä¼šæ€»æ˜¯å¾ˆå‡†ç¡®ã€‚</p>
<h1 id="ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯"><a href="#ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯" class="headerlink" title="ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯"></a>ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯</h1><hr>
<p>å½“éå†é›†åˆå…ƒç´ æ—¶ï¼Œå»ºè®®ä½¿ç”¨å—æšä¸¾ï¼Œå› ä¸ºç›¸å¯¹äºä¼ ç»Ÿçš„forå¾ªç¯ï¼Œå®ƒæ›´åŠ é«˜æ•ˆï¼Œè€Œä¸”ç®€æ´,è¿˜èƒ½è·å–åˆ°ç”¨ä¼ ç»Ÿçš„forå¾ªç¯æ— æ³•æä¾›çš„å€¼ï¼š</p>
<p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ä¼ ç»Ÿçš„éå†ï¼š</p>
<h4 id="ä¼ ç»Ÿçš„foréå†"><a href="#ä¼ ç»Ÿçš„foréå†" class="headerlink" title="ä¼ ç»Ÿçš„foréå†"></a>ä¼ ç»Ÿçš„foréå†</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *anArray = <span class="comment">/* ... */</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; anArray.count; i++) &#123;</div><div class="line">   <span class="keyword">id</span> object = anArray[i];</div><div class="line">   <span class="comment">// Do something with 'object'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// Dictionary</span></div><div class="line"><span class="built_in">NSDictionary</span> *aDictionary = <span class="comment">/* ... */</span>;</div><div class="line"><span class="built_in">NSArray</span> *keys = [aDictionary allKeys];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; keys.count; i++) &#123;</div><div class="line">   <span class="keyword">id</span> key = keys[i];</div><div class="line">   <span class="keyword">id</span> value = aDictionary[key];</div><div class="line">   <span class="comment">// Do something with 'key' and 'value'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// Set</span></div><div class="line"><span class="built_in">NSSet</span> *aSet = <span class="comment">/* ... */</span>;</div><div class="line"><span class="built_in">NSArray</span> *objects = [aSet allObjects];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objects.count; i++) &#123;</div><div class="line">   <span class="keyword">id</span> object = objects[i];</div><div class="line">   <span class="comment">// Do something with 'object'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨éå†NSDictionary,å’ŒNSetæ—¶ï¼Œæˆ‘ä»¬åˆæ–°åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„ã€‚è™½ç„¶éå†çš„ç›®çš„è¾¾æˆäº†ï¼Œä½†æ˜¯å´åŠ å¤§äº†ç³»ç»Ÿçš„å¼€é”€ã€‚</p>
<h4 id="åˆ©ç”¨å¿«é€Ÿéå†ï¼š"><a href="#åˆ©ç”¨å¿«é€Ÿéå†ï¼š" class="headerlink" title="åˆ©ç”¨å¿«é€Ÿéå†ï¼š"></a>åˆ©ç”¨å¿«é€Ÿéå†ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *anArray = <span class="comment">/* ... */</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">id</span> object <span class="keyword">in</span> anArray) &#123;</div><div class="line"> <span class="comment">// Do something with 'object'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// Dictionary</span></div><div class="line"><span class="built_in">NSDictionary</span> *aDictionary = <span class="comment">/* ... */</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">id</span> key <span class="keyword">in</span> aDictionary) &#123;</div><div class="line"> <span class="keyword">id</span> value = aDictionary[key];</div><div class="line"> <span class="comment">// Do something with 'key' and 'value'</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">NSSet</span> *aSet = <span class="comment">/* ... */</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">id</span> object <span class="keyword">in</span> aSet) &#123;</div><div class="line"> <span class="comment">// Do something with 'object'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ç§å¿«é€Ÿéå†çš„æ–¹æ³•è¦æ¯”ä¼ ç»Ÿçš„éå†æ–¹æ³•æ›´åŠ ç®€æ´æ˜“æ‡‚ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯æ— æ³•æ–¹ä¾¿è·å–å…ƒç´ çš„ä¸‹æ ‡ã€‚</p>
<h4 id="åˆ©ç”¨åŸºäºå—ï¼ˆblockï¼‰çš„éå†ï¼š"><a href="#åˆ©ç”¨åŸºäºå—ï¼ˆblockï¼‰çš„éå†ï¼š" class="headerlink" title="åˆ©ç”¨åŸºäºå—ï¼ˆblockï¼‰çš„éå†ï¼š"></a>åˆ©ç”¨åŸºäºå—ï¼ˆblockï¼‰çš„éå†ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *anArray = <span class="comment">/* ... */</span>;</div><div class="line">[anArray enumerateObjectsUsingBlock:^(<span class="keyword">id</span> object, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> *stop)&#123;</div><div class="line">   <span class="comment">// Do something with 'object'</span></div><div class="line">   <span class="keyword">if</span> (shouldStop) &#123;</div><div class="line">      *stop = <span class="literal">YES</span>; <span class="comment">//ä½¿è¿­ä»£åœæ­¢</span></div><div class="line">  &#125;</div><div class="line">&#125;];</div><div class="line"><span class="comment">// Dictionary</span></div><div class="line"><span class="built_in">NSDictionary</span> *aDictionary = <span class="comment">/* ... */</span>;</div><div class="line">[aDictionary enumerateKeysAndObjectsUsingBlock:^(<span class="keyword">id</span> key, <span class="keyword">id</span> object, <span class="built_in">BOOL</span> *stop)&#123;</div><div class="line">     <span class="comment">// Do something with 'key' and 'object'</span></div><div class="line">     <span class="keyword">if</span> (shouldStop) &#123;</div><div class="line">        *stop = <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">&#125;];</div><div class="line"><span class="comment">// Set</span></div><div class="line"><span class="built_in">NSSet</span> *aSet = <span class="comment">/* ... */</span>;</div><div class="line">[aSet enumerateObjectsUsingBlock:^(<span class="keyword">id</span> object, <span class="built_in">BOOL</span> *stop)&#123;</div><div class="line">     <span class="comment">// Do something with 'object'</span></div><div class="line">     <span class="keyword">if</span> (shouldStop) &#123;</div><div class="line">        *stop = <span class="literal">YES</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨å—è¿›è¡Œå¿«é€Ÿæšä¸¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸åˆ›å»ºä¸´æ—¶æ•°ç»„ã€‚è™½ç„¶è¯­æ³•ä¸Šæ²¡æœ‰å¿«é€Ÿæšä¸¾ç®€æ´ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è·å¾—æ•°ç»„å…ƒç´ å¯¹åº”çš„åºå·ï¼Œå­—å…¸å…ƒç´ å¯¹åº”çš„é”®å€¼ï¼Œè€Œä¸”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥éšæ—¶ä»¤éå†ç»ˆæ­¢ã€‚</p>
<p>åˆ©ç”¨å¿«é€Ÿæšä¸¾å’Œå—çš„æšä¸¾è¿˜æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼šèƒ½å¤Ÿä¿®æ”¹å—çš„æ–¹æ³•ç­¾å</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> aDictionary) &#123;</div><div class="line">         <span class="built_in">NSString</span> *object = (<span class="built_in">NSString</span>*)aDictionary[key];</div><div class="line">        <span class="comment">// Do something with 'key' and 'object'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSDictionary</span> *aDictionary = <span class="comment">/* ... */</span>;</div><div class="line">    [aDictionary enumerateKeysAndObjectsUsingBlock:^(<span class="built_in">NSString</span> *key, <span class="built_in">NSString</span> *obj, <span class="built_in">BOOL</span> *stop)&#123;</div><div class="line">             <span class="comment">// Do something with 'key' and 'obj'</span></div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬å¯ä»¥çŸ¥é“é›†åˆé‡Œçš„å…ƒç´ ç±»å‹ï¼Œå°±å¯ä»¥ä¿®æ”¹ç­¾åã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šå¯ä»¥è®©ç¼–è¯‘æœŸæ£€æŸ¥è¯¥å…ƒç´ æ˜¯å¦å¯ä»¥å®ç°æˆ‘ä»¬æƒ³è°ƒç”¨çš„æ–¹æ³•ï¼Œå¦‚æœä¸èƒ½å®ç°ï¼Œå°±åšå¦å¤–çš„å¤„ç†ã€‚è¿™æ ·ä¸€æ¥ï¼Œç¨‹åºå°±èƒ½å˜å¾—æ›´åŠ å®‰å…¨ã€‚</p>
<h1 id="ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨NSCache-è€ŒéNSDictionary"><a href="#ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨NSCache-è€ŒéNSDictionary" class="headerlink" title="ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨NSCache è€ŒéNSDictionary"></a>ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨NSCache è€ŒéNSDictionary</h1><hr>
<p>å¦‚æœæˆ‘ä»¬ç¼“å­˜ä½¿ç”¨å¾—å½“ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦å°±ä¼šæé«˜ã€‚åªæœ‰é‚£ç§â€œé‡æ–°è®¡ç®—èµ·æ¥å¾ˆè´¹äº‹çš„æ•°æ®ï¼Œæ‰å€¼å¾—æ”¾å…¥ç¼“å­˜â€ï¼Œæ¯”å¦‚é‚£äº›éœ€è¦ä»ç½‘ç»œè·å–æˆ–ä»ç£ç›˜è¯»å–çš„æ•°æ®ã€‚</p>
<p>åœ¨æ„å»ºç¼“å­˜çš„æ—¶å€™å¾ˆå¤šäººä¹ æƒ¯ç”¨NSDictionaryæˆ–è€…NSMutableDictionaryï¼Œä½†æ˜¯ä½œè€…å»ºè®®å¤§å®¶ä½¿ç”¨NSCacheï¼Œå®ƒä½œä¸ºç®¡ç†ç¼“å­˜çš„ç±»ï¼Œæœ‰å¾ˆå¤šç‰¹ç‚¹è¦ä¼˜äºå­—å…¸ï¼Œå› ä¸ºå®ƒæœ¬æ¥å°±æ˜¯ä¸ºäº†ç®¡ç†ç¼“å­˜è€Œè®¾è®¡çš„ã€‚</p>
<h4 id="NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼š"><a href="#NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼š" class="headerlink" title="NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼š"></a>NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼š</h4><ul>
<li>å½“ç³»ç»Ÿèµ„æºå°†è¦è€—å°½æ—¶ï¼ŒNSCacheå…·å¤‡è‡ªåŠ¨åˆ å‡ç¼“å†²çš„åŠŸèƒ½ã€‚å¹¶ä¸”è¿˜ä¼šå…ˆåˆ å‡â€œæœ€ä¹…æœªä½¿ç”¨â€çš„å¯¹è±¡ã€‚</li>
<li>NSCacheä¸æ‹·è´é”®ï¼Œè€Œæ˜¯ä¿ç•™é”®ã€‚å› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„é”®éƒ½éµä»æ‹·è´åè®®ï¼ˆå­—å…¸çš„é”®æ˜¯å¿…é¡»è¦æ”¯æŒæ‹·è´åè®®çš„ï¼Œæœ‰å±€é™æ€§ï¼‰ã€‚</li>
<li>NSCacheæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼šä¸ç¼–å†™åŠ é”ä»£ç çš„å‰æä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®NSCacheã€‚</li>
</ul>
<h4 id="å…³äºæ“æ§NSCacheåˆ å‡å†…å®¹çš„æ—¶æœº"><a href="#å…³äºæ“æ§NSCacheåˆ å‡å†…å®¹çš„æ—¶æœº" class="headerlink" title="å…³äºæ“æ§NSCacheåˆ å‡å†…å®¹çš„æ—¶æœº"></a>å…³äºæ“æ§NSCacheåˆ å‡å†…å®¹çš„æ—¶æœº</h4><p>å¼€å‘è€…å¯ä»¥é€šè¿‡ä¸¤ä¸ªå°ºåº¦æ¥è°ƒæ•´è¿™ä¸ªæ—¶æœºï¼š</p>
<ul>
<li>ç¼“å­˜ä¸­çš„å¯¹è±¡æ€»æ•°.</li>
<li>å°†å¯¹è±¡åŠ å…¥ç¼“å­˜æ—¶ï¼Œä¸ºå…¶æŒ‡å®šå¼€é”€å€¼ã€‚</li>
</ul>
<p>å¯¹äºå¼€é”€å€¼ï¼Œåªæœ‰åœ¨èƒ½å¾ˆå¿«è®¡ç®—å‡ºå¼€é”€å€¼çš„æƒ…å†µä¸‹ï¼Œæ‰åº”è¯¥è€ƒè™‘é‡‡ç”¨è¿™ä¸ªå°ºåº¦ï¼Œä¸ç„¶åè€Œä¼šåŠ å¤§ç³»ç»Ÿçš„å¼€é”€ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç¼“å­˜çš„ç”¨æ³•ï¼šç¼“å­˜ç½‘ç»œä¸‹è½½çš„æ•°æ®</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Network fetcher class</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^EOCNetworkFetcherCompletionHandler)(<span class="built_in">NSData</span> *data);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCNetworkFetcher</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)initWithURL:(<span class="built_in">NSURL</span>*)url;</div><div class="line">- (<span class="keyword">void</span>)startWithCompletionHandler:(EOCNetworkFetcherCompletionHandler)handler;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="comment">// Class that uses the network fetcher and caches results</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCClass</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCClass</span> </span>&#123;</div><div class="line">     <span class="built_in">NSCache</span> *_cache;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)init &#123;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">    _cache = [<span class="built_in">NSCache</span> new];</div><div class="line"></div><div class="line">     <span class="comment">// Cache a maximum of 100 URLs</span></div><div class="line">    _cache.countLimit = <span class="number">100</span>;</div><div class="line"></div><div class="line"></div><div class="line">     <span class="comment">/**</span></div><div class="line">     * The size in bytes of data is used as the cost,</div><div class="line">     * so this sets a cost limit of 5MB.</div><div class="line">     */</div><div class="line">    _cache.totalCostLimit = <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>;</div><div class="line">    &#125;</div><div class="line"> <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)downloadDataForURL:(<span class="built_in">NSURL</span>*)url &#123; </div><div class="line"></div><div class="line">     <span class="built_in">NSData</span> *cachedData = [_cache objectForKey:url];</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (cachedData) &#123;</div><div class="line"></div><div class="line">         <span class="comment">// Cache hitï¼šå­˜åœ¨ç¼“å­˜ï¼Œè¯»å–</span></div><div class="line">        [<span class="keyword">self</span> useData:cachedData];</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">         <span class="comment">// Cache missï¼šæ²¡æœ‰ç¼“å­˜ï¼Œä¸‹è½½</span></div><div class="line">         EOCNetworkFetcher *fetcher = [[EOCNetworkFetcher alloc] initWithURL:url];      </div><div class="line"></div><div class="line">        [fetcher startWithCompletionHandler:^(<span class="built_in">NSData</span> *data)&#123;</div><div class="line">         [_cache setObject:data forKey:url cost:data.length];    </div><div class="line">        [<span class="keyword">self</span> useData:data];</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨URLä½œä¸ºç¼“å­˜çš„keyï¼Œå°†æ€»å¯¹è±¡æ•°ç›®è®¾ç½®ä¸º100ï¼Œå°†å¼€é”€å€¼è®¾ç½®ä¸º5MBã€‚</p>
<h2 id="NSPurgeableData"><a href="#NSPurgeableData" class="headerlink" title="NSPurgeableData"></a>NSPurgeableData</h2><p>NSPurgeableDataæ˜¯NSMutableDataçš„å­ç±»ï¼ŒæŠŠå®ƒå’ŒNSCacheé…åˆä½¿ç”¨æ•ˆæœå¾ˆå¥½ã€‚</p>
<p>å› ä¸ºå½“ç³»ç»Ÿèµ„æºç´§å¼ æ—¶ï¼Œå¯ä»¥æŠŠä¿å­˜NSPurgeableDataçš„é‚£å—å†…å­˜é‡Šæ”¾æ‰ã€‚</p>
<p>å¦‚æœéœ€è¦è®¿é—®æŸä¸ªNSPurgeableDataå¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨<code>beginContentAccess</code>æ–¹å‘ï¼Œå‘Šè¯‰å®ƒç°åœ¨è¿˜ä¸åº”è¯¥ä¸¢å¼ƒè‡ªå·±æ‰€å æ®çš„å†…å­˜ã€‚</p>
<p>åœ¨ä½¿ç”¨å®Œä¹‹åï¼Œè°ƒç”¨<code>endContentAccess</code>æ–¹æ³•ï¼Œå‘Šè¯‰ç³»ç»Ÿåœ¨å¿…è¦æ—¶å¯ä»¥ä¸¢å¼ƒè‡ªå·±æ‰€å æ®çš„å†…å­˜ã€‚</p>
<blockquote>
<p>ä¸Šé¢è¿™ä¸¤ä¸ªæ–¹æ³•ç±»ä¼¼äºâ€œå¼•ç”¨è®¡æ•°â€é€’å¢é€’å‡çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“â€œå¼•ç”¨è®¡æ•°â€ä¸º0çš„æ—¶å€™ï¼Œæ‰å¯ä»¥åœ¨å°†æ¥åˆ å»å®ƒæ‰€å çš„å†…å­˜ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">- (void)downloadDataForURL:(NSURL*)url &#123; </div><div class="line"></div><div class="line">      NSPurgeableData *cachedData = [_cache objectForKey:url];</div><div class="line"></div><div class="line">      if (cachedData) &#123;         </div><div class="line"></div><div class="line">            // å¦‚æœå­˜åœ¨ç¼“å­˜ï¼Œéœ€è¦è°ƒç”¨beginContentAccessæ–¹æ³•</div><div class="line">            [cacheData beginContentAccess];</div><div class="line"></div><div class="line">             // Use the cached data</div><div class="line">            [self useData:cachedData];</div><div class="line"></div><div class="line">             // ä½¿ç”¨åï¼Œè°ƒç”¨endContentAccess</div><div class="line">            [cacheData endContentAccess];</div><div class="line"></div><div class="line"></div><div class="line">        &#125; else &#123;</div><div class="line"></div><div class="line">                 //æ²¡æœ‰ç¼“å­˜</div><div class="line">                 EOCNetworkFetcher *fetcher = [[EOCNetworkFetcher alloc] initWithURL:url];    </div><div class="line"></div><div class="line">                  [fetcher startWithCompletionHandler:^(NSData *data)&#123;</div><div class="line"></div><div class="line">                         NSPurgeableData *purgeableData = [NSPurgeableData dataWithData:data];</div><div class="line">                         [_cache setObject:purgeableData forKey:url cost:purgeableData.length];</div><div class="line"></div><div class="line">                          // Don&apos;t need to beginContentAccess as it begins            </div><div class="line">                          // with access already marked</div><div class="line">                           // Use the retrieved data</div><div class="line">                            [self useData:data];</div><div class="line"></div><div class="line">                             // Mark that the data may be purged now</div><div class="line">                            [purgeableData endContentAccess];</div><div class="line"></div><div class="line">            &#125;];</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼š</p>
</blockquote>
<p>åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿åˆ°purgeableDataçš„æƒ…å†µä¸‹éœ€è¦æ‰§è¡Œ<code>beginContentAccess</code>æ–¹æ³•ã€‚ç„¶è€Œï¼Œåœ¨åˆ›å»ºpurgeableDataçš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸éœ€è¦æ‰§è¡ŒbeginContentAccessï¼Œå› ä¸ºåœ¨åˆ›å»ºäº†purgeableDataä¹‹åï¼Œå…¶å¼•ç”¨è®¡æ•°ä¼šè‡ªåŠ¨+1ï¼›</p>
<h1 id="ç¬¬51æ¡-ç²¾ç®€initialize-ä¸-loadçš„å®ç°ä»£ç "><a href="#ç¬¬51æ¡-ç²¾ç®€initialize-ä¸-loadçš„å®ç°ä»£ç " class="headerlink" title="ç¬¬51æ¡: ç²¾ç®€initialize ä¸ loadçš„å®ç°ä»£ç "></a>ç¬¬51æ¡: ç²¾ç®€initialize ä¸ loadçš„å®ç°ä»£ç </h1><hr>
<h2 id="loadæ–¹æ³•"><a href="#loadæ–¹æ³•" class="headerlink" title="loadæ–¹æ³•"></a>loadæ–¹æ³•</h2><p><code>+(void)load;</code><br>æ¯ä¸ªç±»å’Œåˆ†ç±»åœ¨åŠ å…¥è¿è¡ŒæœŸç³»ç»Ÿæ—¶ï¼Œéƒ½ä¼šè°ƒç”¨<code>load</code>æ–¹æ³•ï¼Œè€Œä¸”ä»…ä»…è°ƒç”¨ä¸€æ¬¡ï¼Œå¯èƒ½æœ‰äº›å°ä¼™ä¼´ä¹ æƒ¯åœ¨è¿™é‡Œè°ƒç”¨ä¸€äº›æ–¹æ³•ï¼Œä½†æ˜¯ä½œè€…å»ºè®®å°½é‡ä¸è¦åœ¨è¿™ä¸ªæ–¹æ³•é‡Œè°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨å…¶ä»–çš„ç±»ã€‚åŸå› æ˜¯æ¯ä¸ªç±»è½½å…¥ç¨‹åºåº“çš„æ—¶æœºæ˜¯ä¸åŒçš„ï¼Œå¦‚æœè¯¥ç±»è°ƒç”¨äº†è¿˜æœªè½½å…¥ç¨‹åºåº“çš„ç±»ï¼Œå°±ä¼šå¾ˆå±é™©ã€‚</p>
<h2 id="initializeæ–¹æ³•"><a href="#initializeæ–¹æ³•" class="headerlink" title="initializeæ–¹æ³•"></a>initializeæ–¹æ³•</h2><p><code>+(void)initialize;</code></p>
<p>è¿™ä¸ªæ–¹æ³•ä¸<code>load</code>æ–¹æ³•ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ç¨‹åº<strong>é¦–æ¬¡</strong>è°ƒç”¨è¿™ä¸ªç±»çš„æ—¶å€™è°ƒç”¨ï¼ˆæƒ°æ€§è°ƒç”¨ï¼‰ï¼Œè€Œä¸”åªè°ƒç”¨ä¸€æ¬¡ï¼ˆç»å¯¹ä¸èƒ½ä¸»åŠ¨ä½¿ç”¨ä»£ç è°ƒç”¨ï¼‰ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç°å®ƒï¼Œå®ƒçš„è¶…ç±»å´å®ç°äº†ï¼Œé‚£ä¹ˆå°±ä¼šè¿è¡Œè¶…ç±»çš„ä»£ç ï¼šè¿™ä¸ªæƒ…å†µå¾€å¾€å¾ˆå®¹æ˜“è®©äººå¿½è§†ã€‚</p>
<p>çœ‹ä¸€ä¸‹ğŸŒ° ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface EOCBaseClass : NSObject</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation EOCBaseClass</div><div class="line">+ (void)initialize &#123;</div><div class="line"> NSLog(@&quot;%@ initialize&quot;, self);</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line">@interface EOCSubClass : EOCBaseClass</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation EOCSubClass</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>å½“ä½¿ç”¨EOCSubClassç±»æ—¶ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºä¸¤æ¬¡æ‰“å°æ–¹æ³•ï¼š<br><code>EOCBaseClass initialize
EOCSubClass initialize</code></p>
<p>å› ä¸ºå­ç±»EOCSubClasså¹¶æ²¡æœ‰è¦†å†™<code>initialize</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè‡ªç„¶ä¼šè°ƒç”¨å…¶çˆ¶ç±»EOCBaseClassçš„æ–¹æ³•ã€‚<br>è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡æ£€æµ‹ç±»çš„ç±»å‹çš„æ–¹æ³•ï¼š</p>
<p>``</p>
<ul>
<li>(void)initialize {<br> if (self == [EOCBaseClass class]) {<pre><code>NSLog(@&quot;%@ initialized&quot;, self);
</code></pre>  }<br>}<br>``</li>
</ul>
<p>è¿™æ ·ä¸€æ¥ï¼ŒEOCBaseClassçš„å­ç±»EOCSubClasså°±æ— æ³•å†è°ƒç”¨<code>initialize</code>æ–¹æ³•äº†ã€‚<br>æˆ‘ä»¬å¯ä»¥å¯Ÿè§‰åˆ°ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ–¹æ³•é‡Œæ‰§è¡Œè¿‡å¤šçš„æ“ä½œçš„è¯ï¼Œä¼šä½¿å¾—ç¨‹åºéš¾ä»¥ç»´æŠ¤ï¼Œä¹Ÿå¯èƒ½å¼•èµ·å…¶ä»–çš„bugã€‚å› æ­¤ï¼Œåœ¨<code>initialize</code>æ–¹æ³•é‡Œï¼Œæœ€å¥½åªæ˜¯è®¾ç½®å†…éƒ¨çš„æ•°æ®ï¼Œä¸è¦è°ƒç”¨å…¶ä»–çš„æ–¹æ³•ï¼Œå› ä¸ºå°†æ¥å¯èƒ½ä¼šç»™è¿™äº›æ–¹æ³•æ·»åŠ å…¶å®ƒçš„åŠŸèƒ½ï¼Œé‚£ä¹ˆä¼šå¯èƒ½ä¼šå¼•èµ·éš¾ä»¥æ’æŸ¥çš„bugã€‚</p>
<h1 id="ç¬¬52æ¡-åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡"><a href="#ç¬¬52æ¡-åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡" class="headerlink" title="ç¬¬52æ¡: åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡"></a>ç¬¬52æ¡: åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡</h1><hr>
<p>åœ¨ä½¿ç”¨NSTimerçš„æ—¶å€™ï¼ŒNSTimerä¼šç”ŸæˆæŒ‡å‘å…¶ä½¿ç”¨è€…çš„å¼•ç”¨ï¼Œè€Œå…¶ä½¿ç”¨è€…å¦‚æœä¹Ÿå¼•ç”¨äº†NSTimerï¼Œé‚£ä¹ˆå°±ä¼šç”Ÿæˆä¿ç•™ç¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface EOCClass : NSObject</div><div class="line">- (void)startPolling;</div><div class="line">- (void)stopPolling;</div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">@implementation EOCClass &#123;</div><div class="line">     NSTimer *_pollTimer;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (id)init &#123;</div><div class="line">     return [super init];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (void)dealloc &#123;</div><div class="line">    [_pollTimer invalidate];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (void)stopPolling &#123;</div><div class="line"></div><div class="line">    [_pollTimer invalidate];</div><div class="line">    _pollTimer = nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (void)startPolling &#123;</div><div class="line">   _pollTimer = [NSTimer scheduledTimerWithTimeInterval:5.0</div><div class="line">                                                 target:self</div><div class="line">                                               selector:@selector(p_doPoll)</div><div class="line">                                               userInfo:nil</div><div class="line">                                                repeats:YES];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)p_doPoll &#123;</div><div class="line">    // Poll the resource</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œåœ¨EOCClasså’Œ_pollTimerä¹‹é—´å½¢æˆäº†ä¿ç•™ç¯ï¼Œå¦‚æœä¸ä¸»åŠ¨è°ƒç”¨<code>stopPolling</code>æ–¹æ³•å°±æ— æ³•æ‰“ç ´è¿™ä¸ªä¿ç•™ç¯ã€‚åƒè¿™ç§é€šè¿‡ä¸»åŠ¨è°ƒç”¨æ–¹æ³•æ¥æ‰“ç ´ä¿ç•™ç¯çš„è®¾è®¡æ˜¾ç„¶æ˜¯ä¸å¥½çš„ã€‚</p>
</blockquote>
<p>è€Œä¸”ï¼Œå¦‚æœé€šè¿‡å›æ”¶è¯¥ç±»çš„æ–¹æ³•æ¥æ‰“ç ´æ­¤ä¿ç•™ç¯ä¹Ÿæ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºä¼šå°†è¯¥ç±»å’ŒNSTimerå­¤ç«‹å‡ºæ¥ï¼Œå½¢æˆâ€œå­¤å²›â€:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-d60b4571e7709e46.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å­¤ç«‹äº†ç±»å’Œå®ƒçš„NSTimer"></p>
<p>è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæå…¶å±é™©çš„æƒ…å†µï¼Œå› ä¸ºNSTimeræ²¡æœ‰æ¶ˆå¤±ï¼Œå®ƒè¿˜æœ‰å¯èƒ½æŒç»­æ‰§è¡Œä¸€äº›ä»»åŠ¡ï¼Œä¸æ–­æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚è€Œä¸”ï¼Œå¦‚æœä»»åŠ¡æ¶‰åŠåˆ°ä¸‹è½½ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæ›´ç³Ÿã€‚ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿ é€šè¿‡â€œå—â€æ¥è§£å†³ï¼</p>
<p>é€šè¿‡ç»™NSTimerå¢åŠ ä¸€ä¸ªåˆ†ç±»å°±å¯ä»¥è§£å†³ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface NSTimer (EOCBlocksSupport)</div><div class="line"></div><div class="line">+ (NSTimer*)eoc_scheduledTimerWithTimeInterval:(NSTimeInterval)interval</div><div class="line">                                         block:(void(^)())block</div><div class="line">                                         repeats:(BOOL)repeats;</div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">@implementation NSTimer (EOCBlocksSupport)</div><div class="line"></div><div class="line">+ (NSTimer*)eoc_scheduledTimerWithTimeInterval:(NSTimeInterval)interval</div><div class="line">                                         block:(void(^)())block</div><div class="line">                                        repeats:(BOOL)repeats</div><div class="line">&#123;</div><div class="line">             return [self scheduledTimerWithTimeInterval:interval</div><div class="line">                                                  target:self</div><div class="line">                                                selector:@selector(eoc_blockInvoke:)</div><div class="line">                                                userInfo:[block copy]</div><div class="line">                                                 repeats:repeats];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">+ (void)eoc_blockInvoke:(NSTimer*)timer &#123;</div><div class="line">     void (^block)() = timer.userInfo;</div><div class="line">         if (block) &#123;</div><div class="line">             block();</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨NSTimerç±»é‡Œæ·»åŠ äº†æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨å®ƒï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)startPolling &#123;</div><div class="line"></div><div class="line">         __<span class="keyword">weak</span> EOCClass *weakSelf = <span class="keyword">self</span>;    </div><div class="line">         _pollTimer = [<span class="built_in">NSTimer</span> eoc_scheduledTimerWithTimeInterval:<span class="number">5.0</span> block:^&#123;</div><div class="line"></div><div class="line">               EOCClass *strongSelf = weakSelf;</div><div class="line">               [strongSelf p_doPoll];</div><div class="line">          &#125;</div><div class="line"></div><div class="line">                                                          repeats:<span class="literal">YES</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ï»¿åœ¨è¿™é‡Œï¼Œåˆ›å»ºäº†ä¸€ä¸ªselfçš„å¼±å¼•ç”¨ï¼Œç„¶åè®©å—æ•è·äº†è¿™ä¸ªselfå˜é‡ï¼Œè®©å…¶åœ¨æ‰§è¡ŒæœŸé—´å­˜æ´»ã€‚</p>
<p>ä¸€æ—¦å¤–ç•ŒæŒ‡å‘EOCç±»çš„æœ€åä¸€ä¸ªå¼•ç”¨æ¶ˆå¤±ï¼Œè¯¥ç±»å°±ä¼šè¢«é‡Šæ”¾ï¼Œè¢«é‡Šæ”¾çš„åŒæ—¶ï¼Œä¹Ÿä¼šå‘NSTimerå‘é€invalidateæ¶ˆæ¯ï¼ˆå› ä¸ºåœ¨è¯¥ç±»çš„deallocæ–¹æ³•ä¸­å‘NSTimerå‘é€äº†invalidateæ¶ˆæ¯ï¼‰ã€‚</p>
<p>è€Œä¸”ï¼Œå³ä½¿åœ¨deallocæ–¹æ³•é‡Œæ²¡æœ‰å‘é€invalidateæ¶ˆæ¯ï¼Œå› ä¸ºå—é‡Œçš„weakSelfä¼šå˜æˆnilï¼Œæ‰€ä»¥NSTimeråŒæ ·ä¼šå¤±æ•ˆã€‚</p>
<h1 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h1><hr>
<p>æ€»çš„æ¥è¯´è¿™ä¸€éƒ¨åˆ†è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ï¼Œæ›´å¤šçš„åªæ˜¯æ•™æˆ‘ä»¬ä¸€äº›ç¼–å†™OCç¨‹åºçš„è§„èŒƒï¼Œå¹¶æ²¡æœ‰æ·±å…¥è®²è§£æŠ€æœ¯ç»†èŠ‚ã€‚</p>
<p>è€Œä¸‰éƒ¨æ›²çš„æœ€åä¸€ç¯‡ï¼šæŠ€å·§ç¯‡åˆ™ç€é‡è®²è§£äº†ä¸€äº›åœ¨ç¼–å†™OCä»£ç çš„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨çš„ä¸€äº›æŠ€å·§ã€‚å¹¿ä¹‰ä¸Šæ¥è®²ï¼Œè¿™äº›æŠ€å·§ä¹Ÿå¯ä»¥è¢«ç§°ä¸ºâ€œè§„èŒƒâ€ï¼Œä¾‹å¦‚â€œæä¾›å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•â€è¿™ä¸€èŠ‚ï¼Œä½†æ˜¯è¿™äº›çŸ¥è¯†ç‚¹æ›´åƒæ˜¯ä¸€äº›â€œè®¾è®¡æ¨¡å¼â€ç›®çš„æ›´åå‘äºåœ¨äºè§£å†³ä¸€äº›å®é™…é—®é¢˜ï¼Œå› æ­¤å°†è¿™äº›çŸ¥è¯†ç‚¹å½’ç±»ä¸ºâ€œæŠ€å·§ç±»â€ã€‚</p>
<p>å› ä¸ºç¬¬ä¸‰ç¯‡çš„å†…å®¹ç¨å¾®éš¾ä¸€ç‚¹ï¼Œæ‰€ä»¥ç¬”è€…æ‰“ç®—å†å¥½å¥½æ¶ˆåŒ–å‡ å¤©ï¼Œå°†ç¬¬ä¸‰ç¯‡çš„åˆç¨¿å†ä¸‰æ¶¦é¥°ä¹‹åå‘ˆçŒ®ç»™å¤§å®¶~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-4696272b0a4ffe42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;ã€ŠEffective Objective-C ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç»§ä¸Šä¸€ç¯‡&lt;a href=&quot;http://www.jianshu.com/p/9c93c7ab734d&quot;&gt;ã€ŠEffective Objective-C ã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸€ï¼‰ï¼šæ¦‚å¿µç¯‡&lt;/a&gt;ä¹‹åï¼Œæœ¬ç¯‡å³æ˜¯ä¸‰éƒ¨æ›²çš„ç¬¬äºŒç¯‡ï¼šè§„èŒƒç¯‡ã€‚&lt;br&gt;æ²¡çœ‹è¿‡ä¸‰éƒ¨æ›²ç¬¬ä¸€ç¯‡çš„å°ä¼™ä¼´å¯èƒ½ä¸çŸ¥é“æˆ‘åœ¨è¯´ç¥é©¬ï¼Œåœ¨è¿™é‡Œè¿˜æ˜¯å…ˆå•°å—¦ä¸€ä¸‹ä¸‰éƒ¨æ›²æ˜¯å’‹å›äº‹ï¼šç¬”è€…å°†ã€ŠEffective Objective-C ã€‹è¿™æœ¬ä¹¦çš„52ä¸ªçŸ¥è¯†ç‚¹åˆ†ä¸ºä¸‰å¤§ç±»è¿›è¡Œäº†å½’ç±»æ•´ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¦‚å¿µç±»ï¼šè®²è§£äº†ä¸€äº›æ¦‚å¿µæ€§çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;li&gt;è§„èŒƒç±»ï¼šè®²è§£äº†ä¸€äº›ä¸ºäº†é¿å…ä¸€äº›é—®é¢˜æˆ–è€…ä¸ºåç»­å¼€å‘æä¾›ä¾¿åˆ©æ‰€éœ€è¦éµå¾ªçš„è§„èŒƒæ€§çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;li&gt;æŠ€å·§ç±»ï¼šè®²è§£äº†ä¸€äº›ä¸ºäº†è§£å†³æŸäº›ç‰¹å®šé—®é¢˜è€Œéœ€è¦ç”¨åˆ°çš„æŠ€å·§æ€§çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åç”¨æ€ç»´å¯¼å›¾æ•´ç†äº†ä¸€ä¸‹ï¼š&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-0599d987732d932e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;ä¸‰éƒ¨æ›²åˆ†å¸ƒå›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸‰éƒ¨æ›²çš„ç¬¬äºŒç¯‡ï¼Œæœ¬ç¯‡æ€»ç»“æŠ½å–äº†ã€ŠEffective Objective-C ã€‹è¿™æœ¬ä¹¦ä¸­è®²è§£è§„èŒƒæ€§çŸ¥è¯†çš„éƒ¨åˆ†ï¼šè¿™äº›çŸ¥è¯†ç‚¹éƒ½æ˜¯ä¸ºäº†é¿å…åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜æˆ–ç»™å¼€å‘æä¾›ä¾¿åˆ©çš„è§„èŒƒæ€§çŸ¥è¯†ç‚¹ã€‚æŒæ¡è¿™äº›çŸ¥è¯†æœ‰åŠ©äºå½¢æˆç§‘å­¦åœ°å†™OCä»£ç çš„ä¹ æƒ¯ï¼Œä½¿å¾—ä»£ç æ›´åŠ å®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•ï¼Œå­¦ä¹ è¿™ç±»çŸ¥è¯†æ˜¯iOSåˆå­¦è€…è¿›é˜¶çš„å¿…ç»ä¹‹è·¯ã€‚&lt;/p&gt;
&lt;p&gt;å¥½å§ï¼Œä¸è´¹è¯äº†ï¼Œå¼€å§‹äº†ï¼&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠEffective Objective-Cã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸€ï¼‰ï¼šæ¦‚å¿µç¯‡</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/%E3%80%8AEffective%20Objective-C%E3%80%8B%E8%B6%85%E7%BA%A7%E5%B9%B2%E8%B4%A7%E4%B8%89%E9%83%A8%E6%9B%B2%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E6%A6%82%E5%BF%B5%E7%AF%87/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/ã€ŠEffective Objective-Cã€‹è¶…çº§å¹²è´§ä¸‰éƒ¨æ›²ï¼ˆä¸€ï¼‰ï¼šæ¦‚å¿µç¯‡/</id>
    <published>2017-01-13T05:50:51.000Z</published>
    <updated>2017-03-20T07:49:49.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/859001-4696272b0a4ffe42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ã€ŠEffective Objective-C ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹"></p>
<p>å¾ˆå¤šæ–‡ç« å’Œå¤§ç‰›éƒ½åœ¨æ¨èè¿™æœ¬ä¹¦ï¼Œè¯´å®ƒè®²æˆäº†å¾ˆå¤šç¼–å†™Objective-Cè¯­è¨€æ—¶æ‰€åº”è¯¥éµå¾ªçš„è§„èŒƒã€‚åˆšå¥½ç¬”è€…å‰æ®µæ—¶é—´å› ä¸ºäº§å“åˆšå¼€å‘å®Œï¼Œæœ‰äº†ä¸€ç‚¹ç©ºæ¡£æœŸï¼Œäºæ˜¯ç”¨äº†3ä¸ªæ˜ŸæœŸçš„æ—¶é—´ä»”ç»†ç ”è¯»å’Œæ€»ç»“äº†è¿™æœ¬ä¹¦ã€‚</p>
<p>åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¹Ÿçœ‹è¿‡å¾ˆå¤šæ€»ç»“è¿™æœ¬ä¹¦çš„åšå®¢å’Œæ–‡ç« ï¼Œä½†æ˜¯å‘ç°å¤šæ•°åªæ˜¯å°†æ¯èŠ‚çš„æ€»ç»“éƒ¨åˆ†æŠ„äº†è¿‡æ¥ï¼Œè®²å¾—å¹¶ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œäºæ˜¯ç¬”è€…å°±æƒ³æŒ‰ç…§è‡ªå·±çš„æ–¹å¼å¯¹è¿™æœ¬ä¹¦è¿›è¡Œæ€»ç»“ï¼Œå¹¶ä»¥åšå®¢çš„å½¢å¼å±•ç°å‡ºæ¥ï¼šæ—¢èƒ½åˆ†äº«ï¼ŒåŒæ—¶åˆèƒ½å¯¹çŸ¥è¯†è¿›è¡Œä¸€ä¸‹æ¢³ç†å’ŒäºŒæ¬¡å¤ä¹ ã€‚</p>
<p>è™½ç„¶æœ¬ä¹¦çš„ä½œè€…æŒ‰ç…§çŸ¥è¯†æ¨¡å—æ¥å°†è¿™æœ¬ä¹¦åˆ†æˆä¸ƒä¸ªç« èŠ‚ï¼Œå…±52èŠ‚ï¼Œä½†æ˜¯ç¬”è€…åœ¨æ‹œè¯»çš„è¿‡ç¨‹ä¸­å‘ç°æœ¬ä¹¦ä»‹ç»çš„çŸ¥è¯†ç‚¹å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼šæ¦‚å¿µç±»ï¼Œè§„èŒƒç±»ï¼Œå’ŒæŠ€å·§ç±»ã€‚ç¬”è€…æ‰“ç®—æŒ‰ç…§è¿™ä¸‰ç±»æ¥å¯¹è¿™æœ¬ä¹¦è¿›è¡Œæ€»ç»“ï¼Œå½¢æˆä¸‰éƒ¨æ›²ï¼š</p>
<ul>
<li>æ¦‚å¿µç±»ï¼šè®²è§£äº†ä¸€äº›æ¦‚å¿µæ€§çŸ¥è¯†ã€‚</li>
<li>è§„èŒƒç±»ï¼šè®²è§£äº†ä¸€äº›ä¸ºäº†é¿å…ä¸€äº›é—®é¢˜æˆ–è€…ä¸ºåç»­å¼€å‘æä¾›ä¾¿åˆ©æ‰€éœ€è¦éµå¾ªçš„è§„èŒƒæ€§çŸ¥è¯†ã€‚</li>
<li>æŠ€å·§ç±»ï¼šè®²è§£äº†ä¸€äº›ä¸ºäº†è§£å†³æŸäº›ç‰¹å®šé—®é¢˜è€Œéœ€è¦ç”¨åˆ°çš„æŠ€å·§æ€§çŸ¥è¯†ã€‚</li>
</ul>
<p>è€Œä¸”ï¼Œç¬”è€…ä¹ŸæŒ‰ç…§è‡ªå·±çš„å½’ç±»å°†è¿™æœ¬ä¹¦çš„ç»“æ„ç”¨æ€ç»´å¯¼å›¾å·¥å…·ç”»äº†å‡ºæ¥ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-539498fef0819472.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‰éƒ¨æ›²åˆ†å¸ƒå›¾"></p>
<blockquote>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç¬”è€…å¹¶æ²¡æœ‰æ‰“ä¹±åŸæ¥ä½œè€…çš„æ ‡é¢˜é¡ºåºã€‚æœ¬ç¯‡æ€»ç»“å³æ˜¯ä¸‰éƒ¨æ›²ä¹‹ä¸€ï¼šæ¦‚å¿µç¯‡ï¼Œåç»­ä¼šå‘ˆä¸Šè§„èŒƒç¯‡å’ŒæŠ€å·§ç¯‡ã€‚<br>å¤‡æ³¨ï¼šæœ¬æ€»ç»“æ‰€æœ‰çš„ä»£ç å’Œå›¾ç‰‡éƒ½æ¥è‡ªåŸä¹¦ã€‚å…¶ä¸­ï¼Œä»£ç ä¼šé€‚å½“åŠ ä¸Šç¬”è€…çš„æ³¨é‡Šï¼Œä¾¿äºå„ä½çœ‹å®˜ç†è§£ã€‚</p>
</blockquote>
<p>å¥½äº†ï¼Œä¸å•°å—¦äº†ï¼Œ å¼€å§‹å§ï¼</p>
<a id="more"></a>
<h1 id="ç¬¬1æ¡ï¼šäº†è§£Objective-Cçš„èµ·æº"><a href="#ç¬¬1æ¡ï¼šäº†è§£Objective-Cçš„èµ·æº" class="headerlink" title="ç¬¬1æ¡ï¼šäº†è§£Objective-Cçš„èµ·æº"></a>ç¬¬1æ¡ï¼šäº†è§£Objective-Cçš„èµ·æº</h1><hr>
<h2 id="1-è¿è¡ŒæœŸç»„ä»¶"><a href="#1-è¿è¡ŒæœŸç»„ä»¶" class="headerlink" title="1. è¿è¡ŒæœŸç»„ä»¶"></a>1. è¿è¡ŒæœŸç»„ä»¶</h2><p>å¯¹äºæ¶ˆæ¯ç»“æ„çš„è¯­è¨€ï¼Œè¿è¡Œæ—¶æ‰€æ‰§è¡Œçš„ä»£ç ç”±è¿è¡Œç¯å¢ƒæ¥å†³å®šï¼›åœ¨è¿è¡Œæ—¶æ‰å›å»æŸ¥æ‰¾ç´¢è¦æ‰§è¡Œçš„æ–¹æ³•ã€‚å…¶å®ç°åŸç†æ˜¯ç”±è¿è¡ŒæœŸç»„ä»¶å®Œæˆï¼ˆruntime componentï¼‰ï¼Œä½¿ç”¨Objective-Cçš„é¢å‘å¯¹è±¡ç‰¹æ€§æ‰€éœ€çš„å…¨éƒ¨æ•°æ®ç»“æ„ä»¥åŠå‡½æ•°éƒ½åœ¨è¿è¡ŒæœŸç»„ä»¶é‡Œé¢ã€‚</p>
<p>è¿è¡ŒæœŸç»„ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ä¸å¼€å‘è€…æ‰€ç¼–å†™çš„ä»£ç ç›¸é“¾æ¥çš„åŠ¨æ€åº“ï¼ˆdynamic libraryï¼‰ï¼Œå…¶ä»£ç èƒ½æŠŠå¼€å‘è€…æ‰€ç¼–å†™çš„æ‰€æœ‰ç¨‹åºç²˜åˆèµ·æ¥ï¼Œæ‰€ä»¥åªè¦æ›´æ–°è¿è¡ŒæœŸç»„ä»¶ï¼Œå°±å¯ä»¥æå‡åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚</p>
<p>å†…å­˜ï¼šå¯¹è±¡åˆ†é…åˆ°å †ç©ºé—´,æŒ‡é’ˆåˆ†é…åˆ°æ ˆç©ºé—´ã€‚<br>åˆ†é…åœ¨é˜Ÿä¸­çš„å†…å­˜å¿…é¡»ç›´æ¥ç®¡ç†ï¼Œè€Œåˆ†é…åœ¨æ ˆä¸Šç”¨äºä¿å­˜å˜é‡çš„å†…å­˜åˆ™ä¼šåœ¨å…¶æ ˆå¸§å¼¹å‡ºæ—¶è‡ªåŠ¨æ¸…ç†ã€‚</p>
<p>ä¸å«*çš„å˜é‡ï¼Œå¯èƒ½ä¼šä½¿ç”¨æ ˆç©ºé—´ã€‚ç»“æ„ä½“ä¿å­˜éå¯¹è±¡ç±»å‹ã€‚</p>
<h1 id="ç¬¬6æ¡ï¼šç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ"><a href="#ç¬¬6æ¡ï¼šç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ" class="headerlink" title="ç¬¬6æ¡ï¼šç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ"></a>ç¬¬6æ¡ï¼šç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ</h1><hr>
<blockquote>
<p>å±æ€§ç”¨äºå°è£…å¯¹è±¡ä¸­çš„æ•°æ®ã€‚</p>
</blockquote>
<h2 id="1-å­˜å–æ–¹æ³•"><a href="#1-å­˜å–æ–¹æ³•" class="headerlink" title="1. å­˜å–æ–¹æ³•"></a>1. å­˜å–æ–¹æ³•</h2><p>åœ¨è®¾ç½®å®Œå±æ€§åï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å†™å‡ºä¸€å¥—å­˜å–æ–¹æ³•ï¼Œç”¨äºè®¿é—®ç›¸åº”åç§°çš„å˜é‡ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> <span class="built_in">NSString</span> *firstName;</div><div class="line"><span class="keyword">@property</span> <span class="built_in">NSString</span> *lastName;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> : <span class="title">NSObject</span></span></div><div class="line">- (<span class="built_in">NSString</span>*)firstName;</div><div class="line">- (<span class="keyword">void</span>)setFirstName:(<span class="built_in">NSString</span>*)firstName;</div><div class="line">- (<span class="built_in">NSString</span>*)lastName;</div><div class="line">- (<span class="keyword">void</span>)setLastName:(<span class="built_in">NSString</span>*)lastName;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è®¿é—®å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•ã€‚ç¼–è¯‘å™¨ä¼šæŠŠç‚¹è¯­æ³•è½¬æ¢ä¸ºå¯¹å­˜å–æ–¹æ³•çš„è°ƒç”¨ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">aPerson.firstName = <span class="string">@"Bob"</span>; <span class="comment">// Same as:</span></div><div class="line">[aPerson setFirstName:<span class="string">@"Bob"</span>];</div><div class="line"></div><div class="line"><span class="built_in">NSString</span> *lastName = aPerson.lastName; <span class="comment">// Same as:</span></div><div class="line"><span class="built_in">NSString</span> *lastName = [aPerson lastName];</div></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆå­˜å–æ–¹æ³•çš„è¯ï¼Œéœ€è¦è®¾ç½®@dynamic å­—æ®µï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCPerson</span> : <span class="title">NSManagedObject</span></span></div><div class="line"><span class="keyword">@property</span> <span class="built_in">NSString</span> *firstName;</div><div class="line"><span class="keyword">@property</span> <span class="built_in">NSString</span> *lastName;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCPerson</span></span></div><div class="line"><span class="keyword">@dynamic</span> firstName, lastName;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h2 id="2-å±ç›¸ç‰¹è´¨"><a href="#2-å±ç›¸ç‰¹è´¨" class="headerlink" title="2. å±ç›¸ç‰¹è´¨"></a>2. å±ç›¸ç‰¹è´¨</h2><blockquote>
<p>å®šä¹‰å±æ€§çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šèµ‹äºˆå®ƒä¸€äº›ç‰¹æ€§ï¼Œæ¥æ»¡è¶³ä¸€äº›å¯¹ç±»ä¿å­˜æ•°æ®æ‰€è¦éµå¾ªçš„éœ€æ±‚ã€‚</p>
</blockquote>
<h4 id="åŸå­æ€§ï¼š"><a href="#åŸå­æ€§ï¼š" class="headerlink" title="åŸå­æ€§ï¼š"></a>åŸå­æ€§ï¼š</h4><ul>
<li>nonatomicï¼šä¸ä½¿ç”¨åŒæ­¥é”</li>
<li>atomicï¼šåŠ åŒæ­¥é”ï¼Œç¡®ä¿å…¶åŸå­æ€§</li>
</ul>
<h4 id="è¯»å†™"><a href="#è¯»å†™" class="headerlink" title="è¯»å†™"></a>è¯»å†™</h4><ul>
<li>readwrite:åŒæ—¶å­˜åœ¨å­˜å–æ–¹æ³•</li>
<li>readonly:åªæœ‰è·å–æ–¹æ³•</li>
</ul>
<h4 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h4><ul>
<li>assign:çº¯é‡ç±»å‹(scalar type)çš„ç®€å•èµ‹å€¼æ“ä½œ</li>
<li>strong:æ‹¥æœ‰å…³ç³»ä¿ç•™æ–°å€¼ï¼Œé‡Šæ”¾æ—§å€¼ï¼Œå†è®¾ç½®æ–°å€¼</li>
<li>weak:éæ‹¥æœ‰å…³ç³»(nonowning relationship)ï¼Œå±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§ä¹Ÿä¼šæ¸…ç©º</li>
<li>unsafe_unretained ï¼šç±»ä¼¼assignï¼Œé€‚ç”¨äºå¯¹è±¡ç±»å‹ï¼Œéæ‹¥æœ‰å…³ç³»ï¼Œå±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§ä¸ä¼šæ¸…ç©ºã€‚</li>
<li>copyï¼šä¸ä¿ç•™æ–°å€¼ï¼Œè€Œæ˜¯å°†å…¶æ‹·è´</li>
</ul>
<h4 id="æ³¨æ„ï¼šéµå¾ªå±æ€§å®šä¹‰"><a href="#æ³¨æ„ï¼šéµå¾ªå±æ€§å®šä¹‰" class="headerlink" title="æ³¨æ„ï¼šéµå¾ªå±æ€§å®šä¹‰"></a>æ³¨æ„ï¼šéµå¾ªå±æ€§å®šä¹‰</h4><p>å¦‚æœå±æ€§å®šä¹‰ä¸ºcopyï¼Œé‚£ä¹ˆåœ¨éè®¾ç½®æ–¹æ³•é‡Œè®¾å®šå±æ€§çš„æ—¶å€™ï¼Œä¹Ÿè¦éµå¾ªcopyçš„è¯­ä¹‰</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)initWithFirstName:(<span class="built_in">NSString</span>*)firstName lastName:(<span class="built_in">NSString</span>*)lastName</div><div class="line">&#123;</div><div class="line">         <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">            _firstName = [firstName <span class="keyword">copy</span>];</div><div class="line">            _lastName = [lastName <span class="keyword">copy</span>];</div><div class="line">        &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="ç¬¬8æ¡ï¼šç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ"><a href="#ç¬¬8æ¡ï¼šç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ" class="headerlink" title="ç¬¬8æ¡ï¼šç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ"></a>ç¬¬8æ¡ï¼šç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ</h1><hr>
<h2 id="1-åŒç­‰æ€§åˆ¤æ–­"><a href="#1-åŒç­‰æ€§åˆ¤æ–­" class="headerlink" title="1. åŒç­‰æ€§åˆ¤æ–­"></a>1. åŒç­‰æ€§åˆ¤æ–­</h2><blockquote>
<p>==æ“ä½œç¬¦æ¯”è¾ƒçš„æ˜¯æŒ‡é’ˆå€¼ï¼Œä¹Ÿå°±æ˜¯å†…å­˜åœ°å€ã€‚</p>
</blockquote>
<p>ç„¶è€Œæœ‰çš„æ—¶å€™æˆ‘ä»¬åªæ˜¯æƒ³æ¯”è¾ƒæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹ï¼Œåœ¨è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦é€šè¿‡<code>isEqual:</code>æ–¹æ³•æ¥æ¯”è¾ƒã€‚</p>
<p>è€Œä¸”ï¼Œå¦‚æœå·²çŸ¥ä¸¤ä¸ªå¯¹è±¡æ˜¯å­—ç¬¦ä¸²ï¼Œæœ€å¥½é€šè¿‡<code>isEqualToString:</code>æ–¹æ³•æ¥æ¯”è¾ƒã€‚<br>å¯¹äºæ•°ç»„å’Œå­—å…¸ï¼Œä¹Ÿæœ‰<code>isEqualToArray:</code>æ–¹æ³•å’Œ<code>isEqualToDictionary:</code>æ–¹æ³•ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœæ¯”è¾ƒçš„å¯¹è±¡ç±»å‹å’Œå½“å‰å¯¹è±¡ç±»å‹ç›¸åŒï¼Œå°±å¯ä»¥é‡‡ç”¨è‡ªå·±ç¼–å†™çš„åˆ¤å®šæ–¹æ³•ï¼Œå¦åˆ™è°ƒç”¨çˆ¶ç±»çš„<code>isEqual:</code>æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)isEqualToPerson:(EOCPerson*)otherPerson &#123;</div><div class="line">     <span class="comment">//å…ˆæ¯”è¾ƒå¯¹è±¡ç±»å‹ï¼Œç„¶åæ¯”è¾ƒæ¯ä¸ªå±æ€§</span></div><div class="line">     <span class="keyword">if</span> (<span class="keyword">self</span> == object) <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">     <span class="keyword">if</span> (![_firstName isEqualToString:otherPerson.firstName])</div><div class="line">         <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">     <span class="keyword">if</span> (![_lastName isEqualToString:otherPerson.lastName])</div><div class="line">         <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">     <span class="keyword">if</span> (_age != otherPerson.age)</div><div class="line">         <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">     <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)isEqual:(<span class="keyword">id</span>)object &#123;</div><div class="line">    <span class="comment">//å¦‚æœå¯¹è±¡æ‰€å±ç±»å‹ç›¸åŒï¼Œå°±è°ƒç”¨è‡ªå·±ç¼–å†™çš„åˆ¤å®šæ–¹æ³•ï¼Œå¦‚æœä¸åŒï¼Œè°ƒç”¨çˆ¶ç±»çš„isEqual:æ–¹æ³•</span></div><div class="line">     <span class="keyword">if</span> ([<span class="keyword">self</span> <span class="keyword">class</span>] == [object <span class="keyword">class</span>]) &#123;    </div><div class="line">         <span class="keyword">return</span> [<span class="keyword">self</span> isEqualToPerson:(EOCPerson*)object];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;    </div><div class="line">         <span class="keyword">return</span> [<span class="keyword">super</span> isEqual:object];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2-æ·±åº¦ç­‰åŒæ€§åˆ¤å®š"><a href="#2-æ·±åº¦ç­‰åŒæ€§åˆ¤å®š" class="headerlink" title="2. æ·±åº¦ç­‰åŒæ€§åˆ¤å®š"></a>2. æ·±åº¦ç­‰åŒæ€§åˆ¤å®š</h2><p>æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„æ˜¯å¦ç›¸ç­‰çš„è¯å¯ä»¥ä½¿ç”¨æ·±åº¦åŒç­‰æ€§åˆ¤æ–­æ–¹æ³•ï¼š</p>
<blockquote>
<p>1.å…ˆæ¯”è¾ƒæ•°ç»„çš„ä¸ªæ•°<br>2.å†æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„å¯¹åº”ä½ç½®ä¸Šçš„å¯¹è±¡å‡ç›¸ç­‰ã€‚</p>
</blockquote>
<h1 id="ç¬¬11æ¡ï¼šç†è§£objc-msgSendçš„ä½œç”¨"><a href="#ç¬¬11æ¡ï¼šç†è§£objc-msgSendçš„ä½œç”¨" class="headerlink" title="ç¬¬11æ¡ï¼šç†è§£objc_msgSendçš„ä½œç”¨"></a>ç¬¬11æ¡ï¼šç†è§£objc_msgSendçš„ä½œç”¨</h1><hr>
<p>åœ¨OCä¸­ï¼Œå¦‚æœå‘æŸå¯¹è±¡ä¼ é€’ä¿¡æ¯ï¼Œé‚£å°±ä¼šä½¿ç”¨åŠ¨æ€ç»‘å®šæœºåˆ¶æ¥å†³å®šéœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚åœ¨åº•å±‚ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½æ˜¯æ™®é€šçš„Cè¯­è¨€å‡½æ•°.</p>
<p>ç„¶è€Œå¯¹è±¡æ”¶åˆ° æ¶ˆæ¯åï¼Œç©¶ç«Ÿè¯¥è°ƒç”¨å“ªä¸ªæ–¹æ³•åˆ™å®Œå…¨äºè¿è¡ŒæœŸå†³å®šï¼Œç”šè‡³å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶æ”¹å˜ï¼Œè¿™äº›ç‰¹æ€§ä½¿å¾—OCæˆä¸ºä¸€é—¨çœŸæ­£çš„åŠ¨æ€è¯­è¨€ã€‚</p>
<p>åœ¨OCä¸­ï¼Œç»™å¯¹è±¡å‘é€æ¶ˆæ¯çš„è¯­æ³•æ˜¯ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> returnValue = [someObject messageName:parameter];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œï¼ŒsomeObjectå«åšâ€œæ¥æ”¶è€…(receiver)â€ï¼ŒmessageName:å«åšâ€é€‰æ‹©å­ï¼ˆselectorï¼‰â€,é€‰æ‹©å­å’Œå‚æ•°åˆèµ·æ¥ç§°ä¸ºâ€œæ¶ˆæ¯â€ã€‚ç¼–è¯‘å™¨çœ‹åˆ°æ­¤æ¶ˆæ¯åï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€æ¡æ ‡å‡†çš„Cè¯­è¨€å‡½æ•°è°ƒç”¨ï¼Œæ‰€è°ƒç”¨çš„å‡½æ•°ä¹ƒæ˜¯æ¶ˆæ¯ä¼ é€’æœºåˆ¶ä¸­çš„æ ¸å¿ƒå‡½æ•°å«åšobjc_msgSendï¼Œå®ƒçš„åŸå‹å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> objc_msgSend(<span class="keyword">id</span> <span class="keyword">self</span>, SEL cmd, ...)</div></pre></td></tr></table></figure>
<blockquote>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨æ¥æ”¶è€…ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨é€‰æ‹©å­ï¼Œåç»­å‚æ•°å°±æ˜¯æ¶ˆæ¯ä¸­çš„é‚£äº›å‚æ•°ï¼Œæ•°é‡æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°å°±æ˜¯å‚æ•°ä¸ªæ•°å¯å˜çš„å‡½æ•°ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œä¸Šè¿°ä»¥OCå½¢å¼å±•ç°å‡ºæ¥çš„å‡½æ•°å°±ä¼šè½¬åŒ–æˆå¦‚ä¸‹å‡½æ•°:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> returnValue = objc_msgSend(someObject,<span class="keyword">@selector</span>(messageName:),parameter);</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªå‡½æ•°ä¼šåœ¨æ¥æ”¶è€…æ‰€å±çš„ç±»ä¸­æœå¯»å…¶â€œæ–¹æ³•åˆ—è¡¨â€ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ä¸é€‰æ‹©å­åç§°ç›¸ç¬¦çš„æ–¹æ³•ï¼Œå°±å»å®ç°ä»£ç ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±æ²¿ç€ç»§æ‰¿ä½“ç³»ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ã€‚å¦‚æœæ‰¾åˆ°äº†å°±æ‰§è¡Œï¼Œå¦‚æœæœ€ç»ˆè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå°±æ‰§è¡Œ<strong>æ¶ˆæ¯è½¬å‘</strong>æ“ä½œã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœåŒ¹é…æˆåŠŸçš„è¯ï¼Œè¿™ç§åŒ¹é…çš„ç»“æœä¼šç¼“å­˜åœ¨â€œå¿«é€Ÿæ˜ å°„è¡¨â€é‡Œé¢ã€‚æ¯ä¸ªç±»éƒ½æœ‰è¿™æ ·ä¸€å—ç¼“å­˜ã€‚æ‰€ä»¥å¦‚æœå°†æ¥å†æ¬¡å‘è¯¥ç±»å‘é€å½¢åŒçš„æ¶ˆæ¯ï¼Œæ‰§è¡Œé€Ÿåº¦å°±ä¼šæ›´å¿«äº†ã€‚</p>
</blockquote>
<h1 id="ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶"><a href="#ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶" class="headerlink" title="ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶"></a>ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶</h1><hr>
<p>å¦‚æœå¯¹è±¡æ‰€å±ç±»å’Œå…¶æ‰€æœ‰çš„çˆ¶ç±»éƒ½æ— æ³•è§£è¯»æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå°±ä¼šå¯åŠ¨æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼ˆmessage forwardingï¼‰ã€‚</p>
<p>å°¤å…¶æˆ‘ä»¬åœ¨ç¼–å†™è‡ªå·±çš„ç±»æ—¶ï¼Œå¯åœ¨æ¶ˆæ¯è½¬å‘è¿‡ç¨‹ä¸­è®¾ç½®æŒ‚é’©ï¼Œç”¨ä»¥æ‰§è¡Œé¢„å®šçš„é€»è¾‘ï¼Œè€Œä¸åº”è¯¥ä½¿åº”ç”¨ç¨‹åºå´©æºƒã€‚</p>
<p>æ¶ˆæ¯è½¬å‘åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:</p>
<ol>
<li><p>å¾è¯¢æ¥å—è€…ï¼Œçœ‹å®ƒèƒ½å¦åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œä»¥å¤„ç†è¿™ä¸ªæœªçŸ¥çš„é€‰æ‹©å­ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšåŠ¨æ€æ–¹æ³•è§£æï¼ˆdynamic method resolutionï¼‰ã€‚</p>
</li>
<li><p>è¯·æ¥å—è€…çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–å¯¹è±¡èƒ½å¤„ç†è¿™æ¡æ¶ˆæ¯ï¼š</p>
<p>  2.1 å¦‚æœæœ‰ï¼Œåˆ™è¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠæ¶ˆæ¯è½¬ç»™é‚£ä¸ªå¯¹è±¡ã€‚<br>  2.2 å¦‚æœæ²¡æœ‰ï¼Œåˆ™å¯åŠ¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼ˆfull forwarding mechanismï¼‰ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠä¸æ¶ˆæ¯æœ‰å…³çš„å…¨éƒ¨ç»†èŠ‚éƒ½å°è£…åˆ°NSInvocationå¯¹è±¡ä¸­ï¼Œå†ç»™æ¥å—è€…æœ€åä¸€æ¬¡æœºä¼šï¼Œä»¤å…¶è®¾æ³•è§£å†³å½“å‰è¿˜æœªå¤„ç†çš„è¿™æ¡æ¶ˆæ¯ã€‚</p>
</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-6619cbf33830ce3f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šã€ŠEffective Objective-C ã€‹"></p>
<p>ç±»æ–¹æ³•<code>+(BOOL)resolveInstanceMethod:(SEL)selector</code>:æŸ¥çœ‹è¿™ä¸ªç±»æ˜¯å¦èƒ½æ–°å¢ä¸€ä¸ªå®ä¾‹æ–¹æ³•ç”¨ä»¥å¤„ç†æ­¤é€‰æ‹©å­</p>
<p>å®ä¾‹æ–¹æ³•<code>- (id)forwardTargetForSelector:(SEL)selector;</code>:è¯¢é—®æ˜¯å¦èƒ½æ‰¾åˆ°æœªçŸ¥æ¶ˆæ¯çš„å¤‡æ´æ¥å—è€…ï¼Œå¦‚æœèƒ½æ‰¾åˆ°å¤‡æ´å¯¹è±¡ï¼Œå°±å°†å…¶è¿”å›ï¼Œå¦‚æœä¸èƒ½ï¼Œå°±è¿”å›nilã€‚</p>
<p>å®ä¾‹æ–¹æ³•<code>- (void)forwardInvocation:(NSInvocation*)invocation</code>:åˆ›å»ºNSInvocationå¯¹è±¡ï¼Œå°†å°šæœªå¤„ç†çš„é‚£æ¡æ¶ˆæ¯ æœ‰å…³çš„å…¨éƒ¨ç»†èŠ‚éƒ½å°äºå…¶ä¸­ï¼Œåœ¨è§¦å‘NSInvocationå¯¹è±¡æ—¶ï¼Œâ€œæ¶ˆæ¯æ´¾å‘ç³»ç»Ÿï¼ˆmessage-dispatch systemï¼‰â€å°±ä¼šå°†æ¶ˆæ¯æ´¾ç»™ç›®æ ‡å¯¹è±¡ã€‚</p>
<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªå…³äºåŠ¨æ€æ–¹æ³•è§£æçš„ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCAutoDictionary</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *string;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *number;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSDate</span> *date;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="keyword">id</span> opaqueObject;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"EOCAutoDictionary.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCAutoDictionary</span> ()</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span> *backingStore;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCAutoDictionary</span></span></div><div class="line"><span class="keyword">@dynamic</span> string, number, date, opaqueObject;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)init &#123;</div><div class="line"> <span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</div><div class="line">    _backingStore = [<span class="built_in">NSMutableDictionary</span> new];</div><div class="line">&#125;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)selector &#123;</div><div class="line"></div><div class="line">     <span class="built_in">NSString</span> *selectorString = <span class="built_in">NSStringFromSelector</span>(selector);</div><div class="line">     <span class="keyword">if</span> ([selectorString hasPrefix:<span class="string">@"set"</span>]) &#123;</div><div class="line">         class_addMethod(<span class="keyword">self</span>,selector,(IMP)autoDictionarySetter, <span class="string">"v@:@"</span>);</div><div class="line">     &#125; <span class="keyword">else</span> &#123;</div><div class="line">         class_addMethod(<span class="keyword">self</span>,selector,(IMP)autoDictionaryGetter, <span class="string">"@@:"</span>);</div><div class="line">    &#125;</div><div class="line">     <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼ŒEOCAutoDictionaryç±»å°†å±æ€§è®¾ç½®ä¸º@dynamicï¼Œä¹Ÿå°±æ˜¯è¯´ç¼–è¯‘å™¨æ— æ³•è‡ªåŠ¨ä¸ºå…¶å±æ€§ç”Ÿæˆsetå’Œgetæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åŠ¨æ€ç»™å…¶æ·»åŠ setå’Œgetæ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬å®ç°äº†<code>resolveInstanceMethod:</code>æ–¹æ³•ï¼šé¦–å…ˆå°†é€‰æ‹©å­è½¬æ¢ä¸ºStringï¼Œç„¶ååˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å«æœ‰setå­—æ®µï¼Œå¦‚æœæœ‰ï¼Œåˆ™å¢åŠ å¤„ç†é€‰æ‹©å­çš„setæ–¹æ³•ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™å¢åŠ å¤„ç†é€‰æ‹©å­çš„getæ–¹æ³•ã€‚å…¶ä¸­<code>class_addMethod</code>å¯ä»¥ç»™ç±»åŠ¨æ€æ·»åŠ æ–¹æ³•ã€‚</p>
</blockquote>
<p>å®ç°å¢åŠ å¤„ç†é€‰æ‹©å­çš„getæ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> autoDictionaryGetter(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd) &#123;</div><div class="line"></div><div class="line">     <span class="comment">// Get the backing store from the object</span></div><div class="line">     EOCAutoDictionary *typedSelf = (EOCAutoDictionary*)<span class="keyword">self</span>;</div><div class="line">     <span class="built_in">NSMutableDictionary</span> *backingStore = typedSelf.backingStore;</div><div class="line"></div><div class="line">     <span class="comment">// The key is simply the selector name</span></div><div class="line">     <span class="built_in">NSString</span> *key = <span class="built_in">NSStringFromSelector</span>(_cmd);</div><div class="line"></div><div class="line">     <span class="comment">// Return the value</span></div><div class="line">     <span class="keyword">return</span> [backingStore objectForKey:key];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œé”®çš„åå­—å°±ç­‰äºæ–¹æ³•åï¼Œæ‰€ä»¥åœ¨å–å‡ºé”®å¯¹åº”çš„å€¼ä¹‹å‰ï¼Œè¦å°†æ–¹æ³•åè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<p>å®ç°å¢åŠ å¤„ç†é€‰æ‹©å­çš„setæ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> autoDictionarySetter(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd, <span class="keyword">id</span> value) &#123;</div><div class="line"></div><div class="line">     <span class="comment">// Get the backing store from the object</span></div><div class="line">     EOCAutoDictionary *typedSelf = (EOCAutoDictionary*)<span class="keyword">self</span>;</div><div class="line">     <span class="built_in">NSMutableDictionary</span> *backingStore = typedSelf.backingStore;</div><div class="line"></div><div class="line">     <span class="comment">/** The selector will be for example, "setOpaqueObject:".</span></div><div class="line">     * We need to remove the "set", ":" and lowercase the first</div><div class="line">     * letter of the remainder.</div><div class="line">     */</div><div class="line">     <span class="built_in">NSString</span> *selectorString = <span class="built_in">NSStringFromSelector</span>(_cmd);</div><div class="line">     <span class="built_in">NSMutableString</span> *key = [selectorString mutableCopy];</div><div class="line"></div><div class="line">     <span class="comment">// Remove the ':' at the end</span></div><div class="line">    [key deleteCharactersInRange:<span class="built_in">NSMakeRange</span>(key.length - <span class="number">1</span>, <span class="number">1</span>)];</div><div class="line"></div><div class="line">     <span class="comment">// Remove the 'set' prefix</span></div><div class="line">    [key deleteCharactersInRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">3</span>)];</div><div class="line"></div><div class="line">     <span class="comment">// Lowercase the first character</span></div><div class="line">     <span class="built_in">NSString</span> *lowercaseFirstChar = [[key substringToIndex:<span class="number">1</span>] lowercaseString];</div><div class="line">    [key replaceCharactersInRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">1</span>) withString:lowercaseFirstChar];</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (value) &#123;</div><div class="line">       [backingStore setObject:value forKey:key];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        [backingStore removeObjectForKey:key];        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å› ä¸ºkeyçš„åå­—å¯¹åº”äº†å±æ€§åï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰setï¼Œé¦–å­—æ¯å°å†™ï¼Œå°¾éƒ¨æ²¡æœ‰ï¼šçš„å­—ç¬¦ä¸²ã€‚ç„¶è€Œï¼Œå°†setæ–¹æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²åï¼Œæˆ‘ä»¬éœ€è¦å°†setæ–¹æ³•çš„è¿™äº›â€œè¾¹è§’â€éƒ½å¤„ç†æ‰ã€‚æœ€åå¾—åˆ°äº†â€œçº¯å‡€â€çš„é”®åï¼Œå†è¿›è¡Œå­—å…¸çš„èµ‹å€¼æ“ä½œã€‚</p>
</blockquote>
<h1 id="ç¬¬14æ¡ï¼šç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„"><a href="#ç¬¬14æ¡ï¼šç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„" class="headerlink" title="ç¬¬14æ¡ï¼šç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„"></a>ç¬¬14æ¡ï¼šç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„</h1><hr>
<p>åœ¨è¿è¡ŒæœŸç¨‹åºåº“çš„å¤´æ–‡ä»¶é‡Œå®šä¹‰äº†æè¿°OCå¯¹è±¡æ‰€ç”¨çš„æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</div><div class="line">    <span class="keyword">struct</span> objc_class &#123;</div><div class="line">         Class isa;</div><div class="line">         Class super_class;</div><div class="line">         <span class="keyword">const</span> <span class="keyword">char</span> *name;</div><div class="line">         <span class="keyword">long</span> version;</div><div class="line">         <span class="keyword">long</span> info;</div><div class="line">         <span class="keyword">long</span> instance_size;</div><div class="line">         <span class="keyword">struct</span> objc_ivar_list *ivars;</div><div class="line">         <span class="keyword">struct</span> objc_method_list **methodLists;</div><div class="line">         <span class="keyword">struct</span> objc_cache *cache;</div><div class="line">         <span class="keyword">struct</span> objc_protocol_list *protocols;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼ŒisaæŒ‡é’ˆæŒ‡å‘äº†å¯¹è±¡æ‰€å±çš„ç±»ï¼šå…ƒç±»ï¼ˆmetaclassï¼‰ï¼Œå®ƒæ˜¯æ•´ä¸ªç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå˜é‡ã€‚super_classå®šä¹‰äº†æœ¬ç±»çš„è¶…ç±»ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘å¯¹è±¡å‘é€ç‰¹å®šçš„æ–¹æ³•æ¥æ£€è§†ç±»çš„ç»§æ‰¿ä½“ç³»ï¼šè‡ªèº«å±äºå“ªä¸€ç±»ï¼›è‡ªèº«ç»§æ‰¿ä¸å“ªä¸€ç±»ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨<code>isMemberOfClass:</code>èƒ½å¤Ÿåˆ¤æ–­å‡ºå¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªç‰¹å®šç±»çš„å®ä¾‹ï¼›<br>è€Œ<code>isKindOfClass:</code>æ–¹æ³•èƒ½å¤Ÿåˆ¤æ–­å‡ºå¯¹è±¡æ˜¯å¦ä¸ºæŸç±»æˆ–å…¶æ´¾ç”Ÿç±»çš„å®ä¾‹ã€‚</p>
<p>è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯åˆ©ç”¨äº†isaæŒ‡é’ˆè·å–å¯¹è±¡æ‰€å±çš„ç±»ï¼Œç„¶åé€šè¿‡super_classç±»åœ¨ç»§æ‰¿ä½“ç³»ä¸­æŸ¥è¯¢ã€‚åœ¨OCè¯­è¨€ä¸­ï¼Œå¿…é¡»ä½¿ç”¨è¿™ç§æŸ¥è¯¢ç±»å‹ä¿¡æ¯çš„æ–¹æ³•æ‰èƒ½å®Œå…¨äº†è§£å¯¹è±¡çš„çœŸå®ç±»å‹ã€‚å› ä¸ºå¯¹è±¡ç±»å‹æ— æ³•åœ¨ç¼–è¯‘æœŸå†³å®šã€‚</p>
<p>å°¤å…¶æ³¨æ„åœ¨é›†åˆç±»é‡Œè·å–å¯¹è±¡æ—¶ï¼Œé€šå¸¸è¦æŸ¥è¯¢ç±»å‹ä¿¡æ¯å› ä¸ºè¿™äº›å¯¹è±¡ä¸æ˜¯å¼ºç±»å‹çš„ï¼ˆstrongly typedï¼‰ï¼Œå°†å®ƒä»¬ä»é›†åˆç±»ä¸­å–å‡ºæ¥çš„ç±»å‹é€šå¸¸æ˜¯idï¼Œä¹Ÿå°±æ˜¯èƒ½å“åº”ä»»ä½•æ¶ˆæ¯ï¼ˆç¼–è¯‘æœŸï¼‰ã€‚</p>
<p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯¹è¿™äº›å¯¹è±¡çš„ç±»å‹æŠŠæ¡ä¸å¥½ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¯èƒ½é€ æˆå¯¹è±¡æ— æ³•å“åº”æ¶ˆæ¯çš„æƒ…å†µã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬ä»é›†åˆé‡Œå–å‡ºå¯¹è±¡åï¼Œé€šå¸¸è¦è¿›è¡Œç±»å‹åˆ¤æ–­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSString</span>*)commaSeparatedStringFromObjects:(<span class="built_in">NSArray</span>*)array &#123;</div><div class="line"></div><div class="line">         <span class="built_in">NSMutableString</span> *string = [<span class="built_in">NSMutableString</span> new];</div><div class="line"></div><div class="line">             <span class="keyword">for</span> (<span class="keyword">id</span> object <span class="keyword">in</span> array) &#123;</div><div class="line">                    <span class="keyword">if</span> ([object isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</div><div class="line">                            [string appendFormat:<span class="string">@"%@,"</span>, object];</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([object isKindOfClass:[<span class="built_in">NSNumber</span> <span class="keyword">class</span>]]) &#123;</div><div class="line">                            [string appendFormat:<span class="string">@"%d,"</span>, [object intValue]];</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([object isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</div><div class="line">                           <span class="built_in">NSString</span> *base64Encoded = <span class="comment">/* base64 encoded data */</span>;</div><div class="line">                            [string appendFormat:<span class="string">@"%@,"</span>, base64Encoded];</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            <span class="comment">// Type not supported</span></div><div class="line">                    &#125;</div><div class="line">              &#125;</div><div class="line">             <span class="keyword">return</span> string;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="ç¬¬21æ¡ï¼šç†è§£Objective-Cé”™è¯¯ç±»å‹"><a href="#ç¬¬21æ¡ï¼šç†è§£Objective-Cé”™è¯¯ç±»å‹" class="headerlink" title="ç¬¬21æ¡ï¼šç†è§£Objective-Cé”™è¯¯ç±»å‹"></a>ç¬¬21æ¡ï¼šç†è§£Objective-Cé”™è¯¯ç±»å‹</h1><hr>
<p>åœ¨OCä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨NSErroræè¿°é”™è¯¯ã€‚<br>ä½¿ç”¨NSErrorå¯ä»¥å°è£…ä¸‰ç§ä¿¡æ¯ï¼š</p>
<ul>
<li>Error domain:é”™è¯¯èŒƒå›´ï¼Œç±»å‹æ˜¯å­—ç¬¦ä¸²</li>
<li>Error code :é”™è¯¯ç ï¼Œç±»å‹æ˜¯æ•´æ•°</li>
<li>User infoï¼šç”¨æˆ·ä¿¡æ¯ï¼Œç±»å‹æ˜¯å­—å…¸</li>
</ul>
<h2 id="1-NSErrorçš„ä½¿ç”¨"><a href="#1-NSErrorçš„ä½¿ç”¨" class="headerlink" title="1. NSErrorçš„ä½¿ç”¨"></a>1. NSErrorçš„ä½¿ç”¨</h2><p>ç”¨æ³•ï¼š</p>
<p>1.é€šè¿‡å§”æ‰˜åè®®æ¥ä¼ é€’NSErrorï¼Œå‘Šè¯‰ä»£ç†é”™è¯¯ç±»å‹ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didFailWithError:(<span class="built_in">NSError</span> *)error</div></pre></td></tr></table></figure>
<p>2.ä½œä¸ºæ–¹æ³•çš„â€œè¾“å‡ºå‚æ•°â€è¿”å›ç»™è°ƒç”¨è€…</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)doSomething:(<span class="built_in">NSError</span>**)error</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨èŒƒä¾‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</div><div class="line"><span class="built_in">BOOL</span> ret = [object doSomething:&amp;error];</div><div class="line"></div><div class="line"><span class="keyword">if</span> (error) &#123;</div><div class="line">    <span class="comment">// There was an error</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2-è‡ªå®šä¹‰NSError"><a href="#2-è‡ªå®šä¹‰NSError" class="headerlink" title="2. è‡ªå®šä¹‰NSError"></a>2. è‡ªå®šä¹‰NSError</h2><p>æˆ‘ä»¬å¯ä»¥è®¾ç½®å±äºæˆ‘ä»¬è‡ªå·±ç¨‹åºçš„é”™è¯¯èŒƒå›´å’Œé”™è¯¯ç </p>
<ul>
<li>é”™è¯¯èŒƒå›´å¯ä»¥ç”¨å…¨å±€å¸¸é‡å­—ç¬¦ä¸²æ¥å®šä¹‰ã€‚</li>
<li>é”™è¯¯ç å¯ä»¥ç”¨æšä¸¾æ¥å®šä¹‰ã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// EOCErrors.h</span></div><div class="line"><span class="keyword">extern</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> EOCErrorDomain;</div><div class="line"></div><div class="line"><span class="comment">//å®šä¹‰é”™è¯¯ç </span></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSUInteger</span>, EOCError) &#123;</div><div class="line"></div><div class="line">    EOCErrorUnknown = â€“<span class="number">1</span>,</div><div class="line">    EOCErrorInternalInconsistency = <span class="number">100</span>,</div><div class="line">    EOCErrorGeneralFault = <span class="number">105</span>,</div><div class="line">    EOCErrorBadInput = <span class="number">500</span>,</div><div class="line">&#125;;</div><div class="line"><span class="comment">// EOCErrors.m</span></div><div class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> EOCErrorDomain = <span class="string">@"EOCErrorDomain"</span>; <span class="comment">//å®šä¹‰é”™è¯¯èŒƒå›´</span></div></pre></td></tr></table></figure>
<h1 id="ç¬¬22æ¡ï¼šç†è§£NSCopyingåè®®"><a href="#ç¬¬22æ¡ï¼šç†è§£NSCopyingåè®®" class="headerlink" title="ç¬¬22æ¡ï¼šç†è§£NSCopyingåè®®"></a>ç¬¬22æ¡ï¼šç†è§£NSCopyingåè®®</h1><hr>
<p>å¦‚æœæˆ‘ä»¬æƒ³ä»¤è‡ªå·±çš„ç±»æ”¯æŒæ‹·è´æ“ä½œï¼Œé‚£å°±è¦å®ç°NSCopyingåè®®ï¼Œè¯¥åè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span>*)zone</div></pre></td></tr></table></figure>
<p>ä½œè€…ä¸¾äº†ä¸ªï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span>*)zone &#123;</div><div class="line">     EOCPerson *<span class="keyword">copy</span> = [[[<span class="keyword">self</span> <span class="keyword">class</span>] allocWithZone:zone] initWithFirstName:_firstName  andLastName:_lastName];</div><div class="line">    <span class="keyword">copy</span>-&gt;_friends = [_friends mutableCopy];</div><div class="line">     <span class="keyword">return</span> <span class="keyword">copy</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¹‹æ‰€ä»¥æ˜¯copy-&gt;_friendsï¼Œè€Œä¸æ˜¯copy.friendsæ˜¯å› ä¸ºfriendså¹¶ä¸æ˜¯å±æ€§ï¼Œè€Œæ˜¯ä¸€ä¸ªå†…éƒ¨ä½¿ç”¨çš„å®ä¾‹å˜é‡ã€‚</p>
</blockquote>
<h2 id="1-å¤åˆ¶å¯å˜çš„ç‰ˆæœ¬ï¼š"><a href="#1-å¤åˆ¶å¯å˜çš„ç‰ˆæœ¬ï¼š" class="headerlink" title="1. å¤åˆ¶å¯å˜çš„ç‰ˆæœ¬ï¼š"></a>1. å¤åˆ¶å¯å˜çš„ç‰ˆæœ¬ï¼š</h2><p>éµä»<nsmutablecopying>åè®®</nsmutablecopying></p>
<p>è€Œä¸”è¦æ‰§è¡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)mutableCopyWithZone:(<span class="built_in">NSZone</span>*)zoneï¼›</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šæ‹·è´å¯å˜å‹å’Œä¸å¯å˜å‹å‘é€çš„æ˜¯<code>copy</code>å’Œ<code>mutableCopy</code>æ¶ˆæ¯ï¼Œè€Œæˆ‘ä»¬å®ç°çš„å´æ˜¯<code>- (id)copyWithZone:(NSZone*)zone</code>å’Œ<code>- (id)mutableCopyWithZone:(NSZone*)zone</code> æ–¹æ³•ã€‚</p>
<p>è€Œä¸”ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è·å¾—æŸå¯¹è±¡çš„ä¸å¯å˜å‹ï¼Œç»Ÿä¸€è°ƒç”¨copyæ–¹æ³•ï¼›è·å¾—æŸå¯¹è±¡çš„å¯å˜å‹ï¼Œç»Ÿä¸€è°ƒç”¨mutableCopyæ–¹æ³•ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚æ•°ç»„çš„æ‹·è´ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-[<span class="built_in">NSMutableArray</span> <span class="keyword">copy</span>] =&gt; <span class="built_in">NSArray</span></div><div class="line">-[<span class="built_in">NSArray</span> mutableCopy] =&gt; <span class="built_in">NSMutableArray</span></div></pre></td></tr></table></figure>
<h2 id="2-æµ…æ‹·è´å’Œæ·±æ‹·è´"><a href="#2-æµ…æ‹·è´å’Œæ·±æ‹·è´" class="headerlink" title="2. æµ…æ‹·è´å’Œæ·±æ‹·è´"></a>2. æµ…æ‹·è´å’Œæ·±æ‹·è´</h2><p>Foundationæ¡†æ¶ä¸­çš„é›†åˆç±»é»˜è®¤éƒ½æ‰§è¡Œæµ…æ‹·è´ï¼šåªæ‹·è´å®¹å™¨å¯¹è±¡æœ¬èº«ï¼Œè€Œä¸å¤åˆ¶å…¶ä¸­çš„æ•°æ®ã€‚<br>è€Œæ·±æ‹·è´çš„æ„æ€æ˜¯è¿åŒå¯¹è±¡æœ¬èº«å’Œå®ƒçš„åº•å±‚æ•°æ®éƒ½è¦æ‹·è´ã€‚</p>
<p>ä½œè€…ç”¨ä¸€ä¸ªå›¾å¾ˆå½¢è±¡åœ°ä½“ç°äº†æµ…æ‹·è´å’Œæ·±æ‹·è´çš„åŒºåˆ«ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-0fd10d82cbecd8d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šã€ŠEffective Objective-Cã€‹"></p>
<blockquote>
<p>æµ…æ‹·è´åçš„å†…å®¹å’ŒåŸå§‹å†…å®¹æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡<br>æ·±æ‹·è´åçš„å†…å®¹æ‰€æŒ‡çš„å¯¹è±¡æ˜¯åŸå§‹å†…å®¹å¯¹åº”å¯¹è±¡çš„æ‹·è´</p>
</blockquote>
<h2 id="3-å¦‚ä½•æ·±æ‹·è´ï¼Ÿ"><a href="#3-å¦‚ä½•æ·±æ‹·è´ï¼Ÿ" class="headerlink" title="3. å¦‚ä½•æ·±æ‹·è´ï¼Ÿ"></a>3. å¦‚ä½•æ·±æ‹·è´ï¼Ÿ</h2><p>æˆ‘ä»¬éœ€è¦è‡ªå·±ç¼–å†™æ·±æ‹·è´çš„æ–¹æ³•ï¼šéå†æ¯ä¸ªå…ƒç´ å¹¶å¤åˆ¶ï¼Œç„¶åå°†å¤åˆ¶åçš„æ‰€æœ‰å…ƒç´ é‡æ–°ç»„æˆä¸€ä¸ªæ–°çš„é›†åˆã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)initWithSet:(<span class="built_in">NSArray</span>*)array copyItems:(<span class="built_in">BOOL</span>)copyItems;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è‡ªå·±æä¾›äº†ä¸€ä¸ªæ·±æ‹·è´çš„æ–¹æ³•ï¼šè¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šéœ€è¦æ‹·è´çš„æ•°ç»„å’Œæ˜¯å¦æ‹·è´å…ƒç´ ï¼ˆæ˜¯å¦æ·±æ‹·è´ï¼‰</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)deepCopy &#123;</div><div class="line">       EOCPerson *<span class="keyword">copy</span> = [[[<span class="keyword">self</span> <span class="keyword">class</span>] alloc] initWithFirstName:_firstName andLastName:_lastName];</div><div class="line">        <span class="keyword">copy</span>-&gt;_friends = [[<span class="built_in">NSMutableSet</span> alloc] initWithSet:_friends copyItems:<span class="literal">YES</span>];</div><div class="line">        <span class="keyword">return</span> <span class="keyword">copy</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•°"><a href="#ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•°" class="headerlink" title="ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•°"></a>ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•°</h1><hr>
<p>å°½ç®¡åœ¨iOSç³»ç»Ÿå·²ç»æ”¯æŒäº†è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼Œä½†ä»ç„¶éœ€è¦å¼€å‘è€…äº†è§£å…¶å†…å­˜ç®¡ç†æœºåˆ¶ã€‚</p>
<h2 id="1-è®¡æ•°å™¨çš„æ“ä½œï¼š"><a href="#1-è®¡æ•°å™¨çš„æ“ä½œï¼š" class="headerlink" title="1. è®¡æ•°å™¨çš„æ“ä½œï¼š"></a>1. è®¡æ•°å™¨çš„æ“ä½œï¼š</h2><ol>
<li>retainï¼šé€’å¢ä¿ç•™è®¡æ•°ã€‚</li>
<li>releaseï¼šé€’å‡ä¿ç•™è®¡æ•°</li>
<li>autorelease ï¼šå¾…ç¨åæ¸…ç†â€œè‡ªåŠ¨é‡Šæ”¾æ± æ—¶â€ï¼Œå†é€’å‡ä¿ç•™è®¡æ•°ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨å¯¹è±¡åˆå§‹åŒ–åï¼Œå¼•ç”¨è®¡æ•°ä¸ä¸€å®šæ˜¯1ï¼Œè¿˜æœ‰å¯èƒ½å¤§äº1ã€‚å› ä¸ºåœ¨åˆå§‹åŒ–æ–¹æ³•çš„å®ç°ä¸­ï¼Œæˆ–è®¸è¿˜æœ‰å…¶ä»–çš„æ“ä½œä½¿å¾—å¼•ç”¨è®¡æ•°+1ï¼Œä¾‹å¦‚å…¶ä»–çš„å¯¹è±¡ä¹Ÿä¿ç•™äº†æ­¤å¯¹è±¡ã€‚</p>
</blockquote>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®šåœ¨æŸä¸ªæ“ä½œåå¼•ç”¨è®¡æ•°çš„ç¡®åˆ‡å€¼ï¼Œè€Œåªèƒ½åˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯é€’å¢è¿˜æ˜¯é€’å‡äº†ä¿ç•™è®¡æ•°ã€‚</p>
<h2 id="2-è‡ªåŠ¨é‡Šæ”¾æ± ï¼š"><a href="#2-è‡ªåŠ¨é‡Šæ”¾æ± ï¼š" class="headerlink" title="2. è‡ªåŠ¨é‡Šæ”¾æ± ï¼š"></a>2. è‡ªåŠ¨é‡Šæ”¾æ± ï¼š</h2><p>å°†å¯¹è±¡æ”¾å…¥è‡ªåŠ¨é‡Šæ”¾æ± ä¹‹åï¼Œä¸ä¼šé©¬ä¸Šä½¿å…¶å¼•ç”¨è®¡æ•°-1ï¼Œè€Œæ˜¯åœ¨å½“å‰çº¿ç¨‹çš„ä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯æ—¶é€’å‡ã€‚</p>
<p>ä½¿ç”¨ä¸¾ä¾‹ï¼šå¦‚æœæˆ‘ä»¬æƒ³é‡Šæ”¾å½“å‰éœ€è¦ä½¿ç”¨çš„æ–¹æ³•è¿”å›å€¼æ˜¯ï¼Œå¯ä»¥å°†å…¶æš‚æ—¶æ”¾åœ¨è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSString</span>*)stringValue &#123;</div><div class="line">     <span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc] initWithFormat:<span class="string">@"I am this: %@"</span>, <span class="keyword">self</span>];</div><div class="line">     <span class="keyword">return</span> [str autorelease];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3-ä¿ç•™ç¯ï¼ˆretain-cycleï¼‰"><a href="#3-ä¿ç•™ç¯ï¼ˆretain-cycleï¼‰" class="headerlink" title="3. ä¿ç•™ç¯ï¼ˆretain cycleï¼‰"></a>3. ä¿ç•™ç¯ï¼ˆretain cycleï¼‰</h2><p>å¯¹è±¡ä¹‹é—´ç›¸äº’ç”¨å¼ºå¼•ç”¨æŒ‡å‘å¯¹æ–¹ï¼Œä¼šä½¿å¾—å…¨éƒ¨éƒ½æ— æ³•å¾—ä»¥é‡Šæ”¾ã€‚è§£å†³æ–¹æ¡ˆæ˜¯è®²å…¶ä¸­ä¸€ç«¯çš„å¼•ç”¨æ”¹ä¸ºå¼±å¼•ç”¨ï¼ˆweak referenceï¼‰ï¼Œåœ¨å¼•ç”¨çš„åŒæ—¶ä¸é€’å¢å¼•ç”¨è®¡æ•°ã€‚</p>
<h1 id="ç¬¬30æ¡ï¼šä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°"><a href="#ç¬¬30æ¡ï¼šä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°" class="headerlink" title="ç¬¬30æ¡ï¼šä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°"></a>ç¬¬30æ¡ï¼šä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°</h1><hr>
<p>ä½¿ç”¨ARCï¼Œå¯ä»¥çœç•¥å¯¹äºå¼•ç”¨è®¡æ•°çš„æ“ä½œï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºå¼€å‘æœ¬èº«ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ([<span class="keyword">self</span> shouldLogMessage]) &#123;</div><div class="line">     <span class="built_in">NSString</span> *message = [[<span class="built_in">NSString</span> alloc] initWithFormat:<span class="string">@"I am object, %p"</span>, <span class="keyword">self</span>];</div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"message = %@"</span>, message);</div><div class="line">      [message release]; <span class="comment">///&lt; Added by ARC</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ˜¾ç„¶è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦messageå¯¹è±¡äº†ï¼Œé‚£ä¹ˆARCä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ å†…å­˜ç®¡ç†çš„è¯­å¥ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œåœ¨ARCç¯å¢ƒä¸‹è°ƒç”¨å†…å­˜ç®¡ç†è¯­å¥æ˜¯éæ³•çš„ï¼š</p>
<ul>
<li>retain</li>
<li>release</li>
<li>autorelease</li>
<li>dealloc</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šARCåªè´Ÿè´£ç®¡ç†OCå¯¹è±¡çš„å†…å­˜ï¼ŒCoreFoundationå¯¹è±¡ä¸å½’ARCç®¡ç†</p>
</blockquote>
<h1 id="ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ"><a href="#ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ" class="headerlink" title="ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ"></a>ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ</h1><hr>
<p>å¯¹äºâ€œå—â€çš„åŸºç¡€çŸ¥è¯†å°±ä¸å†èµ˜è¿°äº†ï¼Œè¿™é‡Œå¼ºè°ƒä¸€ä¸‹å—çš„ç§ç±»ã€‚</p>
<p>å—(Block)åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>æ ˆå—</li>
<li>å †å—</li>
<li>å…¨å±€å—</li>
</ul>
<h2 id="1-æ ˆå—"><a href="#1-æ ˆå—" class="headerlink" title="1. æ ˆå—"></a>1. æ ˆå—</h2><p>å®šä¹‰å—çš„æ—¶å€™ï¼Œå…¶æ‰€å å†…å­˜åŒºåŸŸæ˜¯åˆ†é…åœ¨æ ˆä¸­çš„ï¼Œè€Œä¸”åªåœ¨å®šä¹‰å®ƒçš„é‚£ä¸ªèŒƒå›´å†…æœ‰æ•ˆï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> (^block)();</div><div class="line"><span class="keyword">if</span> ( <span class="comment">/* some condition */</span> ) &#123;</div><div class="line">    block = ^&#123;</div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"Block A"</span>);</div><div class="line">    &#125;;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    block = ^&#123;</div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"Block B"</span>);</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line">block();</div></pre></td></tr></table></figure>
<p>ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªå—åªåœ¨if elseè¯­å¥èŒƒå›´å†…æœ‰æ•ˆï¼Œä¸€æ—¦ç¦»å¼€äº†æœ€åä¸€ä¸ªå³æ‹¬å·ï¼Œå¦‚æœç¼–è¯‘å™¨è¦†å†™äº†åˆ†é…ç»™å—çš„å†…å­˜ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆç¨‹åºå´©æºƒã€‚</p>
<h2 id="2-å †å—"><a href="#2-å †å—" class="headerlink" title="2. å †å—"></a>2. å †å—</h2><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å¯¹è±¡å‘é€copyæ¶ˆæ¯ï¼Œå¤åˆ¶ä¸€ä»½åˆ°å †é‡Œï¼Œå¹¶è‡ªå¸¦å¼•ç”¨è®¡æ•°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> (^block)();</div><div class="line"><span class="keyword">if</span> ( <span class="comment">/* some condition */</span> ) &#123;</div><div class="line">    block = [^&#123;</div><div class="line">         <span class="built_in">NSLog</span>(<span class="string">@"Block A"</span>);</div><div class="line">   &#125; <span class="keyword">copy</span>];</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    block = [^&#123;</div><div class="line">         <span class="built_in">NSLog</span>(<span class="string">@"Block B"</span>);</div><div class="line">    &#125; <span class="keyword">copy</span>];</div><div class="line">&#125;</div><div class="line">block();</div></pre></td></tr></table></figure>
<h2 id="3-å…¨å±€å—"><a href="#3-å…¨å±€å—" class="headerlink" title="3. å…¨å±€å—"></a>3. å…¨å±€å—</h2><p>å…¨å±€å—å£°æ˜åœ¨å…¨å±€å†…å­˜é‡Œï¼Œè€Œä¸éœ€è¦åœ¨æ¯æ¬¡ç”¨åˆ°çš„æ—¶å€™äºæ ˆä¸­åˆ›å»ºã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> (^block)() = ^&#123;</div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"This is a block"</span>);</div><div class="line">ï»¿&#125;;</div></pre></td></tr></table></figure>
<h1 id="ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶"><a href="#ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶" class="headerlink" title="ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶"></a>ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶</h1><hr>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†ç³»ç»Ÿæä¾›çš„ç°æˆçš„æ¡†æ¶ï¼Œé‚£ä¹ˆç”¨æˆ·åœ¨å‡çº§ç³»ç»Ÿåï¼Œå°±å¯ä»¥ç›´æ¥äº«å—ç³»ç»Ÿå‡çº§æ‰€å¸¦æ¥çš„æ”¹è¿›ã€‚</p>
<p>ä¸»è¦çš„ç³»ç»Ÿæ¡†æ¶ï¼š</p>
<ul>
<li>Foundation:NSObject,NSArray,NSDictionaryç­‰</li>
<li>CFoundationæ¡†æ¶ï¼šCè¯­è¨€APIï¼ŒFoundationæ¡†æ¶ä¸­çš„è®¸å¤šåŠŸèƒ½ï¼Œéƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å¯¹åº”çš„Cè¯­è¨€API</li>
<li>CFNetworkæ¡†æ¶:Cè¯­è¨€APIï¼Œæä¾›äº†Cè¯­è¨€çº§åˆ«çš„ç½‘ç»œé€šä¿¡èƒ½åŠ›</li>
<li>CoreAudio:Cè¯­è¨€APIï¼Œæ“ä½œè®¾å¤‡ä¸Šçš„éŸ³é¢‘ç¡¬ä»¶</li>
<li>AVFoundationæ¡†æ¶ï¼šæä¾›çš„OCå¯¹è±¡å¯ä»¥å›æ”¾å¹¶å½•åˆ¶éŸ³é¢‘å’Œè§†é¢‘</li>
<li>CoreDataæ¡†æ¶ï¼šOCçš„APIï¼Œå°†å¯¹è±¡å†™å…¥æ•°æ®åº“</li>
<li>CoreTextæ¡†æ¶ï¼šCè¯­è¨€APIï¼Œé«˜æ•ˆæ‰§è¡Œæ–‡å­—æ’ç‰ˆå’Œæ¸²æŸ“æ“ä½œ</li>
</ul>
<p>ç”¨Cè¯­è¨€æ¥å®ç°APIçš„å¥½å¤„ï¼šå¯ä»¥ç»•è¿‡OCçš„è¿è¡ŒæœŸç³»ç»Ÿï¼Œä»è€Œæå‡æ‰§è¡Œé€Ÿåº¦ã€‚</p>
<h1 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h1><hr>
<p>åƒæœ¬æ–‡å¼€å¤´æ‰€è¯´ï¼Œæœ¬æ–‡æ˜¯ä¸‰éƒ¨æ›²ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼šæ¦‚å¿µç¯‡ï¼Œç¬”è€…ä¸»è¦å°†æœ¬ä¹¦è®²è§£æ¦‚å¿µçš„çŸ¥è¯†ç‚¹æŠ½å–å‡ºæ¥åˆå¹¶è€Œæˆï¼Œå†…å®¹ç›¸å¯¹åä¸¤ç¯‡ç®€å•ä¸€äº›ã€‚ç¬”è€…ä¼šåœ¨ä¸€å‘¨çš„æ—¶é—´é‡Œé™†ç»­æ¨å‡ºç¬¬2ç¯‡ï¼ˆè§„èŒƒç¯‡ï¼‰ï¼Œç¬¬3ç¯‡ï¼ˆæŠ€å·§ç¯‡ï¼‰~<br>æœ›å„è·¯å¤§ç¥å’Œåœ¨å¤§ç¥è·¯ä¸Šçš„ä¼™ä¼´ä»¬å¤šå¤šäº¤æµã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-4696272b0a4ffe42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;ã€ŠEffective Objective-C ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¾ˆå¤šæ–‡ç« å’Œå¤§ç‰›éƒ½åœ¨æ¨èè¿™æœ¬ä¹¦ï¼Œè¯´å®ƒè®²æˆäº†å¾ˆå¤šç¼–å†™Objective-Cè¯­è¨€æ—¶æ‰€åº”è¯¥éµå¾ªçš„è§„èŒƒã€‚åˆšå¥½ç¬”è€…å‰æ®µæ—¶é—´å› ä¸ºäº§å“åˆšå¼€å‘å®Œï¼Œæœ‰äº†ä¸€ç‚¹ç©ºæ¡£æœŸï¼Œäºæ˜¯ç”¨äº†3ä¸ªæ˜ŸæœŸçš„æ—¶é—´ä»”ç»†ç ”è¯»å’Œæ€»ç»“äº†è¿™æœ¬ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¹Ÿçœ‹è¿‡å¾ˆå¤šæ€»ç»“è¿™æœ¬ä¹¦çš„åšå®¢å’Œæ–‡ç« ï¼Œä½†æ˜¯å‘ç°å¤šæ•°åªæ˜¯å°†æ¯èŠ‚çš„æ€»ç»“éƒ¨åˆ†æŠ„äº†è¿‡æ¥ï¼Œè®²å¾—å¹¶ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œäºæ˜¯ç¬”è€…å°±æƒ³æŒ‰ç…§è‡ªå·±çš„æ–¹å¼å¯¹è¿™æœ¬ä¹¦è¿›è¡Œæ€»ç»“ï¼Œå¹¶ä»¥åšå®¢çš„å½¢å¼å±•ç°å‡ºæ¥ï¼šæ—¢èƒ½åˆ†äº«ï¼ŒåŒæ—¶åˆèƒ½å¯¹çŸ¥è¯†è¿›è¡Œä¸€ä¸‹æ¢³ç†å’ŒäºŒæ¬¡å¤ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶æœ¬ä¹¦çš„ä½œè€…æŒ‰ç…§çŸ¥è¯†æ¨¡å—æ¥å°†è¿™æœ¬ä¹¦åˆ†æˆä¸ƒä¸ªç« èŠ‚ï¼Œå…±52èŠ‚ï¼Œä½†æ˜¯ç¬”è€…åœ¨æ‹œè¯»çš„è¿‡ç¨‹ä¸­å‘ç°æœ¬ä¹¦ä»‹ç»çš„çŸ¥è¯†ç‚¹å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼šæ¦‚å¿µç±»ï¼Œè§„èŒƒç±»ï¼Œå’ŒæŠ€å·§ç±»ã€‚ç¬”è€…æ‰“ç®—æŒ‰ç…§è¿™ä¸‰ç±»æ¥å¯¹è¿™æœ¬ä¹¦è¿›è¡Œæ€»ç»“ï¼Œå½¢æˆä¸‰éƒ¨æ›²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¦‚å¿µç±»ï¼šè®²è§£äº†ä¸€äº›æ¦‚å¿µæ€§çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;li&gt;è§„èŒƒç±»ï¼šè®²è§£äº†ä¸€äº›ä¸ºäº†é¿å…ä¸€äº›é—®é¢˜æˆ–è€…ä¸ºåç»­å¼€å‘æä¾›ä¾¿åˆ©æ‰€éœ€è¦éµå¾ªçš„è§„èŒƒæ€§çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;li&gt;æŠ€å·§ç±»ï¼šè®²è§£äº†ä¸€äº›ä¸ºäº†è§£å†³æŸäº›ç‰¹å®šé—®é¢˜è€Œéœ€è¦ç”¨åˆ°çš„æŠ€å·§æ€§çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œä¸”ï¼Œç¬”è€…ä¹ŸæŒ‰ç…§è‡ªå·±çš„å½’ç±»å°†è¿™æœ¬ä¹¦çš„ç»“æ„ç”¨æ€ç»´å¯¼å›¾å·¥å…·ç”»äº†å‡ºæ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-539498fef0819472.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;ä¸‰éƒ¨æ›²åˆ†å¸ƒå›¾&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç¬”è€…å¹¶æ²¡æœ‰æ‰“ä¹±åŸæ¥ä½œè€…çš„æ ‡é¢˜é¡ºåºã€‚æœ¬ç¯‡æ€»ç»“å³æ˜¯ä¸‰éƒ¨æ›²ä¹‹ä¸€ï¼šæ¦‚å¿µç¯‡ï¼Œåç»­ä¼šå‘ˆä¸Šè§„èŒƒç¯‡å’ŒæŠ€å·§ç¯‡ã€‚&lt;br&gt;å¤‡æ³¨ï¼šæœ¬æ€»ç»“æ‰€æœ‰çš„ä»£ç å’Œå›¾ç‰‡éƒ½æ¥è‡ªåŸä¹¦ã€‚å…¶ä¸­ï¼Œä»£ç ä¼šé€‚å½“åŠ ä¸Šç¬”è€…çš„æ³¨é‡Šï¼Œä¾¿äºå„ä½çœ‹å®˜ç†è§£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¥½äº†ï¼Œä¸å•°å—¦äº†ï¼Œ å¼€å§‹å§ï¼&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>è¯¦è§£iOSå¤šå›¾ä¸‹è½½çš„ç¼“å­˜æœºåˆ¶</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/%E8%AF%A6%E8%A7%A3iOS%E5%A4%9A%E5%9B%BE%E4%B8%8B%E8%BD%BD%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/è¯¦è§£iOSå¤šå›¾ä¸‹è½½çš„ç¼“å­˜æœºåˆ¶/</id>
    <published>2017-01-13T05:33:55.000Z</published>
    <updated>2017-03-20T07:56:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>åšiOSå¼€å‘ä¹Ÿæœ‰åŠå¹´å¤šäº†ï¼Œæƒ³æƒ³è‡ªå·±å¯¹ä¸€äº›ç¬¬ä¸‰æ–¹åº“è¿˜åªæ˜¯åœç•™åœ¨ç®€å•è¿ç”¨çš„é˜¶æ®µï¼Œæ„Ÿè§‰å¿ƒæ…Œæ…Œçš„ã€‚äºæ˜¯å†³å®šç”¨ä¸€ä¸ªæœˆçš„æ—¶é—´æ·±å…¥äº†è§£ä¸€äº›å¥½çš„ç¬¬ä¸‰æ–¹åº“ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæƒ³åˆ°äº†SDWebImageï¼Œè¿™ä¸ªåº“å¾ˆä¸é”™ï¼Œå‡ ä¹æ¯ä¸ªiOSé¡¹ç›®éƒ½ä¼šæœ‰å®ƒçš„å½±å­ï¼Œå› ä¸ºå®ƒå¾ˆå®Œç¾åœ°è§£å†³äº†ä¸‹è½½å›¾ç‰‡å¹¶æ˜¾ç¤ºçš„å¤„ç†é€»è¾‘ã€‚é‚£ä¹ˆæ·±ç©¶å®ƒä¹‹å‰ï¼Œç¬”è€…å‡†å¤‡å…ˆäº†è§£ä¸€ä¸‹å¤šå›¾ä¸‹è½½çš„ç¼“å­˜æœºåˆ¶ï¼Œå› ä¸ºå®ƒå’ŒSDWebImageçš„æ–¹æ¡ˆç±»ä¼¼ã€‚</p>
<p>æœ‰ä¸€ä¸ªå¤šå›¾ç¼“å­˜æœºåˆ¶çš„æ•™ç¨‹æ˜¯æ¥è‡ªææ˜æ°å°ç å“¥çš„ï¼Œç¬”è€…è§‰å¾—è®²å¾—æŒºä¸é”™çš„ï¼Œäºæ˜¯å°±èŠ±äº†2ä¸ªå°æ—¶å¥½å¥½å­¦ä¹ äº†ä¸€ä¸‹ã€‚</p>
<a id="more"></a>
<h1 id="1-éœ€æ±‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-éœ€æ±‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.éœ€æ±‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.éœ€æ±‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</h1><hr>
<p>è¿™é‡Œæ‰€è¯´çš„<strong>å¤šå›¾ä¸‹è½½</strong>ï¼Œå°±æ˜¯è¦åœ¨tableviewçš„æ¯ä¸€ä¸ªcellé‡Œæ˜¾ç¤ºä¸€å¼ å›¾ç‰‡,è€Œä¸”è¿™äº›å›¾ç‰‡éƒ½éœ€è¦ä»ç½‘ä¸Šä¸‹è½½ã€‚</p>
<h1 id="2-å®¹æ˜“é‡åˆ°çš„é—®é¢˜"><a href="#2-å®¹æ˜“é‡åˆ°çš„é—®é¢˜" class="headerlink" title="2.å®¹æ˜“é‡åˆ°çš„é—®é¢˜"></a>2.å®¹æ˜“é‡åˆ°çš„é—®é¢˜</h1><hr>
<p>å¦‚æœä¸çŸ¥é“æˆ–ä¸ä½¿ç”¨<strong>å¼‚æ­¥æ“ä½œ</strong>å’Œ<strong>ç¼“å­˜æœºåˆ¶</strong>ï¼Œé‚£ä¹ˆå†™å‡ºæ¥çš„ä»£ç å¾ˆå¯èƒ½ä¼šæ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cell.textLabel.text = app.name;</div><div class="line">cell.detailTextLabel.text = app.download;</div><div class="line"><span class="built_in">NSData</span> *imageData = [<span class="built_in">NSData</span> dataWithContentsOfURL:app.url];</div><div class="line">cell.imageView.image = [<span class="built_in">UIImage</span> imageWithData:imageData];</div></pre></td></tr></table></figure>
<p>è¿™æ ·å†™æœ‰ä»€ä¹ˆåæœå‘¢ï¼Ÿ</p>
<h4 id="åæœ1ï¼šä¸å¯é¿å…çš„å¡é¡¿ï¼ˆå› ä¸ºæ²¡æœ‰å¼‚æ­¥ä¸‹è½½æ“ä½œï¼‰"><a href="#åæœ1ï¼šä¸å¯é¿å…çš„å¡é¡¿ï¼ˆå› ä¸ºæ²¡æœ‰å¼‚æ­¥ä¸‹è½½æ“ä½œï¼‰" class="headerlink" title="åæœ1ï¼šä¸å¯é¿å…çš„å¡é¡¿ï¼ˆå› ä¸ºæ²¡æœ‰å¼‚æ­¥ä¸‹è½½æ“ä½œï¼‰"></a>åæœ1ï¼šä¸å¯é¿å…çš„å¡é¡¿ï¼ˆå› ä¸ºæ²¡æœ‰å¼‚æ­¥ä¸‹è½½æ“ä½œï¼‰</h4><blockquote>
<p>dataWithContentsOfURLï¼šæ˜¯è€—æ—¶æ“ä½œï¼Œå°†å…¶æ”¾åœ¨ä¸»çº¿ç¨‹ä¼šé€ æˆå¡é¡¿ã€‚å¦‚æœå›¾ç‰‡å¾ˆå¤šï¼Œå›¾ç‰‡å¾ˆå¤§ï¼Œè€Œä¸”ç½‘ç»œæƒ…å†µä¸å¥½çš„è¯è‚¯å®šä¼šå¡å‡ºç¿”ï¼</p>
</blockquote>
<h4 id="åæœ2ï¼šåŒä¸€å›¾ç‰‡é‡å¤ä¸‹è½½ï¼Œè€—è´¹æµé‡å’Œç³»ç»Ÿå¼€é”€ï¼ˆå› ä¸ºæ²¡æœ‰å»ºç«‹ç¼“å­˜æœºåˆ¶ï¼‰"><a href="#åæœ2ï¼šåŒä¸€å›¾ç‰‡é‡å¤ä¸‹è½½ï¼Œè€—è´¹æµé‡å’Œç³»ç»Ÿå¼€é”€ï¼ˆå› ä¸ºæ²¡æœ‰å»ºç«‹ç¼“å­˜æœºåˆ¶ï¼‰" class="headerlink" title="åæœ2ï¼šåŒä¸€å›¾ç‰‡é‡å¤ä¸‹è½½ï¼Œè€—è´¹æµé‡å’Œç³»ç»Ÿå¼€é”€ï¼ˆå› ä¸ºæ²¡æœ‰å»ºç«‹ç¼“å­˜æœºåˆ¶ï¼‰"></a>åæœ2ï¼šåŒä¸€å›¾ç‰‡é‡å¤ä¸‹è½½ï¼Œè€—è´¹æµé‡å’Œç³»ç»Ÿå¼€é”€ï¼ˆå› ä¸ºæ²¡æœ‰å»ºç«‹ç¼“å­˜æœºåˆ¶ï¼‰</h4><blockquote>
<p>ç”±äºæ²¡æœ‰ç¼“å­˜æœºåˆ¶ï¼Œå³ä½¿ä¸‹è½½å®Œæˆå¹¶æ˜¾ç¤ºäº†å½“å‰cellçš„å›¾ç‰‡ï¼Œä½†æ˜¯å½“è¯¥cellå†ä¸€æ¬¡éœ€è¦æ˜¾ç¤ºçš„æ—¶å€™è¿˜æ˜¯ä¼šä¸‹è½½å®ƒæ‰€å¯¹åº”çš„å›¾ç‰‡ï¼šè€—è´¹äº†ä¸‹è½½æµé‡ï¼Œè€Œä¸”è¿˜å¯¼è‡´é‡å¤æ“ä½œã€‚</p>
</blockquote>
<p>å¾ˆæ˜¾ç„¶ï¼Œè¦è¾¾åˆ°Tableviewæ»šåŠ¨çš„<strong>å¦‚ä¸æ»‘èˆ¬çš„äº«å—</strong>å¿…é¡»äºŒè€…å…¼å¾—æ‰å¯ä»¥ï¼Œå…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<h1 id="3-è§£å†³æ–¹æ¡ˆ"><a href="#3-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.è§£å†³æ–¹æ¡ˆ"></a>3.è§£å†³æ–¹æ¡ˆ</h1><hr>
<h4 id="1-å…ˆçœ‹ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„æµç¨‹å›¾"><a href="#1-å…ˆçœ‹ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„æµç¨‹å›¾" class="headerlink" title="1.å…ˆçœ‹ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„æµç¨‹å›¾"></a>1.å…ˆçœ‹ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„æµç¨‹å›¾</h4><p>å°ç å“¥å°†ä»–çš„è§£å†³æ–¹æ¡ˆåœ¨PPTé‡Œç”¨æµç¨‹å›¾ç”»äº†å‡ºæ¥ï¼Œç¬”è€…è§‰å¾—å¾ˆä¸é”™ï¼Œä½†æ˜¯é¢œå€¼ç•¥ä½ï¼ˆæ¯•ç«Ÿäººå®¶æ˜¯ä¸€å¿ƒææŠ€æœ¯ï¼Œæ²¡æ—¶é—´åœ¨æ„è¿™äº›å¤–åœ¨çš„ä¸œè¥¿ï¼‰ï¼Œç¬”è€…ç†äº†ç†æ€è·¯ï¼Œè‡ªå·±é‡æ–°ç”»äº†ä¸€å¼ ï¼ˆå¥½çœ‹ä¹ˆï¼Ÿï¼‰ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-addf3137097c3912.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤šå›¾ä¸‹è½½è§£å†³æ–¹æ¡ˆæµç¨‹å›¾"></p>
<p>è¦æƒ³å¿«é€Ÿçœ‹æ‡‚æ­¤å›¾ï¼Œéœ€è¦å…ˆäº†è§£è¯¥æµç¨‹æ‰€éœ€çš„æ‰€æœ‰æ•°æ®æºï¼š</p>
<p><strong>1. å›¾ç‰‡çš„URL</strong>ï¼šå› ä¸ºæ¯å¼ å›¾ç‰‡å¯¹åº”çš„URLéƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥å»ºç«‹<strong>å›¾ç‰‡ç¼“å­˜</strong>å’Œ<strong>ä¸‹è½½æ“ä½œçš„ç¼“å­˜</strong>çš„é”®ï¼Œä»¥åŠæ‹¼æ¥<strong>æ²™ç›’ç¼“å­˜</strong>çš„è·¯å¾„å­—ç¬¦ä¸²ã€‚<br><strong>2. å›¾ç‰‡ç¼“å­˜ï¼ˆå­—å…¸ï¼‰</strong>ï¼šå­˜æ”¾äºå†…å­˜ä¸­ï¼›é”®ä¸ºå›¾ç‰‡çš„URLï¼Œå€¼ä¸ºUIImageå¯¹è±¡ã€‚ä½œç”¨ï¼šè¯»å–é€Ÿåº¦å¿«ï¼Œç›´æ¥ä½¿ç”¨UIImageå¯¹è±¡ã€‚<br><strong>3. ä¸‹è½½æ“ä½œç¼“å­˜ï¼ˆå­—å…¸ï¼‰</strong>ï¼šå­˜æ”¾ä¸å†…å­˜ä¸­ï¼Œé”®ä¸ºå›¾ç‰‡çš„URLï¼Œå€¼ä¸ºNSBlockOperationå¯¹è±¡ã€‚ä½œç”¨ï¼šç”¨æ¥é¿å…å¯¹äºåŒä¸€å¼ å›¾ç‰‡è¿˜è¦å¼€å¯å¤šä¸ªä¸‹è½½çº¿ç¨‹ã€‚<br><strong>4. æ²™ç›’ç¼“å­˜(æ–‡ä»¶è·¯å¾„å¯¹åº”NSData)</strong>ï¼šå­˜æ”¾äºç£ç›˜ä¸­ï¼Œä½äºCacheæ–‡ä»¶å¤¹å†…ï¼Œè·¯å¾„ä¸ºâ€œCache/å›¾ç‰‡URLçš„æœ€åçš„éƒ¨åˆ†â€ï¼Œå€¼ä¸ºNSDataå¯¹è±¡ï¼ˆå°†UIImageè½¬åŒ–ä¸ºNSDataæ‰èƒ½å†™å…¥ç£ç›˜é‡Œï¼‰ã€‚ä½œç”¨ï¼šç¨‹åºæ–­ç½‘ï¼Œå†æ¬¡å¯åŠ¨ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç£ç›˜ä¸­æ‹¿åˆ°å›¾ç‰‡ã€‚</p>
<h4 id="2-å†çœ‹ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„ä»£ç "><a href="#2-å†çœ‹ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„ä»£ç " class="headerlink" title="2.å†çœ‹ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„ä»£ç "></a>2.å†çœ‹ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„ä»£ç </h4><p><strong>2.1å›¾ç‰‡ç¼“å­˜ï¼Œä¸‹è½½æ“ä½œç¼“å­˜ï¼Œæ²™ç›’ç¼“å­˜è·¯å¾„</strong><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">Â *Â  å­˜æ”¾æ‰€æœ‰ä¸‹è½½å®Œçš„å›¾ç‰‡</div><div class="line">Â */</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span> *images;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">Â *Â  å­˜æ”¾æ‰€æœ‰çš„ä¸‹è½½æ“ä½œï¼ˆkeyæ˜¯urlï¼Œvalueæ˜¯operationå¯¹è±¡ï¼‰</div><div class="line">Â */</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span> *operations;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">Â *Â  æ‹¼æ¥Cacheæ–‡ä»¶å¤¹çš„è·¯å¾„ä¸urlæœ€åçš„éƒ¨åˆ†ï¼Œåˆå¹¶æˆå”¯ä¸€çº¦å®šå¥½çš„ç¼“å­˜è·¯å¾„</div><div class="line">Â */</div><div class="line"><span class="meta">#define CachedImageFile(url) [[NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:[url lastPathComponent]]</span></div></pre></td></tr></table></figure></p>
<p><strong>2.2 å›¾ç‰‡ä¸‹è½½ä¹‹å‰çš„æŸ¥è¯¢ç¼“å­˜éƒ¨åˆ†</strong>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å…ˆä»imagesç¼“å­˜ä¸­å–å‡ºå›¾ç‰‡urlå¯¹åº”çš„UIImage</span></div><div class="line">Â  Â  <span class="built_in">UIImage</span> *image = <span class="keyword">self</span>.images[app.icon];</div><div class="line">Â  Â  <span class="keyword">if</span> (image) &#123; </div><div class="line"></div><div class="line">    <span class="comment">// å­˜åœ¨ï¼šè¯´æ˜å›¾ç‰‡å·²ç»ä¸‹è½½æˆåŠŸï¼Œå¹¶ç¼“å­˜æˆåŠŸï¼‰</span></div><div class="line">Â  Â  Â  Â  cell.imageView.image = image;</div><div class="line"></div><div class="line">Â  Â  &#125; <span class="keyword">else</span> &#123; </div><div class="line"></div><div class="line">     <span class="comment">// ä¸å­˜åœ¨ï¼šè¯´æ˜å›¾ç‰‡å¹¶æœªä¸‹è½½æˆåŠŸè¿‡ï¼Œæˆ–è€…æˆåŠŸä¸‹è½½ä½†æ˜¯åœ¨imagesé‡Œç¼“å­˜å¤±è´¥ï¼Œéœ€è¦åœ¨æ²™ç›’é‡Œå¯»æ‰¾å¯¹äºçš„å›¾ç‰‡</span></div><div class="line"></div><div class="line">Â  Â   Â  Â  <span class="comment">// è·å¾—urlå¯¹äºçš„æ²™ç›’ç¼“å­˜è·¯å¾„</span></div><div class="line">Â  Â  Â  Â  <span class="built_in">NSString</span> *file = CachedImageFile(app.icon);</div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  <span class="comment">// å…ˆä»æ²™ç›’ä¸­å–å‡ºå›¾ç‰‡</span></div><div class="line">Â  Â  Â  Â  <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfFile:file];</div><div class="line"></div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> (data) &#123;</div><div class="line"></div><div class="line">        <span class="comment">//dataä¸ä¸ºç©ºï¼Œè¯´æ˜æ²™ç›’ä¸­å­˜åœ¨è¿™ä¸ªæ–‡ä»¶</span></div><div class="line">Â  Â  Â  Â  Â  Â  cell.imageView.image = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line"></div><div class="line">Â  Â  Â  Â  &#125; <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">         <span class="comment">// åä¹‹æ²™ç›’ä¸­ä¸å­˜åœ¨è¿™ä¸ªæ–‡ä»¶</span></div><div class="line">Â  Â  Â  Â  Â  Â   <span class="comment">// åœ¨ä¸‹è½½ä¹‹å‰æ˜¾ç¤ºå ä½å›¾ç‰‡</span></div><div class="line">Â  Â  Â  Â  Â  Â  cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"placeholder"</span>];</div><div class="line">Â Â  Â  Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// ä¸‹è½½å›¾ç‰‡</span></div><div class="line">Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span> download:app.icon indexPath:indexPath];</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  &#125;</div></pre></td></tr></table></figure>
<p><strong>2.3 å›¾ç‰‡çš„ä¸‹è½½éƒ¨åˆ†</strong>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">Â *Â  ä¸‹è½½å›¾ç‰‡</div><div class="line">Â *</div><div class="line">Â *Â  @param imageUrl å›¾ç‰‡çš„url</div><div class="line">Â */</div><div class="line">- (<span class="keyword">void</span>)download:(<span class="built_in">NSString</span> *)imageUrl indexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="comment">// å–å‡ºå½“å‰å›¾ç‰‡urlå¯¹åº”çš„ä¸‹è½½æ“ä½œï¼ˆoperationå¯¹è±¡ï¼‰</span></div><div class="line">Â  Â  <span class="built_in">NSBlockOperation</span> *operation = <span class="keyword">self</span>.operations[imageUrl];</div><div class="line">Â  Â  <span class="keyword">if</span> (operation) <span class="keyword">return</span>;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">// åˆ›å»ºæ“ä½œï¼Œä¸‹è½½å›¾ç‰‡</span></div><div class="line">Â  Â  __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) appsVc = <span class="keyword">self</span>;</div><div class="line">Â  Â  operation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:imageUrl];</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url]; <span class="comment">// ä¸‹è½½</span></div><div class="line">Â  Â  Â  Â  <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data]; <span class="comment">// NSData -&gt; UIImage</span></div><div class="line">Â Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  <span class="comment">// å›åˆ°ä¸»çº¿ç¨‹</span></div><div class="line">Â  Â  Â  Â  [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">Â  Â  Â  Â  Â  Â           </div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (image) &#123;</div><div class="line">                <span class="comment">// å¦‚æœå­˜åœ¨å›¾ç‰‡ï¼ˆä¸‹è½½å®Œæˆï¼‰ï¼Œå­˜æ”¾å›¾ç‰‡åˆ°å›¾ç‰‡ç¼“å­˜å­—å…¸ä¸­</span></div><div class="line">Â  Â  Â  Â  Â  Â  Â  Â  appsVc.images[imageUrl] = image;</div><div class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </div><div class="line">                <span class="comment">//å°†å›¾ç‰‡å­˜å…¥æ²™ç›’ä¸­</span></div><div class="line">Â  Â              <span class="comment">//1. å…ˆå°†å›¾ç‰‡è½¬åŒ–ä¸ºNSData</span></div><div class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">NSData</span> *data = <span class="built_in">UIImagePNGRepresentation</span>(image);</div><div class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">//2.  å†ç”Ÿæˆç¼“å­˜è·¯å¾„ Â  Â  Â  Â  Â  Â </span></div><div class="line">Â  Â  Â  Â  Â  Â  Â  Â  [data writeToFile:CachedImageFile(imageUrl) atomically:<span class="literal">YES</span>];</div><div class="line">Â  Â  Â  Â  Â  Â  &#125;</div><div class="line">Â Â  Â  Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// ä»å­—å…¸ä¸­ç§»é™¤ä¸‹è½½æ“ä½œ (ä¿è¯ä¸‹è½½å¤±è´¥åï¼Œèƒ½é‡æ–°ä¸‹è½½)</span></div><div class="line">Â  Â  Â  Â  Â  Â  [appsVc.operations removeObjectForKey:imageUrl];</div><div class="line">Â Â  Â  Â  Â  Â  Â </div><div class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// åˆ·æ–°å½“å‰è¡¨æ ¼ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€</span></div><div class="line">Â  Â  Â  Â  Â  Â  [appsVc.tableView reloadRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationNone</span>];</div><div class="line">Â  Â  Â  Â  &#125;];</div><div class="line">Â  Â  &#125;];</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">// æ·»åŠ ä¸‹è½½æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span></div><div class="line">Â  Â  [<span class="keyword">self</span>.queue addOperation:operation];</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">// å°†å½“å‰ä¸‹è½½æ“ä½œæ·»åŠ åˆ°ä¸‹è½½æ“ä½œç¼“å­˜ä¸­ (ä¸ºäº†è§£å†³é‡å¤ä¸‹è½½)</span></div><div class="line">Â  Â  <span class="keyword">self</span>.operations[imageUrl] = operation;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-æœ‰å“ªäº›ç‚¹æ˜¯å€¼å¾—æ³¨æ„çš„ï¼Ÿ"><a href="#3-æœ‰å“ªäº›ç‚¹æ˜¯å€¼å¾—æ³¨æ„çš„ï¼Ÿ" class="headerlink" title="3. æœ‰å“ªäº›ç‚¹æ˜¯å€¼å¾—æ³¨æ„çš„ï¼Ÿ"></a>3. æœ‰å“ªäº›ç‚¹æ˜¯å€¼å¾—æ³¨æ„çš„ï¼Ÿ</h4><p>è¦è¯´å€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼Œè¿˜æ˜¯ç¦»ä¸å¼€å¯¹äºç¼“å­˜å†…å®¹çš„æ·»åŠ å’Œåˆ é™¤æ“ä½œã€‚</p>
<p><strong>3.1 å…³äºå›¾ç‰‡ç¼“å­˜</strong>ï¼š<br>å¾ˆç®€å•ï¼ŒæˆåŠŸä¸‹è½½ï¼Œæ‹¿åˆ°äº†å›¾ç‰‡ï¼Œå°±å°†å›¾ç‰‡æ·»åŠ åˆ°å›¾ç‰‡ç¼“å­˜ä¸­ï¼›ä¸‹è½½å¤±è´¥ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œåæ­£æ²¡æœ‰å›¾ã€‚åœ¨è¿™ç§æœºåˆ¶ä¸‹ï¼Œå°±æ²¡æœ‰åˆ é™¤ç¼“å­˜é‡ŒæŸä¸ªå›¾ç‰‡é¡¹çš„æƒ…å†µï¼Œå› ä¸ºå›¾ç‰‡ç¼“å­˜æ°¸è¿œä¸ä¼šå‡ºç°é‡å¤æ·»åŠ å¤šä¸ªç›¸åŒå›¾ç‰‡çš„æƒ…å†µï¼Œç¼“å­˜ä¸­åªè¦æœ‰ä¸€å¼ å¯¹åº”çš„å›¾ï¼Œå°±ç›´æ¥æ‹¿å»ç”¨äº†ï¼Œä¸ä¼šå»å†ä¸‹è½½äº†ã€‚</p>
<p><strong>3.2 å…³äºæ²™ç›’ç¼“å­˜</strong>ï¼š<br>åŒæ ·åœ°ï¼Œå¯¹äºæ²™ç›’ç¼“å­˜ä¹Ÿæ˜¯ä¸€ä¸ªé“ç†ï¼šæœ‰å›¾å°±å°†å…¶è½¬åŒ–ä¸ºNSDataï¼Œå†™å…¥ç£ç›˜ï¼Œå¹¶å¯¹åº”å”¯ä¸€çš„è·¯å¾„ï¼Œæ²¡æœ‰å›¾å°±ä¸å†™ã€‚æ‰€ä»¥å³ä½¿æ˜¯è¦ä¸‹è½½ç›¸åŒçš„å›¾ç‰‡ï¼Œå› ä¸ºå½“å‰urlå¯¹åº”çš„æ²™ç›’è·¯å¾„å·²ç»å­˜åœ¨æ–‡ä»¶äº†ï¼Œæ‰€ä»¥ç›´æ¥æ‹¿å°±å¯ä»¥äº†ï¼Œä¸ä¼šå†ä¸‹è½½ã€‚</p>
<p>ä½†æ˜¯ï¼<br>ä¸‹è½½æ“ä½œç¼“å­˜æ˜¯ä¸åŒçš„ï¼</p>
<p><strong>3.3 å…³äºä¸‹è½½æ“ä½œç¼“å­˜</strong><br>æˆ‘ä»¬éœ€è¦åœ¨ä¸‹è½½å›è°ƒå®Œæˆåï¼Œç«‹å³å°†å½“å‰çš„ä¸‹è½½æ“ä½œä»ä¸‹è½½æ“ä½œç¼“å­˜ä¸­åˆ å»ï¼<br>å› ä¸ºè¦é¿å…ä¸‹è½½å¤±è´¥åï¼Œæ— æ³•å†æ¬¡ä¸‹è½½çš„æƒ…å†µçš„å‘ç”Ÿï¼</p>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>æ³¨æ„ä¸€ä¸‹å°†ä¸‹è½½æ“ä½œåŠ å…¥åˆ°ä¸‹è½½æ“ä½œç¼“å­˜çš„æ—¶æœºï¼š<br>æ˜¯åœ¨<strong>ä¸‹è½½å¼€å§‹çš„é‚£ä¸€åˆ»</strong>è€Œä¸æ˜¯<strong>ä¸‹è½½æˆåŠŸçš„é‚£ä¸€åˆ»</strong>ï¼</p>
<p>å¦‚æœåœ¨ä¸‹è½½å¼€å§‹çš„é‚£ä¸€åˆ»åŠ å…¥åˆ°ç¼“å­˜ä¸­çš„è¯ï¼Œè¿™ä¸ªç¼“å­˜ä¿¡æ¯å°±åŒ…æ‹¬ä¸¤ä¸ªæƒ…å†µï¼šä¸‹è½½æˆåŠŸå’Œä¸‹è½½å¤±è´¥ï¼š</p>
<ul>
<li><p>å¦‚æœæœªæ¥ä¸‹è½½æˆåŠŸäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ä¼šæ¥åˆ°åˆ¤æ–­å½“å‰ä¸‹è½½æ“ä½œæ˜¯å¦åœ¨ä¸‹è½½æ“ä½œç¼“å­˜è¿™ä¸€æ­¥ï¼Œåœ¨è¿™ä¹‹å‰ç›´æ¥å°±å¯ä»¥æ‹¿å›¾å»ç”¨äº†ï¼Œä¸‹è½½æ“ä½œæ˜¯å¦å­˜åœ¨ä¸‹è½½æ“ä½œç¼“å­˜é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚</p>
</li>
<li><p>ä½†æ˜¯ï¼å¦‚æœæœªæ¥ä¸‹è½½å¤±è´¥äº†ï¼Œé‚£å°±è‚¯å®šä¸ä¼šæœ‰å¯¹åº”çš„å›¾ç‰‡ç¼“å­˜å’Œæ²™ç›’ç¼“å­˜ï¼Œä¹Ÿå°±è‚¯å®šä¼šæ¥åˆ°åˆ¤æ–­å½“å‰çš„ä¸‹è½½æ“ä½œæ˜¯å¦åœ¨ä¸‹è½½æ“ä½œç¼“å­˜é‡Œè¿™ä¸€æ­¥ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå› ä¸ºæ²¡æœ‰è¢«åˆ å»ï¼Œå®ƒæ˜¯å­˜åœ¨çš„ã€‚å­˜åœ¨çš„è¯å°±ä¸åšä»»ä½•å…¶ä»–æ“ä½œï¼Œæ”¾ä»»è‡ªæµï¼Œå¯¼è‡´æ›¾ç»ä¸‹è½½å¤±è´¥çš„å›¾ç‰‡æ°¸è¿œä¸ä¼šå†æ¬¡ä¸‹è½½ã€‚</p>
</li>
</ul>
<p>å¿˜äº†é‚£æ®µä»£ç äº†ä¹ˆï¼Ÿå›çœ‹ä¸€ä¸‹ä»£ç ï¼ˆçœ‹æˆ‘å¤šå¥½ï¼‰ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSBlockOperation</span> *operation = <span class="keyword">self</span>.operations[imageUrl];</div><div class="line"> <span class="keyword">if</span> (operation) <span class="keyword">return</span>;<span class="comment">//è½¬èº«å°±èµ°ï¼Œæ¯«ä¸ç•™æƒ…</span></div></pre></td></tr></table></figure></p>
<p>å› æ­¤ï¼Œæ— è®ºä¸‹è½½æˆåŠŸæˆ–æ˜¯å¤±è´¥ï¼Œåœ¨å›¾ç‰‡ä¸‹è½½çš„å›è°ƒé‡Œéƒ½è¦å°†å½“å‰çš„ä¸‹è½½æ“ä½œä»ä¸‹è½½æ“ä½œé˜Ÿåˆ—ä¸­ç§»èµ°ï¼šç”¨æ¥ä¿è¯å¦‚æœä¸‹è½½å¤±è´¥äº†ï¼Œå°±å¯ä»¥é‡æ–°å¼€å¯å¯¹åº”çš„ä¸‹è½½æ“ä½œè¿›è¡Œä¸‹è½½ï¼Œé€»è¾‘ä¸Šæ›´åŠ ä¸¥è°¨ã€‚</p>
<h1 id="4-æœ€åçš„è¯"><a href="#4-æœ€åçš„è¯" class="headerlink" title="4.æœ€åçš„è¯"></a>4.æœ€åçš„è¯</h1><hr>
<p>å¼‚æ­¥+ç¼“å­˜è¿™ä¸¤ä¸ªæœºåˆ¶åŒå‰‘åˆç’§çš„è¯ä¼šå¯¹ç¨‹åºæ–°èƒ½å¸¦æ¥å¾ˆå¤§çš„æ”¹è§‚ã€‚è¿™åº”è¯¥appå¼€å‘è¿›é˜¶çš„å¿…ç»ä¹‹è·¯ã€‚</p>
<p>å°ç å“¥è®²è¿°çš„è¿™å¥—æµç¨‹è¿˜ç®—æ¯”è¾ƒå®Œæ•´çš„äº†ï¼Œæ›´é‡è¦çš„è¿˜æ˜¯å­¦ä¹ å…¶ä¸­çš„æ€æƒ³ï¼š</p>
<blockquote>
<ol>
<li><p>å°†ç¼“å­˜åˆ†çº§ï¼šå†…å­˜ç¼“å­˜ï¼Œæ²™ç›’ç¼“å­˜ï¼Œä¸‹è½½æ“ä½œç¼“å­˜ã€‚</p>
</li>
<li><p>è€Œä¸”è¿˜è¦ç»å¸¸ä½¿ç”¨äºŒåˆ†æ³•ï¼Œå°†æˆ‘ä»¬çš„é€»è¾‘è€ƒè™‘å¾—æ»´æ°´ä¸æ¼ã€‚<br>å¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¤è¯†åˆ°å°†ä¸‹è½½æ“ä½œæ·»åŠ åˆ°ä¸‹è½½æ“ä½œç¼“å­˜çš„æ—¶æœºæ˜¯åŒ…å«ä¸‹è½½æˆåŠŸå’Œä¸‹è½½å¤±è´¥ä¸¤ä¸ªæƒ…å†µï¼Œé‚£ä¹ˆå°±ä¸ä¼šè€ƒè™‘åˆ°å³æ—¶è¦å°†ä¸‹è½½æ“ä½œä»ä¸‹è½½æ“ä½œç¼“å­˜ä¸­åˆ å»çš„æ“ä½œï¼Œå¾ˆå®¹æ˜“å¼•èµ·bugã€‚æ‰€ä»¥åœ¨ä»¥åçš„å¼€å‘ä¸­ï¼ŒæˆåŠŸå’Œå¤±è´¥ä¸¤ä¸ªæƒ…å†µéƒ½è¦è€ƒè™‘è¿›å»ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰ifä¸€å®šè¦æœ‰elseï¼</p>
</li>
</ol>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åšiOSå¼€å‘ä¹Ÿæœ‰åŠå¹´å¤šäº†ï¼Œæƒ³æƒ³è‡ªå·±å¯¹ä¸€äº›ç¬¬ä¸‰æ–¹åº“è¿˜åªæ˜¯åœç•™åœ¨ç®€å•è¿ç”¨çš„é˜¶æ®µï¼Œæ„Ÿè§‰å¿ƒæ…Œæ…Œçš„ã€‚äºæ˜¯å†³å®šç”¨ä¸€ä¸ªæœˆçš„æ—¶é—´æ·±å…¥äº†è§£ä¸€äº›å¥½çš„ç¬¬ä¸‰æ–¹åº“ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªæƒ³åˆ°äº†SDWebImageï¼Œè¿™ä¸ªåº“å¾ˆä¸é”™ï¼Œå‡ ä¹æ¯ä¸ªiOSé¡¹ç›®éƒ½ä¼šæœ‰å®ƒçš„å½±å­ï¼Œå› ä¸ºå®ƒå¾ˆå®Œç¾åœ°è§£å†³äº†ä¸‹è½½å›¾ç‰‡å¹¶æ˜¾ç¤ºçš„å¤„ç†é€»è¾‘ã€‚é‚£ä¹ˆæ·±ç©¶å®ƒä¹‹å‰ï¼Œç¬”è€…å‡†å¤‡å…ˆäº†è§£ä¸€ä¸‹å¤šå›¾ä¸‹è½½çš„ç¼“å­˜æœºåˆ¶ï¼Œå› ä¸ºå®ƒå’ŒSDWebImageçš„æ–¹æ¡ˆç±»ä¼¼ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸€ä¸ªå¤šå›¾ç¼“å­˜æœºåˆ¶çš„æ•™ç¨‹æ˜¯æ¥è‡ªææ˜æ°å°ç å“¥çš„ï¼Œç¬”è€…è§‰å¾—è®²å¾—æŒºä¸é”™çš„ï¼Œäºæ˜¯å°±èŠ±äº†2ä¸ªå°æ—¶å¥½å¥½å­¦ä¹ äº†ä¸€ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>æµ…æ˜¾æ˜“æ‡‚è®²è§£iOSå¤šçº¿ç¨‹æŠ€æœ¯-GCD</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/%E6%B5%85%E6%98%BE%E6%98%93%E6%87%82%E8%AE%B2%E8%A7%A3%E7%9A%84iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF-GCD/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/æµ…æ˜¾æ˜“æ‡‚è®²è§£çš„iOSå¤šçº¿ç¨‹æŠ€æœ¯-GCD/</id>
    <published>2017-01-13T05:26:33.000Z</published>
    <updated>2017-03-20T07:53:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>åŠ±å¿—æ‰“é€ ä¸€ç¯‡æµ…æ˜¾æ˜“æ‡‚åœ°ä»‹ç»iOSä¸­GCDçš„æ–‡ç« ï¼<br>ç¬”è€…è§è¿‡å¾ˆå¤šå…¶ä»–è®²è§£GCDçš„åšå®¢ï¼Œæœ‰äº›å†™å¾—éå¸¸è¯¦ç»†éå¸¸ä¸“ä¸šï¼Œå‡ ä¹æ¶µç›–äº†GCDå¤§å¤§å°å°çš„å…¨éƒ¨çŸ¥è¯†ï¼Œç»†è‡´åºæ‚çš„å†…å®¹å®¹æ˜“è®©äººæ‘¸ä¸æ¸…ä¸»æ¬¡ï¼Œç¬”è€…è§‰å¾—è¿™ç±»æ–‡ç« <strong>å¹¶ä¸é€‚åˆåˆå­¦è€…å­¦ä¹ </strong>ï¼Œäºæ˜¯å†³å®šå†™ä¸€ç¯‡é’ˆå¯¹ä¸€äº›åªæ˜¯å¬è¿‡ï¼Œä½†æ˜¯å¯¹GCDè¿˜ä¸äº†è§£çš„ç«¥é‹ä»¬ã€‚</p>
<p>æœ¬æ–‡æ’é™¤äº†ä¸€äº›ç»†ææœ«èŠ‚ï¼Œæ‰°ä¹±äººå¤´ç»ªçš„ä¸œè¥¿ï¼Œç€é‡è®²è§£äº†GCDä¸­é‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œå¹¶åœ¨æœ€åå±•ç¤ºäº†GCDä¸­<strong>ç»å¸¸ä½¿ç”¨çš„å‡½æ•°</strong>å¹¶é™„ä¸Šç»“æœå›¾å’Œè®²è§£ï¼Œç®€å•æ˜äº†ã€‚</p>
<a id="more"></a>
<h1 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h1><hr>
<p>åœ¨äº†è§£å¤šçº¿ç¨‹ä¹‹å‰ï¼Œéœ€è¦å¼„æ¸…è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µå’Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<h3 id="è¿›ç¨‹ï¼š"><a href="#è¿›ç¨‹ï¼š" class="headerlink" title="è¿›ç¨‹ï¼š"></a>è¿›ç¨‹ï¼š</h3><p>ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åºï¼Œè¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å±äºè‡ªå·±çš„å†…å­˜ç©ºé—´ã€‚æ¯”å¦‚æ‰‹æœºä¸­çš„<strong>å¾®ä¿¡</strong>åº”ç”¨å’Œ<strong>å°è±¡ç¬”è®°</strong>åº”ç”¨ï¼Œä»–ä»¬éƒ½æ˜¯iOSç³»ç»Ÿä¸­ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œæœ‰ç€è‡ªå·±çš„å†…å­˜ç©ºé—´ã€‚</p>
<h3 id="çº¿ç¨‹ï¼š"><a href="#çº¿ç¨‹ï¼š" class="headerlink" title="çº¿ç¨‹ï¼š"></a>çº¿ç¨‹ï¼š</h3><p>è¿›ç¨‹å†…éƒ¨æ‰§è¡Œä»»åŠ¡æ‰€éœ€è¦çš„æ‰§è¡Œè·¯å¾„ã€‚è¿›ç¨‹è‹¥æƒ³æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™å¿…é¡»å¾—åœ¨çº¿ç¨‹ä¸‹æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´è¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½æ‰§è¡Œä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨è½¯ä»¶çš„æ—¶å€™ï¼Œå¾ˆå°‘æœ‰åªè®©å®ƒåšä¸€ä»¶äº‹çš„æ—¶å€™ï¼š</p>
<p>ä¸¾ä¸ª<strong>å°è±¡ç¬”è®°</strong>çš„ğŸŒ° ï¼š å½“ä½ æ­£åœ¨ç¼–è¾‘ä¸€åˆ™ç¬”è®°çš„æ—¶å€™ç‚¹å‡»äº†åŒæ­¥æŒ‰é’®ï¼Œé‚£ä¹ˆç¼–è¾‘ä»»åŠ¡ï¼ˆçº¿ç¨‹ï¼‰å’ŒåŒæ­¥ä»»åŠ¡ï¼ˆçº¿ç¨‹ï¼‰ä¸€å®šæ˜¯ä¸èƒ½æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ã€‚å› ä¸ºåŒæ­¥ä»»åŠ¡çš„å®Œæˆæ—¶é—´æ˜¯ä¸å¯æ§çš„ï¼Œå¦‚æœåœ¨åŒæ­¥çš„è¿‡ç¨‹ä¸­æ— æ³•è¿›è¡Œåˆ«çš„ä»»åŠ¡ï¼ˆçº¿ç¨‹ï¼‰é‚£å°±å¤ªç³Ÿç³•äº†ï¼</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®©ä¸€äº›ä»»åŠ¡å¯ä»¥åŒæ—¶è¿›è¡Œã€‚æ—¢ç„¶ä»»åŠ¡æ˜¯åœ¨çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå¤šä»»åŠ¡çš„æ‰§è¡Œå°±æ„å‘³ç€éœ€è¦å¤šçº¿ç¨‹çš„å¼€å¯å’Œä½¿ç”¨ã€‚</p>
<p>æ¥ä¸€å¼ å›¾ç›´è§‚åœ°å±•ç¤ºä¸€ä¸‹å†…å­˜ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-a1e6c65eda0d3aaa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å†…å­˜ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹"></p>
<h1 id="å¤šçº¿ç¨‹æ¦‚è¿°"><a href="#å¤šçº¿ç¨‹æ¦‚è¿°" class="headerlink" title="å¤šçº¿ç¨‹æ¦‚è¿°"></a>å¤šçº¿ç¨‹æ¦‚è¿°</h1><hr>
<p>å¤šçº¿ç¨‹çš„å®ç°åŸç†ï¼šè™½ç„¶åœ¨åŒä¸€æ—¶åˆ»ï¼ŒCPUåªèƒ½å¤„ç†1æ¡çº¿ç¨‹ï¼Œä½†æ˜¯CPUå¯ä»¥å¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ˆåˆ‡æ¢ï¼‰ï¼Œé€ æˆäº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‡è±¡ã€‚</p>
<h2 id="1-å¤šçº¿ç¨‹çš„ä¼˜ç‚¹"><a href="#1-å¤šçº¿ç¨‹çš„ä¼˜ç‚¹" class="headerlink" title="1. å¤šçº¿ç¨‹çš„ä¼˜ç‚¹"></a>1. å¤šçº¿ç¨‹çš„ä¼˜ç‚¹</h2><ul>
<li>èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li>èƒ½é€‚å½“æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜åˆ©ç”¨ç‡ï¼‰ã€‚</li>
</ul>
<h2 id="2-å¤šçº¿ç¨‹çš„ç¼ºç‚¹"><a href="#2-å¤šçº¿ç¨‹çš„ç¼ºç‚¹" class="headerlink" title="2. å¤šçº¿ç¨‹çš„ç¼ºç‚¹"></a>2. å¤šçº¿ç¨‹çš„ç¼ºç‚¹</h2><ul>
<li>åˆ›å»ºçº¿ç¨‹æ˜¯éœ€è¦æˆæœ¬çš„ï¼šiOSä¸‹ä¸»è¦æˆæœ¬åŒ…æ‹¬ï¼šåœ¨æ ˆç©ºé—´çš„å­çº¿ç¨‹512KBã€ä¸»çº¿ç¨‹1MBï¼Œåˆ›å»ºçº¿ç¨‹å¤§çº¦éœ€è¦90æ¯«ç§’çš„åˆ›å»ºæ—¶é—´ã€‚</li>
<li>çº¿ç¨‹è¶Šå¤šï¼ŒCPUåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šçš„å¼€é”€å°±è¶Šå¤§ã€‚</li>
<li>çº¿ç¨‹è¶Šå¤šï¼Œç¨‹åºè®¾è®¡å°±è¶Šå¤æ‚ï¼šå› ä¸ºè¦è€ƒè™‘åˆ°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œå¤šçº¿ç¨‹çš„æ•°æ®å…±äº«ã€‚</li>
</ul>
<h1 id="å¤šçº¿ç¨‹åœ¨iOSå¼€å‘ä¸­çš„åº”"><a href="#å¤šçº¿ç¨‹åœ¨iOSå¼€å‘ä¸­çš„åº”" class="headerlink" title="å¤šçº¿ç¨‹åœ¨iOSå¼€å‘ä¸­çš„åº”"></a>å¤šçº¿ç¨‹åœ¨iOSå¼€å‘ä¸­çš„åº”</h1><hr>
<h2 id="1-iOSçš„ä¸»çº¿ç¨‹"><a href="#1-iOSçš„ä¸»çº¿ç¨‹" class="headerlink" title="1. iOSçš„ä¸»çº¿ç¨‹"></a>1. iOSçš„ä¸»çº¿ç¨‹</h2><p>ä¸€ä¸ªiOSç¨‹åºè¿è¡Œåï¼Œé»˜è®¤ä¼šå¼€å¯1æ¡çº¿ç¨‹ï¼Œç§°ä¸ºâ€œä¸»çº¿ç¨‹â€æˆ–â€œUIçº¿ç¨‹â€</p>
<h4 id="ä¸»çº¿ç¨‹çš„ä½œç”¨"><a href="#ä¸»çº¿ç¨‹çš„ä½œç”¨" class="headerlink" title="ä¸»çº¿ç¨‹çš„ä½œç”¨:"></a>ä¸»çº¿ç¨‹çš„ä½œç”¨:</h4><ul>
<li>æ˜¾ç¤º\åˆ·æ–°UIç•Œé¢</li>
<li>å¤„ç†UIäº‹ä»¶ï¼ˆæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ã€æ»šåŠ¨äº‹ä»¶ã€æ‹–æ‹½äº‹ä»¶ç­‰ï¼‰</li>
</ul>
<blockquote>
<p>ä¸»çº¿ç¨‹çš„ä½¿ç”¨<strong>æ³¨æ„äº‹é¡¹</strong>:<br>ä¸èƒ½æŠŠæ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­ï¼Œï¼Œä¸¥é‡å½±å“UIçš„æµç•…åº¦ï¼Œç»™ç”¨æˆ·ä¸€ç§ç¨‹åºâ€œå¡é¡¿â€çš„ä½“éªŒã€‚<br>å› æ­¤ï¼Œè¦å°†è€—æ—¶çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŠæ—¶å¼€å§‹æ‰§è¡Œäº†è€—æ—¶çš„æ“ä½œï¼Œä¹Ÿä¸ä¼šå½±å“ä¸»çº¿ç¨‹ä¸­UIäº¤äº’çš„ä½“éªŒã€‚</p>
</blockquote>
<h2 id="2-iOSçš„å­çº¿ç¨‹"><a href="#2-iOSçš„å­çº¿ç¨‹" class="headerlink" title="2. iOSçš„å­çº¿ç¨‹"></a>2. iOSçš„å­çº¿ç¨‹</h2><p>å­çº¿ç¨‹æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸å½±å“ä¸»çº¿ç¨‹ã€‚åœ¨iOSå¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†è€—æ—¶çš„ä»»åŠ¡ï¼ˆç½‘ç»œè¯·æ±‚ï¼Œå¤æ‚çš„è¿ç®—ï¼‰æ”¾åœ¨å­çº¿ç¨‹è¿›è¡Œï¼Œä¸è®©å…¶å½±å“UIçš„äº¤äº’ä½“éªŒã€‚</p>
<h2 id="3-å¤šçº¿ç¨‹å®‰å…¨"><a href="#3-å¤šçº¿ç¨‹å®‰å…¨" class="headerlink" title="3. å¤šçº¿ç¨‹å®‰å…¨"></a>3. å¤šçº¿ç¨‹å®‰å…¨</h2><p>å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å—èµ„æºæ—¶ï¼Œå¾ˆå®¹æ˜“å¼•å‘æ•°æ®é”™ä¹±å’Œæ•°æ®å®‰å…¨é—®é¢˜ã€‚å°±å¥½æ¯”å¥½å‡ ä¸ªäººåœ¨åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªè¡¨æ ¼ï¼Œé€ æˆæ•°æ®çš„é”™ä¹±ã€‚</p>
<h4 id="3-1-èµ„æºæŠ¢å¤ºçš„è§£å†³æ–¹æ¡ˆ"><a href="#3-1-èµ„æºæŠ¢å¤ºçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.1 èµ„æºæŠ¢å¤ºçš„è§£å†³æ–¹æ¡ˆ"></a>3.1 èµ„æºæŠ¢å¤ºçš„è§£å†³æ–¹æ¡ˆ</h4><p>æˆ‘ä»¬éœ€è¦ç»™æ•°æ®æ·»åŠ <strong>äº’æ–¥é”</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŸçº¿ç¨‹è®¿é—®ä¸€ä¸ªæ•°æ®ä¹‹å‰å°±è¦ç»™æ•°æ®åŠ é”ï¼Œè®©å…¶ä¸è¢«å…¶ä»–çš„çº¿ç¨‹æ‰€ä¿®æ”¹ã€‚å°±å¥½æ¯”ä¸€ä¸ªäººä¿®æ”¹è¡¨æ ¼çš„æ—¶å€™ç»™è¡¨æ ¼è®¾ç½®äº†å¯†ç ï¼Œé‚£ä¹ˆå…¶ä»–äººå°±æ— æ³•è®¿é—®æ–‡ä»¶äº†ã€‚å½“ä»–ä¿®æ”¹æ–‡ä»¶ä¹‹åï¼Œå†è®²å¯†ç æ’¤é”€ï¼Œç¬¬äºŒä¸ªäººå°±å¯ä»¥è®¿é—®è¯¥æ–‡ä»¶äº†ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<br>è¿™é‡Œçš„çº¿ç¨‹éƒ½ä¸ºå­çº¿ç¨‹ï¼Œå¦‚æœç»™æ•°æ®åŠ äº†é”ï¼Œå°±ç­‰äºå°†è¿™äº›å¼‚æ­¥çš„å­çº¿ç¨‹å˜æˆåŒæ­¥çš„äº†ï¼Œè¿™ä¹Ÿå«åšçº¿ç¨‹åŒæ­¥æŠ€æœ¯ã€‚</p>
</blockquote>
<h4 id="3-2-äº’æ–¥é”ä½¿ç”¨ï¼š"><a href="#3-2-äº’æ–¥é”ä½¿ç”¨ï¼š" class="headerlink" title="3.2 äº’æ–¥é”ä½¿ç”¨ï¼š"></a>3.2 äº’æ–¥é”ä½¿ç”¨ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@synchronized</span>(é”å¯¹è±¡) &#123; <span class="comment">// éœ€è¦é”å®šçš„ä»£ç   &#125;;</span></div></pre></td></tr></table></figure>
<h4 id="3-3-äº’æ–¥é”çš„ä¼˜ç¼ºç‚¹"><a href="#3-3-äº’æ–¥é”çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3.3 äº’æ–¥é”çš„ä¼˜ç¼ºç‚¹"></a>3.3 äº’æ–¥é”çš„ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼šèƒ½æœ‰æ•ˆé˜²æ­¢å› å¤šçº¿ç¨‹æŠ¢å¤ºèµ„æºé€ æˆçš„æ•°æ®å®‰å…¨é—®é¢˜<br>ç¼ºç‚¹ï¼šéœ€è¦æ¶ˆè€—å¤§é‡çš„CPUèµ„æº</p>
<p>äº’æ–¥é”çš„ä½¿ç”¨å‰æï¼šå¤šæ¡çº¿ç¨‹æŠ¢å¤ºåŒä¸€å—èµ„æºçš„æ—¶å€™ä½¿ç”¨ã€‚</p>
<h4 id="3-4äº’æ–¥é”åœ¨iOSå¼€å‘ä¸­çš„ä½¿ç”¨"><a href="#3-4äº’æ–¥é”åœ¨iOSå¼€å‘ä¸­çš„ä½¿ç”¨" class="headerlink" title="3.4äº’æ–¥é”åœ¨iOSå¼€å‘ä¸­çš„ä½¿ç”¨"></a>3.4äº’æ–¥é”åœ¨iOSå¼€å‘ä¸­çš„ä½¿ç”¨</h4><p>OCåœ¨å®šä¹‰å±æ€§æ—¶æœ‰<code>nonatomic</code>å’Œ<code>atomic</code>ä¸¤ç§é€‰æ‹©</p>
<ul>
<li>atomicï¼šåŸå­å±æ€§ï¼Œä¸ºsetteræ–¹æ³•åŠ é”ï¼ˆé»˜è®¤å°±æ˜¯atomicï¼‰</li>
<li>nonatomicï¼šéåŸå­å±æ€§ï¼Œä¸ä¼šä¸ºsetteræ–¹æ³•åŠ é”</li>
</ul>
<h4 id="3-5-nonatomicå’Œatomicå¯¹æ¯”"><a href="#3-5-nonatomicå’Œatomicå¯¹æ¯”" class="headerlink" title="3.5 nonatomicå’Œatomicå¯¹æ¯”"></a>3.5 nonatomicå’Œatomicå¯¹æ¯”</h4><p>atomicï¼šçº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦æ¶ˆè€—å¤§é‡çš„èµ„æº<br>nonatomicï¼šéçº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆå†…å­˜å°çš„ç§»åŠ¨è®¾å¤‡</p>
<blockquote>
<p><strong>å»ºè®®ï¼š</strong><br>æ‰€æœ‰å±æ€§éƒ½å£°æ˜ä¸ºnonatomicï¼Œå°½é‡é¿å…å¤šçº¿ç¨‹æŠ¢å¤ºåŒä¸€å—èµ„æºï¼Œå°†åŠ é”ã€èµ„æºæŠ¢å¤ºçš„ä¸šåŠ¡é€»è¾‘äº¤ç»™æœåŠ¡å™¨ç«¯å¤„ç†ï¼Œå‡å°ç§»åŠ¨å®¢æˆ·ç«¯çš„å‹åŠ›ã€‚</p>
</blockquote>
<h1 id="å¤šçº¿ç¨‹åœ¨iOSä¸­çš„åº”ç”¨ï¼šGCD"><a href="#å¤šçº¿ç¨‹åœ¨iOSä¸­çš„åº”ç”¨ï¼šGCD" class="headerlink" title="å¤šçº¿ç¨‹åœ¨iOSä¸­çš„åº”ç”¨ï¼šGCD"></a>å¤šçº¿ç¨‹åœ¨iOSä¸­çš„åº”ç”¨ï¼šGCD</h1><hr>
<p>GCDï¼Œå…¨ç§°ä¸º Grand Central Dispatch ï¼Œæ˜¯iOSç”¨æ¥ç®¡ç†çº¿ç¨‹çš„æŠ€æœ¯ã€‚ çº¯Cè¯­è¨€ï¼Œæä¾›äº†éå¸¸å¤šå¼ºå¤§çš„å‡½æ•°ã€‚</p>
<h2 id="1-GCDçš„ä¼˜åŠ¿"><a href="#1-GCDçš„ä¼˜åŠ¿" class="headerlink" title="1. GCDçš„ä¼˜åŠ¿"></a>1. GCDçš„ä¼˜åŠ¿</h2><p>GCDä¼šè‡ªåŠ¨åˆ©ç”¨æ›´å¤šçš„CPUå†…æ ¸ï¼ˆæ¯”å¦‚åŒæ ¸ã€å››æ ¸ï¼‰ã€‚<br>GCDä¼šè‡ªåŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»ºçº¿ç¨‹ã€è°ƒåº¦ä»»åŠ¡ã€é”€æ¯çº¿ç¨‹ï¼‰ã€‚<br>ç¨‹åºå‘˜åªéœ€è¦å‘Šè¯‰GCDæƒ³è¦æ‰§è¡Œä»€ä¹ˆä»»åŠ¡ï¼Œä¸éœ€è¦ç¼–å†™ä»»ä½•çº¿ç¨‹ç®¡ç†ä»£ç ã€‚</p>
<h2 id="2-ä¸ºä»€ä¹ˆè¦ç”¨GCDï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆè¦ç”¨GCDï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆè¦ç”¨GCDï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆè¦ç”¨GCDï¼Ÿ</h2><p>ä¸ºäº†è¦æé«˜è½¯ä»¶æ€§èƒ½ï¼Œåº”è¯¥å¼‚æ­¥æ‰§è¡Œè€—æ—¶ä»»åŠ¡(åŠ è½½å›¾ç‰‡)ï¼Œä»¥é˜²æ­¢å½±å“ä¸»çº¿ç¨‹ä»»åŠ¡çš„æ‰§è¡Œ(UIç›¸åº”)ã€‚</p>
<blockquote>
<p>ä¸¾ä¸ªğŸŒ° ï¼š<br>ä»ç½‘ç»œåŠ è½½ä¸€å¼ å›¾ç‰‡ï¼Œå¦‚æœå°†æ­¤ä»»åŠ¡æ”¾åˆ°ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆåœ¨ä¸‹è½½å®Œæˆçš„æ—¶é—´é‡Œï¼Œè½¯ä»¶æ˜¯æ— æ³•ç›¸åº”ç”¨æˆ·çš„ä»»ä½•æ“ä½œçš„ã€‚ç‰¹åˆ«åœ°ï¼Œå¦‚æœå½“å‰æ˜¯åœ¨å¯ä»¥æ»šåŠ¨çš„é¡µé¢ï¼Œå°±ä¼šé€ æˆæ— æ³•æ»šåŠ¨è¿™ç§ä½“éªŒéå¸¸ç³Ÿçš„æƒ…å†µã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼šåº”è¯¥å°†ç½‘ç»œåŠ è½½æ”¾åœ¨å¼‚æ­¥æ‰§è¡Œï¼Œæ‰§è¡ŒæˆåŠŸåï¼Œå†å›åˆ°ä¸»çº¿ç¨‹æ˜¾ç¤ºåŠ è½½åçš„å›¾ç‰‡(è¯¦ç»†åšæ³•é©¬ä¸Šå°±ä¼šè®²åˆ°)ã€‚</p>
<h2 id="3-GCDçš„ä½¿ç”¨æ­¥éª¤"><a href="#3-GCDçš„ä½¿ç”¨æ­¥éª¤" class="headerlink" title="3. GCDçš„ä½¿ç”¨æ­¥éª¤"></a>3. GCDçš„ä½¿ç”¨æ­¥éª¤</h2><ol>
<li>ç”±å¼€å‘è€…å®šåˆ¶å°†è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li>
</ol>
<ul>
<li>å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼ŒGCDä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å–å‡ºï¼Œæ”¾åˆ°å¯¹åº”çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong><br>ä»»åŠ¡çš„å–å‡ºéµå¾ªé˜Ÿåˆ—çš„FIFOåŸåˆ™ï¼šå…ˆè¿›å…ˆå‡ºï¼Œåè¿›åå‡ºã€‚</p>
</blockquote>
<h2 id="4-ä»€ä¹ˆæ˜¯é˜Ÿåˆ—ï¼Ÿ"><a href="#4-ä»€ä¹ˆæ˜¯é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="4. ä»€ä¹ˆæ˜¯é˜Ÿåˆ—ï¼Ÿ"></a>4. ä»€ä¹ˆæ˜¯é˜Ÿåˆ—ï¼Ÿ</h2><p>é˜Ÿåˆ—æ˜¯ç”¨æ¥å­˜æ”¾ä»»åŠ¡çš„ï¼Œç”±GCDå°†è¿™äº›ä»»åŠ¡ä»é˜Ÿåˆ—ä¸­å–å‡ºå¹¶æ”¾åˆ°ç›¸åº”çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p>
<h3 id="GCDçš„é˜Ÿåˆ—å¯ä»¥åˆ†ä¸º2å¤§ç±»å‹ï¼š"><a href="#GCDçš„é˜Ÿåˆ—å¯ä»¥åˆ†ä¸º2å¤§ç±»å‹ï¼š" class="headerlink" title="GCDçš„é˜Ÿåˆ—å¯ä»¥åˆ†ä¸º2å¤§ç±»å‹ï¼š"></a>GCDçš„é˜Ÿåˆ—å¯ä»¥åˆ†ä¸º2å¤§ç±»å‹ï¼š</h3><h4 id="1-å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent-Dispatch-Queueï¼‰"><a href="#1-å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent-Dispatch-Queueï¼‰" class="headerlink" title="1. å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queueï¼‰"></a>1. å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queueï¼‰</h4><p>å¯ä»¥è®©å¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œï¼ˆè‡ªåŠ¨å¼€å¯å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼‰ï¼Œå¹¶å‘åŠŸèƒ½åªæœ‰åœ¨å¼‚æ­¥ï¼ˆdispatch_asyncï¼‰å‡½æ•°ä¸‹æ‰æœ‰æ•ˆ</p>
<h4 id="2-ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial-Dispatch-Queueï¼‰"><a href="#2-ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial-Dispatch-Queueï¼‰" class="headerlink" title="2. ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰"></a>2. ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰</h4><p>è®©ä»»åŠ¡ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œï¼ˆä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼‰ã€‚</p>
<p>é‚£ä¹ˆé˜Ÿåˆ—å’Œçº¿ç¨‹åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>ç®€å•æ¥è¯´ï¼Œé˜Ÿåˆ—å°±æ˜¯ç”¨æ¥å­˜æ”¾ä»»åŠ¡çš„â€œæš‚å­˜åŒºâ€ï¼Œè€Œçº¿ç¨‹æ˜¯æ‰§è¡Œä»»åŠ¡çš„è·¯å¾„ï¼ŒGCDå°†è¿™äº›å­˜åœ¨äºé˜Ÿåˆ—çš„ä»»åŠ¡å–å‡ºæ¥æ”¾åˆ°ç›¸åº”çš„çº¿ç¨‹ä¸Šå»æ‰§è¡Œï¼Œè€Œé˜Ÿåˆ—çš„æ€§è´¨å†³å®šäº†åœ¨å…¶ä¸­çš„ä»»åŠ¡åœ¨å“ªç§çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚</p>
<p>ä¸‹é¢ç”±ä¸€å¼ å›¾æ¥ç›´è§‚åœ°å±•ç¤ºä»»åŠ¡ï¼Œé˜Ÿåˆ—å’Œçº¿ç¨‹çš„å…³ç³»ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-6da601dd550b8390.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä»»åŠ¡ï¼Œé˜Ÿåˆ—å’Œçº¿ç¨‹"></p>
<blockquote>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ”¾å…¥ä¸²è¡Œé˜Ÿåˆ—çš„ä»»åŠ¡ä¼šä¸€ä¸ªä¸€ä¸ªåœ°æ‰§è¡Œã€‚è€Œæ”¾å…¥å¹¶è¡Œé˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œä¼šåœ¨å¤šä¸ªçº¿ç¨‹å¹¶å‘åœ°æ‰§è¡Œã€‚</p>
</blockquote>
<h2 id="5-é˜Ÿåˆ—çš„åˆ›å»º"><a href="#5-é˜Ÿåˆ—çš„åˆ›å»º" class="headerlink" title="5. é˜Ÿåˆ—çš„åˆ›å»º"></a>5. é˜Ÿåˆ—çš„åˆ›å»º</h2><h3 id="5-1-ä¸²è¡Œé˜Ÿåˆ—çš„åˆ›å»ºï¼š"><a href="#5-1-ä¸²è¡Œé˜Ÿåˆ—çš„åˆ›å»ºï¼š" class="headerlink" title="5.1 ä¸²è¡Œé˜Ÿåˆ—çš„åˆ›å»ºï¼š"></a>5.1 ä¸²è¡Œé˜Ÿåˆ—çš„åˆ›å»ºï¼š</h3><p>GCDä¸­è·å¾—ä¸²è¡Œæœ‰2ç§é€”å¾„ï¼š</p>
<p>1.ä½¿ç”¨<code>dispatch_queue_create</code>å‡½æ•°åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—ç±»å‹ä¼ é€’NULLæˆ–è€…DISPATCH_QUEUE_SERIALï¼‰</span></div><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"serial_queue"</span>, <span class="literal">NULL</span>);</div></pre></td></tr></table></figure>
<p>2.ä½¿ç”¨ä¸»é˜Ÿåˆ—ï¼ˆè·Ÿä¸»çº¿ç¨‹ç›¸å…³è”çš„é˜Ÿåˆ—ï¼‰</p>
<p>ä¸»é˜Ÿåˆ—æ˜¯GCDè‡ªå¸¦çš„ä¸€ç§ç‰¹æ®Šçš„ä¸²è¡Œé˜Ÿåˆ—ï¼šæ”¾åœ¨ä¸»é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œéƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚<br>å¯ä»¥ä½¿ç”¨dispatch_get_main_queue()è·å¾—ç³»ç»Ÿæä¾›çš„ä¸»é˜Ÿåˆ—ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</div></pre></td></tr></table></figure>
<h3 id="5-2-å¹¶å‘é˜Ÿåˆ—çš„åˆ›å»ºï¼š"><a href="#5-2-å¹¶å‘é˜Ÿåˆ—çš„åˆ›å»ºï¼š" class="headerlink" title="5.2 å¹¶å‘é˜Ÿåˆ—çš„åˆ›å»ºï¼š"></a>5.2 å¹¶å‘é˜Ÿåˆ—çš„åˆ›å»ºï¼š</h3><p>1.ä½¿ç”¨<code>dispatch_queue_create</code>å‡½æ•°åˆ›å»ºå¹¶å‘é˜Ÿåˆ—ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"concurrent.queue"</span>, DISPATCH_QUEUE_CONCURRENT);</div></pre></td></tr></table></figure>
<p>2.ä½¿ç”¨<code>dispatch_get_global_queue</code>è·å¾—å…¨å±€å¹¶å‘é˜Ÿåˆ—ã€‚</p>
<p>GCDé»˜è®¤å·²ç»æä¾›äº†å…¨å±€çš„å¹¶å‘é˜Ÿåˆ—ï¼Œä¾›æ•´ä¸ªåº”ç”¨ä½¿ç”¨ï¼Œå¯ä»¥æ— éœ€æ‰‹åŠ¨åˆ›å»ºã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<h2 id="6-GCDçš„å‡ ç§é‡è¦çš„åº”ç”¨"><a href="#6-GCDçš„å‡ ç§é‡è¦çš„åº”ç”¨" class="headerlink" title="6. GCDçš„å‡ ç§é‡è¦çš„åº”ç”¨"></a>6. GCDçš„å‡ ç§é‡è¦çš„åº”ç”¨</h2><h3 id="6-1-å­çº¿ç¨‹ä¸ä¸»çº¿ç¨‹çš„é€šä¿¡"><a href="#6-1-å­çº¿ç¨‹ä¸ä¸»çº¿ç¨‹çš„é€šä¿¡" class="headerlink" title="6.1 å­çº¿ç¨‹ä¸ä¸»çº¿ç¨‹çš„é€šä¿¡"></a>6.1 å­çº¿ç¨‹ä¸ä¸»çº¿ç¨‹çš„é€šä¿¡</h3><p>éœ€æ±‚ç‚¹:æˆ‘ä»¬æœ‰æ—¶éœ€è¦åœ¨å­çº¿ç¨‹å¤„ç†ä¸€ä¸ªè€—æ—¶æ¯”è¾ƒé•¿çš„ä»»åŠ¡ï¼Œè€Œä¸”æ­¤ä»»åŠ¡å®Œæˆåï¼Œè¦åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡ã€‚<br>ä¾‹å­ï¼šä»ç½‘ç»œåŠ è½½å›¾ç‰‡ï¼ˆåœ¨å­çº¿ç¨‹ï¼‰ï¼ŒåŠ è½½å®Œæˆå°±æ›´æ–°UIViewï¼ˆåœ¨ä¸»çº¿ç¨‹ï¼‰ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆæ‹¿åˆ°å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼ˆæˆ–è‡ªå·±å¼€å¯ä¸€ä¸ªå­çº¿ç¨‹ï¼‰æ¥æ‰§è¡Œè€—æ—¶çš„æ“ä½œï¼Œç„¶ååœ¨å…¶å®Œæˆblockä¸­æ‹¿åˆ°å…¨å±€ä¸²è¡Œé˜Ÿåˆ—æ¥æ‰§è¡ŒUIåˆ·æ–°çš„ä»»åŠ¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line"></div><div class="line">            <span class="comment">//åŠ è½½å›¾ç‰‡</span></div><div class="line">            <span class="built_in">NSData</span> *dataFromURL = [<span class="built_in">NSData</span> dataWithContentsOfURL:imageURL];</div><div class="line">            <span class="built_in">UIImage</span> *imageFromData = [<span class="built_in">UIImage</span> imageWithData:dataFromURL];</div><div class="line"></div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        </div><div class="line">            <span class="comment">//åŠ è½½å®Œæˆæ›´æ–°view</span></div><div class="line">            <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:imageFromData];          </div><div class="line">    &#125;);      </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>ä»¥ç¬”è€…çš„æ‹™è§ï¼Œé™¤äº†å¤æ‚çš„ç®—æ³•ï¼Œç½‘ç»œè¯·æ±‚ä»¥å¤–ï¼Œå¤§å¤šæ•°<code>dataWithContentsOfã€‚ã€‚ã€‚</code>å‡½æ•°å¯èƒ½ä¹Ÿä¼šæ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥ä»¥åé‡åˆ°ä¸NSDataäº¤äº’çš„æ“ä½œæ—¶ï¼Œå°½é‡å°†å…¶æ”¾åœ¨å­çº¿ç¨‹æ‰§è¡Œã€‚</p>
</blockquote>
<h4 id="6-2-dispatch-once"><a href="#6-2-dispatch-once" class="headerlink" title="6.2 dispatch_once"></a>6.2 dispatch_once</h4><p>éœ€æ±‚ç‚¹ï¼šç”¨äºåœ¨ç¨‹åºå¯åŠ¨åˆ°ç»ˆæ­¢ï¼Œåªæ‰§è¡Œä¸€æ¬¡çš„ä»£ç ã€‚æ­¤ä»£ç è¢«æ‰§è¡Œåï¼Œç›¸å½“äºè‡ªèº«å…¨éƒ¨è¢«åŠ ä¸Šäº†æ³¨é‡Šï¼Œä¸ä¼šå†æ‰§è¡Œäº†ã€‚<br>ä¸ºäº†å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>dispatch_once</code>è®©ä»£ç åœ¨è¿è¡Œä¸€æ¬¡åå³åˆ»è¢«â€œé›ªè—â€ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ä½¿ç”¨dispatch_onceå‡½æ•°èƒ½ä¿è¯æŸæ®µä»£ç åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªè¢«æ‰§è¡Œ1æ¬¡</span></div><div class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">    <span class="comment">// åªæ‰§è¡Œ1æ¬¡çš„ä»£ç ï¼Œè¿™é‡Œé»˜è®¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼šä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å¯ä»¥è®¿é—®åˆ°è¿™é‡Œ</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="6-3-dispatch-group"><a href="#6-3-dispatch-group" class="headerlink" title="6.3 dispatch_group"></a>6.3 dispatch_group</h4><p>éœ€æ±‚ç‚¹ï¼šæ‰§è¡Œå¤šä¸ªè€—æ—¶çš„å¼‚æ­¥ä»»åŠ¡ï¼Œä½†æ˜¯åªèƒ½ç­‰åˆ°è¿™äº›ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œæ‰èƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡ŒæŸä¸ªä»»åŠ¡ã€‚<br>ä¸ºäº†å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦è®©å°†è¿™äº›å¼‚æ­¥æ‰§è¡Œçš„æ“ä½œæ”¾åœ¨<code>dispatch_group_async</code>å‡½æ•°ä¸­æ‰§è¡Œï¼Œæœ€åå†è°ƒç”¨<code>dispatch_group_notify</code>æ¥æ‰§è¡Œæœ€åæ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">dispatch_group_t group =  dispatch_group_create();</div><div class="line">dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">    <span class="comment">// æ‰§è¡Œ1ä¸ªè€—æ—¶çš„å¼‚æ­¥æ“ä½œ</span></div><div class="line">&#125;);</div><div class="line">dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">    <span class="comment">// æ‰§è¡Œ1ä¸ªè€—æ—¶çš„å¼‚æ­¥æ“ä½œ</span></div><div class="line">&#125;);</div><div class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</div><div class="line">    <span class="comment">// ç­‰å‰é¢çš„å¼‚æ­¥æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•åï¼Œå›åˆ°ä¸»çº¿ç¨‹...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç å’Œè¿è¡Œç»“æœï¼š</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<p>ä¸ºäº†ä½¿å¯¹æ¯”æ˜æ˜¾ï¼Œç¬”è€…å¤šå¼€äº†å‡ æ¡çº¿ç¨‹ï¼Œè¿™æ ·æ›´å®¹æ˜“çœ‹æ¸…é—®é¢˜ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line">    dispatch_group_t group =  dispatch_group_create();    </div><div class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        </div><div class="line">        <span class="comment">// æ‰§è¡Œ1ä¸ªè€—æ—¶çš„å¼‚æ­¥æ“ä½œ</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">10000</span>; index ++) &#123;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡1"</span>);                </div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        </div><div class="line">        <span class="comment">// æ‰§è¡Œ1ä¸ªè€—æ—¶çš„å¼‚æ­¥æ“ä½œ</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">20000</span>; index ++) &#123;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡2"</span>);        </div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        </div><div class="line">        <span class="comment">// æ‰§è¡Œ1ä¸ªè€—æ—¶çš„å¼‚æ­¥æ“ä½œ</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">200000</span>; index ++) &#123;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡3"</span>);</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        </div><div class="line">        <span class="comment">// æ‰§è¡Œ1ä¸ªè€—æ—¶çš„å¼‚æ­¥æ“ä½œ</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">400000</span>; index ++) &#123;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡4"</span>);</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        </div><div class="line">        <span class="comment">// æ‰§è¡Œ1ä¸ªè€—æ—¶çš„å¼‚æ­¥æ“ä½œ</span></div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">1000000</span>; index ++) &#123;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡5"</span>);</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">            </div><div class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</div><div class="line">        </div><div class="line">        <span class="comment">// ç­‰å‰é¢çš„å¼‚æ­¥æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•åï¼Œå›åˆ°ä¸»çº¿ç¨‹...</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"éƒ½å®Œæˆäº†"</span>);        </div><div class="line">    &#125;);</div><div class="line">```  </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">è¿è¡Œç»“æœ:</div><div class="line"></div><div class="line"></div><div class="line">![  dispatch_group çš„ä½¿ç”¨è¿è¡Œç»“æœ](http:<span class="comment">//upload-images.jianshu.io/upload_images/859001-3c8d5886442ce7b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">&gt;ä»ä¸‰æ¬¡è¿è¡Œçš„ç»“æœæ¥çœ‹:</div><div class="line"><span class="number">1.</span> å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡<span class="number">1</span><span class="number">-5</span>çš„æœ€ç»ˆå®Œæˆæ—¶é—´æ˜¯ä¸å…¶è‡ªèº«å®Œæˆä»»åŠ¡æ‰€éœ€è¦çš„æ—¶é—´å¹¶æ— ç»å¯¹å…³è”ã€‚å› ä¸ºä»»åŠ¡<span class="number">5</span>æ˜¯æœ€è€—æ—¶çš„ï¼Œå®ƒåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œç»“æœé‡Œå¹¶ä¸æ˜¯æœ€åæ‰å®Œæˆçš„ã€‚ä»»åŠ¡<span class="number">1</span>æ˜¯æœ€ä¸è€—æ—¶çš„ï¼Œä½†æ˜¯å®ƒåœ¨ç¬¬äºŒæ¬¡è¿è¡Œç»“æœé‡Œä¹Ÿä¸æ˜¯æœ€å…ˆå®Œæˆçš„ã€‚</div><div class="line"></div><div class="line">&gt;<span class="number">2.</span> å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡<span class="number">1</span><span class="number">-5</span>æ— è®ºå®Œæˆé¡ºåºå¦‚ä½•ï¼Œåªæœ‰å½“ä»–ä»¬éƒ½å®Œæˆåæ‰ä¼šè°ƒç”¨ä¸»çº¿ç¨‹çš„æ‰“å°â€œéƒ½å®Œæˆäº†â€ã€‚</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#### 6.4 dispatch_barrier</span></div><div class="line"></div><div class="line">éœ€æ±‚ç‚¹ï¼šè™½ç„¶æˆ‘ä»¬æœ‰æ—¶è¦æ‰§è¡Œå‡ ä¸ªä¸åŒçš„å¼‚æ­¥ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦å°†å…¶åˆ†æˆä¸¤ç»„ï¼šå½“ç¬¬ä¸€ç»„å¼‚æ­¥ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆåæ‰æ‰§è¡Œç¬¬äºŒç»„çš„å¼‚æ­¥ä»»åŠ¡ã€‚è¿™é‡Œçš„ç»„å¯ä»¥åŒ…å«ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªä»»åŠ¡ã€‚</div><div class="line"></div><div class="line">ä¸ºäº†å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨``dispatch_barrier_async(<span class="built_in">dispatch_queue_t</span> queue, dispatch_block_t block);``åœ¨ä¸¤ç»„ä»»åŠ¡ä¹‹é—´å½¢æˆâ€œæ …æ â€ï¼Œä½¿å…¶â€œä¸‹æ–¹â€çš„å¼‚æ­¥ä»»åŠ¡åœ¨å…¶â€œä¸Šæ–¹â€çš„å¼‚æ­¥ä»»åŠ¡éƒ½å®Œæˆä¹‹å‰æ˜¯æ— æ³•æ‰§è¡Œçš„ã€‚</div><div class="line"></div><div class="line"></div><div class="line">```objc</div><div class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"12312312"</span>, DISPATCH_QUEUE_CONCURRENT);</div><div class="line"></div><div class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"----ä»»åŠ¡ 1-----"</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"----ä»»åŠ¡ 2-----"</span>);</div><div class="line">    &#125;);    </div><div class="line"></div><div class="line">    dispatch_barrier_async(queue, ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"----barrier-----"</span>);</div><div class="line">    &#125;);</div><div class="line">   </div><div class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"----ä»»åŠ¡ 3-----"</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"----ä»»åŠ¡ 4-----"</span>);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"12312312"</span>, DISPATCH_QUEUE_CONCURRENT);</div><div class="line">   </div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">10000</span>; index ++) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡1"</span>);       </div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">20000</span>; index ++) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡2"</span>);        </div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">200000</span>; index ++) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡3"</span>);        </div><div class="line">&#125;);</div><div class="line">     </div><div class="line"></div><div class="line">dispatch_barrier_async(queue, ^&#123;        </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--------æˆ‘æ˜¯åˆ†å‰²çº¿--------"</span>);        </div><div class="line">&#125;);</div><div class="line"></div><div class="line">    </div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">400000</span>; index ++) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡4"</span>);       </div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">1000000</span>; index ++) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡5"</span>);        </div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> index = <span class="number">0</span>; index &lt; <span class="number">1000</span>; index ++) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å®Œæˆäº†ä»»åŠ¡6"</span>);       </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-ca923e54d3839b2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="dispatch_barrier çš„ä½¿ç”¨è¿è¡Œç»“æœ"></p>
<blockquote>
<p>ä»è¿™ä¸‰æ¬¡è¿è¡Œç»“æœæ¥çœ‹:</p>
<ol>
<li>æ— è®ºä»»åŠ¡1-3å†…éƒ¨çš„æ‰§è¡Œé¡ºåºå¦‚ä½•ï¼Œåªæœ‰å½“ä¸‰è€…éƒ½å®Œæˆäº†æ‰ä¼šæ‰§è¡Œä»»åŠ¡4-6ã€‚</li>
<li>1-3å†…éƒ¨çš„æ‰§è¡Œé¡ºåºå’Œ4-6å†…éƒ¨çš„å®Œæˆé¡ºåºéƒ½æ˜¯ä¸å¯æ§çš„ï¼ŒåŒä¸Šä¸€ä¸ªçŸ¥è¯†ç‚¹ç±»ä¼¼ã€‚</li>
</ol>
</blockquote>
<p>æœ¬æ–‡ä»‹ç»äº†éœ€è¦äº†è§£GCDæ‰€éœ€çš„æœ€é‡è¦çš„çŸ¥è¯†ï¼Œå› ä¸ºæ€•æ‰“æ–­è¯»è€…æ€è·¯ï¼Œå¹¶æ²¡æœ‰æ¶µç›–æ‰€æœ‰ç»†èŠ‚ã€‚ä»¥åæœ‰æœºä¼šä¼šå†å†™ä¸€ç¯‡æ·±å…¥ä»‹ç»GCDçš„æ–‡ç« ï¼ŒæŸ¥ç¼ºè¡¥æ¼ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åŠ±å¿—æ‰“é€ ä¸€ç¯‡æµ…æ˜¾æ˜“æ‡‚åœ°ä»‹ç»iOSä¸­GCDçš„æ–‡ç« ï¼&lt;br&gt;ç¬”è€…è§è¿‡å¾ˆå¤šå…¶ä»–è®²è§£GCDçš„åšå®¢ï¼Œæœ‰äº›å†™å¾—éå¸¸è¯¦ç»†éå¸¸ä¸“ä¸šï¼Œå‡ ä¹æ¶µç›–äº†GCDå¤§å¤§å°å°çš„å…¨éƒ¨çŸ¥è¯†ï¼Œç»†è‡´åºæ‚çš„å†…å®¹å®¹æ˜“è®©äººæ‘¸ä¸æ¸…ä¸»æ¬¡ï¼Œç¬”è€…è§‰å¾—è¿™ç±»æ–‡ç« &lt;strong&gt;å¹¶ä¸é€‚åˆåˆå­¦è€…å­¦ä¹ &lt;/strong&gt;ï¼Œäºæ˜¯å†³å®šå†™ä¸€ç¯‡é’ˆå¯¹ä¸€äº›åªæ˜¯å¬è¿‡ï¼Œä½†æ˜¯å¯¹GCDè¿˜ä¸äº†è§£çš„ç«¥é‹ä»¬ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ’é™¤äº†ä¸€äº›ç»†ææœ«èŠ‚ï¼Œæ‰°ä¹±äººå¤´ç»ªçš„ä¸œè¥¿ï¼Œç€é‡è®²è§£äº†GCDä¸­é‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œå¹¶åœ¨æœ€åå±•ç¤ºäº†GCDä¸­&lt;strong&gt;ç»å¸¸ä½¿ç”¨çš„å‡½æ•°&lt;/strong&gt;å¹¶é™„ä¸Šç»“æœå›¾å’Œè®²è§£ï¼Œç®€å•æ˜äº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>è¿œç¨‹å·¥ä½œæ‰æ˜¯å®ç°é«˜æ•ˆå·¥ä½œå’Œå¹¸ç¦ç”Ÿæ´»çš„æœ‰æ•ˆé€”å¾„ - è¯»ã€Šé‡æ¥2ã€‹æœ‰æ„Ÿ</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/%E8%BF%9C%E7%A8%8B%E5%B7%A5%E4%BD%9C%E6%89%8D%E6%98%AF%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%95%88%E5%B7%A5%E4%BD%9C%E5%92%8C%E5%B9%B8%E7%A6%8F%E7%94%9F%E6%B4%BB%E7%9A%84%E6%9C%89%E6%95%88%E9%80%94%E5%BE%84%20-%20%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9D%A52%E3%80%8B%E6%9C%89%E6%84%9F/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/è¿œç¨‹å·¥ä½œæ‰æ˜¯å®ç°é«˜æ•ˆå·¥ä½œå’Œå¹¸ç¦ç”Ÿæ´»çš„æœ‰æ•ˆé€”å¾„ - è¯»ã€Šé‡æ¥2ã€‹æœ‰æ„Ÿ/</id>
    <published>2017-01-13T05:18:16.000Z</published>
    <updated>2017-03-20T07:56:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœä¹æ™šäº”ï¼Œè¢«ç¦é”¢åœ¨åŠå…¬å®¤é‡Œçš„å·¥ä½œæ¨¡å¼æ˜¯å·¥ä¸šç¤¾ä¼šçš„äº§ç‰©ã€‚ç„¶è€Œï¼Œåœ¨äº’è”ç½‘å´›èµ·çš„ä»Šå¤©ï¼Œè¿™ç§å›ºå®šæ­»æ¿çš„å·¥ä½œæ¨¡å¼åè€Œæ‹–ç´¯äº†æˆ‘ä»¬ã€‚åŠå…¬å®¤æ—©å·²å˜æˆäº†å¹²æ‰°å·¥å‚ï¼ŒæŠŠä½ çš„æ—¶é—´åˆ‡æˆä¸ƒé›¶å…«ç¢çš„å°å—å„¿ï¼Œå·¥ä½œæ— æ³•é¡ºåˆ©ã€åŠæ—¶åœ°å®Œæˆï¼Œæ›´ä¼šé€ æˆå¿ƒç†ä¸Šçš„ç–²æƒ«ã€‚</p>
<p>å¦‚æœæ‚¨ä¹Ÿæ˜¯ä¸€åäº’è”ç½‘ä»ä¸šè€…ï¼Œç‰¹åˆ«æ˜¯ç¨‹åºå‘˜ï¼Œé—®é—®å‘¨å›´çš„äººï¼šå¦‚æœä½ å¯ä»¥è‡ªå·±é€‰æ‹©æ—¶é—´åœ°ç‚¹æ¥å®Œæˆå·¥ä½œä½ ä¼šé€‰æ‹©å“ªé‡Œï¼Ÿä½ èƒ½åœ¨å“ªä¸€æ—¶é—´æ®µæˆ–æ˜¯å“ªä¸€åœ°ç‚¹æ‰èƒ½é«˜æ•ˆåœ°å®Œæˆå·¥ä½œï¼Ÿæˆ‘æƒ³ç­”æ¡ˆ<strong>ä¸€å®šä¸æ˜¯ä¸‹åˆçš„åŠå…¬å®¤</strong>ã€‚</p>
<p>ç¬”è€…è‡ªå·±å°±æ˜¯ä¸€åç¨‹åºå‘˜ï¼Œä¸Šç­çš„æ—¶å€™è¢«ä¼šè®®å’ŒåŒè¡Œçš„æ‰“æ–­å¼„å¾—è‹¦ä¸å ªè¨€ï¼Œè™½ç„¶æœ‰äº›æ²Ÿé€šç¡®æ˜¯å¿…è¦çš„ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹æˆ‘å¾ˆæ¸…æ¥šï¼Œæˆ‘ç»å¸¸æ˜¯åœ¨æ—©ä¸Šä¸Šç­ä¹‹å‰æˆ–æ˜¯æ™šä¸Šç¡è§‰ä¹‹å‰æ‰èƒ½<strong>å®Œå®Œå…¨å…¨ï¼Œæ»¡æ„åœ°</strong>å®Œæˆä¸€ä¸ªæ¨¡å—çš„å¼€å‘ã€‚åœ¨ä¸‹åˆçš„æ—¶å€™ï¼Œæˆ‘å°±ä¼šç»™è‡ªå·±å®‰æ’åšä¸€äº›éš¾åº¦ä¸é«˜çš„ä»»åŠ¡ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ‰“æ–­æ‰€å¸¦æ¥çš„è´Ÿé¢å½±å“ä¼šå¾ˆä½ã€‚</p>
<p>å› æ­¤ç¬”è€…éå¸¸æœŸæœ›è‡ªå·±å¯ä»¥è¿œç¨‹å·¥ä½œï¼Œæ‘†è„±è¿™ç§å›ºè¯çš„å·¥ä½œå’Œç”Ÿæ´»æ–¹å¼ï¼Œå› ä¸ºå®ƒèƒ½å¸¦æ¥çš„å¥½å¤„çœŸçš„æ˜¯å¤ªå¤šå¤ªå¤šäº†ï¼</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-92f9e8f6e5690223.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿œç¨‹å·¥ä½œ"></p>
<a id="more"></a>
<h1 id="è¿œç¨‹å·¥ä½œå¥½å¤„å¤šï¼š"><a href="#è¿œç¨‹å·¥ä½œå¥½å¤„å¤šï¼š" class="headerlink" title="è¿œç¨‹å·¥ä½œå¥½å¤„å¤šï¼š"></a>è¿œç¨‹å·¥ä½œå¥½å¤„å¤šï¼š</h1><hr>
<h2 id="å†ä¹Ÿä¸ç”¨é€šå‹¤äº†"><a href="#å†ä¹Ÿä¸ç”¨é€šå‹¤äº†" class="headerlink" title="å†ä¹Ÿä¸ç”¨é€šå‹¤äº†"></a>å†ä¹Ÿä¸ç”¨é€šå‹¤äº†</h2><p><img src="http://upload-images.jianshu.io/upload_images/859001-3c7fb69828e09480.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€šå‹¤è·¯ä¸Š"></p>
<p>æœ‰çš„äººä¸ºäº†å‡å°‘é€šå‹¤æ—¶é—´åœ¨è‡ªå·±çš„å…¬å¸é™„è¿‘èŠ±è´¹äº†é«˜é¢ç§Ÿé‡‘ã€‚ã€‚ã€‚<br>æœ‰çš„äººä¸ºäº†èŠ‚çœå¼€æ”¯ï¼Œä½çš„ç¦»å…¬å¸å¾ˆè¿œï¼Œä½†å´åœ¨æ‹¥æŒ¤çš„åœ°é“é‡Œå€å—ç…ç†¬ã€‚ã€‚ã€‚<br>æœ‰çš„äººè™½ç„¶æœ‰ç§å®¶è½¦é€šå‹¤ï¼Œä½†æ˜¯æŒç»­æ€§éœ€è¦æ”¯ä»˜çš„ç‡ƒæ²¹è´¹å’Œåœè½¦è´¹ä¹Ÿæ˜¯ä¸å¯é¿å…çš„ã€‚ã€‚ã€‚</p>
<p>ç„¶è€Œï¼Œè¿™ä¸€åˆ‡åœ¨è¿œç¨‹å·¥ä½œçš„ç³»ç»Ÿé‡Œï¼Œå®Œå…¨å¯ä»¥é¿å…ï¼</p>
<p>å¤§å¤šæ•°äººå°†äººç”Ÿè€—è´¹åœ¨é€šå‹¤è·¯ä¸Šï¼Œå¯¼è‡´å¿ƒæƒ…å˜ç³Ÿï¼Œå½±å“å¹¸ç¦æ„Ÿï¼Œæ›´åˆ«è¯´æµªè´¹çš„æ—¶é—´äº†ã€‚ã€‚<br>èŠ‚çœäº†ä¸¤ä¸ªå°æ—¶çš„æ—¶é—´+ç–²åŠ³ï¼Œå¯¹äºå·¥ä½œæ•ˆç‡å’Œå¹¸ç¦æ„Ÿçš„æå‡æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚<br>æ—¶é—´èŠ‚çœäº†ï¼Œè´¢äº§å˜å¤šäº†ï¼Œç©ºæ°”æ›´å¥½äº†(å°¾æ°”æ’æ”¾)ï¼Œä¸–ç•Œæ›´ç¾å¥½äº†ä¸æ˜¯ä¹ˆï¼Ÿ^^</p>
<h2 id="å‘˜å·¥å¯ä»¥è‡ªå·±è§„åˆ’è‡ªå·±çš„ç”Ÿæ´»"><a href="#å‘˜å·¥å¯ä»¥è‡ªå·±è§„åˆ’è‡ªå·±çš„ç”Ÿæ´»" class="headerlink" title="å‘˜å·¥å¯ä»¥è‡ªå·±è§„åˆ’è‡ªå·±çš„ç”Ÿæ´»"></a>å‘˜å·¥å¯ä»¥è‡ªå·±è§„åˆ’è‡ªå·±çš„ç”Ÿæ´»</h2><p><img src="http://upload-images.jianshu.io/upload_images/859001-5ec1095da5690e2b.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è§„åˆ’ç”Ÿæ´»"></p>
<p>æœ‰çš„å‘˜å·¥æ˜¯æ—©èµ·æ—ï¼Œä»–ä»¬æ¯å¤©æ—©æ—©èµ·æ¥ä½†æ˜¯åˆ°äº†ä¸‹åˆç¼ºç–²æƒ«ä¸å ªã€‚ã€‚ã€‚<br>æœ‰çš„å‘˜å·¥æ˜¯å¤œçŒ«å­ï¼Œä»–ä»¬åªæœ‰åœ¨å‡Œæ™¨2-3ç‚¹çš„æ—¶å€™æ‰æ˜¯é«˜æ•ˆå·¥ä½œæ—¶é—´ï¼Œå› æ­¤æ—©èµ·ä¸Šç­è®©ä»–ä»¬è‹¦ä¸å ªè¨€ã€‚ã€‚ã€‚<br>æœ‰çš„å‘˜å·¥å®¶é‡Œæœ‰å°å­©ï¼Œé¡¾å®¶çš„ä»–ä»¬æ— æ³•å¹³è¡¡æ¥é€è‡ªå·±å°å­©å’Œä¸Šä¸‹ç­çš„æ—¶é—´è¡¨ã€‚ã€‚ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¯åŠ¨äº†è¿œç¨‹å·¥ä½œçš„æ¨¡å¼ï¼Œæˆ‘ä»¬å‡ ä¹å¯ä»¥æ»¡è¶³æ¯ä¸ªé›‡å‘˜çš„éœ€æ±‚ï¼šæ—©èµ·æ—ï¼Œå¤œçŒ«å­ï¼Œæ¯å¤©æ¥é€å­©å­çš„å‘˜å·¥ã€‚ä»–ä»¬çš„ç”Ÿæ´»ä¸å†å—æœä¹æ™šäº”çš„å›ºå®šæ¨¡å¼æ‰€æŸç¼šï¼Œå¯ä»¥å……åˆ†è§„åˆ’è‡ªå·±çš„äººç”Ÿã€‚åªè¦èƒ½å‡ºè‰²å®Œæˆä»»åŠ¡ï¼Œå‘˜å·¥å¦‚ä½•å®‰æ’è‡ªå·±çš„ç”Ÿæ´»åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p>
<p>è€Œä¸”è®©è‡ªå·±çš„ç”Ÿæ´»æ›´åŠ ä¸°å¯Œå¤šå½©ï¼Œæ›´æœ‰åŠ©äºè¿¸å°„å‡ºåˆ›æ„çš„ç«èŠ±ï¼Œè¿™æ˜¯ä¸€ä¸ªè‰¯æ€§å¾ªç¯ï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿ</p>
<h2 id="è¡¡é‡å‘˜å·¥çš„æ ‡å‡†æ›´åŠ æœ¬è´¨åŒ–"><a href="#è¡¡é‡å‘˜å·¥çš„æ ‡å‡†æ›´åŠ æœ¬è´¨åŒ–" class="headerlink" title="è¡¡é‡å‘˜å·¥çš„æ ‡å‡†æ›´åŠ æœ¬è´¨åŒ–"></a>è¡¡é‡å‘˜å·¥çš„æ ‡å‡†æ›´åŠ æœ¬è´¨åŒ–</h2><p><img src="http://upload-images.jianshu.io/upload_images/859001-54b23bd2350977c2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åªçœ‹æˆæœ"></p>
<p>æœ‰çš„å‘˜å·¥å·¥ä½œä¸è®¤çœŸï¼Œä½†æ˜¯è¿ç”¨å…¶åœ†æ»‘çš„å¤„äº‹èƒ½åŠ›å’Œæ”¿æ²»ç´ å…»åœ¨å…¬å¸é‡Œå¹³æ­¥é’äº‘ï¼Œè¿™ç§æƒ…å†µå¹¶ä¸å°‘è§ã€‚ã€‚ã€‚<br>æˆ‘ä»¬æ›´å¸Œæœ›é‚£äº›å…·æœ‰çœŸæ‰å®å­¦çš„äººèº«å±…é«˜ä½ï¼Œä¸ºæˆ‘ä»¬æŒ‡ç‚¹æ±Ÿå±±ï¼Œä¸è¿‡ç°å®æ€»æ˜¯è®©äººå¾ˆæ— å¥ˆã€‚</p>
<p>ä½†æ˜¯ï¼è¿œç¨‹å·¥ä½œä½¿å¾—è¡¡é‡å‘˜å·¥çš„æ ‡å‡†æ›´åŠ å•ä¸€,æ›´åŠ æœ¬è´¨åŒ–ï¼šæˆ‘ä»¬åªçœ‹<strong>å·¥ä½œæˆæœ</strong>ï¼Œä¹Ÿå¯ä»¥è¯´æˆ‘ä»¬åªèƒ½çœ‹åˆ°å·¥ä½œæˆæœã€‚</p>
<p>è¿œç¨‹å·¥ä½œæ¨¡å¼è®©æˆ‘ä»¬æ›´åŠ å…³æ³¨å‘˜å·¥çš„å·¥ä½œæˆæœï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘˜å·¥çš„çœŸå®æ°´å¹³å’Œæˆé•¿æƒ…å†µï¼Œè€Œä¸æ˜¯å…¶ä»–æ··æ·†æˆ‘ä»¬è§†å¬ï¼Œç™»ä¸ä¸Šå°é¢çš„ä¸œè¥¿ï¼Œä¸€äº›åœ¨å°†æ¥å¯èƒ½æŠŠæˆ‘ä»¬å…¬å¸é€ä¸Šä¸å½’è·¯çš„ä¸œè¥¿ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œå¼•ç”¨ç¨‹åºå‘˜ç•Œçš„ä¸€å¥æ¯”è¾ƒè‘—åçš„è¯ï¼š</p>
<blockquote>
<p>talk is cheapï¼Œshow me the codeã€‚</p>
</blockquote>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è¯´ï¼š</p>
<blockquote>
<p>talk is cheap, show me your work!</p>
</blockquote>
<h2 id="å°†ä¸–ç•Œå„åœ°çš„äººæ‰çº³å…¥å›Šä¸­"><a href="#å°†ä¸–ç•Œå„åœ°çš„äººæ‰çº³å…¥å›Šä¸­" class="headerlink" title="å°†ä¸–ç•Œå„åœ°çš„äººæ‰çº³å…¥å›Šä¸­"></a>å°†ä¸–ç•Œå„åœ°çš„äººæ‰çº³å…¥å›Šä¸­</h2><p><img src="http://upload-images.jianshu.io/upload_images/859001-4b84c7490a984b94.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿œæ–¹çš„äºº"></p>
<p>è¿œç¨‹å·¥ä½œç³»ç»Ÿä¸å—åœ°åŸŸçš„é™åˆ¶ï¼Œå¯ä»¥é›‡ä½£åˆ†å¸ƒåœ¨å„åœ°çš„æœ€ä¼˜ç§€çš„äººæ‰ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šæ‹…å¿ƒå‘˜å·¥æ¬å®¶æˆ–è€…å‡ºå›½å±…ä½çš„æƒ…å†µã€‚<br>äººæ‰æœ¬æ¥å°±æ˜¯ä¸å—åœ°åŸŸé™åˆ¶çš„ï¼Œå¹¶ä¸æ˜¯è¯´é¡¶å°–äººæ‰å°±ä¸€å®šåœ¨ä¸€çº¿åŸå¸‚é‡Œï¼Œæˆ‘ä»¬è¦å……åˆ†åˆ©ç”¨ä¸€åˆ‡èµ„æºæ‰¾åˆ°é‚£äº›æ•£è½åœ¨ä¸–ç•Œå„åœ°çš„äººæ‰ä¸ºæˆ‘ä»¬å·¥ä½œã€‚è€Œä¸”ï¼Œä¸è®ºä»–ä»¬å±…ä½åœ¨å“ªé‡Œï¼Œåœ¨å½“åœ°çš„ç”Ÿæ´»æ°´å¹³å¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½è¦ç»™ä»–ä»¬ä¸°åšçš„è–ªæ°´å’Œå¾…é‡ï¼Œè®©ä»–ä»¬è‡ªå·±è§‰å¾—è‡ªå·±å³ä½¿è¿œåœ¨å¤©æ¶¯ä¹Ÿä¾ç„¶è¢«â€œç»„ç»‡â€é‡è§†ç€ã€‚</p>
<h2 id="å¤§å®¶æ›´åŠ çæƒœå½¼æ­¤è§é¢çš„æœºä¼š"><a href="#å¤§å®¶æ›´åŠ çæƒœå½¼æ­¤è§é¢çš„æœºä¼š" class="headerlink" title="å¤§å®¶æ›´åŠ çæƒœå½¼æ­¤è§é¢çš„æœºä¼š"></a>å¤§å®¶æ›´åŠ çæƒœå½¼æ­¤è§é¢çš„æœºä¼š</h2><p><img src="http://upload-images.jianshu.io/upload_images/859001-c572e4100af965ca.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ„‰å¿«èšä¼š"></p>
<p>å…¶å®å°±ç®—æ˜¯æ‰§è¡Œè¿œç¨‹å·¥ä½œæ¨¡å¼ï¼Œè¿˜æ˜¯è¦æŒ‘å‡ºä¸€äº›æ—¶é—´æ¥è®©å›¢é˜Ÿçš„äººå‘˜å½¼æ­¤è§é¢çš„ï¼Œ<br>åœ¨è¿œç¨‹å·¥ä½œç³»ç»Ÿä¸­ï¼Œè§é¢çš„ç¨€ç¼ºæå‡äº†å®ƒçš„ä»·å€¼ï¼šå¤§å®¶ä¸ä¼šæµªè´¹æ—¶é—´ï¼Œä¼šæ›´åŠ çæƒœé¢å¯¹é¢äº¤æµï¼ŒåŸ¹å…»æ„Ÿæƒ…çš„æœºä¼šã€‚</p>
<h1 id="ä¸€äº›åå¯¹è¿œç¨‹å·¥ä½œçš„å£°éŸ³"><a href="#ä¸€äº›åå¯¹è¿œç¨‹å·¥ä½œçš„å£°éŸ³" class="headerlink" title="ä¸€äº›åå¯¹è¿œç¨‹å·¥ä½œçš„å£°éŸ³"></a>ä¸€äº›åå¯¹è¿œç¨‹å·¥ä½œçš„å£°éŸ³</h1><hr>
<h3 id="â€œæˆ‘æ€ä¹ˆçŸ¥é“ä»–ä»¬åœ¨å¹²æ´»ï¼Ÿâ€"><a href="#â€œæˆ‘æ€ä¹ˆçŸ¥é“ä»–ä»¬åœ¨å¹²æ´»ï¼Ÿâ€" class="headerlink" title="â€œæˆ‘æ€ä¹ˆçŸ¥é“ä»–ä»¬åœ¨å¹²æ´»ï¼Ÿâ€"></a>â€œæˆ‘æ€ä¹ˆçŸ¥é“ä»–ä»¬åœ¨å¹²æ´»ï¼Ÿâ€</h3><p>å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“è¯¥ä¸è¯¥ä¿¡ä»»è¿™ä¸ªå‘˜å·¥ï¼Œå°±è¯´æ˜å½“åˆè¿™ä¸ªæ‹›è˜å†³å®šæ˜¯é”™è¯¯çš„ï¼Œå¦‚æœæŸä¸ªæˆå‘˜ä¸èƒ½å–å¾—å¥½ç»“æœï¼Œæˆ–æ˜¯æ²¡æ³•ç®¡ç†å¥½è‡ªå·±çš„å·¥ä½œæ—¥ç¨‹å’Œå·¥ä½œé‡ï¼Œé‚£æˆ‘ä»¬ä¹Ÿæ²¡å¿…è¦ç»§ç»­è˜ç”¨ä»–ã€‚è¦ä¹ˆå­¦ä¼šä¿¡ä»»ä½ çš„ä¸‹å±ï¼Œè¦ä¹ˆå°±æ¢äººå§ã€‚</p>
<h3 id="â€œå®¶é‡Œçš„å¹²æ‰°æ¯”è¾ƒå¤šâ€"><a href="#â€œå®¶é‡Œçš„å¹²æ‰°æ¯”è¾ƒå¤šâ€" class="headerlink" title="â€œå®¶é‡Œçš„å¹²æ‰°æ¯”è¾ƒå¤šâ€"></a>â€œå®¶é‡Œçš„å¹²æ‰°æ¯”è¾ƒå¤šâ€</h3><p>æˆ‘ä»¬å¯ä»¥ç»™è‡ªå·±å•ç‹¬ä¸€ä¸ªå·¥ä½œæˆ¿é—´ï¼Œè€Œä¸”ä½ ä¹Ÿå¯ä»¥å»é™„è¿‘çš„å’–å•¡å…ã€‚<br>åƒç¬”è€…è‡ªå·±æœ‰çš„æ—¶å€™åœ¨å‘¨æœ«å°±æ¯”è¾ƒå–œæ¬¢å»å’–å•¡å…ï¼Œä¸ªäººè§‰å¾—åœ¨ä¸€äº›ç¨å¾®æœ‰ç‚¹åµæ‚åˆæ¯”è¾ƒå¹²å‡€é«˜é›…çš„åœºæ‰€åè€Œèƒ½æ›´åŠ é›†ä¸­æ³¨æ„åŠ›ã€‚è€Œä¸”åœ¨å®¶é‡Œå¯èƒ½ä¼šè§‰å¾—æ¯”è¾ƒèˆ’æœï¼Œåè€Œä¼šæä¸èµ·ç²¾ç¥æ¥ï¼Œå½±å“å·¥ä½œæ•ˆç‡ã€‚</p>
<h1 id="è¿œç¨‹å·¥ä½œçš„å…·ä½“å®è·µ"><a href="#è¿œç¨‹å·¥ä½œçš„å…·ä½“å®è·µ" class="headerlink" title="è¿œç¨‹å·¥ä½œçš„å…·ä½“å®è·µ"></a>è¿œç¨‹å·¥ä½œçš„å…·ä½“å®è·µ</h1><hr>
<ol>
<li>æœ€å¥½è¿˜æ˜¯èƒ½è§„åˆ’å‡ºé‡å æ—¶é—´ï¼Œå¯ä»¥é¿å…ä¿¡æ¯å»¶è¿Ÿï¼Œä¹Ÿèƒ½è®©å¤§å®¶äº§ç”ŸåŒåœ¨ä¸€ä¸ªå›¢é˜Ÿçš„æ„Ÿè§‰ã€‚</li>
<li>å…±äº«æ—¥å†ï¼Œè®©æ¯ä¸ªæˆå‘˜çš„æ—¶é—´è¡¨é€æ˜åŒ–ï¼ŒèŠ‚çœäº†æ²Ÿé€šæˆæœ¬ã€‚</li>
<li>å…±äº«æ‰€æœ‰çš„èµ„æ–™ï¼Œé€šè¿‡æœç´¢æ¥èŠ‚çœæ²Ÿé€šæˆæœ¬ã€‚</li>
<li>æ¯å‘¨ä¸€æ¬¡çš„å±•ç¤ºä¼šæ¥ç§€ä½ çš„å·¥ä½œè¿›å±•ï¼šè°ˆè°ˆè‡ªå·±ä¸Šå‘¨åšäº†ä»€ä¹ˆï¼Œè¿™å‘¨åšäº†ä»€ä¹ˆï¼Œä¸‹å‘¨æ‰“ç®—åšä»€ä¹ˆã€‚</li>
<li>å¯¹äºç›®å‰è¿˜æ²¡æœ‰å®è·µè¿œç¨‹å·¥ä½œçš„å…¬å¸ï¼Œå¯ä»¥å…ˆæ‰¾å‡ ä½ä¿¡å¾—è¿‡çš„å‘˜å·¥ï¼Œçœ‹çœ‹ç»“æœã€‚</li>
<li>åœ¨å®¶å·¥ä½œæ—¶ï¼Œæœ€å¥½å¯ä»¥æŠŠå·¥ä½œåŒºå’Œä¼‘é—²åŒºåˆ†å¼€ã€‚</li>
<li>é¿å…è¿‡åº¦ç–²åŠ³ï¼Œå¯ä»¥åœ¨å·¥ä½œååˆ‡æ¢åˆ°å¹³æ¿ç”µè„‘ï¼ŒæŠŠç´§ç»·çš„æ€ç»´è½¬æ¢ä¸€ä¸‹ã€‚</li>
<li>æˆ–è®¸å¯ä»¥ç”¨ä¸Šåˆåšä¸€äº›é¿å¼€å¹²æ‰°çš„äº‹æƒ…ï¼Œç„¶ååœ¨ä¸‹åˆå»å…¬å¸åšé‚£äº›éœ€è¦æ›´å¤šåä½œçš„å·¥ä½œã€‚</li>
</ol>
<h1 id="è¿œç¨‹å·¥å…·ç®±"><a href="#è¿œç¨‹å·¥å…·ç®±" class="headerlink" title="è¿œç¨‹å·¥å…·ç®±"></a>è¿œç¨‹å·¥å…·ç®±</h1><hr>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-bd5885fa7b4658ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿œç¨‹å·¥å…·ç®±"></p>
<ol>
<li>WebEx:å…±äº«å±å¹•ï¼Œç»™å¼‚åœ°çš„æŸäººåšäº§å“ä»‹ç»ã€‚</li>
<li>Google Hangouts : è§†é¢‘ä¼šè®®ï¼Œå¯ä»¥é€šè¿‡ç”µè„‘ä¸Šæˆ–æ‰‹æœºä¸Šçš„æ‘„åƒå¤´è¿›è¡Œè§†é¢‘é€šè¯ã€‚</li>
<li>Dropbox:å…¬å¸æ–‡æ¡£çš„å­˜æ”¾å¤„ï¼Œæ”¯æŒå¤šå¹³å¸¦ï¼Œåªè¦å¯ä»¥è¿ä¸Šç½‘ç»œå°±èƒ½åœ¨ä¸–ç•Œå„å¤„è®¿é—®å…¬å¸çš„èµ„æ–™ã€‚</li>
<li>Google Docs:å®æ—¶å…±äº«æ–‡æ¡£ã€‚</li>
</ol>
<h1 id="è¿œç¨‹å·¥ä½œçš„å‰¯ä½œç”¨"><a href="#è¿œç¨‹å·¥ä½œçš„å‰¯ä½œç”¨" class="headerlink" title="è¿œç¨‹å·¥ä½œçš„å‰¯ä½œç”¨"></a>è¿œç¨‹å·¥ä½œçš„å‰¯ä½œç”¨</h1><hr>
<h2 id="ä¸è¦è¿‡å¤šå»¶é•¿äº†å·¥ä½œæ—¶é—´"><a href="#ä¸è¦è¿‡å¤šå»¶é•¿äº†å·¥ä½œæ—¶é—´" class="headerlink" title="ä¸è¦è¿‡å¤šå»¶é•¿äº†å·¥ä½œæ—¶é—´"></a>ä¸è¦è¿‡å¤šå»¶é•¿äº†å·¥ä½œæ—¶é—´</h2><p>æˆ‘ä»¬éœ€è¦æ‹…å¿ƒçš„æ˜¯ï¼Œå¦‚æœå°†ä¸€ä¸ªå·¥ä½œç‹‚æ”¾åœ¨å®¶é‡Œå·¥ä½œï¼Œå¯èƒ½å¯¼è‡´ä»–å¹²çš„å¤ªå¤šäº†ï¼Œé€ æˆè¿‡åº¦ç–²åŠ³ã€‚<br>è§£å†³åŠæ³•ï¼šåœ¨è§„å®šçš„å·¥ä½œåï¼Œé—®é—®è‡ªå·±ä»Šå¤©æœ‰æ²¡æœ‰å¥½å¥½å·¥ä½œï¼Ÿå¦‚æœå›ç­”æ˜¯ï¼Œå°±å¯ä»¥åœæ­¢äº†ã€‚å¦‚æœä¸æ˜¯ï¼Œé—®è‡ªå·±äº”ä¸ªä¸ºä»€ä¹ˆï¼Œæ‰¾å‡ºé—®é¢˜çš„æ ¹æºã€‚</p>
<h2 id="æ¢ä¸ªç¯å¢ƒ"><a href="#æ¢ä¸ªç¯å¢ƒ" class="headerlink" title="æ¢ä¸ªç¯å¢ƒ"></a>æ¢ä¸ªç¯å¢ƒ</h2><p>å°±ç®—æ˜¯è¿œç¨‹å·¥ä½œï¼Œä¹Ÿå°½é‡ä¸è¦æ†‹åœ¨å®¶é‡Œï¼Œå»å’–å•¡å…æˆ–è€…å…¬å›­ä¹Ÿæ˜¯è›®ä¸é”™çš„é€‰æ‹©ã€‚</p>
<h2 id="æ³¨æ„å¥åº·"><a href="#æ³¨æ„å¥åº·" class="headerlink" title="æ³¨æ„å¥åº·"></a>æ³¨æ„å¥åº·</h2><p>æœ‰äº›äººå¦‚æœå¯ä»¥è®©ä»–æŒç»­ååœ¨ç”µè„‘å‰å°±å¾ˆéš¾è®©ä»–ç¦»å¼€äº†ï¼ˆåŒ…æ‹¬æˆ‘ï¼‰ï¼Œè¦æ³¨æ„å¤šè¿åŠ¨ï¼Œç‰¹åˆ«è¦ä½¿ç”¨ä¼˜è‰¯çš„å·¥ä½œè®¾å¤‡ï¼šä¾‹å¦‚äººä½“å·¥å­¦æ¤…ã€‚</p>
<h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><hr>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿œç¨‹å·¥ä½œæ‰€èƒ½å¸¦æ¥çš„å¥½å¤„å¤ªå¤šäº†ï¼šèŠ‚çœé€šå‹¤çš„æ—¶é—´å’Œé‡‘é’±ï¼Œæ›´å¥½è§„åˆ’å‘˜å·¥è‡ªå·±çš„ç”Ÿæ´»ï¼Œæ›´åŠ æ­£ç¡®åœ°è¡¡é‡å‘˜å·¥çš„èƒ½åŠ›å’Œå·¥ä½œæ€åº¦ã€‚ã€‚è€Œè¿™äº›ä¼˜åŠ¿ï¼Œèƒ½å¤Ÿå¸å¼•æ›´å¤šä¸–ç•Œå„åœ°çš„äººæ‰ï¼Œè®©ä¸€ç¾¤ä¼˜ç§€çš„å›¢é˜Ÿæˆå‘˜åˆä½œï¼Œæ˜¯å–å¾—å·…å³°ç»©æ•ˆçš„å…³é”®ã€‚</p>
<p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¤§å®¶å½¼æ­¤è¶Šæ¥è¶Šç†Ÿæ‚‰ï¼Œç›¸å¤„çš„è¶Šæ¥è¶Šèæ´½ï¼Œè‡ªç„¶è€Œç„¶åœ°ï¼Œå·¥ä½œè´¨é‡å°±ä¼šå˜å¾—å¾ˆé«˜ã€‚åœ¨äººç”Ÿçš„å¹¸ç¦æ¥æºä¸­ï¼Œå’Œå“è¶Šçš„äººå…±äº‹ï¼Œåšå‡ºå“è¶Šçš„ä¸šç»©æ­£å¼å…¶ä¸­ä¹‹ä¸€ã€‚</p>
<p>è¦æ¿€å‘å‡ºå‘˜å·¥çš„åŠ¨åŠ›ï¼Œå”¯ä¸€é å¾—ä½çš„åŠæ³•å°±æ˜¯é¼“åŠ±ä»–ä»¬ä»äº‹è‡ªå·±å–œæ¬¢çš„ï¼Œåœ¨ä¹çš„äº‹æƒ…ï¼Œè€Œä¸”è·Ÿä»–ä»¬å–œæ¬¢çš„ï¼Œåœ¨ä¹çš„äººä¸€èµ·åšäº‹ï¼Œæ­¤å¤–æ²¡æœ‰æ·å¾„å¯èµ°ã€‚</p>
<p>ä½ è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿå¦‚æœä½ æ˜¯é›‡ä¸»ï¼Œä½•ä¸å¯åŠ¨è¿œç¨‹å·¥ä½œç³»ç»Ÿè¯•è¯•çœ‹ï¼Ÿå¦‚æœä½ æ˜¯é›‡å‘˜ï¼Œä½•ä¸å‘è‡ªå·±çš„é›‡ä¸»å»ºè®®ä¸€ä¸‹å‘¢ï¼Ÿ</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœä¹æ™šäº”ï¼Œè¢«ç¦é”¢åœ¨åŠå…¬å®¤é‡Œçš„å·¥ä½œæ¨¡å¼æ˜¯å·¥ä¸šç¤¾ä¼šçš„äº§ç‰©ã€‚ç„¶è€Œï¼Œåœ¨äº’è”ç½‘å´›èµ·çš„ä»Šå¤©ï¼Œè¿™ç§å›ºå®šæ­»æ¿çš„å·¥ä½œæ¨¡å¼åè€Œæ‹–ç´¯äº†æˆ‘ä»¬ã€‚åŠå…¬å®¤æ—©å·²å˜æˆäº†å¹²æ‰°å·¥å‚ï¼ŒæŠŠä½ çš„æ—¶é—´åˆ‡æˆä¸ƒé›¶å…«ç¢çš„å°å—å„¿ï¼Œå·¥ä½œæ— æ³•é¡ºåˆ©ã€åŠæ—¶åœ°å®Œæˆï¼Œæ›´ä¼šé€ æˆå¿ƒç†ä¸Šçš„ç–²æƒ«ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨ä¹Ÿæ˜¯ä¸€åäº’è”ç½‘ä»ä¸šè€…ï¼Œç‰¹åˆ«æ˜¯ç¨‹åºå‘˜ï¼Œé—®é—®å‘¨å›´çš„äººï¼šå¦‚æœä½ å¯ä»¥è‡ªå·±é€‰æ‹©æ—¶é—´åœ°ç‚¹æ¥å®Œæˆå·¥ä½œä½ ä¼šé€‰æ‹©å“ªé‡Œï¼Ÿä½ èƒ½åœ¨å“ªä¸€æ—¶é—´æ®µæˆ–æ˜¯å“ªä¸€åœ°ç‚¹æ‰èƒ½é«˜æ•ˆåœ°å®Œæˆå·¥ä½œï¼Ÿæˆ‘æƒ³ç­”æ¡ˆ&lt;strong&gt;ä¸€å®šä¸æ˜¯ä¸‹åˆçš„åŠå…¬å®¤&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç¬”è€…è‡ªå·±å°±æ˜¯ä¸€åç¨‹åºå‘˜ï¼Œä¸Šç­çš„æ—¶å€™è¢«ä¼šè®®å’ŒåŒè¡Œçš„æ‰“æ–­å¼„å¾—è‹¦ä¸å ªè¨€ï¼Œè™½ç„¶æœ‰äº›æ²Ÿé€šç¡®æ˜¯å¿…è¦çš„ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹æˆ‘å¾ˆæ¸…æ¥šï¼Œæˆ‘ç»å¸¸æ˜¯åœ¨æ—©ä¸Šä¸Šç­ä¹‹å‰æˆ–æ˜¯æ™šä¸Šç¡è§‰ä¹‹å‰æ‰èƒ½&lt;strong&gt;å®Œå®Œå…¨å…¨ï¼Œæ»¡æ„åœ°&lt;/strong&gt;å®Œæˆä¸€ä¸ªæ¨¡å—çš„å¼€å‘ã€‚åœ¨ä¸‹åˆçš„æ—¶å€™ï¼Œæˆ‘å°±ä¼šç»™è‡ªå·±å®‰æ’åšä¸€äº›éš¾åº¦ä¸é«˜çš„ä»»åŠ¡ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ‰“æ–­æ‰€å¸¦æ¥çš„è´Ÿé¢å½±å“ä¼šå¾ˆä½ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ç¬”è€…éå¸¸æœŸæœ›è‡ªå·±å¯ä»¥è¿œç¨‹å·¥ä½œï¼Œæ‘†è„±è¿™ç§å›ºè¯çš„å·¥ä½œå’Œç”Ÿæ´»æ–¹å¼ï¼Œå› ä¸ºå®ƒèƒ½å¸¦æ¥çš„å¥½å¤„çœŸçš„æ˜¯å¤ªå¤šå¤ªå¤šäº†ï¼&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-92f9e8f6e5690223.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;è¿œç¨‹å·¥ä½œ&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="BookNote" scheme="https://github.com/knightsj/knightsj.github.io/categories/BookNote/"/>
    
    
      <category term="BookNote" scheme="https://github.com/knightsj/knightsj.github.io/tags/BookNote/"/>
    
      <category term="IT" scheme="https://github.com/knightsj/knightsj.github.io/tags/IT/"/>
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆäº’è”ç½‘å•†ä¸šæ€ç»´çš„å‡ ä¸ªè¯¯åŒº - è¯»ã€Šé‡æ¥ã€‹æœ‰æ„Ÿ</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/13/%E6%B5%85%E8%B0%88%E4%BA%92%E8%81%94%E7%BD%91%E5%95%86%E4%B8%9A%E6%80%9D%E7%BB%B4%E7%9A%84%E5%87%A0%E4%B8%AA%E8%AF%AF%E5%8C%BA%20-%20%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9D%A5%E3%80%8B%E6%9C%89%E6%84%9F/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/13/æµ…è°ˆäº’è”ç½‘å•†ä¸šæ€ç»´çš„å‡ ä¸ªè¯¯åŒº - è¯»ã€Šé‡æ¥ã€‹æœ‰æ„Ÿ/</id>
    <published>2017-01-13T05:12:57.000Z</published>
    <updated>2017-03-20T07:53:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘è¯»äº†ä¸€äº›å…³äºäº’è”ç½‘æ€ç»´å’Œç®¡ç†çš„ä¸€äº›ä¹¦ç±ï¼Œæ„Ÿè§¦é¢‡æ·±ï¼Œæƒ³ä»å›¢é˜Ÿï¼Œäº§å“ï¼Œå…¬å¸æ–¹å‘å’Œä¸ªäººå‡ ä¸ªæ–¹é¢ï¼Œç»“åˆç¬”è€…çš„ä¸ªäººç»å†åˆ†äº«ä¸€ä¸‹ç¬”è€…çš„æ€è€ƒå’Œæ„Ÿæ‚Ÿã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-063cce725ad58f38.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªï¼šwww.pexels.com"></p>
<a id="more"></a>
<hr>
<h1 id="å…³äºå›¢é˜Ÿ"><a href="#å…³äºå›¢é˜Ÿ" class="headerlink" title="å…³äºå›¢é˜Ÿ"></a>å…³äºå›¢é˜Ÿ</h1><h3 id="â€œé¸¡å°¾é…’ä¼šâ€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ°›å›´"><a href="#â€œé¸¡å°¾é…’ä¼šâ€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ°›å›´" class="headerlink" title="â€œé¸¡å°¾é…’ä¼šâ€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ°›å›´"></a>â€œé¸¡å°¾é…’ä¼šâ€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ°›å›´</h3><p>é¸¡å°¾é…’ä¼šå°±æ˜¯å…³ç³»å¹¶ä¸ç†Ÿçš„äººçš„èšä¼šï¼Œäººä»¬éƒ½æŠŠè‡ªå·±ä¸ä»–ä»¬æ‹‰å¼€ä¸€æ®µè·ç¦»ï¼Œç§‰æ‰¿ç€â€œä½ å¥½æˆ‘å¥½å¤§å®¶å¥½ï¼Œäº•æ°´ä¸çŠ¯æ²³æ°´â€çš„åŸåˆ™ï¼Œäº’ä¸ä¾µçŠ¯ï¼Œç”Ÿæ€•è¯´é”™è¯ï¼Œæƒ³èµ¶ç´§ç»“æŸèµ°äººã€‚</p>
<p>å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§å·¥ä½œæ°›å›´æ˜¯åŠå…¶å±é™©çš„ï¼Œå› ä¸ºæ²¡äººæ•¢è¯´å®è¯ã€‚ç¬”è€…ä¸ªäººéå¸¸ä¸å–œæ¬¢è¿™ç§å·¥ä½œæ°›å›´ã€‚</p>
<p>ç¬”è€…åœ¨éŸ©å›½ç•™å­¦çš„æ—¶å€™ï¼Œç ”ç©¶å®¤é‡Œå°±æ˜¯è¿™ç§æ°›å›´ï¼ŒéŸ©å›½äººçš„ç­‰çº§åˆ¶åº¦å¾ˆä¸¥é‡ï¼šåè¾ˆï¼Œä¹Ÿå°±æ˜¯ç›¸å¯¹æ¯”è¾ƒæ™šåŠ å…¥çš„å¹´è½»äººæ˜¯ä¸èƒ½å¯¹å‰è¾ˆçš„è¡Œä¸ºæœ‰ä»»ä½•æŒ‡ç‚¹ï¼Œæ›´ä¸ç”¨è¯´æ‰¹è¯„äº†ã€‚ç¬”è€…å¯¹è¿™ç§ç•¸å½¢çš„æ–‡åŒ–å·²ç»åŒæ¶è‡³æï¼Œå› æ­¤æ¯…ç„¶å†³ç„¶ï¼Œæ¯•ä¸šåå›åˆ°äº†ç¥–å›½å‘å±•ã€‚</p>
<p>æˆ‘ä»¬åº”è¯¥è¥é€ ä¸€ä¸ªæ•¢è¯´ä»»ä½•èƒ¡ä½†æ˜¯è¿˜éå¸¸æœ‰å®‰å…¨æ„Ÿçš„ç¯å¢ƒï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…¬å¸çš„å„ç§é—®é¢˜éƒ½ä¼šç«‹å³è¢«å¤§å®¶çŸ¥æ™“ï¼Œç„¶åæ‰¾å‡ºè§£å†³åŠæ³•ï¼Œç«‹é©¬æ‰§è¡Œï¼</p>
<h3 id="å¸‚åœºè¥é”€å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„éƒ¨é—¨"><a href="#å¸‚åœºè¥é”€å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„éƒ¨é—¨" class="headerlink" title="å¸‚åœºè¥é”€å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„éƒ¨é—¨"></a>å¸‚åœºè¥é”€å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„éƒ¨é—¨</h3><p>ç¬”è€…æ‰€åœ¨çš„å…¬å¸ï¼ŒæŠ€æœ¯äººå‘˜å’Œç”¨æˆ·å‡ ä¹æ˜¯æ— äº¤æµçš„ï¼Œä½†æ˜¯å¦‚æœè®©æŠ€æœ¯äººå‘˜äº²è‡ªå»å’Œåé¦ˆé—®é¢˜çš„ç”¨æˆ·æ²Ÿé€šï¼Œé‚£ä¹ˆç”¨æˆ·åº”è¯¥ä¼šæ»¡æ„å¾ˆå¤šï¼Œå› ä¸ºè‡³å°‘ä»–ä»¬æ‰€å¾—åˆ°çš„æœåŠ¡æ˜¯ç›¸å¯¹æ›´ä¸“ä¸šçš„ã€‚åƒè¿™ç§æŠ€æœ¯äººå‘˜ä¸ç”¨æˆ·ç›´æ¥äº¤æµçš„è¡Œä¸ºå°±æ˜¯å¸‚åœºè¥é”€ã€‚</p>
<p>å› æ­¤ï¼Œæ— è®ºæ˜¯æŠ€æœ¯äººå‘˜ä¹Ÿå¥½ï¼Œäº§å“äººå‘˜ä¹Ÿå¥½ï¼Œéƒ½è¦ç§¯æä¸ç”¨æˆ·æ²Ÿé€šäº¤æµï¼Œç§¯æå‚ä¸å„ç§â€œç±»è¥é”€â€æ´»åŠ¨ï¼Œå› ä¸ºæˆ‘ä»¬æ¯ä¸ªäººéƒ½å¯ä»¥ä½œä¸ºè¥é”€çš„ä¸€å‘˜ï¼Œä¸ºå…¬å¸å¸¦æ¥å¥½çš„å½±å“ã€‚</p>
<hr>
<h1 id="å…³äºäº§å“"><a href="#å…³äºäº§å“" class="headerlink" title="å…³äºäº§å“"></a>å…³äºäº§å“</h1><h3 id="ä¸åº”è¯¥ä¸ºäº†è¿åˆæŠ•èµ„äººï¼Œä¸ªåˆ«ç”¨æˆ·æ¥æ”¹å˜äº§å“çš„æ ¸å¿ƒ"><a href="#ä¸åº”è¯¥ä¸ºäº†è¿åˆæŠ•èµ„äººï¼Œä¸ªåˆ«ç”¨æˆ·æ¥æ”¹å˜äº§å“çš„æ ¸å¿ƒ" class="headerlink" title="ä¸åº”è¯¥ä¸ºäº†è¿åˆæŠ•èµ„äººï¼Œä¸ªåˆ«ç”¨æˆ·æ¥æ”¹å˜äº§å“çš„æ ¸å¿ƒ"></a>ä¸åº”è¯¥ä¸ºäº†è¿åˆæŠ•èµ„äººï¼Œä¸ªåˆ«ç”¨æˆ·æ¥æ”¹å˜äº§å“çš„æ ¸å¿ƒ</h3><p>æœ‰å¾ˆå¤šåˆåˆ›å…¬å¸å¬ä»äº†æŠ•èµ„äººçš„è¦æ±‚æˆ–è€…ä¸ªåˆ«ç”¨æˆ·çš„æŠ±æ€¨å°±æ”¹å˜äº†äº§å“çš„åˆè¡·ï¼Œåšå‡ºäº†ä¸€ä¸ªè¿è‡ªå·±éƒ½ä¸å–œæ¬¢çš„äº§å“ã€‚åæ¥ï¼Œé‚£ä¸ªæå‡ºæ€ªå¼‚è¦æ±‚çš„æŠ•èµ„äººæ‹¿ç€é’±èµ°äº†ï¼Œé‚£ä¸ªæŠ±æ€¨çš„å®¢æˆ·ä¸åœ¨ä½¿ç”¨äº§å“äº†ï¼Œå…¬å¸å°±åªå‰©ä¸‹ä¸€ä¸ªé¢ç›®å…¨éæ¯«æ— ä¸ªæ€§çš„äº§å“ï¼Œè¿™æ— ç–‘æ˜¯è®©äººå¿ƒç—›çš„ã€‚</p>
<p>æƒ³è¦åˆ›é€ ä¸€ä¸ªä¼Ÿå¤§çš„äº§å“æˆ–æŸé¡¹å“è¶Šçš„æœåŠ¡ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯åšä½ è‡ªå·±æƒ³ç”¨çš„ä¸œè¥¿ã€‚<br>è¿™ä¸ªä¸œè¥¿æœ‰ä¸€ä¸ªæ ¸å¿ƒï¼Œå®ƒåœ¨ä½ çš„åˆ›ä¸šç­‰å¼ä¸­æ˜¯æ— æ³•è¢«æ‹¿æ‰çš„ã€‚æ— è®ºæŠ•èµ„äººï¼Œå®¢æˆ·ï¼Œè¿˜æ˜¯ä¸ªåˆ«ç”¨æˆ·æƒ³è¦æ’¼åŠ¨ä»–éƒ½æ— æµäºäº‹ï¼Œå› ä¸ºè¿™æ˜¯ä½ è‡ªå·±çš„äº§å“ï¼Œä½ çˆ±ä½ è‡ªå·±çš„äº§å“ï¼Œä½ è¦å»æå«å®ƒï¼Œä¸æ–­åœ°å»å®Œå–„å®ƒã€‚è¿™æ‰æ˜¯äº‹ä¸šæˆåŠŸçš„æ ¹æœ¬ã€‚</p>
<h3 id="ä¸è¦ä¸ºäº†å¢åŠ åŠŸèƒ½æ‹–å»¶ä¸Šçº¿çš„æ—¶é—´"><a href="#ä¸è¦ä¸ºäº†å¢åŠ åŠŸèƒ½æ‹–å»¶ä¸Šçº¿çš„æ—¶é—´" class="headerlink" title="ä¸è¦ä¸ºäº†å¢åŠ åŠŸèƒ½æ‹–å»¶ä¸Šçº¿çš„æ—¶é—´"></a>ä¸è¦ä¸ºäº†å¢åŠ åŠŸèƒ½æ‹–å»¶ä¸Šçº¿çš„æ—¶é—´</h3><p>æœ‰äº›æ—¶å€™ï¼Œäº§å“é‚£è¾¹ä¸€ç›´æƒ³è¦å¢åŠ éœ€æ±‚ï¼Œç”šè‡³æ˜¯åœ¨æµ‹è¯•é˜¶æ®µã€‚è¿™æ˜¯ä¸€ç§éå¸¸ä¸æ˜æ™ºçš„åšæ³•ã€‚</p>
<p>åœ¨äº§å“å½¢æˆåˆæœŸï¼Œäº§å“è¿­ä»£çš„èŠ‚å¥å’Œé€Ÿåº¦æ˜¯æœ€é‡è¦çš„ï¼Œä¸å…¶æŠŠæŸä¸€é¡¹åŠŸèƒ½åšçš„æˆç†Ÿï¼Œä¸å¦‚èµ¶ç´§åšå¥½æœ€åŸºæœ¬çš„åŠŸèƒ½æ”¾åˆ°å¸‚åœºï¼Œè¿™æ ·æ‰æœ‰åˆ©äºæŠŠæ¡å¸‚åœºæ–¹å‘ï¼ŒæŠŠé€‰æ‹©æƒäº¤ç»™å¸‚åœºè€Œä¸æ˜¯åœ¨å…¬å¸é‡Œé¢ççŒœã€‚</p>
<h3 id="ä¸è¦åªå…³æ³¨ä¸»æ‰“äº§å“ï¼Œæ‰¾åˆ°å‰¯äº§å“ç»™å…¬å¸å¸¦æ¥é¢å¤–æ”¶ç›Š"><a href="#ä¸è¦åªå…³æ³¨ä¸»æ‰“äº§å“ï¼Œæ‰¾åˆ°å‰¯äº§å“ç»™å…¬å¸å¸¦æ¥é¢å¤–æ”¶ç›Š" class="headerlink" title="ä¸è¦åªå…³æ³¨ä¸»æ‰“äº§å“ï¼Œæ‰¾åˆ°å‰¯äº§å“ç»™å…¬å¸å¸¦æ¥é¢å¤–æ”¶ç›Š"></a>ä¸è¦åªå…³æ³¨ä¸»æ‰“äº§å“ï¼Œæ‰¾åˆ°å‰¯äº§å“ç»™å…¬å¸å¸¦æ¥é¢å¤–æ”¶ç›Š</h3><p>åœ¨ä¸è€½è¯¯ä¸»æ‰“äº§å“ç ”å‘çš„å‰æä¸‹ï¼Œå¯ä»¥æŒ–æ®å…¬å¸çš„å‰¯äº§å“ï¼Œè™½ç„¶æ”¶æ•ˆå¯èƒ½ä¸é«˜ï¼Œä½†å¯¹äºæé«˜å…¬å¸çš„å½±å“åŠ›å’Œäº²å’ŒåŠ›æ˜¯ç”±ç§¯æå½±å“çš„ã€‚</p>
<p>å¼€ä¸ªåšå®¢ï¼Œåˆ†äº«æœ‰æ„ä¹‰çš„çŸ¥è¯†ï¼›å†™ä¹¦ï¼Œæ¥è®°å½•å…¬å¸çš„ä¿¡æ¡ï¼›æ‹ä¸ªçºªå½•ç‰‡ï¼Œæ¥è®°å½•å…¬å¸çš„æˆé•¿éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>
<hr>
<h1 id="å…³äºæ–¹å‘"><a href="#å…³äºæ–¹å‘" class="headerlink" title="å…³äºæ–¹å‘"></a>å…³äºæ–¹å‘</h1><h3 id="â€œå‘å±•æˆä¸ºå¤§å…¬å¸â€å¹¶ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå¥½çš„ç›®æ ‡"><a href="#â€œå‘å±•æˆä¸ºå¤§å…¬å¸â€å¹¶ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå¥½çš„ç›®æ ‡" class="headerlink" title="â€œå‘å±•æˆä¸ºå¤§å…¬å¸â€å¹¶ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå¥½çš„ç›®æ ‡"></a>â€œå‘å±•æˆä¸ºå¤§å…¬å¸â€å¹¶ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå¥½çš„ç›®æ ‡</h3><p>å¾ˆå¤šå°å…¬å¸éƒ½æœ‰æƒ³å˜å£®å¤§ï¼Œè€Œå¾ˆå¤šå¤§å…¬å¸å´æ¢¦æƒ³å˜å¾—æ›´æ•æ·ï¼Œæ›´çµæ´»ã€‚<br>ä½†æ˜¯å¯æ‚²çš„æ˜¯ï¼Œä¸€æ—¦å…¬å¸åšå¤§äº†ï¼Œè¦æƒ³å†ç¼©å°ï¼Œå°±åœ¨æ‰€éš¾å…è¦è¿›è¡Œè£å‘˜ï¼Œé‚£ä¹ˆåæœå°±æ˜¯æ‰“å‡»å£«æ°”ï¼Œå½±å“å·¥ä½œæ°›å›´ï¼Œè¿™å¾€å¾€æ˜¯è‡´å‘½çš„ã€‚æ‰€ä»¥æˆ‘ä¸ªäººè®¤ä¸ºï¼Œå…¬å¸ä¸å¿…åšå¾—å¾ˆå¤§ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´ä¿¡æ¯æµé€šæ•ˆç‡å˜ä½ï¼Œè€Œå›¢é˜Ÿä¿¡æ¯æµé€šæ•ˆç‡æ˜¯å›¢é˜Ÿæ‰§è¡Œæ•ˆç‡çš„æ ¹æœ¬ã€‚</p>
<p>æœ‰ä¸€ä¸ªé«˜æ•ˆæ•æ·çš„å°å›¢é˜Ÿèƒœè¿‡ä½æ•ˆç¬¨é‡çš„å¤§å›¢é˜Ÿï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå¯¹å˜åŒ–è¿…é€Ÿåšå‡ºååº”ï¼Œè€Œä¸”æ¯æ¬¡çš„å†³ç­–éƒ½å¯ä»¥è¿…é€Ÿä¸‹è¾¾å’Œæ‰§è¡Œï¼Œè¿™æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚</p>
<h3 id="ä¸åº”è¯¥è®©å¯¹æ‰‹çš„æ–¹å‘å½±å“ä½ çš„æ–¹å‘"><a href="#ä¸åº”è¯¥è®©å¯¹æ‰‹çš„æ–¹å‘å½±å“ä½ çš„æ–¹å‘" class="headerlink" title="ä¸åº”è¯¥è®©å¯¹æ‰‹çš„æ–¹å‘å½±å“ä½ çš„æ–¹å‘"></a>ä¸åº”è¯¥è®©å¯¹æ‰‹çš„æ–¹å‘å½±å“ä½ çš„æ–¹å‘</h3><p>æŠŠç›®å…‰æ”¾åœ¨è‡ªå·±èº«ä¸Šï¼Œè€Œä¸æ˜¯å¯¹æ‰‹èº«ä¸Šã€‚å¦‚æœä½ æŠŠæ—¶é—´æµªè´¹åœ¨å…³æ³¨ä»–äººèº«ä¸Šæ—¶ï¼Œå¤´è„‘é‡Œåªä¼šå……æ–¥ç€åˆ«äººçš„æƒ³æ³•ï¼Œç„¶åå°†è‡ªå·±çš„æƒ³æ³•å†²æ·¡ï¼Œæ›´åˆ«æè‡ªæˆ‘æé«˜äº†ã€‚</p>
<p>å¦‚æœä½ è¿˜è¦åˆ¶é€ ä¸€ä¸ªç±»ipodçš„äº§å“ï¼Œæ³¨å®šæ˜¯å¤±è´¥çš„ã€‚å› ä¸ºæ¸¸æˆè§„åˆ™æ˜¯ä»–ä»¬å®šä¸‹çš„ï¼Œè€Œä½ æ˜¯æ— æ³•æ‰“è´¥æ¸¸æˆè§„åˆ™åˆ¶å®šè€…çš„ã€‚</p>
<p>èµ°åˆ«äººèµ°è¿‡çš„è·¯æˆä¸äº†å¤§æ°”å€™çš„ï¼Œä¸è¦å»æŒ‘æˆ˜è§„åˆ™çš„åˆ¶å®šè€…ï¼Œè¦èµ°å‡ºä¸€æ¡è‡ªå·±çš„è·¯ã€‚è€Œä¸æ˜¯æŠŠåˆ«äººä¿®å¥½çš„è·¯åœ¨æ—è¾¹ç§ä¸€æ’æ ‘ï¼Œè¿™æ— éæ˜¯ç»™ä»–äººåšå«è¡£ã€‚æœºæ™ºä¸€ç‚¹ï¼Œå‹‡æ•¢ä¸€ç‚¹å»ä¿®ä¸€æ¡è‡ªå·±ç‹¬æœ‰çš„è·¯å§ã€‚</p>
<h3 id="ä¸è¦ä¾èµ–è®¡åˆ’"><a href="#ä¸è¦ä¾èµ–è®¡åˆ’" class="headerlink" title="ä¸è¦ä¾èµ–è®¡åˆ’"></a>ä¸è¦ä¾èµ–è®¡åˆ’</h3><p>æœ€å±é™©çš„è«è¿‡äºâ€œä¸çŸ¥é“è‡ªå·±ä¸çŸ¥é“äº†â€ï¼Œå®šåˆ¶è®¡åˆ’æ—¶ï¼Œæœ‰å¾ˆå¤šå› ç´ æ˜¯æˆ‘ä»¬æ— æ³•é¢„æ–™åˆ°çš„ï¼Œå› ä¸ºäº§å“æŠ•å…¥å¸‚åœºåï¼Œæœ‰å¤ªå¤šçš„ä¸ç¡®å®šå› ç´ ï¼Œè€Œè¿™äº›ä¸ç¡®å®šå› ç´ æ°æ°æœ‰å¯èƒ½å¯¹è®¡åˆ’äº§ç”Ÿä¸å¯ä¼°é‡çš„å½±å“ã€‚æ‰€ä»¥è¿˜æ˜¯åŠ å¿«èŠ‚å¥ï¼Œå°½å¿«æŠŠäº§å“æŠ•æ”¾åˆ°å¸‚åœºã€‚</p>
<h3 id="ä¸è¦è‡ªæƒæ¸…é«˜ï¼Œåº”è¯¥æ—¶åˆ»æƒ³ç€å¦‚ä½•ç›ˆåˆ©"><a href="#ä¸è¦è‡ªæƒæ¸…é«˜ï¼Œåº”è¯¥æ—¶åˆ»æƒ³ç€å¦‚ä½•ç›ˆåˆ©" class="headerlink" title="ä¸è¦è‡ªæƒæ¸…é«˜ï¼Œåº”è¯¥æ—¶åˆ»æƒ³ç€å¦‚ä½•ç›ˆåˆ©"></a>ä¸è¦è‡ªæƒæ¸…é«˜ï¼Œåº”è¯¥æ—¶åˆ»æƒ³ç€å¦‚ä½•ç›ˆåˆ©</h3><p>ä¸è¦ä¾èµ–æŠ•èµ„äººçš„é’±ï¼Œè¦ä»ä¸€å¼€å§‹å°±æ—¶æ—¶åˆ»åˆ»æƒ³ç€å¦‚ä½•ç»™å…¬å¸å¸¦æ¥æ”¶ç›Šï¼Œå› ä¸ºå°±ç®—ä½ æƒ³äºå¾…è‡ªå·±ï¼Œä½ ä¹Ÿä¸èƒ½äºå¾…ä½ çš„å‘˜å·¥ã€‚è€Œä¸”ï¼Œå¦‚æœè¿‡åˆ†ä¾èµ–åˆ«äººçš„é’±ï¼Œé‚£è¿˜è°ˆä»€ä¹ˆåšæŒèµ°è‡ªå·±çš„è·¯ï¼Œå¼€åˆ›è‡ªå·±çš„äº‹ä¸šå‘¢ï¼Ÿ</p>
<hr>
<h1 id="å…³äºä¸ªäºº"><a href="#å…³äºä¸ªäºº" class="headerlink" title="å…³äºä¸ªäºº"></a>å…³äºä¸ªäºº</h1><h3 id="â€œå·¥ä½œç‹‚â€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®šä½"><a href="#â€œå·¥ä½œç‹‚â€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®šä½" class="headerlink" title="â€œå·¥ä½œç‹‚â€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®šä½"></a>â€œå·¥ä½œç‹‚â€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®šä½</h3><p>æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°å…¬å¸ä¸­æœ‰ä¸€äº›äººè‡ªè¯©ä¸ºâ€œå·¥ä½œç‹‚â€ï¼Œæ¯å¤©åŠ ç­åˆ°å¾ˆæ™šï¼Œä½†æ˜¯å·¥ä½œæˆæœå¹³å¹³ï¼Œè€Œä¸”ç²¾ç¥çŠ¶æ€èé¡ä¸æŒ¯ã€‚å…¶å®è¿™äº›äººå¤§å¤šæ˜¯é€šè¿‡å¢åŠ æ—¶é—´çš„æ–¹å¼æ¥å»å®Œæˆä¸€äº›äº‹å®ä¸Šæ¯”è¾ƒæ¬¡è¦çš„ä»»åŠ¡æˆ–è€…ç»†èŠ‚ï¼Œæˆ–æ˜¯ä¸å»æ€è€ƒå®Œæˆä»»åŠ¡çš„æ­£ç¡®æ–¹æ³•ï¼Œä½æ•ˆç‡å·¥ä½œã€‚</p>
<p>å…¶å®æˆ‘ä»¬åº”è¯¥æ˜æ™ºåœ°å»å·¥ä½œï¼Œä¸åº”é è›®åŠ›æ¥å¼¥è¡¥æ€ç»´ä¸Šçš„æƒ°æ€§ï¼Œåº”è¯¥å‡†ç¡®åˆ¤æ–­ä»»åŠ¡çš„ä¸»æ¬¡ï¼Œæƒ³å‡ºæœ€é«˜æ•ˆçš„æ–¹æ³•è§£å†³æ‰å®ƒã€‚</p>
<p>å‰ä¸€é˜µå­ï¼Œç¬”è€…ç‹¬ç«‹è´Ÿè´£å…¬å¸çš„ä¸€ä¸ªé¡¹ç›®ï¼Œå‹åŠ›å¾ˆå¤§ï¼Œä½†æ˜¯æ€•åˆšä¸ä¸Šå·¥æœŸï¼Œä¾¿ä¸€å‘³åœ°å»¶é•¿å·¥ä½œæ—¶é—´:åŠ ç­+å›å®¶å†æåˆ°1ç‚¹ã€‚è™½ç„¶äº§å“åŠæ—¶ä¸Šçº¿ï¼Œä½†æ˜¯å›æƒ³ä¸€ä¸‹å¥½å¤šå·¥ä½œéƒ½è¿”å·¥äº†ï¼Œå› ä¸ºå½“æ—¶å¹¶æ²¡æœ‰åšå¥½å†³ç­–ï¼Œé€‰æ‹©æœ€å¥½çš„è§£å†³åŠæ³•ã€‚</p>
<p>ä¸è¿‡å½“æˆ‘è®¤è¯†åˆ°äº†é—®é¢˜çš„ä¸¥é‡æ€§åï¼Œåˆ»æ„é€¼è¿«è‡ªå·±å›å®¶åªåšè‡ªå·±çš„äº‹æƒ…ã€‚åœ¨å·¥ä½œæ—¶ï¼Œå¤„ç†æ¯ä¸ªä»»åŠ¡ä¹‹å‰ä»”ç»†æ¨æ•²é€»è¾‘ï¼Œæ‰¾å‡ºæœ€åˆç†çš„åŠæ³•ã€‚è™½ç„¶å·¥ä½œçš„èŠ‚å¥æ…¢äº†ä¸€ç‚¹(å› ä¸ºä¸æ˜¯ä¸€å‘³åœ°è›®å¹²)ï¼Œä½†æ˜¯åŠŸèƒ½åšå‡ºæ¥ä¹‹åbugæå°‘ï¼Œå‡ ä¹æ²¡æœ‰é‡å†™æˆ–è€…ä¼˜åŒ–çš„éƒ¨åˆ†ã€‚è€Œä¸”æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘æ¯å¤©å›å®¶éƒ½æœ‰è‡ªå·±çš„æ—¶é—´å»ç»™è‡ªå·±å……ç”µã€‚ç°åœ¨å›æƒ³ä¸€ä¸‹å½“æ—¶çš„æˆ‘è¿˜æ˜¯è›®å¿ƒç–¼çš„ï¼Œæ˜æ˜å¯ä»¥æ¢ä¸€ç§æ›´åŠ è½»æ¾é«˜æ•ˆæ–¹å¼å»ç”Ÿæ´»ï¼Œä½•å¿…æŠŠè‡ªå·±æå¾—é‚£ä¹ˆç´¯å‘¢?</p>
<h3 id="å•çº¯åœ°ç½—åˆ—é—®é¢˜å¹¶ä¸èƒ½è§£å†³é—®é¢˜"><a href="#å•çº¯åœ°ç½—åˆ—é—®é¢˜å¹¶ä¸èƒ½è§£å†³é—®é¢˜" class="headerlink" title="å•çº¯åœ°ç½—åˆ—é—®é¢˜å¹¶ä¸èƒ½è§£å†³é—®é¢˜"></a>å•çº¯åœ°ç½—åˆ—é—®é¢˜å¹¶ä¸èƒ½è§£å†³é—®é¢˜</h3><p>å¾ˆå¤šäººåœ¨ä½¿ç”¨ä»»åŠ¡æ¸…å•ï¼Œä½†æ˜¯å¤§å¤šæ•°åªæ˜¯æŠŠä»–ä»¬åˆ—åˆ°é‚£é‡Œï¼Œåšå®Œäº†å»æ‰“ä¸ªå‹¾ã€‚ä½†æ˜¯ï¼Œè™½ç„¶è¿™å¯ä»¥èµ·åˆ°æé†’çš„ä½œç”¨ï¼Œä½†è¿˜æ˜¯ä¸å¤Ÿå®Œå–„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>ç½—åˆ—ä¸€ä¸ªto-doæ¸…å•å¹¶ä¸æ˜¯åœ¨éƒ¨ç½²ä»»åŠ¡ï¼Œè€Œæ›´å¤šåœ°åƒæ˜¯ç»™å¤§è„‘ä¸€ä¸ªç¼“å­˜è€Œå·²ã€‚</p>
<p>ä»»åŠ¡æ˜¯è¦è¢«æ‰§è¡Œçš„ï¼Œè€Œæ‰§è¡Œå°±éœ€è¦æ‰§è¡Œçš„æ—¶é—´ã€‚å› æ­¤ï¼Œç»™æ¯ä¸€æ¡å¹²å·´å·´çš„é¡¹ç›®æ¡åŠ ä¸Šä¼˜å…ˆçº§å¹¶ä¸”é™„ä¸Šæ‰§è¡Œæ—¶é—´å’ŒæœŸé™æ‰æ˜¯æ¯”è¾ƒç°å®çš„åšæ³•ã€‚åƒä¸‡åˆ«åˆ—äº†å¥½é•¿çš„æ¸…å•ç„¶åå‹¾äº†å‡ ä¸ªæ— è¶³è½»é‡çš„ä»»åŠ¡åæ‰å‘ç°è¿˜æœ‰ä¸€æ ¹ç¡¬éª¨å¤´èººåœ¨ä¸Šé¢ç­‰ä½ è§£å†³ã€‚</p>
<h3 id="é«˜ç«¯è®¾å¤‡å’Œå·¥å…·å¹¶ä¸æ˜¯åˆå­¦è€…åº”è¯¥ç”¨çš„"><a href="#é«˜ç«¯è®¾å¤‡å’Œå·¥å…·å¹¶ä¸æ˜¯åˆå­¦è€…åº”è¯¥ç”¨çš„" class="headerlink" title="é«˜ç«¯è®¾å¤‡å’Œå·¥å…·å¹¶ä¸æ˜¯åˆå­¦è€…åº”è¯¥ç”¨çš„"></a>é«˜ç«¯è®¾å¤‡å’Œå·¥å…·å¹¶ä¸æ˜¯åˆå­¦è€…åº”è¯¥ç”¨çš„</h3><p>äººä»¬éƒ½å–œæ¬¢é«˜ç«¯è®¾å¤‡ï¼Œè®¤ä¸ºâ€œå¥½çš„è£…å¤‡â€æ‰æ˜¯å–èƒœçš„æ³•å®ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼šç»å¸¸ä¼šçœ‹åˆ°ä¸€äº›åˆå­¦è€…å»ä½¿ç”¨èŠ±å“¨çš„æ’ä»¶(ä¸ºäº†èŠ‚çœç¼–ç¨‹æ—¶é—´)ï¼Œä½¿ç”¨ä¸€äº›çœ‹ä¼¼èƒ½æé«˜æ•ˆç‡çš„å·¥å…·ã€‚ä¸€äº›åˆåˆ›å…¬å¸ç½®åŠè±ªåçš„å®¶å…·ï¼Œç»™å‘˜å·¥æä¾›éå¸¸èˆ’é€‚çš„åŠå…¬ç¯å¢ƒã€‚ä½†æ˜¯ï¼Œåˆå­¦è€…ä»¬åº”è¯¥ä»é›¶åšèµ·ï¼Œå…ˆæ‰“å¥½åŸºç¡€ï¼Œè€Œå…¬å¸åº”è¯¥å…³æ³¨çš„æ˜¯æ€æ ·èµ¢å¾—å®¢æˆ·ï¼Œå¦‚ä½•ç›ˆåˆ©ã€‚</p>
<p>ç¬”è€…è‡ªå·±å‡ ä¸ªæœˆå‰éå¸¸æƒ³ç”¨æœºæ¢°é”®ç›˜ï¼Œå› ä¸ºè§‰å¾—è¿™æ˜¯ä¸€ä¸ªç¨‹åºå‘˜åº”è¯¥ç”¨çš„å·¥å…·ã€‚ä½†æ˜¯åæ¥æƒ³æƒ³ï¼Œå¦‚æœæ— æ³•å‡†ç¡®æŠŠæ­£åœ¨ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€çš„å„ç§è¯­å¥å’Œå­—ç¬¦æ‰“å‡ºæ¥ï¼Œè€Œä¸”å…‰æ ‡ä¹Ÿå¾—å¤šæ•°é é¼ æ ‡æ¥ç§»åŠ¨çš„è¯ï¼Œå³ä½¿æ˜¯ç”¨æœºæ¢°é”®ç›˜ï¼Œæ•ˆç‡ä¹Ÿä¸ä¼šæé«˜å¾ˆå¤šã€‚æ‰€ä»¥ç¬”è€…å†³å®šç­‰è‡ªå·±å®Œå…¨ç†Ÿç»ƒè¯­æ³•ä»¥åŠå¯ä»¥å®Œå…¨è„±ç¦»é¼ æ ‡ä¹‹åå†ä½¿ç”¨æœºæ¢°é”®ç›˜ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘è¯»äº†ä¸€äº›å…³äºäº’è”ç½‘æ€ç»´å’Œç®¡ç†çš„ä¸€äº›ä¹¦ç±ï¼Œæ„Ÿè§¦é¢‡æ·±ï¼Œæƒ³ä»å›¢é˜Ÿï¼Œäº§å“ï¼Œå…¬å¸æ–¹å‘å’Œä¸ªäººå‡ ä¸ªæ–¹é¢ï¼Œç»“åˆç¬”è€…çš„ä¸ªäººç»å†åˆ†äº«ä¸€ä¸‹ç¬”è€…çš„æ€è€ƒå’Œæ„Ÿæ‚Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/859001-063cce725ad58f38.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;å›¾ç‰‡æ¥è‡ªï¼šwww.pexels.com&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="BookNote" scheme="https://github.com/knightsj/knightsj.github.io/categories/BookNote/"/>
    
    
      <category term="BookNote" scheme="https://github.com/knightsj/knightsj.github.io/tags/BookNote/"/>
    
      <category term="IT" scheme="https://github.com/knightsj/knightsj.github.io/tags/IT/"/>
    
  </entry>
  
  <entry>
    <title>æ–¯å¦ç¦å¤§å­¦iOSå¼€å‘å…¬å¼€è¯¾æ€»ç»“ï¼ˆåå…«ï¼‰ï¼šå›½é™…åŒ–ï¼Œè‡ªå®šä¹‰è®¾ç½®UI</title>
    <link href="https://github.com/knightsj/knightsj.github.io/2017/01/11/%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%A4%A7%E5%AD%A6iOS%E5%BC%80%E5%8F%91%E5%85%AC%E5%BC%80%E8%AF%BE%E6%80%BB%E7%BB%93%EF%BC%88%E5%8D%81%E5%85%AB%EF%BC%89%EF%BC%9A%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%BE%E7%BD%AEUI/"/>
    <id>https://github.com/knightsj/knightsj.github.io/2017/01/11/æ–¯å¦ç¦å¤§å­¦iOSå¼€å‘å…¬å¼€è¯¾æ€»ç»“ï¼ˆåå…«ï¼‰ï¼šå›½é™…åŒ–ï¼Œè‡ªå®šä¹‰è®¾ç½®UI/</id>
    <published>2017-01-11T07:30:42.000Z</published>
    <updated>2017-03-20T07:55:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡æ˜¯æ–¯å¦ç¦å¤§å­¦iOS7ç³»åˆ—è¯¾ç¨‹ï¼ˆCS193Pï¼‰çš„æœ€åä¸€èŠ‚è¯¾çš„æ€»ç»“ï¼Œç»ˆäºæŠŠ18èŠ‚è¯¾çš„å†…å®¹éƒ½æ€»ç»“å®Œäº†ï¼Œè€Œä¸”è¿™ä¸ªæ–‡é›†ä¹Ÿç”»ä¸Šäº†å¥å·ï¼Œæœ‰ç‚¹ä¸èˆçš„èµ¶è„šã€‚ã€‚</p>
<p>å¥½äº†ï¼Œä¸ç…½æƒ…äº†ï¼Œå¼€å§‹ï¼<br><a id="more"></a></p>
<h1 id="å›½é™…åŒ–-Internationalization"><a href="#å›½é™…åŒ–-Internationalization" class="headerlink" title="å›½é™…åŒ– Internationalization"></a>å›½é™…åŒ– Internationalization</h1><hr>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦å°†appæ¨å¹¿åˆ°å›½é™…å¸‚åœºï¼Œé‚£ä¹ˆå°±å…ä¸äº†å°†æˆ‘ä»¬çš„appç¿»è¯‘æˆå…¶ä»–å›½å®¶çš„è¯­è¨€ä»¥ä¾¿äºå½“åœ°äººå»ä½¿ç”¨ã€‚</p>
<p>è€Œç¿»è¯‘çš„å†…å®¹ä¸»è¦é›†ä¸­äºâ€œéå†…å®¹â€éƒ¨åˆ†ï¼šä¾‹å¦‚æ ‡é¢˜ç±»æ–‡å­—ï¼ŒæŒ‰é’®ä¸Šçš„æ–‡å­—ï¼Œæç¤ºæ¡†çš„æ–‡å­—ç­‰ç­‰ã€‚</p>
<p>æ‰€è°“â€œç¿»è¯‘â€appçš„è¿‡ç¨‹ä¸»è¦åˆ†ä¸º<strong>å›½é™…åŒ–</strong>å’Œ<strong>æœ¬åœ°åŒ–</strong>ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>å›½é™…åŒ–ï¼šæ˜¯è®©appèƒ½å¤Ÿæœ¬åœ°åŒ–çš„è¿‡ç¨‹ã€‚</li>
<li>æœ¬åœ°åŒ–ï¼šå°†ç¨‹åºç¿»è¯‘å¦å¤–ä¸€ç§è¯­è¨€ã€‚<ul>
<li>æ•…äº‹ç‰ˆå­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–ï¼šæ”¹å˜æ•…äº‹ç‰ˆä¸­å‡ºç°çš„å­—ç¬¦ä¸²ã€‚</li>
<li>ç±»æ–‡ä»¶å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–ï¼šæ”¹å˜æ–‡ä»¶ä¸­å‡ºç°çš„å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²é¢é‡å’Œéå­—ç¬¦ä¸²é¢é‡ã€‚</li>
</ul>
</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>å¥½çš„UIè®¾è®¡ï¼šç»™ç”¨æˆ·å‘ˆç°å‡ºçš„å†…å®¹å¤§å¤šæ•°éƒ½éœ€è¦æ˜¾ç¤ºçš„ï¼ˆå†…å®¹ï¼‰ï¼Œè€Œä¸æ˜¯è‡ªå·±æ·»åŠ çš„ï¼ˆæç¤ºï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¹Ÿä¼šå‡å°‘æˆ‘ä»¬æœ¬åœ°åŒ–çš„å·¥ä½œé‡ã€‚</li>
<li>æ‰€æœ‰çš„åœ°æ–¹éƒ½è¦è®¾ç½®å¥½è‡ªåŠ¨å¸ƒå±€ï¼Œå¦åˆ™æœ¬åœ°åŒ–å°†æ— ä»è°ˆèµ·ï¼Œå› ä¸ºå°†æ–‡å­—ç¿»è¯‘æˆå…¶ä»–è¯­è¨€åï¼Œé•¿åº¦å¾ˆå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</li>
</ol>
</blockquote>
<p>ä¸‹é¢æ¥æ¥å…·ä½“çœ‹ä¸€ä¸‹æœ¬åœ°åŒ–çš„æ–¹æ³•ï¼Œåˆ†ä¸º<strong>æ•…äº‹ç‰ˆä¸­å­—ç¬¦ä¸²</strong>çš„æœ¬åœ°åŒ–å’Œ<strong>ç±»æ–‡ä»¶ä¸­å­—ç¬¦ä¸²</strong>çš„æœ¬åœ°åŒ–ã€‚</p>
<h2 id="1-æ•…äº‹ç‰ˆä¸­çš„æœ¬åœ°åŒ–"><a href="#1-æ•…äº‹ç‰ˆä¸­çš„æœ¬åœ°åŒ–" class="headerlink" title="1. æ•…äº‹ç‰ˆä¸­çš„æœ¬åœ°åŒ–"></a>1. æ•…äº‹ç‰ˆä¸­çš„æœ¬åœ°åŒ–</h2><p>åœ¨æ•…äº‹ç‰ˆä¸­æœ¬åœ°åŒ–çš„è¿‡ç¨‹æ˜¯ï¼š</p>
<ol>
<li>åœ¨é¡¹ç›®é‡Œæ·»åŠ å…¶ä»–è¯­è¨€ã€‚</li>
<li>åœ¨è¢«æ·»åŠ è¯­è¨€çš„æ•…äº‹ç‰ˆæ–‡ä»¶ä¸­æ‰¾åˆ°ç›¸åº”çš„.stringæ–‡ä»¶ï¼ŒåŠ ä»¥æ›´æ”¹ã€‚</li>
</ol>
<p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-917657136741d815.gif?imageMogr2/auto-orient/strip" alt="æ•…äº‹ç‰ˆçš„æœ¬åœ°åŒ–.gif"></p>
<h2 id="2-ç±»æ–‡ä»¶ä¸­å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–"><a href="#2-ç±»æ–‡ä»¶ä¸­å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–" class="headerlink" title="2. ç±»æ–‡ä»¶ä¸­å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–"></a>2. ç±»æ–‡ä»¶ä¸­å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–</h2><p>é™¤äº†éœ€è¦æœ¬åœ°åŒ–æ•…äº‹ç‰ˆä¸­çš„å­—ç¬¦ä¸²ï¼Œç±»æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²ä¹Ÿéœ€è¦æœ¬åœ°åŒ–ï¼Œå› ä¸ºæ•…äº‹ç‰ˆå¹¶ä¸èƒ½æ˜¾ç¤ºæ‰€æœ‰éœ€è¦ç¿»è¯‘çš„å­—ç¬¦ä¸²ã€‚</p>
<p>è€Œä¸”ï¼Œç±»æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼š</p>
<ol>
<li>å­—ç¬¦ä¸²é¢é‡ã€‚</li>
<li>éå­—ç¬¦ä¸²é¢é‡ã€‚</li>
</ol>
<p>å­—ç¬¦ä¸²é¢é‡:</p>
<p><code>NSString *myName = @â€œJackâ€;</code></p>
<p>ç±»ä¼¼è¿™æ ·çš„å­—ç¬¦ä¸²æ˜¯æ¯”è¾ƒå¥½æ‰¾çš„ï¼Œåªéœ€è¦æœç´¢<code>@</code>å³å¯å¾ˆå®¹æ˜“æ‰¾åˆ°ã€‚<br>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šé€šè¿‡è¯¥æ–¹æ³•æœç´¢åˆ°ä¸åº”è¯¥æœ¬åœ°åŒ–çš„å­—ç¬¦ä¸²ï¼š<br>ä¹Ÿå°±æ˜¯ä¸å‡ºç°åœ¨UIä¸­çš„å­—ç¬¦ä¸²é¢é‡ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>æ–‡ä»¶æ‰©å±•å</li>
<li>segureçš„identifier</li>
<li>stiringWithFormat:</li>
</ul>
<h4 id="2-1å­—ç¬¦ä¸²é¢é‡çš„æœ¬åœ°åŒ–æ­¥éª¤ï¼š"><a href="#2-1å­—ç¬¦ä¸²é¢é‡çš„æœ¬åœ°åŒ–æ­¥éª¤ï¼š" class="headerlink" title="2.1å­—ç¬¦ä¸²é¢é‡çš„æœ¬åœ°åŒ–æ­¥éª¤ï¼š"></a>2.1å­—ç¬¦ä¸²é¢é‡çš„æœ¬åœ°åŒ–æ­¥éª¤ï¼š</h4><ol>
<li>æ‰¾åˆ°éœ€è¦æœ¬åœ°åŒ–çš„å­—ç¬¦ä¸²é¢é‡ã€‚</li>
<li>é€šè¿‡å®ï¼Œå°†å­—ç¬¦ä¸²é¢é‡æ·»åŠ åˆ°è¡¨ä¸­ã€‚</li>
<li>åˆ›å»ºè¡¨çš„.stringæ–‡ä»¶ã€‚</li>
<li>æœ¬åœ°åŒ–.stringæ–‡ä»¶</li>
</ol>
<p>ï»¿<br>1.æ‰¾åˆ° <code>@&quot;Sorry, this device cannot add a photo.&quot;</code> å­—ç¬¦ä¸²é¢é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidAppear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">    [super viewDidAppear:animated];</div><div class="line">    if (![[self class] canAddPhoto]) &#123;</div><div class="line">        [self fatalAlert:@&quot;Sorry, this device cannot add a photo.&quot;]; //</div><div class="line">    &#125; else &#123;</div><div class="line">        [self.locationManager startUpdatingLocation];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.é€šè¿‡å®ï¼Œå°†å­—ç¬¦ä¸²é¢é‡æ·»åŠ åˆ°è¡¨ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidAppear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">   [super viewDidAppear: animated];</div><div class="line">   </div><div class="line">   if (![[self class] canAddPhoto]) &#123;</div><div class="line">       [self fatalAlert:ALERT_CANT_ADD_PHOTO]; // @&quot;Sorry, this device cannot add a photo.&quot;</div><div class="line">   &#125; else &#123;</div><div class="line">       [self.locationManager startUpdatingLocation];</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define ALERT_CANT_ADD_PHOTO NSLocalizedStringFromTable(@&quot;ALERT_CANT_ADD_PHOTO&quot;, @&quot;AddPhotoViewController&quot;, @&quot;Alert message delivered when there is something that prevents the user from adding a new photo to the database that the user can do nothing about.&quot;)</div></pre></td></tr></table></figure>
<p>3.åˆ›å»ºè¡¨çš„.stringæ–‡ä»¶</p>
<p>æˆ‘ä»¬å·²ç»åœ¨AddPhotoViewController.mæ–‡ä»¶é‡Œå°†éœ€è¦æœ¬åœ°åŒ–çš„å­—ç¬¦ä¸²æ·»åŠ åˆ°äº†å«åšAddPhotoViewControllerçš„è¡¨é‡Œï¼Œä¸‹é¢å°±éœ€è¦ç”¨å‘½ä»¤è¡Œå·¥å…·æ‰¾åˆ°è¯¥.mæ–‡ä»¶ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-a043fa2da855615c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰¾åˆ°.mæ–‡ä»¶æ‰€åœ¨ç›®å½•"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-b3adf539663b1269.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¾“å…¥genstrigns ^*må‘½ä»¤"></p>
<p>4.æœ¬åœ°åŒ–.stringæ–‡ä»¶</p>
<p>åœ¨ç¬¬ä¸‰æ­¥ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»º<code>AddPhotoViewController</code>è¡¨çš„.stringæ–‡ä»¶ï¼Œç„¶ååœ¨æ–‡ä»¶å†…éƒ¨å°†å¯¹åº”çš„keyè¿›è¡Œç¿»è¯‘ã€‚å› ä¸ºè¿‡ç¨‹ç•¥ç¹çï¼Œæ‰€ä»¥ä»¥åŠ¨å›¾çš„å½¢å¼å‘ˆçŒ®ç»™å¤§å®¶ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-100dfbddbe7399bb.gif?imageMogr2/auto-orient/strip" alt="æœ¬åœ°åŒ–string.gif"></p>
<blockquote>
<p>å¤±è¯¯äº†ï¼Œå³ä¾§çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯æ²¡æœ‰â€œ@â€çš„ï¼Œå¤§å®¶æ³¨æ„ã€‚å› ä¸ºåˆ°æœ€åæ‰å‘ç°çš„ï¼Œä¸å¥½æ”¹äº† é¢ã€‚ã€‚ ç†è§£ä¸‡å²ã€‚ã€‚</p>
</blockquote>
<h2 id="2-2-éå­—é¢é‡å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–ï¼š"><a href="#2-2-éå­—é¢é‡å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–ï¼š" class="headerlink" title="2.2 éå­—é¢é‡å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–ï¼š"></a>2.2 éå­—é¢é‡å­—ç¬¦ä¸²çš„æœ¬åœ°åŒ–ï¼š</h2><p>åœ¨ç±»æ–‡ä»¶é‡Œï¼Œæœ‰äº›æ˜¾ç¤ºå‡ºæ¥çš„å­—ç¬¦ä¸²å¹¶ä¸éƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²é¢é‡èµ‹å€¼çš„ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<p><code>self.title = newfrc.fetchRequest.entity.name;</code></p>
<p>åœ¨è¿™é‡Œï¼Œtitleå–çš„æ˜¯æ¨¡å‹é‡Œçš„å­—æ®µï¼Œå¹¶æ²¡æœ‰ç”¨å­—é¢é‡è¯­æ³•æ¥è¡¨ç¤ºã€‚<br>å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ç”¨NSBundleçš„<code>localizedStringForKey:value:table:</code>æ–¹æ³•æ¥è¿›è¡Œæœ¬åœ°åŒ–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">self.title = [[NSBundle mainBundle] localizedStringForKey:newfrc.fetchRequest.entity.name</div><div class="line">                         value:newfrc.fetchRequest.entity.name     </div><div class="line">                         table:@&quot;Entities&quot;];</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±ç”Ÿæˆäº†å¯¹åº”åå­—å«<strong>Entities</strong>çš„è¡¨çš„æ˜ å°„ã€‚ä½†æ˜¯è¿™å¼ è¡¨å¯¹åº”çš„.stringæ–‡ä»¶è¿˜æ²¡æœ‰ç”Ÿæˆï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»ç”Ÿæˆï¼Œå¹¶è®¾ç½®å¯¹åº”çš„keyå’Œvalueã€‚ç”Ÿæˆæ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-965d85e9b008d0c8.gif?imageMogr2/auto-orient/strip" alt="æ‰‹åŠ¨ç”Ÿæˆ.stringæ–‡ä»¶"></p>
<h1 id="è®¾ç½®é¡µçš„UI"><a href="#è®¾ç½®é¡µçš„UI" class="headerlink" title="è®¾ç½®é¡µçš„UI"></a>è®¾ç½®é¡µçš„UI</h1><hr>
<p>åœ¨è‹¹æœç³»ç»Ÿçš„è®¾ç½®é‡Œï¼Œä¼šæœ‰æˆ‘ä»¬è£…å…¥çš„appçš„ä¿¡æ¯å’Œè®¾ç½®ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸€äº›è®¾ç½®é€‰é¡¹æ”¾åœ¨è¿™é‡Œé¢ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚</p>
<p>è€Œè¿™é‡Œçš„UIæ˜¯é€šè¿‡é€šè¿‡Settings bundleæ¥è®¾å®šçš„ã€‚æˆ‘ä»¬é¦–å…ˆè¦æ–°å»ºä¸€ä¸ªSettings Bundle:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-d49a21d343306156.gif?imageMogr2/auto-orient/strip" alt="åˆ›å»ºSettings Bundle"></p>
<p>åˆ›å»ºæˆåŠŸåï¼Œåˆ†åˆ«æœ‰ä¸€ä¸ªsliderï¼Œswitchï¼Œå’Œtextfieldæ¥å¯¹åº”è®¾ç½®é¡µé‡Œçš„UIã€‚</p>
<p>åœ¨è®¾ç½®é¡µé‡Œçš„æ ·å­æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-6dc1b24f8d070871.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»ºçš„Settings Bundle åçš„è®¾ç½®é¡µæ•ˆæœ"></p>
<p>é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿæˆ‘ä»¬è®¾ç½®ä¸€ä¸‹ä¸Šä¸€èŠ‚è¯¾çš„Bouncer Demoçš„å¼¹æ€§ç³»æ•°ï¼šè®©ç”¨æˆ·é€šè¿‡è°ƒèŠ‚è®¾ç½®é‡Œçš„slideræ¥è°ƒæ•´appé‡Œçš„å¼¹æ€§ç³»æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)resetElasticity</div><div class="line">&#123;</div><div class="line">    //è¿æ¥ä»£ç ä¸Setting Bundle</div><div class="line">    NSNumber *elasticity = [[NSUserDefaults standardUserDefaults] valueForKey:@&quot;Setting_Elasticity&quot;];//è¿æ¥setting bundle</div><div class="line">    if (elasticity) &#123;</div><div class="line">        //å¦‚æœæœ‰ï¼Œå°±å–å½“å‰è®¾å®šçš„</div><div class="line">        self.elastic.elasticity = [elasticity floatValue];</div><div class="line">    &#125; else &#123;</div><div class="line">        //å¦‚æœæ²¡æœ‰ï¼Œå°±è®¾ç½®ä¸º1</div><div class="line">        self.elastic.elasticity = 1.0;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œé€šè¿‡<code>valueForKey</code>çš„é”®å€¼å¯¹åº”äº†Setting Bundle plist æ–‡ä»¶é‡Œçš„<code>identifier</code>ï¼Œæˆ‘ä»¬å°†plistæ–‡ä»¶é‡Œçš„<code>identifier</code>ä¿®æ”¹æˆäº†<code>Setting_Elasticity</code>è€Œä¸”æ›´æ”¹äº†<code>Title</code>ï¼Œè€Œä¸”å°†æŒ‰é’®å’Œæ–‡æœ¬æ¡†åˆ é™¤æ‰ï¼Œåªä¿ç•™äº†sliderï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-f195429739d8262b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Setting Bundle plist"></p>
<p>æ‰€å¯¹åº”çš„è®¾ç½®é¡µçš„UIï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-1d15dcab18d5df94.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°çš„è®¾ç½®é¡µUI"></p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡identifierè¿æ¥äº†ä»£ç å’Œplistæ–‡ä»¶ï¼Œè·å–åˆ°äº†é”®å¯¹åº”çš„å€¼ã€‚</p>
<p>è€Œä¸”ï¼Œæˆ‘ä»¬è¿˜éœ€è€ƒè™‘åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è·³è½¬åˆ°äº†è®¾ç½®é¡µé¢æ¥è®¾ç½®å¼¹æ€§ç³»æ•°çš„æƒ…å†µã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬ç”¨æˆ·æ˜¯å¦æ›´æ”¹äº†è®¾ç½®é‡Œçš„é€‰é¡¹ï¼š</p>
<p>ç›‘å¬ç”¨æˆ·åœ¨è®¾ç½®ä¸­çš„è¡Œä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter] addObserverForName:NSUserDefaultsDidChangeNotification</div><div class="line">                                                  object:nil</div><div class="line">                                                   queue:nil</div><div class="line">                                              usingBlock:^(NSNotification *note) &#123;</div><div class="line">                                                  [self resetElasticity];</div><div class="line">                                              &#125;];</div></pre></td></tr></table></figure>
<h1 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h1><hr>
<p>å½“~å½“~å½“~å½“~ï¼<br>ç¬”è€…ç»ˆäºåˆ©ç”¨äº†2ä¸ªæœˆçš„éƒ¨åˆ†ä¸šä½™æ—¶é—´æ€»ç»“äº†æ‰€æœ‰æ–¯å¦ç¦iOS7çš„è¯¾ç¨‹å’Œç›¸å…³Demoã€‚é€šè¿‡ä»¥åšå®¢çš„å½¢å¼æ€»ç»“ï¼Œæ›´åŠ åŠ æ·±äº†å¯¹çŸ¥è¯†çš„ç†è§£å’Œè®¤è¯†ï¼Œä¹Ÿå¯¹åŸºç¡€çŸ¥è¯†è¿›è¡Œäº†ä¸€æ¬¡æŸ¥ç¼ºè¡¥æ¼ï¼Œæˆ–è®¸ä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šç»™å…¶ä»–çœ‹åˆ°è¿™äº›åšå®¢çš„åŒä»ä»¬ä¸€äº›å¸®åŠ©å§~</p>
<p>æœ€åé™„ä¸Šè¿™ä¸€ç³»åˆ—ç¬”è€…æ€»ç»“çš„æ‰€æœ‰Demoåœ¨GitHubä¸Šçš„åœ°å€ï¼š<a href="https://github.com/Shijie0111/Stanford_iOS_Lecture_DemoBundle">Stanford_iOS_Lecture_DemoBundle</a>ã€‚</p>
<p>ç¬”è€…ä¸‹ä¸€é˜¶æ®µåº”è¯¥æ˜¯æ€»ç»“ä¸‹é¢ä¸¤æœ¬ä¹¦çš„å†…å®¹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-0eeac0652f909c84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Effective Objective- C 2.0"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/859001-c1046257878a01d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Swift åŸºç¡€æ•™ç¨‹"></p>
<p>è¿™ä¸¤æœ¬ä¹¦ç¬”è€…éƒ½å·²ç»çœ‹äº†3åˆ†ä¹‹ä¸€ï¼Œå› ä¸ºè¦æ€»ç»“å½’çº³ï¼Œæ‰€ä»¥åº”è¯¥è¿›åº¦ä¸æ˜¯å¾ˆå¿«ï¼Œä¸è¿‡è¿˜æ˜¯ä¼šåšæŒå†™åšå®¢çš„ï¼</p>
<p>åŠ æ²¹~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬ç¯‡æ˜¯æ–¯å¦ç¦å¤§å­¦iOS7ç³»åˆ—è¯¾ç¨‹ï¼ˆCS193Pï¼‰çš„æœ€åä¸€èŠ‚è¯¾çš„æ€»ç»“ï¼Œç»ˆäºæŠŠ18èŠ‚è¯¾çš„å†…å®¹éƒ½æ€»ç»“å®Œäº†ï¼Œè€Œä¸”è¿™ä¸ªæ–‡é›†ä¹Ÿç”»ä¸Šäº†å¥å·ï¼Œæœ‰ç‚¹ä¸èˆçš„èµ¶è„šã€‚ã€‚&lt;/p&gt;
&lt;p&gt;å¥½äº†ï¼Œä¸ç…½æƒ…äº†ï¼Œå¼€å§‹ï¼&lt;br&gt;
    
    </summary>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/categories/Objective-C/"/>
    
    
      <category term="iOS" scheme="https://github.com/knightsj/knightsj.github.io/tags/iOS/"/>
    
      <category term="Objective-C" scheme="https://github.com/knightsj/knightsj.github.io/tags/Objective-C/"/>
    
  </entry>
  
</feed>
